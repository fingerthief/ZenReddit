var OT=Object.defineProperty;var PT=(t,e,n)=>e in t?OT(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var kc=(t,e,n)=>PT(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();var eu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yu(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var _x={exports:{}},qu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FT=Symbol.for("react.transitional.element"),BT=Symbol.for("react.fragment");function Lx(t,e,n){var i=null;if(n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),"key"in e){n={};for(var s in e)s!=="key"&&(n[s]=e[s])}else n=e;return e=n.ref,{$$typeof:FT,type:t,key:i,ref:e!==void 0?e:null,props:n}}qu.Fragment=BT;qu.jsx=Lx;qu.jsxs=Lx;_x.exports=qu;var g=_x.exports,Rx={exports:{}},me={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ch=Symbol.for("react.transitional.element"),UT=Symbol.for("react.portal"),jT=Symbol.for("react.fragment"),$T=Symbol.for("react.strict_mode"),zT=Symbol.for("react.profiler"),GT=Symbol.for("react.consumer"),HT=Symbol.for("react.context"),VT=Symbol.for("react.forward_ref"),KT=Symbol.for("react.suspense"),YT=Symbol.for("react.memo"),wx=Symbol.for("react.lazy"),qT=Symbol.for("react.activity"),R0=Symbol.iterator;function XT(t){return t===null||typeof t!="object"?null:(t=R0&&t[R0]||t["@@iterator"],typeof t=="function"?t:null)}var Cx={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ix=Object.assign,Dx={};function ia(t,e,n){this.props=t,this.context=e,this.refs=Dx,this.updater=n||Cx}ia.prototype.isReactComponent={};ia.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ia.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Nx(){}Nx.prototype=ia.prototype;function Ih(t,e,n){this.props=t,this.context=e,this.refs=Dx,this.updater=n||Cx}var Dh=Ih.prototype=new Nx;Dh.constructor=Ih;Ix(Dh,ia.prototype);Dh.isPureReactComponent=!0;var w0=Array.isArray;function Wd(){}var Qe={H:null,A:null,T:null,S:null},Mx=Object.prototype.hasOwnProperty;function Nh(t,e,n){var i=n.ref;return{$$typeof:Ch,type:t,key:e,ref:i!==void 0?i:null,props:n}}function QT(t,e){return Nh(t.type,e,t.props)}function Mh(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ch}function WT(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var C0=/\/+/g;function _c(t,e){return typeof t=="object"&&t!==null&&t.key!=null?WT(""+t.key):e.toString(36)}function ZT(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Wd,Wd):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function hr(t,e,n,i,s){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(r){case"bigint":case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Ch:case UT:a=!0;break;case wx:return a=t._init,hr(a(t._payload),e,n,i,s)}}if(a)return s=s(t),a=i===""?"."+_c(t,0):i,w0(s)?(n="",a!=null&&(n=a.replace(C0,"$&/")+"/"),hr(s,e,n,"",function(u){return u})):s!=null&&(Mh(s)&&(s=QT(s,n+(s.key==null||t&&t.key===s.key?"":(""+s.key).replace(C0,"$&/")+"/")+a)),e.push(s)),1;a=0;var l=i===""?".":i+":";if(w0(t))for(var o=0;o<t.length;o++)i=t[o],r=l+_c(i,o),a+=hr(i,e,n,r,s);else if(o=XT(t),typeof o=="function")for(t=o.call(t),o=0;!(i=t.next()).done;)i=i.value,r=l+_c(i,o++),a+=hr(i,e,n,r,s);else if(r==="object"){if(typeof t.then=="function")return hr(ZT(t),e,n,i,s);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function Gl(t,e,n){if(t==null)return t;var i=[],s=0;return hr(t,i,"","",function(r){return e.call(n,r,s++)}),i}function JT(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var I0=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},eA={map:Gl,forEach:function(t,e,n){Gl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Gl(t,function(){e++}),e},toArray:function(t){return Gl(t,function(e){return e})||[]},only:function(t){if(!Mh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};me.Activity=qT;me.Children=eA;me.Component=ia;me.Fragment=jT;me.Profiler=zT;me.PureComponent=Ih;me.StrictMode=$T;me.Suspense=KT;me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Qe;me.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Qe.H.useMemoCache(t)}};me.cache=function(t){return function(){return t.apply(null,arguments)}};me.cacheSignal=function(){return null};me.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var i=Ix({},t.props),s=t.key;if(e!=null)for(r in e.key!==void 0&&(s=""+e.key),e)!Mx.call(e,r)||r==="key"||r==="__self"||r==="__source"||r==="ref"&&e.ref===void 0||(i[r]=e[r]);var r=arguments.length-2;if(r===1)i.children=n;else if(1<r){for(var a=Array(r),l=0;l<r;l++)a[l]=arguments[l+2];i.children=a}return Nh(t.type,s,i)};me.createContext=function(t){return t={$$typeof:HT,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:GT,_context:t},t};me.createElement=function(t,e,n){var i,s={},r=null;if(e!=null)for(i in e.key!==void 0&&(r=""+e.key),e)Mx.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(s[i]=e[i]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),o=0;o<a;o++)l[o]=arguments[o+2];s.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return Nh(t,r,s)};me.createRef=function(){return{current:null}};me.forwardRef=function(t){return{$$typeof:VT,render:t}};me.isValidElement=Mh;me.lazy=function(t){return{$$typeof:wx,_payload:{_status:-1,_result:t},_init:JT}};me.memo=function(t,e){return{$$typeof:YT,type:t,compare:e===void 0?null:e}};me.startTransition=function(t){var e=Qe.T,n={};Qe.T=n;try{var i=t(),s=Qe.S;s!==null&&s(n,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(Wd,I0)}catch(r){I0(r)}finally{e!==null&&n.types!==null&&(e.types=n.types),Qe.T=e}};me.unstable_useCacheRefresh=function(){return Qe.H.useCacheRefresh()};me.use=function(t){return Qe.H.use(t)};me.useActionState=function(t,e,n){return Qe.H.useActionState(t,e,n)};me.useCallback=function(t,e){return Qe.H.useCallback(t,e)};me.useContext=function(t){return Qe.H.useContext(t)};me.useDebugValue=function(){};me.useDeferredValue=function(t,e){return Qe.H.useDeferredValue(t,e)};me.useEffect=function(t,e){return Qe.H.useEffect(t,e)};me.useEffectEvent=function(t){return Qe.H.useEffectEvent(t)};me.useId=function(){return Qe.H.useId()};me.useImperativeHandle=function(t,e,n){return Qe.H.useImperativeHandle(t,e,n)};me.useInsertionEffect=function(t,e){return Qe.H.useInsertionEffect(t,e)};me.useLayoutEffect=function(t,e){return Qe.H.useLayoutEffect(t,e)};me.useMemo=function(t,e){return Qe.H.useMemo(t,e)};me.useOptimistic=function(t,e){return Qe.H.useOptimistic(t,e)};me.useReducer=function(t,e,n){return Qe.H.useReducer(t,e,n)};me.useRef=function(t){return Qe.H.useRef(t)};me.useState=function(t){return Qe.H.useState(t)};me.useSyncExternalStore=function(t,e,n){return Qe.H.useSyncExternalStore(t,e,n)};me.useTransition=function(){return Qe.H.useTransition()};me.version="19.2.3";Rx.exports=me;var P=Rx.exports;const Ll=Yu(P);var Ox={exports:{}},Xu={},Px={exports:{}},Fx={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,j){var U=D.length;D.push(j);e:for(;0<U;){var q=U-1>>>1,R=D[q];if(0<s(R,j))D[q]=j,D[U]=R,U=q;else break e}}function n(D){return D.length===0?null:D[0]}function i(D){if(D.length===0)return null;var j=D[0],U=D.pop();if(U!==j){D[0]=U;e:for(var q=0,R=D.length,F=R>>>1;q<F;){var B=2*(q+1)-1,T=D[B],Y=B+1,X=D[Y];if(0>s(T,U))Y<R&&0>s(X,T)?(D[q]=X,D[Y]=U,q=Y):(D[q]=T,D[B]=U,q=B);else if(Y<R&&0>s(X,U))D[q]=X,D[Y]=U,q=Y;else break e}}return j}function s(D,j){var U=D.sortIndex-j.sortIndex;return U!==0?U:D.id-j.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var o=[],u=[],c=1,d=null,f=3,h=!1,m=!1,y=!1,x=!1,p=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function E(D){for(var j=n(u);j!==null;){if(j.callback===null)i(u);else if(j.startTime<=D)i(u),j.sortIndex=j.expirationTime,e(o,j);else break;j=n(u)}}function k(D){if(y=!1,E(D),!m)if(n(o)!==null)m=!0,_||(_=!0,N());else{var j=n(u);j!==null&&$(k,j.startTime-D)}}var _=!1,L=-1,C=5,w=-1;function A(){return x?!0:!(t.unstable_now()-w<C)}function I(){if(x=!1,_){var D=t.unstable_now();w=D;var j=!0;try{e:{m=!1,y&&(y=!1,v(L),L=-1),h=!0;var U=f;try{t:{for(E(D),d=n(o);d!==null&&!(d.expirationTime>D&&A());){var q=d.callback;if(typeof q=="function"){d.callback=null,f=d.priorityLevel;var R=q(d.expirationTime<=D);if(D=t.unstable_now(),typeof R=="function"){d.callback=R,E(D),j=!0;break t}d===n(o)&&i(o),E(D)}else i(o);d=n(o)}if(d!==null)j=!0;else{var F=n(u);F!==null&&$(k,F.startTime-D),j=!1}}break e}finally{d=null,f=U,h=!1}j=void 0}}finally{j?N():_=!1}}}var N;if(typeof b=="function")N=function(){b(I)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,G=V.port2;V.port1.onmessage=I,N=function(){G.postMessage(null)}}else N=function(){p(I,0)};function $(D,j){L=p(function(){D(t.unstable_now())},j)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(D){switch(f){case 1:case 2:case 3:var j=3;break;default:j=f}var U=f;f=j;try{return D()}finally{f=U}},t.unstable_requestPaint=function(){x=!0},t.unstable_runWithPriority=function(D,j){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var U=f;f=D;try{return j()}finally{f=U}},t.unstable_scheduleCallback=function(D,j,U){var q=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?q+U:q):U=q,D){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=U+R,D={id:c++,callback:j,priorityLevel:D,startTime:U,expirationTime:R,sortIndex:-1},U>q?(D.sortIndex=U,e(u,D),n(o)===null&&D===n(u)&&(y?(v(L),L=-1):y=!0,$(k,U-q))):(D.sortIndex=R,e(o,D),m||h||(m=!0,_||(_=!0,N()))),D},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(D){var j=f;return function(){var U=f;f=j;try{return D.apply(this,arguments)}finally{f=U}}}})(Fx);Px.exports=Fx;var tA=Px.exports,Bx={exports:{}},Gt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nA=P;function Ux(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function ji(){}var $t={d:{f:ji,r:function(){throw Error(Ux(522))},D:ji,C:ji,L:ji,m:ji,X:ji,S:ji,M:ji},p:0,findDOMNode:null},iA=Symbol.for("react.portal");function sA(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:iA,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}var Oa=nA.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Qu(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Gt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$t;Gt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(Ux(299));return sA(t,e,null,n)};Gt.flushSync=function(t){var e=Oa.T,n=$t.p;try{if(Oa.T=null,$t.p=2,t)return t()}finally{Oa.T=e,$t.p=n,$t.d.f()}};Gt.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,$t.d.C(t,e))};Gt.prefetchDNS=function(t){typeof t=="string"&&$t.d.D(t)};Gt.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,i=Qu(n,e.crossOrigin),s=typeof e.integrity=="string"?e.integrity:void 0,r=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?$t.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:s,fetchPriority:r}):n==="script"&&$t.d.X(t,{crossOrigin:i,integrity:s,fetchPriority:r,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Gt.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=Qu(e.as,e.crossOrigin);$t.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&$t.d.M(t)};Gt.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,i=Qu(n,e.crossOrigin);$t.d.L(t,n,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Gt.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=Qu(e.as,e.crossOrigin);$t.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else $t.d.m(t)};Gt.requestFormReset=function(t){$t.d.r(t)};Gt.unstable_batchedUpdates=function(t,e){return t(e)};Gt.useFormState=function(t,e,n){return Oa.H.useFormState(t,e,n)};Gt.useFormStatus=function(){return Oa.H.useHostTransitionStatus()};Gt.version="19.2.3";function jx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jx)}catch(t){console.error(t)}}jx(),Bx.exports=Gt;var rA=Bx.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Et=tA,$x=P,aA=rA;function K(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function zx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Rl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Gx(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Hx(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function D0(t){if(Rl(t)!==t)throw Error(K(188))}function lA(t){var e=t.alternate;if(!e){if(e=Rl(t),e===null)throw Error(K(188));return e!==t?null:t}for(var n=t,i=e;;){var s=n.return;if(s===null)break;var r=s.alternate;if(r===null){if(i=s.return,i!==null){n=i;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===n)return D0(s),t;if(r===i)return D0(s),e;r=r.sibling}throw Error(K(188))}if(n.return!==i.return)n=s,i=r;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,i=r;break}if(l===i){a=!0,i=s,n=r;break}l=l.sibling}if(!a){for(l=r.child;l;){if(l===n){a=!0,n=r,i=s;break}if(l===i){a=!0,i=r,n=s;break}l=l.sibling}if(!a)throw Error(K(189))}}if(n.alternate!==i)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?t:e}function Vx(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=Vx(t),e!==null)return e;t=t.sibling}return null}var We=Object.assign,oA=Symbol.for("react.element"),Hl=Symbol.for("react.transitional.element"),wa=Symbol.for("react.portal"),xr=Symbol.for("react.fragment"),Kx=Symbol.for("react.strict_mode"),Zd=Symbol.for("react.profiler"),Yx=Symbol.for("react.consumer"),ki=Symbol.for("react.context"),Oh=Symbol.for("react.forward_ref"),Jd=Symbol.for("react.suspense"),ef=Symbol.for("react.suspense_list"),Ph=Symbol.for("react.memo"),Hi=Symbol.for("react.lazy"),tf=Symbol.for("react.activity"),uA=Symbol.for("react.memo_cache_sentinel"),N0=Symbol.iterator;function ga(t){return t===null||typeof t!="object"?null:(t=N0&&t[N0]||t["@@iterator"],typeof t=="function"?t:null)}var cA=Symbol.for("react.client.reference");function nf(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===cA?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case xr:return"Fragment";case Zd:return"Profiler";case Kx:return"StrictMode";case Jd:return"Suspense";case ef:return"SuspenseList";case tf:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case wa:return"Portal";case ki:return t.displayName||"Context";case Yx:return(t._context.displayName||"Context")+".Consumer";case Oh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ph:return e=t.displayName||null,e!==null?e:nf(t.type)||"Memo";case Hi:e=t._payload,t=t._init;try{return nf(t(e))}catch{}}return null}var Ca=Array.isArray,ce=$x.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,De=aA.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Os={pending:!1,data:null,method:null,action:null},sf=[],vr=-1;function di(t){return{current:t}}function _t(t){0>vr||(t.current=sf[vr],sf[vr]=null,vr--)}function Ye(t,e){vr++,sf[vr]=t.current,t.current=e}var oi=di(null),tl=di(null),is=di(null),tu=di(null);function nu(t,e){switch(Ye(is,e),Ye(tl,t),Ye(oi,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?Ug(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=Ug(e),t=h1(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}_t(oi),Ye(oi,t)}function Gr(){_t(oi),_t(tl),_t(is)}function rf(t){t.memoizedState!==null&&Ye(tu,t);var e=oi.current,n=h1(e,t.type);e!==n&&(Ye(tl,t),Ye(oi,n))}function iu(t){tl.current===t&&(_t(oi),_t(tl)),tu.current===t&&(_t(tu),fl._currentValue=Os)}var Lc,M0;function ws(t){if(Lc===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Lc=e&&e[1]||"",M0=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Lc+t+M0}var Rc=!1;function wc(t,e){if(!t||Rc)return"";Rc=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var d=function(){throw Error()};if(Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(h){var f=h}Reflect.construct(t,[],d)}else{try{d.call()}catch(h){f=h}t.call(d.prototype)}}else{try{throw Error()}catch(h){f=h}(d=t())&&typeof d.catch=="function"&&d.catch(function(){})}}catch(h){if(h&&f&&typeof h.stack=="string")return[h.stack,f.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var s=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");s&&s.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=i.DetermineComponentFrameRoot(),a=r[0],l=r[1];if(a&&l){var o=a.split(`
`),u=l.split(`
`);for(s=i=0;i<o.length&&!o[i].includes("DetermineComponentFrameRoot");)i++;for(;s<u.length&&!u[s].includes("DetermineComponentFrameRoot");)s++;if(i===o.length||s===u.length)for(i=o.length-1,s=u.length-1;1<=i&&0<=s&&o[i]!==u[s];)s--;for(;1<=i&&0<=s;i--,s--)if(o[i]!==u[s]){if(i!==1||s!==1)do if(i--,s--,0>s||o[i]!==u[s]){var c=`
`+o[i].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=i&&0<=s);break}}}finally{Rc=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?ws(n):""}function dA(t,e){switch(t.tag){case 26:case 27:case 5:return ws(t.type);case 16:return ws("Lazy");case 13:return t.child!==e&&e!==null?ws("Suspense Fallback"):ws("Suspense");case 19:return ws("SuspenseList");case 0:case 15:return wc(t.type,!1);case 11:return wc(t.type.render,!1);case 1:return wc(t.type,!0);case 31:return ws("Activity");default:return""}}function O0(t){try{var e="",n=null;do e+=dA(t,n),n=t,t=t.return;while(t);return e}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var af=Object.prototype.hasOwnProperty,Fh=Et.unstable_scheduleCallback,Cc=Et.unstable_cancelCallback,fA=Et.unstable_shouldYield,hA=Et.unstable_requestPaint,xn=Et.unstable_now,mA=Et.unstable_getCurrentPriorityLevel,qx=Et.unstable_ImmediatePriority,Xx=Et.unstable_UserBlockingPriority,su=Et.unstable_NormalPriority,gA=Et.unstable_LowPriority,Qx=Et.unstable_IdlePriority,pA=Et.log,yA=Et.unstable_setDisableYieldValue,wl=null,vn=null;function Zi(t){if(typeof pA=="function"&&yA(t),vn&&typeof vn.setStrictMode=="function")try{vn.setStrictMode(wl,t)}catch{}}var bn=Math.clz32?Math.clz32:bA,xA=Math.log,vA=Math.LN2;function bA(t){return t>>>=0,t===0?32:31-(xA(t)/vA|0)|0}var Vl=256,Kl=262144,Yl=4194304;function Cs(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Wu(t,e,n){var i=t.pendingLanes;if(i===0)return 0;var s=0,r=t.suspendedLanes,a=t.pingedLanes;t=t.warmLanes;var l=i&134217727;return l!==0?(i=l&~r,i!==0?s=Cs(i):(a&=l,a!==0?s=Cs(a):n||(n=l&~t,n!==0&&(s=Cs(n))))):(l=i&~r,l!==0?s=Cs(l):a!==0?s=Cs(a):n||(n=i&~t,n!==0&&(s=Cs(n)))),s===0?0:e!==0&&e!==s&&!(e&r)&&(r=s&-s,n=e&-e,r>=n||r===32&&(n&4194048)!==0)?e:s}function Cl(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function SA(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Wx(){var t=Yl;return Yl<<=1,!(Yl&62914560)&&(Yl=4194304),t}function Ic(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Il(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function EA(t,e,n,i,s,r){var a=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var l=t.entanglements,o=t.expirationTimes,u=t.hiddenUpdates;for(n=a&~n;0<n;){var c=31-bn(n),d=1<<c;l[c]=0,o[c]=-1;var f=u[c];if(f!==null)for(u[c]=null,c=0;c<f.length;c++){var h=f[c];h!==null&&(h.lane&=-536870913)}n&=~d}i!==0&&Zx(t,i,0),r!==0&&s===0&&t.tag!==0&&(t.suspendedLanes|=r&~(a&~e))}function Zx(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var i=31-bn(e);t.entangledLanes|=e,t.entanglements[i]=t.entanglements[i]|1073741824|n&261930}function Jx(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-bn(n),s=1<<i;s&e|t[i]&e&&(t[i]|=e),n&=~s}}function ev(t,e){var n=e&-e;return n=n&42?1:Bh(n),n&(t.suspendedLanes|e)?0:n}function Bh(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Uh(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function tv(){var t=De.p;return t!==0?t:(t=window.event,t===void 0?32:A1(t.type))}function P0(t,e){var n=De.p;try{return De.p=t,e()}finally{De.p=n}}var bs=Math.random().toString(36).slice(2),It="__reactFiber$"+bs,Jt="__reactProps$"+bs,sa="__reactContainer$"+bs,lf="__reactEvents$"+bs,TA="__reactListeners$"+bs,AA="__reactHandles$"+bs,F0="__reactResources$"+bs,Dl="__reactMarker$"+bs;function jh(t){delete t[It],delete t[Jt],delete t[lf],delete t[TA],delete t[AA]}function br(t){var e=t[It];if(e)return e;for(var n=t.parentNode;n;){if(e=n[sa]||n[It]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Hg(t);t!==null;){if(n=t[It])return n;t=Hg(t)}return e}t=n,n=t.parentNode}return null}function ra(t){if(t=t[It]||t[sa]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function Ia(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(K(33))}function Ir(t){var e=t[F0];return e||(e=t[F0]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function kt(t){t[Dl]=!0}var nv=new Set,iv={};function Ws(t,e){Hr(t,e),Hr(t+"Capture",e)}function Hr(t,e){for(iv[t]=e,t=0;t<e.length;t++)nv.add(e[t])}var kA=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),B0={},U0={};function _A(t){return af.call(U0,t)?!0:af.call(B0,t)?!1:kA.test(t)?U0[t]=!0:(B0[t]=!0,!1)}function _o(t,e,n){if(_A(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function ql(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function mi(t,e,n,i){if(i===null)t.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+i)}}function Rn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function LA(t,e,n){var i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var s=i.get,r=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){n=""+a,r.call(this,a)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(a){n=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function of(t){if(!t._valueTracker){var e=sv(t)?"checked":"value";t._valueTracker=LA(t,e,""+t[e])}}function rv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=sv(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function ru(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var RA=/[\n"\\]/g;function Dn(t){return t.replace(RA,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function uf(t,e,n,i,s,r,a,l){t.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?t.type=a:t.removeAttribute("type"),e!=null?a==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+Rn(e)):t.value!==""+Rn(e)&&(t.value=""+Rn(e)):a!=="submit"&&a!=="reset"||t.removeAttribute("value"),e!=null?cf(t,a,Rn(e)):n!=null?cf(t,a,Rn(n)):i!=null&&t.removeAttribute("value"),s==null&&r!=null&&(t.defaultChecked=!!r),s!=null&&(t.checked=s&&typeof s!="function"&&typeof s!="symbol"),l!=null&&typeof l!="function"&&typeof l!="symbol"&&typeof l!="boolean"?t.name=""+Rn(l):t.removeAttribute("name")}function av(t,e,n,i,s,r,a,l){if(r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(t.type=r),e!=null||n!=null){if(!(r!=="submit"&&r!=="reset"||e!=null)){of(t);return}n=n!=null?""+Rn(n):"",e=e!=null?""+Rn(e):n,l||e===t.value||(t.value=e),t.defaultValue=e}i=i??s,i=typeof i!="function"&&typeof i!="symbol"&&!!i,t.checked=l?t.checked:!!i,t.defaultChecked=!!i,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(t.name=a),of(t)}function cf(t,e,n){e==="number"&&ru(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function Dr(t,e,n,i){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Rn(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,i&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function lv(t,e,n){if(e!=null&&(e=""+Rn(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+Rn(n):""}function ov(t,e,n,i){if(e==null){if(i!=null){if(n!=null)throw Error(K(92));if(Ca(i)){if(1<i.length)throw Error(K(93));i=i[0]}n=i}n==null&&(n=""),e=n}n=Rn(e),t.defaultValue=n,i=t.textContent,i===n&&i!==""&&i!==null&&(t.value=i),of(t)}function Vr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wA=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function j0(t,e,n){var i=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?i?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":i?t.setProperty(e,n):typeof n!="number"||n===0||wA.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function uv(t,e,n){if(e!=null&&typeof e!="object")throw Error(K(62));if(t=t.style,n!=null){for(var i in n)!n.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="");for(var s in e)i=e[s],e.hasOwnProperty(s)&&n[s]!==i&&j0(t,s,i)}else for(var r in e)e.hasOwnProperty(r)&&j0(t,r,e[r])}function $h(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var CA=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),IA=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lo(t){return IA.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function _i(){}var df=null;function zh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sr=null,Nr=null;function $0(t){var e=ra(t);if(e&&(t=e.stateNode)){var n=t[Jt]||null;e:switch(t=e.stateNode,e.type){case"input":if(uf(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Dn(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var s=i[Jt]||null;if(!s)throw Error(K(90));uf(i,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name)}}for(e=0;e<n.length;e++)i=n[e],i.form===t.form&&rv(i)}break e;case"textarea":lv(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&Dr(t,!!n.multiple,e,!1)}}}var Dc=!1;function cv(t,e,n){if(Dc)return t(e,n);Dc=!0;try{var i=t(e);return i}finally{if(Dc=!1,(Sr!==null||Nr!==null)&&(uc(),Sr&&(e=Sr,t=Nr,Nr=Sr=null,$0(e),t)))for(e=0;e<t.length;e++)$0(t[e])}}function nl(t,e){var n=t.stateNode;if(n===null)return null;var i=n[Jt]||null;if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(K(231,e,typeof n));return n}var Ii=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ff=!1;if(Ii)try{var pa={};Object.defineProperty(pa,"passive",{get:function(){ff=!0}}),window.addEventListener("test",pa,pa),window.removeEventListener("test",pa,pa)}catch{ff=!1}var Ji=null,Gh=null,Ro=null;function dv(){if(Ro)return Ro;var t,e=Gh,n=e.length,i,s="value"in Ji?Ji.value:Ji.textContent,r=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(i=1;i<=a&&e[n-i]===s[r-i];i++);return Ro=s.slice(t,1<i?1-i:void 0)}function wo(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Xl(){return!0}function z0(){return!1}function en(t){function e(n,i,s,r,a){this._reactName=n,this._targetInst=s,this.type=i,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Xl:z0,this.isPropagationStopped=z0,this}return We(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Xl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Xl)},persist:function(){},isPersistent:Xl}),e}var Zs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zu=en(Zs),Nl=We({},Zs,{view:0,detail:0}),DA=en(Nl),Nc,Mc,ya,Ju=We({},Nl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ya&&(ya&&t.type==="mousemove"?(Nc=t.screenX-ya.screenX,Mc=t.screenY-ya.screenY):Mc=Nc=0,ya=t),Nc)},movementY:function(t){return"movementY"in t?t.movementY:Mc}}),G0=en(Ju),NA=We({},Ju,{dataTransfer:0}),MA=en(NA),OA=We({},Nl,{relatedTarget:0}),Oc=en(OA),PA=We({},Zs,{animationName:0,elapsedTime:0,pseudoElement:0}),FA=en(PA),BA=We({},Zs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),UA=en(BA),jA=We({},Zs,{data:0}),H0=en(jA),$A={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function HA(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=GA[t])?!!e[t]:!1}function Hh(){return HA}var VA=We({},Nl,{key:function(t){if(t.key){var e=$A[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=wo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?zA[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hh,charCode:function(t){return t.type==="keypress"?wo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?wo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),KA=en(VA),YA=We({},Ju,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),V0=en(YA),qA=We({},Nl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hh}),XA=en(qA),QA=We({},Zs,{propertyName:0,elapsedTime:0,pseudoElement:0}),WA=en(QA),ZA=We({},Ju,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),JA=en(ZA),ek=We({},Zs,{newState:0,oldState:0}),tk=en(ek),nk=[9,13,27,32],Vh=Ii&&"CompositionEvent"in window,Pa=null;Ii&&"documentMode"in document&&(Pa=document.documentMode);var ik=Ii&&"TextEvent"in window&&!Pa,fv=Ii&&(!Vh||Pa&&8<Pa&&11>=Pa),K0=" ",Y0=!1;function hv(t,e){switch(t){case"keyup":return nk.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Er=!1;function sk(t,e){switch(t){case"compositionend":return mv(e);case"keypress":return e.which!==32?null:(Y0=!0,K0);case"textInput":return t=e.data,t===K0&&Y0?null:t;default:return null}}function rk(t,e){if(Er)return t==="compositionend"||!Vh&&hv(t,e)?(t=dv(),Ro=Gh=Ji=null,Er=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return fv&&e.locale!=="ko"?null:e.data;default:return null}}var ak={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q0(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ak[t.type]:e==="textarea"}function gv(t,e,n,i){Sr?Nr?Nr.push(i):Nr=[i]:Sr=i,e=Tu(e,"onChange"),0<e.length&&(n=new Zu("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Fa=null,il=null;function lk(t){c1(t,0)}function ec(t){var e=Ia(t);if(rv(e))return t}function X0(t,e){if(t==="change")return e}var pv=!1;if(Ii){var Pc;if(Ii){var Fc="oninput"in document;if(!Fc){var Q0=document.createElement("div");Q0.setAttribute("oninput","return;"),Fc=typeof Q0.oninput=="function"}Pc=Fc}else Pc=!1;pv=Pc&&(!document.documentMode||9<document.documentMode)}function W0(){Fa&&(Fa.detachEvent("onpropertychange",yv),il=Fa=null)}function yv(t){if(t.propertyName==="value"&&ec(il)){var e=[];gv(e,il,t,zh(t)),cv(lk,e)}}function ok(t,e,n){t==="focusin"?(W0(),Fa=e,il=n,Fa.attachEvent("onpropertychange",yv)):t==="focusout"&&W0()}function uk(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ec(il)}function ck(t,e){if(t==="click")return ec(e)}function dk(t,e){if(t==="input"||t==="change")return ec(e)}function fk(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var An=typeof Object.is=="function"?Object.is:fk;function sl(t,e){if(An(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var s=n[i];if(!af.call(e,s)||!An(t[s],e[s]))return!1}return!0}function Z0(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function J0(t,e){var n=Z0(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Z0(n)}}function xv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vv(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=ru(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ru(t.document)}return e}function Kh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var hk=Ii&&"documentMode"in document&&11>=document.documentMode,Tr=null,hf=null,Ba=null,mf=!1;function eg(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;mf||Tr==null||Tr!==ru(i)||(i=Tr,"selectionStart"in i&&Kh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ba&&sl(Ba,i)||(Ba=i,i=Tu(hf,"onSelect"),0<i.length&&(e=new Zu("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Tr)))}function ks(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Ar={animationend:ks("Animation","AnimationEnd"),animationiteration:ks("Animation","AnimationIteration"),animationstart:ks("Animation","AnimationStart"),transitionrun:ks("Transition","TransitionRun"),transitionstart:ks("Transition","TransitionStart"),transitioncancel:ks("Transition","TransitionCancel"),transitionend:ks("Transition","TransitionEnd")},Bc={},bv={};Ii&&(bv=document.createElement("div").style,"AnimationEvent"in window||(delete Ar.animationend.animation,delete Ar.animationiteration.animation,delete Ar.animationstart.animation),"TransitionEvent"in window||delete Ar.transitionend.transition);function Js(t){if(Bc[t])return Bc[t];if(!Ar[t])return t;var e=Ar[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in bv)return Bc[t]=e[n];return t}var Sv=Js("animationend"),Ev=Js("animationiteration"),Tv=Js("animationstart"),mk=Js("transitionrun"),gk=Js("transitionstart"),pk=Js("transitioncancel"),Av=Js("transitionend"),kv=new Map,gf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gf.push("scrollEnd");function qn(t,e){kv.set(t,e),Ws(e,[t])}var au=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Ln=[],kr=0,Yh=0;function tc(){for(var t=kr,e=Yh=kr=0;e<t;){var n=Ln[e];Ln[e++]=null;var i=Ln[e];Ln[e++]=null;var s=Ln[e];Ln[e++]=null;var r=Ln[e];if(Ln[e++]=null,i!==null&&s!==null){var a=i.pending;a===null?s.next=s:(s.next=a.next,a.next=s),i.pending=s}r!==0&&_v(n,s,r)}}function nc(t,e,n,i){Ln[kr++]=t,Ln[kr++]=e,Ln[kr++]=n,Ln[kr++]=i,Yh|=i,t.lanes|=i,t=t.alternate,t!==null&&(t.lanes|=i)}function qh(t,e,n,i){return nc(t,e,n,i),lu(t)}function er(t,e){return nc(t,null,null,e),lu(t)}function _v(t,e,n){t.lanes|=n;var i=t.alternate;i!==null&&(i.lanes|=n);for(var s=!1,r=t.return;r!==null;)r.childLanes|=n,i=r.alternate,i!==null&&(i.childLanes|=n),r.tag===22&&(t=r.stateNode,t===null||t._visibility&1||(s=!0)),t=r,r=r.return;return t.tag===3?(r=t.stateNode,s&&e!==null&&(s=31-bn(n),t=r.hiddenUpdates,i=t[s],i===null?t[s]=[e]:i.push(e),e.lane=n|536870912),r):null}function lu(t){if(50<Ya)throw Ya=0,Pf=null,Error(K(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var _r={};function yk(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gn(t,e,n,i){return new yk(t,e,n,i)}function Xh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ri(t,e){var n=t.alternate;return n===null?(n=gn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function Lv(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Co(t,e,n,i,s,r){var a=0;if(i=t,typeof t=="function")Xh(t)&&(a=1);else if(typeof t=="string")a=E_(t,n,oi.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case tf:return t=gn(31,n,e,s),t.elementType=tf,t.lanes=r,t;case xr:return Ps(n.children,s,r,e);case Kx:a=8,s|=24;break;case Zd:return t=gn(12,n,e,s|2),t.elementType=Zd,t.lanes=r,t;case Jd:return t=gn(13,n,e,s),t.elementType=Jd,t.lanes=r,t;case ef:return t=gn(19,n,e,s),t.elementType=ef,t.lanes=r,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ki:a=10;break e;case Yx:a=9;break e;case Oh:a=11;break e;case Ph:a=14;break e;case Hi:a=16,i=null;break e}a=29,n=Error(K(130,t===null?"null":typeof t,"")),i=null}return e=gn(a,n,e,s),e.elementType=t,e.type=i,e.lanes=r,e}function Ps(t,e,n,i){return t=gn(7,t,i,e),t.lanes=n,t}function Uc(t,e,n){return t=gn(6,t,null,e),t.lanes=n,t}function Rv(t){var e=gn(18,null,null,0);return e.stateNode=t,e}function jc(t,e,n){return e=gn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var tg=new WeakMap;function Nn(t,e){if(typeof t=="object"&&t!==null){var n=tg.get(t);return n!==void 0?n:(e={value:t,source:e,stack:O0(e)},tg.set(t,e),e)}return{value:t,source:e,stack:O0(e)}}var Lr=[],Rr=0,ou=null,rl=0,wn=[],Cn=0,hs=null,ni=1,ii="";function Ti(t,e){Lr[Rr++]=rl,Lr[Rr++]=ou,ou=t,rl=e}function wv(t,e,n){wn[Cn++]=ni,wn[Cn++]=ii,wn[Cn++]=hs,hs=t;var i=ni;t=ii;var s=32-bn(i)-1;i&=~(1<<s),n+=1;var r=32-bn(e)+s;if(30<r){var a=s-s%5;r=(i&(1<<a)-1).toString(32),i>>=a,s-=a,ni=1<<32-bn(e)+s|n<<s|i,ii=r+t}else ni=1<<r|n<<s|i,ii=t}function Qh(t){t.return!==null&&(Ti(t,1),wv(t,1,0))}function Wh(t){for(;t===ou;)ou=Lr[--Rr],Lr[Rr]=null,rl=Lr[--Rr],Lr[Rr]=null;for(;t===hs;)hs=wn[--Cn],wn[Cn]=null,ii=wn[--Cn],wn[Cn]=null,ni=wn[--Cn],wn[Cn]=null}function Cv(t,e){wn[Cn++]=ni,wn[Cn++]=ii,wn[Cn++]=hs,ni=e.id,ii=e.overflow,hs=t}var Dt=null,Xe=null,Le=!1,ss=null,Mn=!1,pf=Error(K(519));function ms(t){var e=Error(K(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw al(Nn(e,t)),pf}function ng(t){var e=t.stateNode,n=t.type,i=t.memoizedProps;switch(e[It]=t,e[Jt]=i,n){case"dialog":Te("cancel",e),Te("close",e);break;case"iframe":case"object":case"embed":Te("load",e);break;case"video":case"audio":for(n=0;n<cl.length;n++)Te(cl[n],e);break;case"source":Te("error",e);break;case"img":case"image":case"link":Te("error",e),Te("load",e);break;case"details":Te("toggle",e);break;case"input":Te("invalid",e),av(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":Te("invalid",e);break;case"textarea":Te("invalid",e),ov(e,i.value,i.defaultValue,i.children)}n=i.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||i.suppressHydrationWarning===!0||f1(e.textContent,n)?(i.popover!=null&&(Te("beforetoggle",e),Te("toggle",e)),i.onScroll!=null&&Te("scroll",e),i.onScrollEnd!=null&&Te("scrollend",e),i.onClick!=null&&(e.onclick=_i),e=!0):e=!1,e||ms(t,!0)}function ig(t){for(Dt=t.return;Dt;)switch(Dt.tag){case 5:case 31:case 13:Mn=!1;return;case 27:case 3:Mn=!0;return;default:Dt=Dt.return}}function sr(t){if(t!==Dt)return!1;if(!Le)return ig(t),Le=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||$f(t.type,t.memoizedProps)),n=!n),n&&Xe&&ms(t),ig(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));Xe=Gg(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));Xe=Gg(t)}else e===27?(e=Xe,Ss(t.type)?(t=Vf,Vf=null,Xe=t):Xe=e):Xe=Dt?Pn(t.stateNode.nextSibling):null;return!0}function zs(){Xe=Dt=null,Le=!1}function $c(){var t=ss;return t!==null&&(Qt===null?Qt=t:Qt.push.apply(Qt,t),ss=null),t}function al(t){ss===null?ss=[t]:ss.push(t)}var yf=di(null),tr=null,Li=null;function qi(t,e,n){Ye(yf,e._currentValue),e._currentValue=n}function wi(t){t._currentValue=yf.current,_t(yf)}function xf(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function vf(t,e,n,i){var s=t.child;for(s!==null&&(s.return=t);s!==null;){var r=s.dependencies;if(r!==null){var a=s.child;r=r.firstContext;e:for(;r!==null;){var l=r;r=s;for(var o=0;o<e.length;o++)if(l.context===e[o]){r.lanes|=n,l=r.alternate,l!==null&&(l.lanes|=n),xf(r.return,n,t),i||(a=null);break e}r=l.next}}else if(s.tag===18){if(a=s.return,a===null)throw Error(K(341));a.lanes|=n,r=a.alternate,r!==null&&(r.lanes|=n),xf(a,n,t),a=null}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===t){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}}function aa(t,e,n,i){t=null;for(var s=e,r=!1;s!==null;){if(!r){if(s.flags&524288)r=!0;else if(s.flags&262144)break}if(s.tag===10){var a=s.alternate;if(a===null)throw Error(K(387));if(a=a.memoizedProps,a!==null){var l=s.type;An(s.pendingProps.value,a.value)||(t!==null?t.push(l):t=[l])}}else if(s===tu.current){if(a=s.alternate,a===null)throw Error(K(387));a.memoizedState.memoizedState!==s.memoizedState.memoizedState&&(t!==null?t.push(fl):t=[fl])}s=s.return}t!==null&&vf(e,t,n,i),e.flags|=262144}function uu(t){for(t=t.firstContext;t!==null;){if(!An(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Gs(t){tr=t,Li=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Nt(t){return Iv(tr,t)}function Ql(t,e){return tr===null&&Gs(t),Iv(t,e)}function Iv(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},Li===null){if(t===null)throw Error(K(308));Li=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else Li=Li.next=e;return n}var xk=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},vk=Et.unstable_scheduleCallback,bk=Et.unstable_NormalPriority,yt={$$typeof:ki,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zh(){return{controller:new xk,data:new Map,refCount:0}}function Ml(t){t.refCount--,t.refCount===0&&vk(bk,function(){t.controller.abort()})}var Ua=null,bf=0,Kr=0,Mr=null;function Sk(t,e){if(Ua===null){var n=Ua=[];bf=0,Kr=Tm(),Mr={status:"pending",value:void 0,then:function(i){n.push(i)}}}return bf++,e.then(sg,sg),e}function sg(){if(--bf===0&&Ua!==null){Mr!==null&&(Mr.status="fulfilled");var t=Ua;Ua=null,Kr=0,Mr=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function Ek(t,e){var n=[],i={status:"pending",value:null,reason:null,then:function(s){n.push(s)}};return t.then(function(){i.status="fulfilled",i.value=e;for(var s=0;s<n.length;s++)(0,n[s])(e)},function(s){for(i.status="rejected",i.reason=s,s=0;s<n.length;s++)(0,n[s])(void 0)}),i}var rg=ce.S;ce.S=function(t,e){Vb=xn(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&Sk(t,e),rg!==null&&rg(t,e)};var Fs=di(null);function Jh(){var t=Fs.current;return t!==null?t:He.pooledCache}function Io(t,e){e===null?Ye(Fs,Fs.current):Ye(Fs,e.pool)}function Dv(){var t=Jh();return t===null?null:{parent:yt._currentValue,pool:t}}var la=Error(K(460)),em=Error(K(474)),ic=Error(K(542)),cu={then:function(){}};function ag(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Nv(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(_i,_i),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,og(t),t;default:if(typeof e.status=="string")e.then(_i,_i);else{if(t=He,t!==null&&100<t.shellSuspendCounter)throw Error(K(482));t=e,t.status="pending",t.then(function(i){if(e.status==="pending"){var s=e;s.status="fulfilled",s.value=i}},function(i){if(e.status==="pending"){var s=e;s.status="rejected",s.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,og(t),t}throw Bs=e,la}}function Is(t){try{var e=t._init;return e(t._payload)}catch(n){throw n!==null&&typeof n=="object"&&typeof n.then=="function"?(Bs=n,la):n}}var Bs=null;function lg(){if(Bs===null)throw Error(K(459));var t=Bs;return Bs=null,t}function og(t){if(t===la||t===ic)throw Error(K(483))}var Or=null,ll=0;function Wl(t){var e=ll;return ll+=1,Or===null&&(Or=[]),Nv(Or,t,e)}function xa(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function Zl(t,e){throw e.$$typeof===oA?Error(K(525)):(t=Object.prototype.toString.call(e),Error(K(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function Mv(t){function e(p,v){if(t){var b=p.deletions;b===null?(p.deletions=[v],p.flags|=16):b.push(v)}}function n(p,v){if(!t)return null;for(;v!==null;)e(p,v),v=v.sibling;return null}function i(p){for(var v=new Map;p!==null;)p.key!==null?v.set(p.key,p):v.set(p.index,p),p=p.sibling;return v}function s(p,v){return p=Ri(p,v),p.index=0,p.sibling=null,p}function r(p,v,b){return p.index=b,t?(b=p.alternate,b!==null?(b=b.index,b<v?(p.flags|=67108866,v):b):(p.flags|=67108866,v)):(p.flags|=1048576,v)}function a(p){return t&&p.alternate===null&&(p.flags|=67108866),p}function l(p,v,b,E){return v===null||v.tag!==6?(v=Uc(b,p.mode,E),v.return=p,v):(v=s(v,b),v.return=p,v)}function o(p,v,b,E){var k=b.type;return k===xr?c(p,v,b.props.children,E,b.key):v!==null&&(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Hi&&Is(k)===v.type)?(v=s(v,b.props),xa(v,b),v.return=p,v):(v=Co(b.type,b.key,b.props,null,p.mode,E),xa(v,b),v.return=p,v)}function u(p,v,b,E){return v===null||v.tag!==4||v.stateNode.containerInfo!==b.containerInfo||v.stateNode.implementation!==b.implementation?(v=jc(b,p.mode,E),v.return=p,v):(v=s(v,b.children||[]),v.return=p,v)}function c(p,v,b,E,k){return v===null||v.tag!==7?(v=Ps(b,p.mode,E,k),v.return=p,v):(v=s(v,b),v.return=p,v)}function d(p,v,b){if(typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint")return v=Uc(""+v,p.mode,b),v.return=p,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Hl:return b=Co(v.type,v.key,v.props,null,p.mode,b),xa(b,v),b.return=p,b;case wa:return v=jc(v,p.mode,b),v.return=p,v;case Hi:return v=Is(v),d(p,v,b)}if(Ca(v)||ga(v))return v=Ps(v,p.mode,b,null),v.return=p,v;if(typeof v.then=="function")return d(p,Wl(v),b);if(v.$$typeof===ki)return d(p,Ql(p,v),b);Zl(p,v)}return null}function f(p,v,b,E){var k=v!==null?v.key:null;if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return k!==null?null:l(p,v,""+b,E);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Hl:return b.key===k?o(p,v,b,E):null;case wa:return b.key===k?u(p,v,b,E):null;case Hi:return b=Is(b),f(p,v,b,E)}if(Ca(b)||ga(b))return k!==null?null:c(p,v,b,E,null);if(typeof b.then=="function")return f(p,v,Wl(b),E);if(b.$$typeof===ki)return f(p,v,Ql(p,b),E);Zl(p,b)}return null}function h(p,v,b,E,k){if(typeof E=="string"&&E!==""||typeof E=="number"||typeof E=="bigint")return p=p.get(b)||null,l(v,p,""+E,k);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case Hl:return p=p.get(E.key===null?b:E.key)||null,o(v,p,E,k);case wa:return p=p.get(E.key===null?b:E.key)||null,u(v,p,E,k);case Hi:return E=Is(E),h(p,v,b,E,k)}if(Ca(E)||ga(E))return p=p.get(b)||null,c(v,p,E,k,null);if(typeof E.then=="function")return h(p,v,b,Wl(E),k);if(E.$$typeof===ki)return h(p,v,b,Ql(v,E),k);Zl(v,E)}return null}function m(p,v,b,E){for(var k=null,_=null,L=v,C=v=0,w=null;L!==null&&C<b.length;C++){L.index>C?(w=L,L=null):w=L.sibling;var A=f(p,L,b[C],E);if(A===null){L===null&&(L=w);break}t&&L&&A.alternate===null&&e(p,L),v=r(A,v,C),_===null?k=A:_.sibling=A,_=A,L=w}if(C===b.length)return n(p,L),Le&&Ti(p,C),k;if(L===null){for(;C<b.length;C++)L=d(p,b[C],E),L!==null&&(v=r(L,v,C),_===null?k=L:_.sibling=L,_=L);return Le&&Ti(p,C),k}for(L=i(L);C<b.length;C++)w=h(L,p,C,b[C],E),w!==null&&(t&&w.alternate!==null&&L.delete(w.key===null?C:w.key),v=r(w,v,C),_===null?k=w:_.sibling=w,_=w);return t&&L.forEach(function(I){return e(p,I)}),Le&&Ti(p,C),k}function y(p,v,b,E){if(b==null)throw Error(K(151));for(var k=null,_=null,L=v,C=v=0,w=null,A=b.next();L!==null&&!A.done;C++,A=b.next()){L.index>C?(w=L,L=null):w=L.sibling;var I=f(p,L,A.value,E);if(I===null){L===null&&(L=w);break}t&&L&&I.alternate===null&&e(p,L),v=r(I,v,C),_===null?k=I:_.sibling=I,_=I,L=w}if(A.done)return n(p,L),Le&&Ti(p,C),k;if(L===null){for(;!A.done;C++,A=b.next())A=d(p,A.value,E),A!==null&&(v=r(A,v,C),_===null?k=A:_.sibling=A,_=A);return Le&&Ti(p,C),k}for(L=i(L);!A.done;C++,A=b.next())A=h(L,p,C,A.value,E),A!==null&&(t&&A.alternate!==null&&L.delete(A.key===null?C:A.key),v=r(A,v,C),_===null?k=A:_.sibling=A,_=A);return t&&L.forEach(function(N){return e(p,N)}),Le&&Ti(p,C),k}function x(p,v,b,E){if(typeof b=="object"&&b!==null&&b.type===xr&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Hl:e:{for(var k=b.key;v!==null;){if(v.key===k){if(k=b.type,k===xr){if(v.tag===7){n(p,v.sibling),E=s(v,b.props.children),E.return=p,p=E;break e}}else if(v.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Hi&&Is(k)===v.type){n(p,v.sibling),E=s(v,b.props),xa(E,b),E.return=p,p=E;break e}n(p,v);break}else e(p,v);v=v.sibling}b.type===xr?(E=Ps(b.props.children,p.mode,E,b.key),E.return=p,p=E):(E=Co(b.type,b.key,b.props,null,p.mode,E),xa(E,b),E.return=p,p=E)}return a(p);case wa:e:{for(k=b.key;v!==null;){if(v.key===k)if(v.tag===4&&v.stateNode.containerInfo===b.containerInfo&&v.stateNode.implementation===b.implementation){n(p,v.sibling),E=s(v,b.children||[]),E.return=p,p=E;break e}else{n(p,v);break}else e(p,v);v=v.sibling}E=jc(b,p.mode,E),E.return=p,p=E}return a(p);case Hi:return b=Is(b),x(p,v,b,E)}if(Ca(b))return m(p,v,b,E);if(ga(b)){if(k=ga(b),typeof k!="function")throw Error(K(150));return b=k.call(b),y(p,v,b,E)}if(typeof b.then=="function")return x(p,v,Wl(b),E);if(b.$$typeof===ki)return x(p,v,Ql(p,b),E);Zl(p,b)}return typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint"?(b=""+b,v!==null&&v.tag===6?(n(p,v.sibling),E=s(v,b),E.return=p,p=E):(n(p,v),E=Uc(b,p.mode,E),E.return=p,p=E),a(p)):n(p,v)}return function(p,v,b,E){try{ll=0;var k=x(p,v,b,E);return Or=null,k}catch(L){if(L===la||L===ic)throw L;var _=gn(29,L,null,p.mode);return _.lanes=E,_.return=p,_}finally{}}}var Hs=Mv(!0),Ov=Mv(!1),Vi=!1;function tm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sf(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function rs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function as(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ie&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,e=lu(t),_v(t,null,n),e}return nc(t,i,e,n),lu(t)}function ja(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Jx(t,n)}}function zc(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var s=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var a={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};r===null?s=r=a:r=r.next=a,n=n.next}while(n!==null);r===null?s=r=e:r=r.next=e}else s=r=e;n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:i.shared,callbacks:i.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var Ef=!1;function $a(){if(Ef){var t=Mr;if(t!==null)throw t}}function za(t,e,n,i){Ef=!1;var s=t.updateQueue;Vi=!1;var r=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var o=l,u=o.next;o.next=null,a===null?r=u:a.next=u,a=o;var c=t.alternate;c!==null&&(c=c.updateQueue,l=c.lastBaseUpdate,l!==a&&(l===null?c.firstBaseUpdate=u:l.next=u,c.lastBaseUpdate=o))}if(r!==null){var d=s.baseState;a=0,c=u=o=null,l=r;do{var f=l.lane&-536870913,h=f!==l.lane;if(h?(_e&f)===f:(i&f)===f){f!==0&&f===Kr&&(Ef=!0),c!==null&&(c=c.next={lane:0,tag:l.tag,payload:l.payload,callback:null,next:null});e:{var m=t,y=l;f=e;var x=n;switch(y.tag){case 1:if(m=y.payload,typeof m=="function"){d=m.call(x,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,f=typeof m=="function"?m.call(x,d,f):m,f==null)break e;d=We({},d,f);break e;case 2:Vi=!0}}f=l.callback,f!==null&&(t.flags|=64,h&&(t.flags|=8192),h=s.callbacks,h===null?s.callbacks=[f]:h.push(f))}else h={lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},c===null?(u=c=h,o=d):c=c.next=h,a|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;h=l,l=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);c===null&&(o=d),s.baseState=o,s.firstBaseUpdate=u,s.lastBaseUpdate=c,r===null&&(s.shared.lanes=0),ps|=a,t.lanes=a,t.memoizedState=d}}function Pv(t,e){if(typeof t!="function")throw Error(K(191,t));t.call(e)}function Fv(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)Pv(n[t],e)}var Yr=di(null),du=di(0);function ug(t,e){t=Oi,Ye(du,t),Ye(Yr,e),Oi=t|e.baseLanes}function Tf(){Ye(du,Oi),Ye(Yr,Yr.current)}function nm(){Oi=du.current,_t(Yr),_t(du)}var kn=di(null),On=null;function Xi(t){var e=t.alternate;Ye(ct,ct.current&1),Ye(kn,t),On===null&&(e===null||Yr.current!==null||e.memoizedState!==null)&&(On=t)}function Af(t){Ye(ct,ct.current),Ye(kn,t),On===null&&(On=t)}function Bv(t){t.tag===22?(Ye(ct,ct.current),Ye(kn,t),On===null&&(On=t)):Qi()}function Qi(){Ye(ct,ct.current),Ye(kn,kn.current)}function hn(t){_t(kn),On===t&&(On=null),_t(ct)}var ct=di(0);function fu(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||Gf(n)||Hf(n)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Di=0,pe=null,je=null,gt=null,hu=!1,Pr=!1,Vs=!1,mu=0,ol=0,Fr=null,Tk=0;function st(){throw Error(K(321))}function im(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!An(t[n],e[n]))return!1;return!0}function sm(t,e,n,i,s,r){return Di=r,pe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ce.H=t===null||t.memoizedState===null?gb:gm,Vs=!1,r=n(i,s),Vs=!1,Pr&&(r=jv(e,n,i,s)),Uv(t),r}function Uv(t){ce.H=ul;var e=je!==null&&je.next!==null;if(Di=0,gt=je=pe=null,hu=!1,ol=0,Fr=null,e)throw Error(K(300));t===null||xt||(t=t.dependencies,t!==null&&uu(t)&&(xt=!0))}function jv(t,e,n,i){pe=t;var s=0;do{if(Pr&&(Fr=null),ol=0,Pr=!1,25<=s)throw Error(K(301));if(s+=1,gt=je=null,t.updateQueue!=null){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,r.memoCache!=null&&(r.memoCache.index=0)}ce.H=pb,r=e(n,i)}while(Pr);return r}function Ak(){var t=ce.H,e=t.useState()[0];return e=typeof e.then=="function"?Ol(e):e,t=t.useState()[0],(je!==null?je.memoizedState:null)!==t&&(pe.flags|=1024),e}function rm(){var t=mu!==0;return mu=0,t}function am(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function lm(t){if(hu){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}hu=!1}Di=0,gt=je=pe=null,Pr=!1,ol=mu=0,Fr=null}function Ut(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gt===null?pe.memoizedState=gt=t:gt=gt.next=t,gt}function dt(){if(je===null){var t=pe.alternate;t=t!==null?t.memoizedState:null}else t=je.next;var e=gt===null?pe.memoizedState:gt.next;if(e!==null)gt=e,je=t;else{if(t===null)throw pe.alternate===null?Error(K(467)):Error(K(310));je=t,t={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},gt===null?pe.memoizedState=gt=t:gt=gt.next=t}return gt}function sc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ol(t){var e=ol;return ol+=1,Fr===null&&(Fr=[]),t=Nv(Fr,t,e),e=pe,(gt===null?e.memoizedState:gt.next)===null&&(e=e.alternate,ce.H=e===null||e.memoizedState===null?gb:gm),t}function rc(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ol(t);if(t.$$typeof===ki)return Nt(t)}throw Error(K(438,String(t)))}function om(t){var e=null,n=pe.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var i=pe.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(s){return s.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=sc(),pe.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),i=0;i<t;i++)n[i]=uA;return e.index++,n}function Ni(t,e){return typeof e=="function"?e(t):e}function Do(t){var e=dt();return um(e,je,t)}function um(t,e,n){var i=t.queue;if(i===null)throw Error(K(311));i.lastRenderedReducer=n;var s=t.baseQueue,r=i.pending;if(r!==null){if(s!==null){var a=s.next;s.next=r.next,r.next=a}e.baseQueue=s=r,i.pending=null}if(r=t.baseState,s===null)t.memoizedState=r;else{e=s.next;var l=a=null,o=null,u=e,c=!1;do{var d=u.lane&-536870913;if(d!==u.lane?(_e&d)===d:(Di&d)===d){var f=u.revertLane;if(f===0)o!==null&&(o=o.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),d===Kr&&(c=!0);else if((Di&f)===f){u=u.next,f===Kr&&(c=!0);continue}else d={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},o===null?(l=o=d,a=r):o=o.next=d,pe.lanes|=f,ps|=f;d=u.action,Vs&&n(r,d),r=u.hasEagerState?u.eagerState:n(r,d)}else f={lane:d,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},o===null?(l=o=f,a=r):o=o.next=f,pe.lanes|=d,ps|=d;u=u.next}while(u!==null&&u!==e);if(o===null?a=r:o.next=l,!An(r,t.memoizedState)&&(xt=!0,c&&(n=Mr,n!==null)))throw n;t.memoizedState=r,t.baseState=a,t.baseQueue=o,i.lastRenderedState=r}return s===null&&(i.lanes=0),[t.memoizedState,i.dispatch]}function Gc(t){var e=dt(),n=e.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=t;var i=n.dispatch,s=n.pending,r=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do r=t(r,a.action),a=a.next;while(a!==s);An(r,e.memoizedState)||(xt=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,i]}function $v(t,e,n){var i=pe,s=dt(),r=Le;if(r){if(n===void 0)throw Error(K(407));n=n()}else n=e();var a=!An((je||s).memoizedState,n);if(a&&(s.memoizedState=n,xt=!0),s=s.queue,cm(Hv.bind(null,i,s,t),[t]),s.getSnapshot!==e||a||gt!==null&&gt.memoizedState.tag&1){if(i.flags|=2048,qr(9,{destroy:void 0},Gv.bind(null,i,s,n,e),null),He===null)throw Error(K(349));r||Di&127||zv(i,e,n)}return n}function zv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=pe.updateQueue,e===null?(e=sc(),pe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Gv(t,e,n,i){e.value=n,e.getSnapshot=i,Vv(e)&&Kv(t)}function Hv(t,e,n){return n(function(){Vv(e)&&Kv(t)})}function Vv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!An(t,n)}catch{return!0}}function Kv(t){var e=er(t,2);e!==null&&Zt(e,t,2)}function kf(t){var e=Ut();if(typeof t=="function"){var n=t;if(t=n(),Vs){Zi(!0);try{n()}finally{Zi(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:t},e}function Yv(t,e,n,i){return t.baseState=n,um(t,je,typeof i=="function"?i:Ni)}function kk(t,e,n,i,s){if(lc(t))throw Error(K(485));if(t=e.action,t!==null){var r={payload:s,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){r.listeners.push(a)}};ce.T!==null?n(!0):r.isTransition=!1,i(r),n=e.pending,n===null?(r.next=e.pending=r,qv(e,r)):(r.next=n.next,e.pending=n.next=r)}}function qv(t,e){var n=e.action,i=e.payload,s=t.state;if(e.isTransition){var r=ce.T,a={};ce.T=a;try{var l=n(s,i),o=ce.S;o!==null&&o(a,l),cg(t,e,l)}catch(u){_f(t,e,u)}finally{r!==null&&a.types!==null&&(r.types=a.types),ce.T=r}}else try{r=n(s,i),cg(t,e,r)}catch(u){_f(t,e,u)}}function cg(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(i){dg(t,e,i)},function(i){return _f(t,e,i)}):dg(t,e,n)}function dg(t,e,n){e.status="fulfilled",e.value=n,Xv(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,qv(t,n)))}function _f(t,e,n){var i=t.pending;if(t.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=n,Xv(e),e=e.next;while(e!==i)}t.action=null}function Xv(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function Qv(t,e){return e}function fg(t,e){if(Le){var n=He.formState;if(n!==null){e:{var i=pe;if(Le){if(Xe){t:{for(var s=Xe,r=Mn;s.nodeType!==8;){if(!r){s=null;break t}if(s=Pn(s.nextSibling),s===null){s=null;break t}}r=s.data,s=r==="F!"||r==="F"?s:null}if(s){Xe=Pn(s.nextSibling),i=s.data==="F!";break e}}ms(i)}i=!1}i&&(e=n[0])}}return n=Ut(),n.memoizedState=n.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qv,lastRenderedState:e},n.queue=i,n=fb.bind(null,pe,i),i.dispatch=n,i=kf(!1),r=mm.bind(null,pe,!1,i.queue),i=Ut(),s={state:e,dispatch:null,action:t,pending:null},i.queue=s,n=kk.bind(null,pe,s,r,n),s.dispatch=n,i.memoizedState=t,[e,n,!1]}function hg(t){var e=dt();return Wv(e,je,t)}function Wv(t,e,n){if(e=um(t,e,Qv)[0],t=Do(Ni)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=Ol(e)}catch(a){throw a===la?ic:a}else i=e;e=dt();var s=e.queue,r=s.dispatch;return n!==e.memoizedState&&(pe.flags|=2048,qr(9,{destroy:void 0},_k.bind(null,s,n),null)),[i,r,t]}function _k(t,e){t.action=e}function mg(t){var e=dt(),n=je;if(n!==null)return Wv(e,n,t);dt(),e=e.memoizedState,n=dt();var i=n.queue.dispatch;return n.memoizedState=t,[e,i,!1]}function qr(t,e,n,i){return t={tag:t,create:n,deps:i,inst:e,next:null},e=pe.updateQueue,e===null&&(e=sc(),pe.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Zv(){return dt().memoizedState}function No(t,e,n,i){var s=Ut();pe.flags|=t,s.memoizedState=qr(1|e,{destroy:void 0},n,i===void 0?null:i)}function ac(t,e,n,i){var s=dt();i=i===void 0?null:i;var r=s.memoizedState.inst;je!==null&&i!==null&&im(i,je.memoizedState.deps)?s.memoizedState=qr(e,r,n,i):(pe.flags|=t,s.memoizedState=qr(1|e,r,n,i))}function gg(t,e){No(8390656,8,t,e)}function cm(t,e){ac(2048,8,t,e)}function Lk(t){pe.flags|=4;var e=pe.updateQueue;if(e===null)e=sc(),pe.updateQueue=e,e.events=[t];else{var n=e.events;n===null?e.events=[t]:n.push(t)}}function Jv(t){var e=dt().memoizedState;return Lk({ref:e,nextImpl:t}),function(){if(Ie&2)throw Error(K(440));return e.impl.apply(void 0,arguments)}}function eb(t,e){return ac(4,2,t,e)}function tb(t,e){return ac(4,4,t,e)}function nb(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ib(t,e,n){n=n!=null?n.concat([t]):null,ac(4,4,nb.bind(null,e,t),n)}function dm(){}function sb(t,e){var n=dt();e=e===void 0?null:e;var i=n.memoizedState;return e!==null&&im(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function rb(t,e){var n=dt();e=e===void 0?null:e;var i=n.memoizedState;if(e!==null&&im(e,i[1]))return i[0];if(i=t(),Vs){Zi(!0);try{t()}finally{Zi(!1)}}return n.memoizedState=[i,e],i}function fm(t,e,n){return n===void 0||Di&1073741824&&!(_e&261930)?t.memoizedState=e:(t.memoizedState=n,t=Yb(),pe.lanes|=t,ps|=t,n)}function ab(t,e,n,i){return An(n,e)?n:Yr.current!==null?(t=fm(t,n,i),An(t,e)||(xt=!0),t):!(Di&42)||Di&1073741824&&!(_e&261930)?(xt=!0,t.memoizedState=n):(t=Yb(),pe.lanes|=t,ps|=t,e)}function lb(t,e,n,i,s){var r=De.p;De.p=r!==0&&8>r?r:8;var a=ce.T,l={};ce.T=l,mm(t,!1,e,n);try{var o=s(),u=ce.S;if(u!==null&&u(l,o),o!==null&&typeof o=="object"&&typeof o.then=="function"){var c=Ek(o,i);Ga(t,e,c,Sn(t))}else Ga(t,e,i,Sn(t))}catch(d){Ga(t,e,{then:function(){},status:"rejected",reason:d},Sn())}finally{De.p=r,a!==null&&l.types!==null&&(a.types=l.types),ce.T=a}}function Rk(){}function Lf(t,e,n,i){if(t.tag!==5)throw Error(K(476));var s=ob(t).queue;lb(t,s,e,Os,n===null?Rk:function(){return ub(t),n(i)})}function ob(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:Os,baseState:Os,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:Os},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ni,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function ub(t){var e=ob(t);e.next===null&&(e=t.alternate.memoizedState),Ga(t,e.next.queue,{},Sn())}function hm(){return Nt(fl)}function cb(){return dt().memoizedState}function db(){return dt().memoizedState}function wk(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=Sn();t=rs(n);var i=as(e,t,n);i!==null&&(Zt(i,e,n),ja(i,e,n)),e={cache:Zh()},t.payload=e;return}e=e.return}}function Ck(t,e,n){var i=Sn();n={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},lc(t)?hb(e,n):(n=qh(t,e,n,i),n!==null&&(Zt(n,t,i),mb(n,e,i)))}function fb(t,e,n){var i=Sn();Ga(t,e,n,i)}function Ga(t,e,n,i){var s={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(lc(t))hb(e,s);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,l=r(a,n);if(s.hasEagerState=!0,s.eagerState=l,An(l,a))return nc(t,e,s,0),He===null&&tc(),!1}catch{}finally{}if(n=qh(t,e,s,i),n!==null)return Zt(n,t,i),mb(n,e,i),!0}return!1}function mm(t,e,n,i){if(i={lane:2,revertLane:Tm(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},lc(t)){if(e)throw Error(K(479))}else e=qh(t,n,i,2),e!==null&&Zt(e,t,2)}function lc(t){var e=t.alternate;return t===pe||e!==null&&e===pe}function hb(t,e){Pr=hu=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function mb(t,e,n){if(n&4194048){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Jx(t,n)}}var ul={readContext:Nt,use:rc,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useLayoutEffect:st,useInsertionEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useSyncExternalStore:st,useId:st,useHostTransitionStatus:st,useFormState:st,useActionState:st,useOptimistic:st,useMemoCache:st,useCacheRefresh:st};ul.useEffectEvent=st;var gb={readContext:Nt,use:rc,useCallback:function(t,e){return Ut().memoizedState=[t,e===void 0?null:e],t},useContext:Nt,useEffect:gg,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,No(4194308,4,nb.bind(null,e,t),n)},useLayoutEffect:function(t,e){return No(4194308,4,t,e)},useInsertionEffect:function(t,e){No(4,2,t,e)},useMemo:function(t,e){var n=Ut();e=e===void 0?null:e;var i=t();if(Vs){Zi(!0);try{t()}finally{Zi(!1)}}return n.memoizedState=[i,e],i},useReducer:function(t,e,n){var i=Ut();if(n!==void 0){var s=n(e);if(Vs){Zi(!0);try{n(e)}finally{Zi(!1)}}}else s=e;return i.memoizedState=i.baseState=s,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},i.queue=t,t=t.dispatch=Ck.bind(null,pe,t),[i.memoizedState,t]},useRef:function(t){var e=Ut();return t={current:t},e.memoizedState=t},useState:function(t){t=kf(t);var e=t.queue,n=fb.bind(null,pe,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:dm,useDeferredValue:function(t,e){var n=Ut();return fm(n,t,e)},useTransition:function(){var t=kf(!1);return t=lb.bind(null,pe,t.queue,!0,!1),Ut().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var i=pe,s=Ut();if(Le){if(n===void 0)throw Error(K(407));n=n()}else{if(n=e(),He===null)throw Error(K(349));_e&127||zv(i,e,n)}s.memoizedState=n;var r={value:n,getSnapshot:e};return s.queue=r,gg(Hv.bind(null,i,r,t),[t]),i.flags|=2048,qr(9,{destroy:void 0},Gv.bind(null,i,r,n,e),null),n},useId:function(){var t=Ut(),e=He.identifierPrefix;if(Le){var n=ii,i=ni;n=(i&~(1<<32-bn(i)-1)).toString(32)+n,e="_"+e+"R_"+n,n=mu++,0<n&&(e+="H"+n.toString(32)),e+="_"}else n=Tk++,e="_"+e+"r_"+n.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:hm,useFormState:fg,useActionState:fg,useOptimistic:function(t){var e=Ut();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=mm.bind(null,pe,!0,n),n.dispatch=e,[t,e]},useMemoCache:om,useCacheRefresh:function(){return Ut().memoizedState=wk.bind(null,pe)},useEffectEvent:function(t){var e=Ut(),n={impl:t};return e.memoizedState=n,function(){if(Ie&2)throw Error(K(440));return n.impl.apply(void 0,arguments)}}},gm={readContext:Nt,use:rc,useCallback:sb,useContext:Nt,useEffect:cm,useImperativeHandle:ib,useInsertionEffect:eb,useLayoutEffect:tb,useMemo:rb,useReducer:Do,useRef:Zv,useState:function(){return Do(Ni)},useDebugValue:dm,useDeferredValue:function(t,e){var n=dt();return ab(n,je.memoizedState,t,e)},useTransition:function(){var t=Do(Ni)[0],e=dt().memoizedState;return[typeof t=="boolean"?t:Ol(t),e]},useSyncExternalStore:$v,useId:cb,useHostTransitionStatus:hm,useFormState:hg,useActionState:hg,useOptimistic:function(t,e){var n=dt();return Yv(n,je,t,e)},useMemoCache:om,useCacheRefresh:db};gm.useEffectEvent=Jv;var pb={readContext:Nt,use:rc,useCallback:sb,useContext:Nt,useEffect:cm,useImperativeHandle:ib,useInsertionEffect:eb,useLayoutEffect:tb,useMemo:rb,useReducer:Gc,useRef:Zv,useState:function(){return Gc(Ni)},useDebugValue:dm,useDeferredValue:function(t,e){var n=dt();return je===null?fm(n,t,e):ab(n,je.memoizedState,t,e)},useTransition:function(){var t=Gc(Ni)[0],e=dt().memoizedState;return[typeof t=="boolean"?t:Ol(t),e]},useSyncExternalStore:$v,useId:cb,useHostTransitionStatus:hm,useFormState:mg,useActionState:mg,useOptimistic:function(t,e){var n=dt();return je!==null?Yv(n,je,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:om,useCacheRefresh:db};pb.useEffectEvent=Jv;function Hc(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:We({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Rf={enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Sn(),s=rs(i);s.payload=e,n!=null&&(s.callback=n),e=as(t,s,i),e!==null&&(Zt(e,t,i),ja(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Sn(),s=rs(i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=as(t,s,i),e!==null&&(Zt(e,t,i),ja(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Sn(),i=rs(n);i.tag=2,e!=null&&(i.callback=e),e=as(t,i,n),e!==null&&(Zt(e,t,n),ja(e,t,n))}};function pg(t,e,n,i,s,r,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,r,a):e.prototype&&e.prototype.isPureReactComponent?!sl(n,i)||!sl(s,r):!0}function yg(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Rf.enqueueReplaceState(e,e.state,null)}function Ks(t,e){var n=e;if("ref"in e){n={};for(var i in e)i!=="ref"&&(n[i]=e[i])}if(t=t.defaultProps){n===e&&(n=We({},n));for(var s in t)n[s]===void 0&&(n[s]=t[s])}return n}function yb(t){au(t)}function xb(t){console.error(t)}function vb(t){au(t)}function gu(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function xg(t,e,n){try{var i=t.onCaughtError;i(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(s){setTimeout(function(){throw s})}}function wf(t,e,n){return n=rs(n),n.tag=3,n.payload={element:null},n.callback=function(){gu(t,e)},n}function bb(t){return t=rs(t),t.tag=3,t}function Sb(t,e,n,i){var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var r=i.value;t.payload=function(){return s(r)},t.callback=function(){xg(e,n,i)}}var a=n.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){xg(e,n,i),typeof s!="function"&&(ls===null?ls=new Set([this]):ls.add(this));var l=i.stack;this.componentDidCatch(i.value,{componentStack:l!==null?l:""})})}function Ik(t,e,n,i,s){if(n.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=n.alternate,e!==null&&aa(e,n,s,!0),n=kn.current,n!==null){switch(n.tag){case 31:case 13:return On===null?bu():n.alternate===null&&at===0&&(at=3),n.flags&=-257,n.flags|=65536,n.lanes=s,i===cu?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([i]):e.add(i),td(t,i,s)),!1;case 22:return n.flags|=65536,i===cu?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([i]):n.add(i)),td(t,i,s)),!1}throw Error(K(435,n.tag))}return td(t,i,s),bu(),!1}if(Le)return e=kn.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=s,i!==pf&&(t=Error(K(422),{cause:i}),al(Nn(t,n)))):(i!==pf&&(e=Error(K(423),{cause:i}),al(Nn(e,n))),t=t.current.alternate,t.flags|=65536,s&=-s,t.lanes|=s,i=Nn(i,n),s=wf(t.stateNode,i,s),zc(t,s),at!==4&&(at=2)),!1;var r=Error(K(520),{cause:i});if(r=Nn(r,n),Ka===null?Ka=[r]:Ka.push(r),at!==4&&(at=2),e===null)return!0;i=Nn(i,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=s&-s,n.lanes|=t,t=wf(n.stateNode,i,t),zc(n,t),!1;case 1:if(e=n.type,r=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||r!==null&&typeof r.componentDidCatch=="function"&&(ls===null||!ls.has(r))))return n.flags|=65536,s&=-s,n.lanes|=s,s=bb(s),Sb(s,t,n,i),zc(n,s),!1}n=n.return}while(n!==null);return!1}var pm=Error(K(461)),xt=!1;function Lt(t,e,n,i){e.child=t===null?Ov(e,null,n,i):Hs(e,t.child,n,i)}function vg(t,e,n,i,s){n=n.render;var r=e.ref;if("ref"in i){var a={};for(var l in i)l!=="ref"&&(a[l]=i[l])}else a=i;return Gs(e),i=sm(t,e,n,a,r,s),l=rm(),t!==null&&!xt?(am(t,e,s),Mi(t,e,s)):(Le&&l&&Qh(e),e.flags|=1,Lt(t,e,i,s),e.child)}function bg(t,e,n,i,s){if(t===null){var r=n.type;return typeof r=="function"&&!Xh(r)&&r.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=r,Eb(t,e,r,i,s)):(t=Co(n.type,null,i,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!ym(t,s)){var a=r.memoizedProps;if(n=n.compare,n=n!==null?n:sl,n(a,i)&&t.ref===e.ref)return Mi(t,e,s)}return e.flags|=1,t=Ri(r,i),t.ref=e.ref,t.return=e,e.child=t}function Eb(t,e,n,i,s){if(t!==null){var r=t.memoizedProps;if(sl(r,i)&&t.ref===e.ref)if(xt=!1,e.pendingProps=i=r,ym(t,s))t.flags&131072&&(xt=!0);else return e.lanes=t.lanes,Mi(t,e,s)}return Cf(t,e,n,i,s)}function Tb(t,e,n,i){var s=i.children,r=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(e.flags&128){if(r=r!==null?r.baseLanes|n:n,t!==null){for(i=e.child=t.child,s=0;i!==null;)s=s|i.lanes|i.childLanes,i=i.sibling;i=s&~r}else i=0,e.child=null;return Sg(t,e,r,n,i)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Io(e,r!==null?r.cachePool:null),r!==null?ug(e,r):Tf(),Bv(e);else return i=e.lanes=536870912,Sg(t,e,r!==null?r.baseLanes|n:n,n,i)}else r!==null?(Io(e,r.cachePool),ug(e,r),Qi(),e.memoizedState=null):(t!==null&&Io(e,null),Tf(),Qi());return Lt(t,e,s,n),e.child}function Da(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function Sg(t,e,n,i,s){var r=Jh();return r=r===null?null:{parent:yt._currentValue,pool:r},e.memoizedState={baseLanes:n,cachePool:r},t!==null&&Io(e,null),Tf(),Bv(e),t!==null&&aa(t,e,i,!0),e.childLanes=s,null}function Mo(t,e){return e=pu({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function Eg(t,e,n){return Hs(e,t.child,null,n),t=Mo(e,e.pendingProps),t.flags|=2,hn(e),e.memoizedState=null,t}function Dk(t,e,n){var i=e.pendingProps,s=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(Le){if(i.mode==="hidden")return t=Mo(e,i),e.lanes=536870912,Da(null,t);if(Af(e),(t=Xe)?(t=g1(t,Mn),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:hs!==null?{id:ni,overflow:ii}:null,retryLane:536870912,hydrationErrors:null},n=Rv(t),n.return=e,e.child=n,Dt=e,Xe=null)):t=null,t===null)throw ms(e);return e.lanes=536870912,null}return Mo(e,i)}var r=t.memoizedState;if(r!==null){var a=r.dehydrated;if(Af(e),s)if(e.flags&256)e.flags&=-257,e=Eg(t,e,n);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(K(558));else if(xt||aa(t,e,n,!1),s=(n&t.childLanes)!==0,xt||s){if(i=He,i!==null&&(a=ev(i,n),a!==0&&a!==r.retryLane))throw r.retryLane=a,er(t,a),Zt(i,t,a),pm;bu(),e=Eg(t,e,n)}else t=r.treeContext,Xe=Pn(a.nextSibling),Dt=e,Le=!0,ss=null,Mn=!1,t!==null&&Cv(e,t),e=Mo(e,i),e.flags|=4096;return e}return t=Ri(t.child,{mode:i.mode,children:i.children}),t.ref=e.ref,e.child=t,t.return=e,t}function Oo(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(K(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function Cf(t,e,n,i,s){return Gs(e),n=sm(t,e,n,i,void 0,s),i=rm(),t!==null&&!xt?(am(t,e,s),Mi(t,e,s)):(Le&&i&&Qh(e),e.flags|=1,Lt(t,e,n,s),e.child)}function Tg(t,e,n,i,s,r){return Gs(e),e.updateQueue=null,n=jv(e,i,n,s),Uv(t),i=rm(),t!==null&&!xt?(am(t,e,r),Mi(t,e,r)):(Le&&i&&Qh(e),e.flags|=1,Lt(t,e,n,r),e.child)}function Ag(t,e,n,i,s){if(Gs(e),e.stateNode===null){var r=_r,a=n.contextType;typeof a=="object"&&a!==null&&(r=Nt(a)),r=new n(i,r),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Rf,e.stateNode=r,r._reactInternals=e,r=e.stateNode,r.props=i,r.state=e.memoizedState,r.refs={},tm(e),a=n.contextType,r.context=typeof a=="object"&&a!==null?Nt(a):_r,r.state=e.memoizedState,a=n.getDerivedStateFromProps,typeof a=="function"&&(Hc(e,n,a,i),r.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(a=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),a!==r.state&&Rf.enqueueReplaceState(r,r.state,null),za(e,i,r,s),$a(),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(t===null){r=e.stateNode;var l=e.memoizedProps,o=Ks(n,l);r.props=o;var u=r.context,c=n.contextType;a=_r,typeof c=="object"&&c!==null&&(a=Nt(c));var d=n.getDerivedStateFromProps;c=typeof d=="function"||typeof r.getSnapshotBeforeUpdate=="function",l=e.pendingProps!==l,c||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(l||u!==a)&&yg(e,r,i,a),Vi=!1;var f=e.memoizedState;r.state=f,za(e,i,r,s),$a(),u=e.memoizedState,l||f!==u||Vi?(typeof d=="function"&&(Hc(e,n,d,i),u=e.memoizedState),(o=Vi||pg(e,n,o,i,f,u,a))?(c||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=u),r.props=i,r.state=u,r.context=a,i=o):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{r=e.stateNode,Sf(t,e),a=e.memoizedProps,c=Ks(n,a),r.props=c,d=e.pendingProps,f=r.context,u=n.contextType,o=_r,typeof u=="object"&&u!==null&&(o=Nt(u)),l=n.getDerivedStateFromProps,(u=typeof l=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==d||f!==o)&&yg(e,r,i,o),Vi=!1,f=e.memoizedState,r.state=f,za(e,i,r,s),$a();var h=e.memoizedState;a!==d||f!==h||Vi||t!==null&&t.dependencies!==null&&uu(t.dependencies)?(typeof l=="function"&&(Hc(e,n,l,i),h=e.memoizedState),(c=Vi||pg(e,n,c,i,f,h,o)||t!==null&&t.dependencies!==null&&uu(t.dependencies))?(u||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(i,h,o),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(i,h,o)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=h),r.props=i,r.state=h,r.context=o,i=c):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return r=i,Oo(t,e),i=(e.flags&128)!==0,r||i?(r=e.stateNode,n=i&&typeof n.getDerivedStateFromError!="function"?null:r.render(),e.flags|=1,t!==null&&i?(e.child=Hs(e,t.child,null,s),e.child=Hs(e,null,n,s)):Lt(t,e,n,s),e.memoizedState=r.state,t=e.child):t=Mi(t,e,s),t}function kg(t,e,n,i){return zs(),e.flags|=256,Lt(t,e,n,i),e.child}var Vc={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Kc(t){return{baseLanes:t,cachePool:Dv()}}function Yc(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=yn),t}function Ab(t,e,n){var i=e.pendingProps,s=!1,r=(e.flags&128)!==0,a;if((a=r)||(a=t!==null&&t.memoizedState===null?!1:(ct.current&2)!==0),a&&(s=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,t===null){if(Le){if(s?Xi(e):Qi(),(t=Xe)?(t=g1(t,Mn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:hs!==null?{id:ni,overflow:ii}:null,retryLane:536870912,hydrationErrors:null},n=Rv(t),n.return=e,e.child=n,Dt=e,Xe=null)):t=null,t===null)throw ms(e);return Hf(t)?e.lanes=32:e.lanes=536870912,null}var l=i.children;return i=i.fallback,s?(Qi(),s=e.mode,l=pu({mode:"hidden",children:l},s),i=Ps(i,s,n,null),l.return=e,i.return=e,l.sibling=i,e.child=l,i=e.child,i.memoizedState=Kc(n),i.childLanes=Yc(t,a,n),e.memoizedState=Vc,Da(null,i)):(Xi(e),If(e,l))}var o=t.memoizedState;if(o!==null&&(l=o.dehydrated,l!==null)){if(r)e.flags&256?(Xi(e),e.flags&=-257,e=qc(t,e,n)):e.memoizedState!==null?(Qi(),e.child=t.child,e.flags|=128,e=null):(Qi(),l=i.fallback,s=e.mode,i=pu({mode:"visible",children:i.children},s),l=Ps(l,s,n,null),l.flags|=2,i.return=e,l.return=e,i.sibling=l,e.child=i,Hs(e,t.child,null,n),i=e.child,i.memoizedState=Kc(n),i.childLanes=Yc(t,a,n),e.memoizedState=Vc,e=Da(null,i));else if(Xi(e),Hf(l)){if(a=l.nextSibling&&l.nextSibling.dataset,a)var u=a.dgst;a=u,i=Error(K(419)),i.stack="",i.digest=a,al({value:i,source:null,stack:null}),e=qc(t,e,n)}else if(xt||aa(t,e,n,!1),a=(n&t.childLanes)!==0,xt||a){if(a=He,a!==null&&(i=ev(a,n),i!==0&&i!==o.retryLane))throw o.retryLane=i,er(t,i),Zt(a,t,i),pm;Gf(l)||bu(),e=qc(t,e,n)}else Gf(l)?(e.flags|=192,e.child=t.child,e=null):(t=o.treeContext,Xe=Pn(l.nextSibling),Dt=e,Le=!0,ss=null,Mn=!1,t!==null&&Cv(e,t),e=If(e,i.children),e.flags|=4096);return e}return s?(Qi(),l=i.fallback,s=e.mode,o=t.child,u=o.sibling,i=Ri(o,{mode:"hidden",children:i.children}),i.subtreeFlags=o.subtreeFlags&65011712,u!==null?l=Ri(u,l):(l=Ps(l,s,n,null),l.flags|=2),l.return=e,i.return=e,i.sibling=l,e.child=i,Da(null,i),i=e.child,l=t.child.memoizedState,l===null?l=Kc(n):(s=l.cachePool,s!==null?(o=yt._currentValue,s=s.parent!==o?{parent:o,pool:o}:s):s=Dv(),l={baseLanes:l.baseLanes|n,cachePool:s}),i.memoizedState=l,i.childLanes=Yc(t,a,n),e.memoizedState=Vc,Da(t.child,i)):(Xi(e),n=t.child,t=n.sibling,n=Ri(n,{mode:"visible",children:i.children}),n.return=e,n.sibling=null,t!==null&&(a=e.deletions,a===null?(e.deletions=[t],e.flags|=16):a.push(t)),e.child=n,e.memoizedState=null,n)}function If(t,e){return e=pu({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function pu(t,e){return t=gn(22,t,null,e),t.lanes=0,t}function qc(t,e,n){return Hs(e,t.child,null,n),t=If(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function _g(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),xf(t.return,e,n)}function Xc(t,e,n,i,s,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:s,treeForkCount:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=i,a.tail=n,a.tailMode=s,a.treeForkCount=r)}function kb(t,e,n){var i=e.pendingProps,s=i.revealOrder,r=i.tail;i=i.children;var a=ct.current,l=(a&2)!==0;if(l?(a=a&1|2,e.flags|=128):a&=1,Ye(ct,a),Lt(t,e,i,n),i=Le?rl:0,!l&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_g(t,n,e);else if(t.tag===19)_g(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&fu(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Xc(e,!1,s,n,r,i);break;case"backwards":case"unstable_legacy-backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&fu(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Xc(e,!0,n,null,r,i);break;case"together":Xc(e,!1,null,null,void 0,i);break;default:e.memoizedState=null}return e.child}function Mi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ps|=e.lanes,!(n&e.childLanes))if(t!==null){if(aa(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(K(153));if(e.child!==null){for(t=e.child,n=Ri(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ri(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ym(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&uu(t)))}function Nk(t,e,n){switch(e.tag){case 3:nu(e,e.stateNode.containerInfo),qi(e,yt,t.memoizedState.cache),zs();break;case 27:case 5:rf(e);break;case 4:nu(e,e.stateNode.containerInfo);break;case 10:qi(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,Af(e),null;break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(Xi(e),e.flags|=128,null):n&e.child.childLanes?Ab(t,e,n):(Xi(e),t=Mi(t,e,n),t!==null?t.sibling:null);Xi(e);break;case 19:var s=(t.flags&128)!==0;if(i=(n&e.childLanes)!==0,i||(aa(t,e,n,!1),i=(n&e.childLanes)!==0),s){if(i)return kb(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ye(ct,ct.current),i)break;return null;case 22:return e.lanes=0,Tb(t,e,n,e.pendingProps);case 24:qi(e,yt,t.memoizedState.cache)}return Mi(t,e,n)}function _b(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)xt=!0;else{if(!ym(t,n)&&!(e.flags&128))return xt=!1,Nk(t,e,n);xt=!!(t.flags&131072)}else xt=!1,Le&&e.flags&1048576&&wv(e,rl,e.index);switch(e.lanes=0,e.tag){case 16:e:{var i=e.pendingProps;if(t=Is(e.elementType),e.type=t,typeof t=="function")Xh(t)?(i=Ks(t,i),e.tag=1,e=Ag(null,e,t,i,n)):(e.tag=0,e=Cf(null,e,t,i,n));else{if(t!=null){var s=t.$$typeof;if(s===Oh){e.tag=11,e=vg(null,e,t,i,n);break e}else if(s===Ph){e.tag=14,e=bg(null,e,t,i,n);break e}}throw e=nf(t)||t,Error(K(306,e,""))}}return e;case 0:return Cf(t,e,e.type,e.pendingProps,n);case 1:return i=e.type,s=Ks(i,e.pendingProps),Ag(t,e,i,s,n);case 3:e:{if(nu(e,e.stateNode.containerInfo),t===null)throw Error(K(387));i=e.pendingProps;var r=e.memoizedState;s=r.element,Sf(t,e),za(e,i,null,n);var a=e.memoizedState;if(i=a.cache,qi(e,yt,i),i!==r.cache&&vf(e,[yt],n,!0),$a(),i=a.element,r.isDehydrated)if(r={element:i,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){e=kg(t,e,i,n);break e}else if(i!==s){s=Nn(Error(K(424)),e),al(s),e=kg(t,e,i,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Xe=Pn(t.firstChild),Dt=e,Le=!0,ss=null,Mn=!0,n=Ov(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(zs(),i===s){e=Mi(t,e,n);break e}Lt(t,e,i,n)}e=e.child}return e;case 26:return Oo(t,e),t===null?(n=Kg(e.type,null,e.pendingProps,null))?e.memoizedState=n:Le||(n=e.type,t=e.pendingProps,i=Au(is.current).createElement(n),i[It]=e,i[Jt]=t,Mt(i,n,t),kt(i),e.stateNode=i):e.memoizedState=Kg(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return rf(e),t===null&&Le&&(i=e.stateNode=p1(e.type,e.pendingProps,is.current),Dt=e,Mn=!0,s=Xe,Ss(e.type)?(Vf=s,Xe=Pn(i.firstChild)):Xe=s),Lt(t,e,e.pendingProps.children,n),Oo(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&Le&&((s=i=Xe)&&(i=u_(i,e.type,e.pendingProps,Mn),i!==null?(e.stateNode=i,Dt=e,Xe=Pn(i.firstChild),Mn=!1,s=!0):s=!1),s||ms(e)),rf(e),s=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,i=r.children,$f(s,r)?i=null:a!==null&&$f(s,a)&&(e.flags|=32),e.memoizedState!==null&&(s=sm(t,e,Ak,null,null,n),fl._currentValue=s),Oo(t,e),Lt(t,e,i,n),e.child;case 6:return t===null&&Le&&((t=n=Xe)&&(n=c_(n,e.pendingProps,Mn),n!==null?(e.stateNode=n,Dt=e,Xe=null,t=!0):t=!1),t||ms(e)),null;case 13:return Ab(t,e,n);case 4:return nu(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Hs(e,null,i,n):Lt(t,e,i,n),e.child;case 11:return vg(t,e,e.type,e.pendingProps,n);case 7:return Lt(t,e,e.pendingProps,n),e.child;case 8:return Lt(t,e,e.pendingProps.children,n),e.child;case 12:return Lt(t,e,e.pendingProps.children,n),e.child;case 10:return i=e.pendingProps,qi(e,e.type,i.value),Lt(t,e,i.children,n),e.child;case 9:return s=e.type._context,i=e.pendingProps.children,Gs(e),s=Nt(s),i=i(s),e.flags|=1,Lt(t,e,i,n),e.child;case 14:return bg(t,e,e.type,e.pendingProps,n);case 15:return Eb(t,e,e.type,e.pendingProps,n);case 19:return kb(t,e,n);case 31:return Dk(t,e,n);case 22:return Tb(t,e,n,e.pendingProps);case 24:return Gs(e),i=Nt(yt),t===null?(s=Jh(),s===null&&(s=He,r=Zh(),s.pooledCache=r,r.refCount++,r!==null&&(s.pooledCacheLanes|=n),s=r),e.memoizedState={parent:i,cache:s},tm(e),qi(e,yt,s)):(t.lanes&n&&(Sf(t,e),za(e,null,null,n),$a()),s=t.memoizedState,r=e.memoizedState,s.parent!==i?(s={parent:i,cache:i},e.memoizedState=s,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=s),qi(e,yt,i)):(i=r.cache,qi(e,yt,i),i!==s.cache&&vf(e,[yt],n,!0))),Lt(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(K(156,e.tag))}function gi(t){t.flags|=4}function Qc(t,e,n,i,s){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(s&335544128)===s)if(t.stateNode.complete)t.flags|=8192;else if(Qb())t.flags|=8192;else throw Bs=cu,em}else t.flags&=-16777217}function Lg(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!v1(e))if(Qb())t.flags|=8192;else throw Bs=cu,em}function Jl(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?Wx():536870912,t.lanes|=e,Xr|=e)}function va(t,e){if(!Le)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function qe(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags&65011712,i|=s.flags&65011712,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function Mk(t,e,n){var i=e.pendingProps;switch(Wh(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qe(e),null;case 1:return qe(e),null;case 3:return n=e.stateNode,i=null,t!==null&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),wi(yt),Gr(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(sr(e)?gi(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,$c())),qe(e),null;case 26:var s=e.type,r=e.memoizedState;return t===null?(gi(e),r!==null?(qe(e),Lg(e,r)):(qe(e),Qc(e,s,null,i,n))):r?r!==t.memoizedState?(gi(e),qe(e),Lg(e,r)):(qe(e),e.flags&=-16777217):(t=t.memoizedProps,t!==i&&gi(e),qe(e),Qc(e,s,t,i,n)),null;case 27:if(iu(e),n=is.current,s=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&gi(e);else{if(!i){if(e.stateNode===null)throw Error(K(166));return qe(e),null}t=oi.current,sr(e)?ng(e):(t=p1(s,i,n),e.stateNode=t,gi(e))}return qe(e),null;case 5:if(iu(e),s=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&gi(e);else{if(!i){if(e.stateNode===null)throw Error(K(166));return qe(e),null}if(r=oi.current,sr(e))ng(e);else{var a=Au(is.current);switch(r){case 1:r=a.createElementNS("http://www.w3.org/2000/svg",s);break;case 2:r=a.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;default:switch(s){case"svg":r=a.createElementNS("http://www.w3.org/2000/svg",s);break;case"math":r=a.createElementNS("http://www.w3.org/1998/Math/MathML",s);break;case"script":r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof i.is=="string"?a.createElement("select",{is:i.is}):a.createElement("select"),i.multiple?r.multiple=!0:i.size&&(r.size=i.size);break;default:r=typeof i.is=="string"?a.createElement(s,{is:i.is}):a.createElement(s)}}r[It]=e,r[Jt]=i;e:for(a=e.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.tag!==27&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}e.stateNode=r;e:switch(Mt(r,s,i),s){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&gi(e)}}return qe(e),Qc(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,n),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==i&&gi(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(K(166));if(t=is.current,sr(e)){if(t=e.stateNode,n=e.memoizedProps,i=null,s=Dt,s!==null)switch(s.tag){case 27:case 5:i=s.memoizedProps}t[It]=e,t=!!(t.nodeValue===n||i!==null&&i.suppressHydrationWarning===!0||f1(t.nodeValue,n)),t||ms(e,!0)}else t=Au(t).createTextNode(i),t[It]=e,e.stateNode=t}return qe(e),null;case 31:if(n=e.memoizedState,t===null||t.memoizedState!==null){if(i=sr(e),n!==null){if(t===null){if(!i)throw Error(K(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(557));t[It]=e}else zs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),t=!1}else n=$c(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=n),t=!0;if(!t)return e.flags&256?(hn(e),e):(hn(e),null);if(e.flags&128)throw Error(K(558))}return qe(e),null;case 13:if(i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(s=sr(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(K(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(K(317));s[It]=e}else zs(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;qe(e),s=!1}else s=$c(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),s=!0;if(!s)return e.flags&256?(hn(e),e):(hn(e),null)}return hn(e),e.flags&128?(e.lanes=n,e):(n=i!==null,t=t!==null&&t.memoizedState!==null,n&&(i=e.child,s=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(s=i.alternate.memoizedState.cachePool.pool),r=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(r=i.memoizedState.cachePool.pool),r!==s&&(i.flags|=2048)),n!==t&&n&&(e.child.flags|=8192),Jl(e,e.updateQueue),qe(e),null);case 4:return Gr(),t===null&&Am(e.stateNode.containerInfo),qe(e),null;case 10:return wi(e.type),qe(e),null;case 19:if(_t(ct),i=e.memoizedState,i===null)return qe(e),null;if(s=(e.flags&128)!==0,r=i.rendering,r===null)if(s)va(i,!1);else{if(at!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(r=fu(t),r!==null){for(e.flags|=128,va(i,!1),t=r.updateQueue,e.updateQueue=t,Jl(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)Lv(n,t),n=n.sibling;return Ye(ct,ct.current&1|2),Le&&Ti(e,i.treeForkCount),e.child}t=t.sibling}i.tail!==null&&xn()>xu&&(e.flags|=128,s=!0,va(i,!1),e.lanes=4194304)}else{if(!s)if(t=fu(r),t!==null){if(e.flags|=128,s=!0,t=t.updateQueue,e.updateQueue=t,Jl(e,t),va(i,!0),i.tail===null&&i.tailMode==="hidden"&&!r.alternate&&!Le)return qe(e),null}else 2*xn()-i.renderingStartTime>xu&&n!==536870912&&(e.flags|=128,s=!0,va(i,!1),e.lanes=4194304);i.isBackwards?(r.sibling=e.child,e.child=r):(t=i.last,t!==null?t.sibling=r:e.child=r,i.last=r)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=xn(),t.sibling=null,n=ct.current,Ye(ct,s?n&1|2:n&1),Le&&Ti(e,i.treeForkCount),t):(qe(e),null);case 22:case 23:return hn(e),nm(),i=e.memoizedState!==null,t!==null?t.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?n&536870912&&!(e.flags&128)&&(qe(e),e.subtreeFlags&6&&(e.flags|=8192)):qe(e),n=e.updateQueue,n!==null&&Jl(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==n&&(e.flags|=2048),t!==null&&_t(Fs),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),wi(yt),qe(e),null;case 25:return null;case 30:return null}throw Error(K(156,e.tag))}function Ok(t,e){switch(Wh(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return wi(yt),Gr(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return iu(e),null;case 31:if(e.memoizedState!==null){if(hn(e),e.alternate===null)throw Error(K(340));zs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(hn(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(K(340));zs()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return _t(ct),null;case 4:return Gr(),null;case 10:return wi(e.type),null;case 22:case 23:return hn(e),nm(),t!==null&&_t(Fs),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return wi(yt),null;case 25:return null;default:return null}}function Lb(t,e){switch(Wh(e),e.tag){case 3:wi(yt),Gr();break;case 26:case 27:case 5:iu(e);break;case 4:Gr();break;case 31:e.memoizedState!==null&&hn(e);break;case 13:hn(e);break;case 19:_t(ct);break;case 10:wi(e.type);break;case 22:case 23:hn(e),nm(),t!==null&&_t(Fs);break;case 24:wi(yt)}}function Pl(t,e){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var s=i.next;n=s;do{if((n.tag&t)===t){i=void 0;var r=n.create,a=n.inst;i=r(),a.destroy=i}n=n.next}while(n!==s)}}catch(l){Oe(e,e.return,l)}}function gs(t,e,n){try{var i=e.updateQueue,s=i!==null?i.lastEffect:null;if(s!==null){var r=s.next;i=r;do{if((i.tag&t)===t){var a=i.inst,l=a.destroy;if(l!==void 0){a.destroy=void 0,s=e;var o=n,u=l;try{u()}catch(c){Oe(s,o,c)}}}i=i.next}while(i!==r)}}catch(c){Oe(e,e.return,c)}}function Rb(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{Fv(e,n)}catch(i){Oe(t,t.return,i)}}}function wb(t,e,n){n.props=Ks(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(i){Oe(t,e,i)}}function Ha(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var i=t.stateNode;break;case 30:i=t.stateNode;break;default:i=t.stateNode}typeof n=="function"?t.refCleanup=n(i):n.current=i}}catch(s){Oe(t,e,s)}}function si(t,e){var n=t.ref,i=t.refCleanup;if(n!==null)if(typeof i=="function")try{i()}catch(s){Oe(t,e,s)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(s){Oe(t,e,s)}else n.current=null}function Cb(t){var e=t.type,n=t.memoizedProps,i=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(s){Oe(t,t.return,s)}}function Wc(t,e,n){try{var i=t.stateNode;i_(i,t.type,n,e),i[Jt]=e}catch(s){Oe(t,t.return,s)}}function Ib(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ss(t.type)||t.tag===4}function Zc(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ib(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ss(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Df(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_i));else if(i!==4&&(i===27&&Ss(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(Df(t,e,n),t=t.sibling;t!==null;)Df(t,e,n),t=t.sibling}function yu(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(i===27&&Ss(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(yu(t,e,n),t=t.sibling;t!==null;)yu(t,e,n),t=t.sibling}function Db(t){var e=t.stateNode,n=t.memoizedProps;try{for(var i=t.type,s=e.attributes;s.length;)e.removeAttributeNode(s[0]);Mt(e,i,n),e[It]=t,e[Jt]=n}catch(r){Oe(t,t.return,r)}}var Ai=!1,pt=!1,Jc=!1,Rg=typeof WeakSet=="function"?WeakSet:Set,At=null;function Pk(t,e){if(t=t.containerInfo,Uf=Ru,t=vv(t),Kh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var s=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var a=0,l=-1,o=-1,u=0,c=0,d=t,f=null;t:for(;;){for(var h;d!==n||s!==0&&d.nodeType!==3||(l=a+s),d!==r||i!==0&&d.nodeType!==3||(o=a+i),d.nodeType===3&&(a+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++u===s&&(l=a),f===r&&++c===i&&(o=a),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=l===-1||o===-1?null:{start:l,end:o}}else n=null}n=n||{start:0,end:0}}else n=null;for(jf={focusedElem:t,selectionRange:n},Ru=!1,At=e;At!==null;)if(e=At,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,At=t;else for(;At!==null;){switch(e=At,r=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(n=0;n<t.length;n++)s=t[n],s.ref.impl=s.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&r!==null){t=void 0,n=e,s=r.memoizedProps,r=r.memoizedState,i=n.stateNode;try{var m=Ks(n.type,s);t=i.getSnapshotBeforeUpdate(m,r),i.__reactInternalSnapshotBeforeUpdate=t}catch(y){Oe(n,n.return,y)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)zf(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":zf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(K(163))}if(t=e.sibling,t!==null){t.return=e.return,At=t;break}At=e.return}}function Nb(t,e,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:yi(t,n),i&4&&Pl(5,n);break;case 1:if(yi(t,n),i&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(a){Oe(n,n.return,a)}else{var s=Ks(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(s,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){Oe(n,n.return,a)}}i&64&&Rb(n),i&512&&Ha(n,n.return);break;case 3:if(yi(t,n),i&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{Fv(t,e)}catch(a){Oe(n,n.return,a)}}break;case 27:e===null&&i&4&&Db(n);case 26:case 5:yi(t,n),e===null&&i&4&&Cb(n),i&512&&Ha(n,n.return);break;case 12:yi(t,n);break;case 31:yi(t,n),i&4&&Pb(t,n);break;case 13:yi(t,n),i&4&&Fb(t,n),i&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=Vk.bind(null,n),d_(t,n))));break;case 22:if(i=n.memoizedState!==null||Ai,!i){e=e!==null&&e.memoizedState!==null||pt,s=Ai;var r=pt;Ai=i,(pt=e)&&!r?bi(t,n,(n.subtreeFlags&8772)!==0):yi(t,n),Ai=s,pt=r}break;case 30:break;default:yi(t,n)}}function Mb(t){var e=t.alternate;e!==null&&(t.alternate=null,Mb(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&jh(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Je=null,Xt=!1;function pi(t,e,n){for(n=n.child;n!==null;)Ob(t,e,n),n=n.sibling}function Ob(t,e,n){if(vn&&typeof vn.onCommitFiberUnmount=="function")try{vn.onCommitFiberUnmount(wl,n)}catch{}switch(n.tag){case 26:pt||si(n,e),pi(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:pt||si(n,e);var i=Je,s=Xt;Ss(n.type)&&(Je=n.stateNode,Xt=!1),pi(t,e,n),qa(n.stateNode),Je=i,Xt=s;break;case 5:pt||si(n,e);case 6:if(i=Je,s=Xt,Je=null,pi(t,e,n),Je=i,Xt=s,Je!==null)if(Xt)try{(Je.nodeType===9?Je.body:Je.nodeName==="HTML"?Je.ownerDocument.body:Je).removeChild(n.stateNode)}catch(r){Oe(n,e,r)}else try{Je.removeChild(n.stateNode)}catch(r){Oe(n,e,r)}break;case 18:Je!==null&&(Xt?(t=Je,$g(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),Jr(t)):$g(Je,n.stateNode));break;case 4:i=Je,s=Xt,Je=n.stateNode.containerInfo,Xt=!0,pi(t,e,n),Je=i,Xt=s;break;case 0:case 11:case 14:case 15:gs(2,n,e),pt||gs(4,n,e),pi(t,e,n);break;case 1:pt||(si(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"&&wb(n,e,i)),pi(t,e,n);break;case 21:pi(t,e,n);break;case 22:pt=(i=pt)||n.memoizedState!==null,pi(t,e,n),pt=i;break;default:pi(t,e,n)}}function Pb(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Jr(t)}catch(n){Oe(e,e.return,n)}}}function Fb(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Jr(t)}catch(n){Oe(e,e.return,n)}}function Fk(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new Rg),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new Rg),e;default:throw Error(K(435,t.tag))}}function eo(t,e){var n=Fk(t);e.forEach(function(i){if(!n.has(i)){n.add(i);var s=Kk.bind(null,t,i);i.then(s,s)}})}function Vt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var s=n[i],r=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 27:if(Ss(l.type)){Je=l.stateNode,Xt=!1;break e}break;case 5:Je=l.stateNode,Xt=!1;break e;case 3:case 4:Je=l.stateNode.containerInfo,Xt=!0;break e}l=l.return}if(Je===null)throw Error(K(160));Ob(r,a,s),Je=null,Xt=!1,r=s.alternate,r!==null&&(r.return=null),s.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)Bb(e,t),e=e.sibling}var Kn=null;function Bb(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Vt(e,t),Kt(t),i&4&&(gs(3,t,t.return),Pl(3,t),gs(5,t,t.return));break;case 1:Vt(e,t),Kt(t),i&512&&(pt||n===null||si(n,n.return)),i&64&&Ai&&(t=t.updateQueue,t!==null&&(i=t.callbacks,i!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?i:n.concat(i))));break;case 26:var s=Kn;if(Vt(e,t),Kt(t),i&512&&(pt||n===null||si(n,n.return)),i&4){var r=n!==null?n.memoizedState:null;if(i=t.memoizedState,n===null)if(i===null)if(t.stateNode===null){e:{i=t.type,n=t.memoizedProps,s=s.ownerDocument||s;t:switch(i){case"title":r=s.getElementsByTagName("title")[0],(!r||r[Dl]||r[It]||r.namespaceURI==="http://www.w3.org/2000/svg"||r.hasAttribute("itemprop"))&&(r=s.createElement(i),s.head.insertBefore(r,s.querySelector("head > title"))),Mt(r,i,n),r[It]=t,kt(r),i=r;break e;case"link":var a=qg("link","href",s).get(i+(n.href||""));if(a){for(var l=0;l<a.length;l++)if(r=a[l],r.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&r.getAttribute("rel")===(n.rel==null?null:n.rel)&&r.getAttribute("title")===(n.title==null?null:n.title)&&r.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){a.splice(l,1);break t}}r=s.createElement(i),Mt(r,i,n),s.head.appendChild(r);break;case"meta":if(a=qg("meta","content",s).get(i+(n.content||""))){for(l=0;l<a.length;l++)if(r=a[l],r.getAttribute("content")===(n.content==null?null:""+n.content)&&r.getAttribute("name")===(n.name==null?null:n.name)&&r.getAttribute("property")===(n.property==null?null:n.property)&&r.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&r.getAttribute("charset")===(n.charSet==null?null:n.charSet)){a.splice(l,1);break t}}r=s.createElement(i),Mt(r,i,n),s.head.appendChild(r);break;default:throw Error(K(468,i))}r[It]=t,kt(r),i=r}t.stateNode=i}else Xg(s,t.type,t.stateNode);else t.stateNode=Yg(s,i,t.memoizedProps);else r!==i?(r===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):r.count--,i===null?Xg(s,t.type,t.stateNode):Yg(s,i,t.memoizedProps)):i===null&&t.stateNode!==null&&Wc(t,t.memoizedProps,n.memoizedProps)}break;case 27:Vt(e,t),Kt(t),i&512&&(pt||n===null||si(n,n.return)),n!==null&&i&4&&Wc(t,t.memoizedProps,n.memoizedProps);break;case 5:if(Vt(e,t),Kt(t),i&512&&(pt||n===null||si(n,n.return)),t.flags&32){s=t.stateNode;try{Vr(s,"")}catch(m){Oe(t,t.return,m)}}i&4&&t.stateNode!=null&&(s=t.memoizedProps,Wc(t,s,n!==null?n.memoizedProps:s)),i&1024&&(Jc=!0);break;case 6:if(Vt(e,t),Kt(t),i&4){if(t.stateNode===null)throw Error(K(162));i=t.memoizedProps,n=t.stateNode;try{n.nodeValue=i}catch(m){Oe(t,t.return,m)}}break;case 3:if(Bo=null,s=Kn,Kn=ku(e.containerInfo),Vt(e,t),Kn=s,Kt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Jr(e.containerInfo)}catch(m){Oe(t,t.return,m)}Jc&&(Jc=!1,Ub(t));break;case 4:i=Kn,Kn=ku(t.stateNode.containerInfo),Vt(e,t),Kt(t),Kn=i;break;case 12:Vt(e,t),Kt(t);break;case 31:Vt(e,t),Kt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,eo(t,i)));break;case 13:Vt(e,t),Kt(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(oc=xn()),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,eo(t,i)));break;case 22:s=t.memoizedState!==null;var o=n!==null&&n.memoizedState!==null,u=Ai,c=pt;if(Ai=u||s,pt=c||o,Vt(e,t),pt=c,Ai=u,Kt(t),i&8192)e:for(e=t.stateNode,e._visibility=s?e._visibility&-2:e._visibility|1,s&&(n===null||o||Ai||pt||Ds(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){o=n=e;try{if(r=o.stateNode,s)a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{l=o.stateNode;var d=o.memoizedProps.style,f=d!=null&&d.hasOwnProperty("display")?d.display:null;l.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(m){Oe(o,o.return,m)}}}else if(e.tag===6){if(n===null){o=e;try{o.stateNode.nodeValue=s?"":o.memoizedProps}catch(m){Oe(o,o.return,m)}}}else if(e.tag===18){if(n===null){o=e;try{var h=o.stateNode;s?zg(h,!0):zg(o.stateNode,!1)}catch(m){Oe(o,o.return,m)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=t.updateQueue,i!==null&&(n=i.retryQueue,n!==null&&(i.retryQueue=null,eo(t,n))));break;case 19:Vt(e,t),Kt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,eo(t,i)));break;case 30:break;case 21:break;default:Vt(e,t),Kt(t)}}function Kt(t){var e=t.flags;if(e&2){try{for(var n,i=t.return;i!==null;){if(Ib(i)){n=i;break}i=i.return}if(n==null)throw Error(K(160));switch(n.tag){case 27:var s=n.stateNode,r=Zc(t);yu(t,r,s);break;case 5:var a=n.stateNode;n.flags&32&&(Vr(a,""),n.flags&=-33);var l=Zc(t);yu(t,l,a);break;case 3:case 4:var o=n.stateNode.containerInfo,u=Zc(t);Df(t,u,o);break;default:throw Error(K(161))}}catch(c){Oe(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ub(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;Ub(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function yi(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)Nb(t,e.alternate,e),e=e.sibling}function Ds(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:gs(4,e,e.return),Ds(e);break;case 1:si(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&wb(e,e.return,n),Ds(e);break;case 27:qa(e.stateNode);case 26:case 5:si(e,e.return),Ds(e);break;case 22:e.memoizedState===null&&Ds(e);break;case 30:Ds(e);break;default:Ds(e)}t=t.sibling}}function bi(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,s=t,r=e,a=r.flags;switch(r.tag){case 0:case 11:case 15:bi(s,r,n),Pl(4,r);break;case 1:if(bi(s,r,n),i=r,s=i.stateNode,typeof s.componentDidMount=="function")try{s.componentDidMount()}catch(u){Oe(i,i.return,u)}if(i=r,s=i.updateQueue,s!==null){var l=i.stateNode;try{var o=s.shared.hiddenCallbacks;if(o!==null)for(s.shared.hiddenCallbacks=null,s=0;s<o.length;s++)Pv(o[s],l)}catch(u){Oe(i,i.return,u)}}n&&a&64&&Rb(r),Ha(r,r.return);break;case 27:Db(r);case 26:case 5:bi(s,r,n),n&&i===null&&a&4&&Cb(r),Ha(r,r.return);break;case 12:bi(s,r,n);break;case 31:bi(s,r,n),n&&a&4&&Pb(s,r);break;case 13:bi(s,r,n),n&&a&4&&Fb(s,r);break;case 22:r.memoizedState===null&&bi(s,r,n),Ha(r,r.return);break;case 30:break;default:bi(s,r,n)}e=e.sibling}}function xm(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&Ml(n))}function vm(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Ml(t))}function Gn(t,e,n,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)jb(t,e,n,i),e=e.sibling}function jb(t,e,n,i){var s=e.flags;switch(e.tag){case 0:case 11:case 15:Gn(t,e,n,i),s&2048&&Pl(9,e);break;case 1:Gn(t,e,n,i);break;case 3:Gn(t,e,n,i),s&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Ml(t)));break;case 12:if(s&2048){Gn(t,e,n,i),t=e.stateNode;try{var r=e.memoizedProps,a=r.id,l=r.onPostCommit;typeof l=="function"&&l(a,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(o){Oe(e,e.return,o)}}else Gn(t,e,n,i);break;case 31:Gn(t,e,n,i);break;case 13:Gn(t,e,n,i);break;case 23:break;case 22:r=e.stateNode,a=e.alternate,e.memoizedState!==null?r._visibility&2?Gn(t,e,n,i):Va(t,e):r._visibility&2?Gn(t,e,n,i):(r._visibility|=2,mr(t,e,n,i,(e.subtreeFlags&10256)!==0||!1)),s&2048&&xm(a,e);break;case 24:Gn(t,e,n,i),s&2048&&vm(e.alternate,e);break;default:Gn(t,e,n,i)}}function mr(t,e,n,i,s){for(s=s&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var r=t,a=e,l=n,o=i,u=a.flags;switch(a.tag){case 0:case 11:case 15:mr(r,a,l,o,s),Pl(8,a);break;case 23:break;case 22:var c=a.stateNode;a.memoizedState!==null?c._visibility&2?mr(r,a,l,o,s):Va(r,a):(c._visibility|=2,mr(r,a,l,o,s)),s&&u&2048&&xm(a.alternate,a);break;case 24:mr(r,a,l,o,s),s&&u&2048&&vm(a.alternate,a);break;default:mr(r,a,l,o,s)}e=e.sibling}}function Va(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,i=e,s=i.flags;switch(i.tag){case 22:Va(n,i),s&2048&&xm(i.alternate,i);break;case 24:Va(n,i),s&2048&&vm(i.alternate,i);break;default:Va(n,i)}e=e.sibling}}var Na=8192;function rr(t,e,n){if(t.subtreeFlags&Na)for(t=t.child;t!==null;)$b(t,e,n),t=t.sibling}function $b(t,e,n){switch(t.tag){case 26:rr(t,e,n),t.flags&Na&&t.memoizedState!==null&&T_(n,Kn,t.memoizedState,t.memoizedProps);break;case 5:rr(t,e,n);break;case 3:case 4:var i=Kn;Kn=ku(t.stateNode.containerInfo),rr(t,e,n),Kn=i;break;case 22:t.memoizedState===null&&(i=t.alternate,i!==null&&i.memoizedState!==null?(i=Na,Na=16777216,rr(t,e,n),Na=i):rr(t,e,n));break;default:rr(t,e,n)}}function zb(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function ba(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];At=i,Hb(i,t)}zb(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Gb(t),t=t.sibling}function Gb(t){switch(t.tag){case 0:case 11:case 15:ba(t),t.flags&2048&&gs(9,t,t.return);break;case 3:ba(t);break;case 12:ba(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,Po(t)):ba(t);break;default:ba(t)}}function Po(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];At=i,Hb(i,t)}zb(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:gs(8,e,e.return),Po(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,Po(e));break;default:Po(e)}t=t.sibling}}function Hb(t,e){for(;At!==null;){var n=At;switch(n.tag){case 0:case 11:case 15:gs(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var i=n.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Ml(n.memoizedState.cache)}if(i=n.child,i!==null)i.return=n,At=i;else e:for(n=t;At!==null;){i=At;var s=i.sibling,r=i.return;if(Mb(i),i===n){At=null;break e}if(s!==null){s.return=r,At=s;break e}At=r}}}var Bk={getCacheForType:function(t){var e=Nt(yt),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n},cacheSignal:function(){return Nt(yt).controller.signal}},Uk=typeof WeakMap=="function"?WeakMap:Map,Ie=0,He=null,Ae=null,_e=0,Ne=0,fn=null,es=!1,oa=!1,bm=!1,Oi=0,at=0,ps=0,Us=0,Sm=0,yn=0,Xr=0,Ka=null,Qt=null,Nf=!1,oc=0,Vb=0,xu=1/0,vu=null,ls=null,St=0,os=null,Qr=null,Ci=0,Mf=0,Of=null,Kb=null,Ya=0,Pf=null;function Sn(){return Ie&2&&_e!==0?_e&-_e:ce.T!==null?Tm():tv()}function Yb(){if(yn===0)if(!(_e&536870912)||Le){var t=Kl;Kl<<=1,!(Kl&3932160)&&(Kl=262144),yn=t}else yn=536870912;return t=kn.current,t!==null&&(t.flags|=32),yn}function Zt(t,e,n){(t===He&&(Ne===2||Ne===9)||t.cancelPendingCommit!==null)&&(Wr(t,0),ts(t,_e,yn,!1)),Il(t,n),(!(Ie&2)||t!==He)&&(t===He&&(!(Ie&2)&&(Us|=n),at===4&&ts(t,_e,yn,!1)),fi(t))}function qb(t,e,n){if(Ie&6)throw Error(K(327));var i=!n&&(e&127)===0&&(e&t.expiredLanes)===0||Cl(t,e),s=i?zk(t,e):ed(t,e,!0),r=i;do{if(s===0){oa&&!i&&ts(t,e,0,!1);break}else{if(n=t.current.alternate,r&&!jk(n)){s=ed(t,e,!1),r=!1;continue}if(s===2){if(r=e,t.errorRecoveryDisabledLanes&r)var a=0;else a=t.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var l=t;s=Ka;var o=l.current.memoizedState.isDehydrated;if(o&&(Wr(l,a).flags|=256),a=ed(l,a,!1),a!==2){if(bm&&!o){l.errorRecoveryDisabledLanes|=r,Us|=r,s=4;break e}r=Qt,Qt=s,r!==null&&(Qt===null?Qt=r:Qt.push.apply(Qt,r))}s=a}if(r=!1,s!==2)continue}}if(s===1){Wr(t,0),ts(t,e,0,!0);break}e:{switch(i=t,r=s,r){case 0:case 1:throw Error(K(345));case 4:if((e&4194048)!==e)break;case 6:ts(i,e,yn,!es);break e;case 2:Qt=null;break;case 3:case 5:break;default:throw Error(K(329))}if((e&62914560)===e&&(s=oc+300-xn(),10<s)){if(ts(i,e,yn,!es),Wu(i,0,!0)!==0)break e;Ci=e,i.timeoutHandle=m1(wg.bind(null,i,n,Qt,vu,Nf,e,yn,Us,Xr,es,r,"Throttled",-0,0),s);break e}wg(i,n,Qt,vu,Nf,e,yn,Us,Xr,es,r,null,-0,0)}}break}while(!0);fi(t)}function wg(t,e,n,i,s,r,a,l,o,u,c,d,f,h){if(t.timeoutHandle=-1,d=e.subtreeFlags,d&8192||(d&16785408)===16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_i},$b(e,r,d);var m=(r&62914560)===r?oc-xn():(r&4194048)===r?Vb-xn():0;if(m=A_(d,m),m!==null){Ci=r,t.cancelPendingCommit=m(Ig.bind(null,t,e,r,n,i,s,a,l,o,c,d,null,f,h)),ts(t,r,a,!u);return}}Ig(t,e,r,n,i,s,a,l,o)}function jk(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var i=0;i<n.length;i++){var s=n[i],r=s.getSnapshot;s=s.value;try{if(!An(r(),s))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ts(t,e,n,i){e&=~Sm,e&=~Us,t.suspendedLanes|=e,t.pingedLanes&=~e,i&&(t.warmLanes|=e),i=t.expirationTimes;for(var s=e;0<s;){var r=31-bn(s),a=1<<r;i[r]=-1,s&=~a}n!==0&&Zx(t,n,e)}function uc(){return Ie&6?!0:(Fl(0),!1)}function Em(){if(Ae!==null){if(Ne===0)var t=Ae.return;else t=Ae,Li=tr=null,lm(t),Or=null,ll=0,t=Ae;for(;t!==null;)Lb(t.alternate,t),t=t.return;Ae=null}}function Wr(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,a_(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),Ci=0,Em(),He=t,Ae=n=Ri(t.current,null),_e=e,Ne=0,fn=null,es=!1,oa=Cl(t,e),bm=!1,Xr=yn=Sm=Us=ps=at=0,Qt=Ka=null,Nf=!1,e&8&&(e|=e&32);var i=t.entangledLanes;if(i!==0)for(t=t.entanglements,i&=e;0<i;){var s=31-bn(i),r=1<<s;e|=t[s],i&=~r}return Oi=e,tc(),n}function Xb(t,e){pe=null,ce.H=ul,e===la||e===ic?(e=lg(),Ne=3):e===em?(e=lg(),Ne=4):Ne=e===pm?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,fn=e,Ae===null&&(at=1,gu(t,Nn(e,t.current)))}function Qb(){var t=kn.current;return t===null?!0:(_e&4194048)===_e?On===null:(_e&62914560)===_e||_e&536870912?t===On:!1}function Wb(){var t=ce.H;return ce.H=ul,t===null?ul:t}function Zb(){var t=ce.A;return ce.A=Bk,t}function bu(){at=4,es||(_e&4194048)!==_e&&kn.current!==null||(oa=!0),!(ps&134217727)&&!(Us&134217727)||He===null||ts(He,_e,yn,!1)}function ed(t,e,n){var i=Ie;Ie|=2;var s=Wb(),r=Zb();(He!==t||_e!==e)&&(vu=null,Wr(t,e)),e=!1;var a=at;e:do try{if(Ne!==0&&Ae!==null){var l=Ae,o=fn;switch(Ne){case 8:Em(),a=6;break e;case 3:case 2:case 9:case 6:kn.current===null&&(e=!0);var u=Ne;if(Ne=0,fn=null,wr(t,l,o,u),n&&oa){a=0;break e}break;default:u=Ne,Ne=0,fn=null,wr(t,l,o,u)}}$k(),a=at;break}catch(c){Xb(t,c)}while(!0);return e&&t.shellSuspendCounter++,Li=tr=null,Ie=i,ce.H=s,ce.A=r,Ae===null&&(He=null,_e=0,tc()),a}function $k(){for(;Ae!==null;)Jb(Ae)}function zk(t,e){var n=Ie;Ie|=2;var i=Wb(),s=Zb();He!==t||_e!==e?(vu=null,xu=xn()+500,Wr(t,e)):oa=Cl(t,e);e:do try{if(Ne!==0&&Ae!==null){e=Ae;var r=fn;t:switch(Ne){case 1:Ne=0,fn=null,wr(t,e,r,1);break;case 2:case 9:if(ag(r)){Ne=0,fn=null,Cg(e);break}e=function(){Ne!==2&&Ne!==9||He!==t||(Ne=7),fi(t)},r.then(e,e);break e;case 3:Ne=7;break e;case 4:Ne=5;break e;case 7:ag(r)?(Ne=0,fn=null,Cg(e)):(Ne=0,fn=null,wr(t,e,r,7));break;case 5:var a=null;switch(Ae.tag){case 26:a=Ae.memoizedState;case 5:case 27:var l=Ae;if(a?v1(a):l.stateNode.complete){Ne=0,fn=null;var o=l.sibling;if(o!==null)Ae=o;else{var u=l.return;u!==null?(Ae=u,cc(u)):Ae=null}break t}}Ne=0,fn=null,wr(t,e,r,5);break;case 6:Ne=0,fn=null,wr(t,e,r,6);break;case 8:Em(),at=6;break e;default:throw Error(K(462))}}Gk();break}catch(c){Xb(t,c)}while(!0);return Li=tr=null,ce.H=i,ce.A=s,Ie=n,Ae!==null?0:(He=null,_e=0,tc(),at)}function Gk(){for(;Ae!==null&&!fA();)Jb(Ae)}function Jb(t){var e=_b(t.alternate,t,Oi);t.memoizedProps=t.pendingProps,e===null?cc(t):Ae=e}function Cg(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=Tg(n,e,e.pendingProps,e.type,void 0,_e);break;case 11:e=Tg(n,e,e.pendingProps,e.type.render,e.ref,_e);break;case 5:lm(e);default:Lb(n,e),e=Ae=Lv(e,Oi),e=_b(n,e,Oi)}t.memoizedProps=t.pendingProps,e===null?cc(t):Ae=e}function wr(t,e,n,i){Li=tr=null,lm(e),Or=null,ll=0;var s=e.return;try{if(Ik(t,s,e,n,_e)){at=1,gu(t,Nn(n,t.current)),Ae=null;return}}catch(r){if(s!==null)throw Ae=s,r;at=1,gu(t,Nn(n,t.current)),Ae=null;return}e.flags&32768?(Le||i===1?t=!0:oa||_e&536870912?t=!1:(es=t=!0,(i===2||i===9||i===3||i===6)&&(i=kn.current,i!==null&&i.tag===13&&(i.flags|=16384))),e1(e,t)):cc(e)}function cc(t){var e=t;do{if(e.flags&32768){e1(e,es);return}t=e.return;var n=Mk(e.alternate,e,Oi);if(n!==null){Ae=n;return}if(e=e.sibling,e!==null){Ae=e;return}Ae=e=t}while(e!==null);at===0&&(at=5)}function e1(t,e){do{var n=Ok(t.alternate,t);if(n!==null){n.flags&=32767,Ae=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){Ae=t;return}Ae=t=n}while(t!==null);at=6,Ae=null}function Ig(t,e,n,i,s,r,a,l,o){t.cancelPendingCommit=null;do dc();while(St!==0);if(Ie&6)throw Error(K(327));if(e!==null){if(e===t.current)throw Error(K(177));if(r=e.lanes|e.childLanes,r|=Yh,EA(t,n,r,a,l,o),t===He&&(Ae=He=null,_e=0),Qr=e,os=t,Ci=n,Mf=r,Of=s,Kb=i,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,Yk(su,function(){return r1(),null})):(t.callbackNode=null,t.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=ce.T,ce.T=null,s=De.p,De.p=2,a=Ie,Ie|=4;try{Pk(t,e,n)}finally{Ie=a,De.p=s,ce.T=i}}St=1,t1(),n1(),i1()}}function t1(){if(St===1){St=0;var t=os,e=Qr,n=(e.flags&13878)!==0;if(e.subtreeFlags&13878||n){n=ce.T,ce.T=null;var i=De.p;De.p=2;var s=Ie;Ie|=4;try{Bb(e,t);var r=jf,a=vv(t.containerInfo),l=r.focusedElem,o=r.selectionRange;if(a!==l&&l&&l.ownerDocument&&xv(l.ownerDocument.documentElement,l)){if(o!==null&&Kh(l)){var u=o.start,c=o.end;if(c===void 0&&(c=u),"selectionStart"in l)l.selectionStart=u,l.selectionEnd=Math.min(c,l.value.length);else{var d=l.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var h=f.getSelection(),m=l.textContent.length,y=Math.min(o.start,m),x=o.end===void 0?y:Math.min(o.end,m);!h.extend&&y>x&&(a=x,x=y,y=a);var p=J0(l,y),v=J0(l,x);if(p&&v&&(h.rangeCount!==1||h.anchorNode!==p.node||h.anchorOffset!==p.offset||h.focusNode!==v.node||h.focusOffset!==v.offset)){var b=d.createRange();b.setStart(p.node,p.offset),h.removeAllRanges(),y>x?(h.addRange(b),h.extend(v.node,v.offset)):(b.setEnd(v.node,v.offset),h.addRange(b))}}}}for(d=[],h=l;h=h.parentNode;)h.nodeType===1&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<d.length;l++){var E=d[l];E.element.scrollLeft=E.left,E.element.scrollTop=E.top}}Ru=!!Uf,jf=Uf=null}finally{Ie=s,De.p=i,ce.T=n}}t.current=e,St=2}}function n1(){if(St===2){St=0;var t=os,e=Qr,n=(e.flags&8772)!==0;if(e.subtreeFlags&8772||n){n=ce.T,ce.T=null;var i=De.p;De.p=2;var s=Ie;Ie|=4;try{Nb(t,e.alternate,e)}finally{Ie=s,De.p=i,ce.T=n}}St=3}}function i1(){if(St===4||St===3){St=0,hA();var t=os,e=Qr,n=Ci,i=Kb;e.subtreeFlags&10256||e.flags&10256?St=5:(St=0,Qr=os=null,s1(t,t.pendingLanes));var s=t.pendingLanes;if(s===0&&(ls=null),Uh(n),e=e.stateNode,vn&&typeof vn.onCommitFiberRoot=="function")try{vn.onCommitFiberRoot(wl,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=ce.T,s=De.p,De.p=2,ce.T=null;try{for(var r=t.onRecoverableError,a=0;a<i.length;a++){var l=i[a];r(l.value,{componentStack:l.stack})}}finally{ce.T=e,De.p=s}}Ci&3&&dc(),fi(t),s=t.pendingLanes,n&261930&&s&42?t===Pf?Ya++:(Ya=0,Pf=t):Ya=0,Fl(0)}}function s1(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,Ml(e)))}function dc(){return t1(),n1(),i1(),r1()}function r1(){if(St!==5)return!1;var t=os,e=Mf;Mf=0;var n=Uh(Ci),i=ce.T,s=De.p;try{De.p=32>n?32:n,ce.T=null,n=Of,Of=null;var r=os,a=Ci;if(St=0,Qr=os=null,Ci=0,Ie&6)throw Error(K(331));var l=Ie;if(Ie|=4,Gb(r.current),jb(r,r.current,a,n),Ie=l,Fl(0,!1),vn&&typeof vn.onPostCommitFiberRoot=="function")try{vn.onPostCommitFiberRoot(wl,r)}catch{}return!0}finally{De.p=s,ce.T=i,s1(t,e)}}function Dg(t,e,n){e=Nn(n,e),e=wf(t.stateNode,e,2),t=as(t,e,2),t!==null&&(Il(t,2),fi(t))}function Oe(t,e,n){if(t.tag===3)Dg(t,t,n);else for(;e!==null;){if(e.tag===3){Dg(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ls===null||!ls.has(i))){t=Nn(n,t),n=bb(2),i=as(e,n,2),i!==null&&(Sb(n,i,e,t),Il(i,2),fi(i));break}}e=e.return}}function td(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new Uk;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(n)||(bm=!0,s.add(n),t=Hk.bind(null,t,e,n),e.then(t,t))}function Hk(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,He===t&&(_e&n)===n&&(at===4||at===3&&(_e&62914560)===_e&&300>xn()-oc?!(Ie&2)&&Wr(t,0):Sm|=n,Xr===_e&&(Xr=0)),fi(t)}function a1(t,e){e===0&&(e=Wx()),t=er(t,e),t!==null&&(Il(t,e),fi(t))}function Vk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),a1(t,n)}function Kk(t,e){var n=0;switch(t.tag){case 31:case 13:var i=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:i=t.stateNode;break;case 22:i=t.stateNode._retryCache;break;default:throw Error(K(314))}i!==null&&i.delete(e),a1(t,n)}function Yk(t,e){return Fh(t,e)}var Su=null,gr=null,Ff=!1,Eu=!1,nd=!1,ns=0;function fi(t){t!==gr&&t.next===null&&(gr===null?Su=gr=t:gr=gr.next=t),Eu=!0,Ff||(Ff=!0,Xk())}function Fl(t,e){if(!nd&&Eu){nd=!0;do for(var n=!1,i=Su;i!==null;){if(t!==0){var s=i.pendingLanes;if(s===0)var r=0;else{var a=i.suspendedLanes,l=i.pingedLanes;r=(1<<31-bn(42|t)+1)-1,r&=s&~(a&~l),r=r&201326741?r&201326741|1:r?r|2:0}r!==0&&(n=!0,Ng(i,r))}else r=_e,r=Wu(i,i===He?r:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(r&3)||Cl(i,r)||(n=!0,Ng(i,r));i=i.next}while(n);nd=!1}}function qk(){l1()}function l1(){Eu=Ff=!1;var t=0;ns!==0&&r_()&&(t=ns);for(var e=xn(),n=null,i=Su;i!==null;){var s=i.next,r=o1(i,e);r===0?(i.next=null,n===null?Su=s:n.next=s,s===null&&(gr=n)):(n=i,(t!==0||r&3)&&(Eu=!0)),i=s}St!==0&&St!==5||Fl(t),ns!==0&&(ns=0)}function o1(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,s=t.expirationTimes,r=t.pendingLanes&-62914561;0<r;){var a=31-bn(r),l=1<<a,o=s[a];o===-1?(!(l&n)||l&i)&&(s[a]=SA(l,e)):o<=e&&(t.expiredLanes|=l),r&=~l}if(e=He,n=_e,n=Wu(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i=t.callbackNode,n===0||t===e&&(Ne===2||Ne===9)||t.cancelPendingCommit!==null)return i!==null&&i!==null&&Cc(i),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||Cl(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(i!==null&&Cc(i),Uh(n)){case 2:case 8:n=Xx;break;case 32:n=su;break;case 268435456:n=Qx;break;default:n=su}return i=u1.bind(null,t),n=Fh(n,i),t.callbackPriority=e,t.callbackNode=n,e}return i!==null&&i!==null&&Cc(i),t.callbackPriority=2,t.callbackNode=null,2}function u1(t,e){if(St!==0&&St!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(dc()&&t.callbackNode!==n)return null;var i=_e;return i=Wu(t,t===He?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i===0?null:(qb(t,i,e),o1(t,xn()),t.callbackNode!=null&&t.callbackNode===n?u1.bind(null,t):null)}function Ng(t,e){if(dc())return null;qb(t,e,!0)}function Xk(){l_(function(){Ie&6?Fh(qx,qk):l1()})}function Tm(){if(ns===0){var t=Kr;t===0&&(t=Vl,Vl<<=1,!(Vl&261888)&&(Vl=256)),ns=t}return ns}function Mg(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Lo(""+t)}function Og(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function Qk(t,e,n,i,s){if(e==="submit"&&n&&n.stateNode===s){var r=Mg((s[Jt]||null).action),a=i.submitter;a&&(e=(e=a[Jt]||null)?Mg(e.formAction):a.getAttribute("formAction"),e!==null&&(r=e,a=null));var l=new Zu("action","action",null,i,s);t.push({event:l,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(ns!==0){var o=a?Og(s,a):new FormData(s);Lf(n,{pending:!0,data:o,method:s.method,action:r},null,o)}}else typeof r=="function"&&(l.preventDefault(),o=a?Og(s,a):new FormData(s),Lf(n,{pending:!0,data:o,method:s.method,action:r},r,o))},currentTarget:s}]})}}for(var id=0;id<gf.length;id++){var sd=gf[id],Wk=sd.toLowerCase(),Zk=sd[0].toUpperCase()+sd.slice(1);qn(Wk,"on"+Zk)}qn(Sv,"onAnimationEnd");qn(Ev,"onAnimationIteration");qn(Tv,"onAnimationStart");qn("dblclick","onDoubleClick");qn("focusin","onFocus");qn("focusout","onBlur");qn(mk,"onTransitionRun");qn(gk,"onTransitionStart");qn(pk,"onTransitionCancel");qn(Av,"onTransitionEnd");Hr("onMouseEnter",["mouseout","mouseover"]);Hr("onMouseLeave",["mouseout","mouseover"]);Hr("onPointerEnter",["pointerout","pointerover"]);Hr("onPointerLeave",["pointerout","pointerover"]);Ws("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ws("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ws("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ws("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ws("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Jk=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cl));function c1(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],s=i.event;i=i.listeners;e:{var r=void 0;if(e)for(var a=i.length-1;0<=a;a--){var l=i[a],o=l.instance,u=l.currentTarget;if(l=l.listener,o!==r&&s.isPropagationStopped())break e;r=l,s.currentTarget=u;try{r(s)}catch(c){au(c)}s.currentTarget=null,r=o}else for(a=0;a<i.length;a++){if(l=i[a],o=l.instance,u=l.currentTarget,l=l.listener,o!==r&&s.isPropagationStopped())break e;r=l,s.currentTarget=u;try{r(s)}catch(c){au(c)}s.currentTarget=null,r=o}}}}function Te(t,e){var n=e[lf];n===void 0&&(n=e[lf]=new Set);var i=t+"__bubble";n.has(i)||(d1(e,t,2,!1),n.add(i))}function rd(t,e,n){var i=0;e&&(i|=4),d1(n,t,i,e)}var to="_reactListening"+Math.random().toString(36).slice(2);function Am(t){if(!t[to]){t[to]=!0,nv.forEach(function(n){n!=="selectionchange"&&(Jk.has(n)||rd(n,!1,t),rd(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[to]||(e[to]=!0,rd("selectionchange",!1,e))}}function d1(t,e,n,i){switch(A1(e)){case 2:var s=L_;break;case 8:s=R_;break;default:s=Rm}n=s.bind(null,e,n,t),s=void 0,!ff||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function ad(t,e,n,i,s){var r=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var l=i.stateNode.containerInfo;if(l===s)break;if(a===4)for(a=i.return;a!==null;){var o=a.tag;if((o===3||o===4)&&a.stateNode.containerInfo===s)return;a=a.return}for(;l!==null;){if(a=br(l),a===null)return;if(o=a.tag,o===5||o===6||o===26||o===27){i=r=a;continue e}l=l.parentNode}}i=i.return}cv(function(){var u=r,c=zh(n),d=[];e:{var f=kv.get(t);if(f!==void 0){var h=Zu,m=t;switch(t){case"keypress":if(wo(n)===0)break e;case"keydown":case"keyup":h=KA;break;case"focusin":m="focus",h=Oc;break;case"focusout":m="blur",h=Oc;break;case"beforeblur":case"afterblur":h=Oc;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=G0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=MA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=XA;break;case Sv:case Ev:case Tv:h=FA;break;case Av:h=WA;break;case"scroll":case"scrollend":h=DA;break;case"wheel":h=JA;break;case"copy":case"cut":case"paste":h=UA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=V0;break;case"toggle":case"beforetoggle":h=tk}var y=(e&4)!==0,x=!y&&(t==="scroll"||t==="scrollend"),p=y?f!==null?f+"Capture":null:f;y=[];for(var v=u,b;v!==null;){var E=v;if(b=E.stateNode,E=E.tag,E!==5&&E!==26&&E!==27||b===null||p===null||(E=nl(v,p),E!=null&&y.push(dl(v,E,b))),x)break;v=v.return}0<y.length&&(f=new h(f,m,null,n,c),d.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==df&&(m=n.relatedTarget||n.fromElement)&&(br(m)||m[sa]))break e;if((h||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,h?(m=n.relatedTarget||n.toElement,h=u,m=m?br(m):null,m!==null&&(x=Rl(m),y=m.tag,m!==x||y!==5&&y!==27&&y!==6)&&(m=null)):(h=null,m=u),h!==m)){if(y=G0,E="onMouseLeave",p="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=V0,E="onPointerLeave",p="onPointerEnter",v="pointer"),x=h==null?f:Ia(h),b=m==null?f:Ia(m),f=new y(E,v+"leave",h,n,c),f.target=x,f.relatedTarget=b,E=null,br(c)===u&&(y=new y(p,v+"enter",m,n,c),y.target=b,y.relatedTarget=x,E=y),x=E,h&&m)t:{for(y=e_,p=h,v=m,b=0,E=p;E;E=y(E))b++;E=0;for(var k=v;k;k=y(k))E++;for(;0<b-E;)p=y(p),b--;for(;0<E-b;)v=y(v),E--;for(;b--;){if(p===v||v!==null&&p===v.alternate){y=p;break t}p=y(p),v=y(v)}y=null}else y=null;h!==null&&Pg(d,f,h,y,!1),m!==null&&x!==null&&Pg(d,x,m,y,!0)}}e:{if(f=u?Ia(u):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var _=X0;else if(q0(f))if(pv)_=dk;else{_=uk;var L=ok}else h=f.nodeName,!h||h.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?u&&$h(u.elementType)&&(_=X0):_=ck;if(_&&(_=_(t,u))){gv(d,_,n,c);break e}L&&L(t,f,u),t==="focusout"&&u&&f.type==="number"&&u.memoizedProps.value!=null&&cf(f,"number",f.value)}switch(L=u?Ia(u):window,t){case"focusin":(q0(L)||L.contentEditable==="true")&&(Tr=L,hf=u,Ba=null);break;case"focusout":Ba=hf=Tr=null;break;case"mousedown":mf=!0;break;case"contextmenu":case"mouseup":case"dragend":mf=!1,eg(d,n,c);break;case"selectionchange":if(hk)break;case"keydown":case"keyup":eg(d,n,c)}var C;if(Vh)e:{switch(t){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Er?hv(t,n)&&(w="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(fv&&n.locale!=="ko"&&(Er||w!=="onCompositionStart"?w==="onCompositionEnd"&&Er&&(C=dv()):(Ji=c,Gh="value"in Ji?Ji.value:Ji.textContent,Er=!0)),L=Tu(u,w),0<L.length&&(w=new H0(w,t,null,n,c),d.push({event:w,listeners:L}),C?w.data=C:(C=mv(n),C!==null&&(w.data=C)))),(C=ik?sk(t,n):rk(t,n))&&(w=Tu(u,"onBeforeInput"),0<w.length&&(L=new H0("onBeforeInput","beforeinput",null,n,c),d.push({event:L,listeners:w}),L.data=C)),Qk(d,t,u,n,c)}c1(d,e)})}function dl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Tu(t,e){for(var n=e+"Capture",i=[];t!==null;){var s=t,r=s.stateNode;if(s=s.tag,s!==5&&s!==26&&s!==27||r===null||(s=nl(t,n),s!=null&&i.unshift(dl(t,s,r)),s=nl(t,e),s!=null&&i.push(dl(t,s,r))),t.tag===3)return i;t=t.return}return[]}function e_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Pg(t,e,n,i,s){for(var r=e._reactName,a=[];n!==null&&n!==i;){var l=n,o=l.alternate,u=l.stateNode;if(l=l.tag,o!==null&&o===i)break;l!==5&&l!==26&&l!==27||u===null||(o=u,s?(u=nl(n,r),u!=null&&a.unshift(dl(n,u,o))):s||(u=nl(n,r),u!=null&&a.push(dl(n,u,o)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var t_=/\r\n?/g,n_=/\u0000|\uFFFD/g;function Fg(t){return(typeof t=="string"?t:""+t).replace(t_,`
`).replace(n_,"")}function f1(t,e){return e=Fg(e),Fg(t)===e}function Ue(t,e,n,i,s,r){switch(n){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||Vr(t,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&Vr(t,""+i);break;case"className":ql(t,"class",i);break;case"tabIndex":ql(t,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":ql(t,n,i);break;case"style":uv(t,i,r);break;case"data":if(e!=="object"){ql(t,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=Lo(""+i),t.setAttribute(n,i);break;case"action":case"formAction":if(typeof i=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof r=="function"&&(n==="formAction"?(e!=="input"&&Ue(t,e,"name",s.name,s,null),Ue(t,e,"formEncType",s.formEncType,s,null),Ue(t,e,"formMethod",s.formMethod,s,null),Ue(t,e,"formTarget",s.formTarget,s,null)):(Ue(t,e,"encType",s.encType,s,null),Ue(t,e,"method",s.method,s,null),Ue(t,e,"target",s.target,s,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=Lo(""+i),t.setAttribute(n,i);break;case"onClick":i!=null&&(t.onclick=_i);break;case"onScroll":i!=null&&Te("scroll",t);break;case"onScrollEnd":i!=null&&Te("scrollend",t);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(K(61));if(n=i.__html,n!=null){if(s.children!=null)throw Error(K(60));t.innerHTML=n}}break;case"multiple":t.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":t.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){t.removeAttribute("xlink:href");break}n=Lo(""+i),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""+i):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":i===!0?t.setAttribute(n,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,i):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?t.setAttribute(n,i):t.removeAttribute(n);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?t.removeAttribute(n):t.setAttribute(n,i);break;case"popover":Te("beforetoggle",t),Te("toggle",t),_o(t,"popover",i);break;case"xlinkActuate":mi(t,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":mi(t,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":mi(t,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":mi(t,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":mi(t,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":mi(t,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":mi(t,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":mi(t,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":mi(t,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":_o(t,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=CA.get(n)||n,_o(t,n,i))}}function Bf(t,e,n,i,s,r){switch(n){case"style":uv(t,i,r);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(K(61));if(n=i.__html,n!=null){if(s.children!=null)throw Error(K(60));t.innerHTML=n}}break;case"children":typeof i=="string"?Vr(t,i):(typeof i=="number"||typeof i=="bigint")&&Vr(t,""+i);break;case"onScroll":i!=null&&Te("scroll",t);break;case"onScrollEnd":i!=null&&Te("scrollend",t);break;case"onClick":i!=null&&(t.onclick=_i);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!iv.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(s=n.endsWith("Capture"),e=n.slice(2,s?n.length-7:void 0),r=t[Jt]||null,r=r!=null?r[n]:null,typeof r=="function"&&t.removeEventListener(e,r,s),typeof i=="function")){typeof r!="function"&&r!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,i,s);break e}n in t?t[n]=i:i===!0?t.setAttribute(n,""):_o(t,n,i)}}}function Mt(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Te("error",t),Te("load",t);var i=!1,s=!1,r;for(r in n)if(n.hasOwnProperty(r)){var a=n[r];if(a!=null)switch(r){case"src":i=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(K(137,e));default:Ue(t,e,r,a,n,null)}}s&&Ue(t,e,"srcSet",n.srcSet,n,null),i&&Ue(t,e,"src",n.src,n,null);return;case"input":Te("invalid",t);var l=r=a=s=null,o=null,u=null;for(i in n)if(n.hasOwnProperty(i)){var c=n[i];if(c!=null)switch(i){case"name":s=c;break;case"type":a=c;break;case"checked":o=c;break;case"defaultChecked":u=c;break;case"value":r=c;break;case"defaultValue":l=c;break;case"children":case"dangerouslySetInnerHTML":if(c!=null)throw Error(K(137,e));break;default:Ue(t,e,i,c,n,null)}}av(t,r,l,o,u,a,s,!1);return;case"select":Te("invalid",t),i=a=r=null;for(s in n)if(n.hasOwnProperty(s)&&(l=n[s],l!=null))switch(s){case"value":r=l;break;case"defaultValue":a=l;break;case"multiple":i=l;default:Ue(t,e,s,l,n,null)}e=r,n=a,t.multiple=!!i,e!=null?Dr(t,!!i,e,!1):n!=null&&Dr(t,!!i,n,!0);return;case"textarea":Te("invalid",t),r=s=i=null;for(a in n)if(n.hasOwnProperty(a)&&(l=n[a],l!=null))switch(a){case"value":i=l;break;case"defaultValue":s=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(l!=null)throw Error(K(91));break;default:Ue(t,e,a,l,n,null)}ov(t,i,s,r);return;case"option":for(o in n)if(n.hasOwnProperty(o)&&(i=n[o],i!=null))switch(o){case"selected":t.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:Ue(t,e,o,i,n,null)}return;case"dialog":Te("beforetoggle",t),Te("toggle",t),Te("cancel",t),Te("close",t);break;case"iframe":case"object":Te("load",t);break;case"video":case"audio":for(i=0;i<cl.length;i++)Te(cl[i],t);break;case"image":Te("error",t),Te("load",t);break;case"details":Te("toggle",t);break;case"embed":case"source":case"link":Te("error",t),Te("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in n)if(n.hasOwnProperty(u)&&(i=n[u],i!=null))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(K(137,e));default:Ue(t,e,u,i,n,null)}return;default:if($h(e)){for(c in n)n.hasOwnProperty(c)&&(i=n[c],i!==void 0&&Bf(t,e,c,i,n,void 0));return}}for(l in n)n.hasOwnProperty(l)&&(i=n[l],i!=null&&Ue(t,e,l,i,n,null))}function i_(t,e,n,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var s=null,r=null,a=null,l=null,o=null,u=null,c=null;for(h in n){var d=n[h];if(n.hasOwnProperty(h)&&d!=null)switch(h){case"checked":break;case"value":break;case"defaultValue":o=d;default:i.hasOwnProperty(h)||Ue(t,e,h,null,i,d)}}for(var f in i){var h=i[f];if(d=n[f],i.hasOwnProperty(f)&&(h!=null||d!=null))switch(f){case"type":r=h;break;case"name":s=h;break;case"checked":u=h;break;case"defaultChecked":c=h;break;case"value":a=h;break;case"defaultValue":l=h;break;case"children":case"dangerouslySetInnerHTML":if(h!=null)throw Error(K(137,e));break;default:h!==d&&Ue(t,e,f,h,i,d)}}uf(t,a,l,o,u,c,r,s);return;case"select":h=a=l=f=null;for(r in n)if(o=n[r],n.hasOwnProperty(r)&&o!=null)switch(r){case"value":break;case"multiple":h=o;default:i.hasOwnProperty(r)||Ue(t,e,r,null,i,o)}for(s in i)if(r=i[s],o=n[s],i.hasOwnProperty(s)&&(r!=null||o!=null))switch(s){case"value":f=r;break;case"defaultValue":l=r;break;case"multiple":a=r;default:r!==o&&Ue(t,e,s,r,i,o)}e=l,n=a,i=h,f!=null?Dr(t,!!n,f,!1):!!i!=!!n&&(e!=null?Dr(t,!!n,e,!0):Dr(t,!!n,n?[]:"",!1));return;case"textarea":h=f=null;for(l in n)if(s=n[l],n.hasOwnProperty(l)&&s!=null&&!i.hasOwnProperty(l))switch(l){case"value":break;case"children":break;default:Ue(t,e,l,null,i,s)}for(a in i)if(s=i[a],r=n[a],i.hasOwnProperty(a)&&(s!=null||r!=null))switch(a){case"value":f=s;break;case"defaultValue":h=s;break;case"children":break;case"dangerouslySetInnerHTML":if(s!=null)throw Error(K(91));break;default:s!==r&&Ue(t,e,a,s,i,r)}lv(t,f,h);return;case"option":for(var m in n)if(f=n[m],n.hasOwnProperty(m)&&f!=null&&!i.hasOwnProperty(m))switch(m){case"selected":t.selected=!1;break;default:Ue(t,e,m,null,i,f)}for(o in i)if(f=i[o],h=n[o],i.hasOwnProperty(o)&&f!==h&&(f!=null||h!=null))switch(o){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Ue(t,e,o,f,i,h)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var y in n)f=n[y],n.hasOwnProperty(y)&&f!=null&&!i.hasOwnProperty(y)&&Ue(t,e,y,null,i,f);for(u in i)if(f=i[u],h=n[u],i.hasOwnProperty(u)&&f!==h&&(f!=null||h!=null))switch(u){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(K(137,e));break;default:Ue(t,e,u,f,i,h)}return;default:if($h(e)){for(var x in n)f=n[x],n.hasOwnProperty(x)&&f!==void 0&&!i.hasOwnProperty(x)&&Bf(t,e,x,void 0,i,f);for(c in i)f=i[c],h=n[c],!i.hasOwnProperty(c)||f===h||f===void 0&&h===void 0||Bf(t,e,c,f,i,h);return}}for(var p in n)f=n[p],n.hasOwnProperty(p)&&f!=null&&!i.hasOwnProperty(p)&&Ue(t,e,p,null,i,f);for(d in i)f=i[d],h=n[d],!i.hasOwnProperty(d)||f===h||f==null&&h==null||Ue(t,e,d,f,i,h)}function Bg(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function s_(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,n=performance.getEntriesByType("resource"),i=0;i<n.length;i++){var s=n[i],r=s.transferSize,a=s.initiatorType,l=s.duration;if(r&&l&&Bg(a)){for(a=0,l=s.responseEnd,i+=1;i<n.length;i++){var o=n[i],u=o.startTime;if(u>l)break;var c=o.transferSize,d=o.initiatorType;c&&Bg(d)&&(o=o.responseEnd,a+=c*(o<l?1:(l-u)/(o-u)))}if(--i,e+=8*(r+a)/(s.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Uf=null,jf=null;function Au(t){return t.nodeType===9?t:t.ownerDocument}function Ug(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function h1(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function $f(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ld=null;function r_(){var t=window.event;return t&&t.type==="popstate"?t===ld?!1:(ld=t,!0):(ld=null,!1)}var m1=typeof setTimeout=="function"?setTimeout:void 0,a_=typeof clearTimeout=="function"?clearTimeout:void 0,jg=typeof Promise=="function"?Promise:void 0,l_=typeof queueMicrotask=="function"?queueMicrotask:typeof jg<"u"?function(t){return jg.resolve(null).then(t).catch(o_)}:m1;function o_(t){setTimeout(function(){throw t})}function Ss(t){return t==="head"}function $g(t,e){var n=e,i=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"||n==="/&"){if(i===0){t.removeChild(s),Jr(e);return}i--}else if(n==="$"||n==="$?"||n==="$~"||n==="$!"||n==="&")i++;else if(n==="html")qa(t.ownerDocument.documentElement);else if(n==="head"){n=t.ownerDocument.head,qa(n);for(var r=n.firstChild;r;){var a=r.nextSibling,l=r.nodeName;r[Dl]||l==="SCRIPT"||l==="STYLE"||l==="LINK"&&r.rel.toLowerCase()==="stylesheet"||n.removeChild(r),r=a}}else n==="body"&&qa(t.ownerDocument.body);n=s}while(n);Jr(e)}function zg(t,e){var n=t;t=0;do{var i=n.nextSibling;if(n.nodeType===1?e?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",n.getAttribute("style")===""&&n.removeAttribute("style")):n.nodeType===3&&(e?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(t===0)break;t--}else n!=="$"&&n!=="$?"&&n!=="$~"&&n!=="$!"||t++;n=i}while(n)}function zf(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":zf(n),jh(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function u_(t,e,n,i){for(;t.nodeType===1;){var s=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(i){if(!t[Dl])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(r=t.getAttribute("rel"),r==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(r!==s.rel||t.getAttribute("href")!==(s.href==null||s.href===""?null:s.href)||t.getAttribute("crossorigin")!==(s.crossOrigin==null?null:s.crossOrigin)||t.getAttribute("title")!==(s.title==null?null:s.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(r=t.getAttribute("src"),(r!==(s.src==null?null:s.src)||t.getAttribute("type")!==(s.type==null?null:s.type)||t.getAttribute("crossorigin")!==(s.crossOrigin==null?null:s.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var r=s.name==null?null:""+s.name;if(s.type==="hidden"&&t.getAttribute("name")===r)return t}else return t;if(t=Pn(t.nextSibling),t===null)break}return null}function c_(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=Pn(t.nextSibling),t===null))return null;return t}function g1(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=Pn(t.nextSibling),t===null))return null;return t}function Gf(t){return t.data==="$?"||t.data==="$~"}function Hf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function d_(t,e){var n=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||n.readyState!=="loading")e();else{var i=function(){e(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),t._reactRetry=i}}function Pn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var Vf=null;function Gg(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"||n==="/&"){if(e===0)return Pn(t.nextSibling);e--}else n!=="$"&&n!=="$!"&&n!=="$?"&&n!=="$~"&&n!=="&"||e++}t=t.nextSibling}return null}function Hg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"){if(e===0)return t;e--}else n!=="/$"&&n!=="/&"||e++}t=t.previousSibling}return null}function p1(t,e,n){switch(e=Au(n),t){case"html":if(t=e.documentElement,!t)throw Error(K(452));return t;case"head":if(t=e.head,!t)throw Error(K(453));return t;case"body":if(t=e.body,!t)throw Error(K(454));return t;default:throw Error(K(451))}}function qa(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);jh(t)}var Fn=new Map,Vg=new Set;function ku(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Pi=De.d;De.d={f:f_,r:h_,D:m_,C:g_,L:p_,m:y_,X:v_,S:x_,M:b_};function f_(){var t=Pi.f(),e=uc();return t||e}function h_(t){var e=ra(t);e!==null&&e.tag===5&&e.type==="form"?ub(e):Pi.r(t)}var ua=typeof document>"u"?null:document;function y1(t,e,n){var i=ua;if(i&&typeof e=="string"&&e){var s=Dn(e);s='link[rel="'+t+'"][href="'+s+'"]',typeof n=="string"&&(s+='[crossorigin="'+n+'"]'),Vg.has(s)||(Vg.add(s),t={rel:t,crossOrigin:n,href:e},i.querySelector(s)===null&&(e=i.createElement("link"),Mt(e,"link",t),kt(e),i.head.appendChild(e)))}}function m_(t){Pi.D(t),y1("dns-prefetch",t,null)}function g_(t,e){Pi.C(t,e),y1("preconnect",t,e)}function p_(t,e,n){Pi.L(t,e,n);var i=ua;if(i&&t&&e){var s='link[rel="preload"][as="'+Dn(e)+'"]';e==="image"&&n&&n.imageSrcSet?(s+='[imagesrcset="'+Dn(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(s+='[imagesizes="'+Dn(n.imageSizes)+'"]')):s+='[href="'+Dn(t)+'"]';var r=s;switch(e){case"style":r=Zr(t);break;case"script":r=ca(t)}Fn.has(r)||(t=We({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),Fn.set(r,t),i.querySelector(s)!==null||e==="style"&&i.querySelector(Bl(r))||e==="script"&&i.querySelector(Ul(r))||(e=i.createElement("link"),Mt(e,"link",t),kt(e),i.head.appendChild(e)))}}function y_(t,e){Pi.m(t,e);var n=ua;if(n&&t){var i=e&&typeof e.as=="string"?e.as:"script",s='link[rel="modulepreload"][as="'+Dn(i)+'"][href="'+Dn(t)+'"]',r=s;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=ca(t)}if(!Fn.has(r)&&(t=We({rel:"modulepreload",href:t},e),Fn.set(r,t),n.querySelector(s)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Ul(r)))return}i=n.createElement("link"),Mt(i,"link",t),kt(i),n.head.appendChild(i)}}}function x_(t,e,n){Pi.S(t,e,n);var i=ua;if(i&&t){var s=Ir(i).hoistableStyles,r=Zr(t);e=e||"default";var a=s.get(r);if(!a){var l={loading:0,preload:null};if(a=i.querySelector(Bl(r)))l.loading=5;else{t=We({rel:"stylesheet",href:t,"data-precedence":e},n),(n=Fn.get(r))&&km(t,n);var o=a=i.createElement("link");kt(o),Mt(o,"link",t),o._p=new Promise(function(u,c){o.onload=u,o.onerror=c}),o.addEventListener("load",function(){l.loading|=1}),o.addEventListener("error",function(){l.loading|=2}),l.loading|=4,Fo(a,e,i)}a={type:"stylesheet",instance:a,count:1,state:l},s.set(r,a)}}}function v_(t,e){Pi.X(t,e);var n=ua;if(n&&t){var i=Ir(n).hoistableScripts,s=ca(t),r=i.get(s);r||(r=n.querySelector(Ul(s)),r||(t=We({src:t,async:!0},e),(e=Fn.get(s))&&_m(t,e),r=n.createElement("script"),kt(r),Mt(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(s,r))}}function b_(t,e){Pi.M(t,e);var n=ua;if(n&&t){var i=Ir(n).hoistableScripts,s=ca(t),r=i.get(s);r||(r=n.querySelector(Ul(s)),r||(t=We({src:t,async:!0,type:"module"},e),(e=Fn.get(s))&&_m(t,e),r=n.createElement("script"),kt(r),Mt(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(s,r))}}function Kg(t,e,n,i){var s=(s=is.current)?ku(s):null;if(!s)throw Error(K(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=Zr(n.href),n=Ir(s).hoistableStyles,i=n.get(e),i||(i={type:"style",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=Zr(n.href);var r=Ir(s).hoistableStyles,a=r.get(t);if(a||(s=s.ownerDocument||s,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},r.set(t,a),(r=s.querySelector(Bl(t)))&&!r._p&&(a.instance=r,a.state.loading=5),Fn.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Fn.set(t,n),r||S_(s,t,n,a.state))),e&&i===null)throw Error(K(528,""));return a}if(e&&i!==null)throw Error(K(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=ca(n),n=Ir(s).hoistableScripts,i=n.get(e),i||(i={type:"script",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(K(444,t))}}function Zr(t){return'href="'+Dn(t)+'"'}function Bl(t){return'link[rel="stylesheet"]['+t+"]"}function x1(t){return We({},t,{"data-precedence":t.precedence,precedence:null})}function S_(t,e,n,i){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=t.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),Mt(e,"link",n),kt(e),t.head.appendChild(e))}function ca(t){return'[src="'+Dn(t)+'"]'}function Ul(t){return"script[async]"+t}function Yg(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var i=t.querySelector('style[data-href~="'+Dn(n.href)+'"]');if(i)return e.instance=i,kt(i),i;var s=We({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return i=(t.ownerDocument||t).createElement("style"),kt(i),Mt(i,"style",s),Fo(i,n.precedence,t),e.instance=i;case"stylesheet":s=Zr(n.href);var r=t.querySelector(Bl(s));if(r)return e.state.loading|=4,e.instance=r,kt(r),r;i=x1(n),(s=Fn.get(s))&&km(i,s),r=(t.ownerDocument||t).createElement("link"),kt(r);var a=r;return a._p=new Promise(function(l,o){a.onload=l,a.onerror=o}),Mt(r,"link",i),e.state.loading|=4,Fo(r,n.precedence,t),e.instance=r;case"script":return r=ca(n.src),(s=t.querySelector(Ul(r)))?(e.instance=s,kt(s),s):(i=n,(s=Fn.get(r))&&(i=We({},n),_m(i,s)),t=t.ownerDocument||t,s=t.createElement("script"),kt(s),Mt(s,"link",i),t.head.appendChild(s),e.instance=s);case"void":return null;default:throw Error(K(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,Fo(i,n.precedence,t));return e.instance}function Fo(t,e,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),s=i.length?i[i.length-1]:null,r=s,a=0;a<i.length;a++){var l=i[a];if(l.dataset.precedence===e)r=l;else if(r!==s)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function km(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function _m(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var Bo=null;function qg(t,e,n){if(Bo===null){var i=new Map,s=Bo=new Map;s.set(n,i)}else s=Bo,i=s.get(n),i||(i=new Map,s.set(n,i));if(i.has(t))return i;for(i.set(t,null),n=n.getElementsByTagName(t),s=0;s<n.length;s++){var r=n[s];if(!(r[Dl]||r[It]||t==="link"&&r.getAttribute("rel")==="stylesheet")&&r.namespaceURI!=="http://www.w3.org/2000/svg"){var a=r.getAttribute(e)||"";a=t+a;var l=i.get(a);l?l.push(r):i.set(a,[r])}}return i}function Xg(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function E_(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function v1(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function T_(t,e,n,i){if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(n.state.loading&4)){if(n.instance===null){var s=Zr(i.href),r=e.querySelector(Bl(s));if(r){e=r._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=_u.bind(t),e.then(t,t)),n.state.loading|=4,n.instance=r,kt(r);return}r=e.ownerDocument||e,i=x1(i),(s=Fn.get(s))&&km(i,s),r=r.createElement("link"),kt(r);var a=r;a._p=new Promise(function(l,o){a.onload=l,a.onerror=o}),Mt(r,"link",i),n.instance=r}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(n,e),(e=n.state.preload)&&!(n.state.loading&3)&&(t.count++,n=_u.bind(t),e.addEventListener("load",n),e.addEventListener("error",n))}}var od=0;function A_(t,e){return t.stylesheets&&t.count===0&&Uo(t,t.stylesheets),0<t.count||0<t.imgCount?function(n){var i=setTimeout(function(){if(t.stylesheets&&Uo(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4+e);0<t.imgBytes&&od===0&&(od=62500*s_());var s=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Uo(t,t.stylesheets),t.unsuspend)){var r=t.unsuspend;t.unsuspend=null,r()}},(t.imgBytes>od?50:800)+e);return t.unsuspend=n,function(){t.unsuspend=null,clearTimeout(i),clearTimeout(s)}}:null}function _u(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Uo(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Lu=null;function Uo(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Lu=new Map,e.forEach(k_,t),Lu=null,_u.call(t))}function k_(t,e){if(!(e.state.loading&4)){var n=Lu.get(t);if(n)var i=n.get(null);else{n=new Map,Lu.set(t,n);for(var s=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<s.length;r++){var a=s[r];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(n.set(a.dataset.precedence,a),i=a)}i&&n.set(null,i)}s=e.instance,a=s.getAttribute("data-precedence"),r=n.get(a)||i,r===i&&n.set(null,s),n.set(a,s),this.count++,i=_u.bind(this),s.addEventListener("load",i),s.addEventListener("error",i),r?r.parentNode.insertBefore(s,r.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(s,t.firstChild)),e.state.loading|=4}}var fl={$$typeof:ki,Provider:null,Consumer:null,_currentValue:Os,_currentValue2:Os,_threadCount:0};function __(t,e,n,i,s,r,a,l,o){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ic(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ic(0),this.hiddenUpdates=Ic(null),this.identifierPrefix=i,this.onUncaughtError=s,this.onCaughtError=r,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=o,this.incompleteTransitions=new Map}function b1(t,e,n,i,s,r,a,l,o,u,c,d){return t=new __(t,e,n,a,o,u,c,d,l),e=1,r===!0&&(e|=24),r=gn(3,null,null,e),t.current=r,r.stateNode=t,e=Zh(),e.refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:i,isDehydrated:n,cache:e},tm(r),t}function S1(t){return t?(t=_r,t):_r}function E1(t,e,n,i,s,r){s=S1(s),i.context===null?i.context=s:i.pendingContext=s,i=rs(e),i.payload={element:n},r=r===void 0?null:r,r!==null&&(i.callback=r),n=as(t,i,e),n!==null&&(Zt(n,t,e),ja(n,t,e))}function Qg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Lm(t,e){Qg(t,e),(t=t.alternate)&&Qg(t,e)}function T1(t){if(t.tag===13||t.tag===31){var e=er(t,67108864);e!==null&&Zt(e,t,67108864),Lm(t,67108864)}}function Wg(t){if(t.tag===13||t.tag===31){var e=Sn();e=Bh(e);var n=er(t,e);n!==null&&Zt(n,t,e),Lm(t,e)}}var Ru=!0;function L_(t,e,n,i){var s=ce.T;ce.T=null;var r=De.p;try{De.p=2,Rm(t,e,n,i)}finally{De.p=r,ce.T=s}}function R_(t,e,n,i){var s=ce.T;ce.T=null;var r=De.p;try{De.p=8,Rm(t,e,n,i)}finally{De.p=r,ce.T=s}}function Rm(t,e,n,i){if(Ru){var s=Kf(i);if(s===null)ad(t,e,i,wu,n),Zg(t,i);else if(C_(s,t,e,n,i))i.stopPropagation();else if(Zg(t,i),e&4&&-1<w_.indexOf(t)){for(;s!==null;){var r=ra(s);if(r!==null)switch(r.tag){case 3:if(r=r.stateNode,r.current.memoizedState.isDehydrated){var a=Cs(r.pendingLanes);if(a!==0){var l=r;for(l.pendingLanes|=2,l.entangledLanes|=2;a;){var o=1<<31-bn(a);l.entanglements[1]|=o,a&=~o}fi(r),!(Ie&6)&&(xu=xn()+500,Fl(0))}}break;case 31:case 13:l=er(r,2),l!==null&&Zt(l,r,2),uc(),Lm(r,2)}if(r=Kf(i),r===null&&ad(t,e,i,wu,n),r===s)break;s=r}s!==null&&i.stopPropagation()}else ad(t,e,i,null,n)}}function Kf(t){return t=zh(t),wm(t)}var wu=null;function wm(t){if(wu=null,t=br(t),t!==null){var e=Rl(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=Gx(e),t!==null)return t;t=null}else if(n===31){if(t=Hx(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return wu=t,null}function A1(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(mA()){case qx:return 2;case Xx:return 8;case su:case gA:return 32;case Qx:return 268435456;default:return 32}default:return 32}}var Yf=!1,us=null,cs=null,ds=null,hl=new Map,ml=new Map,Wi=[],w_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Zg(t,e){switch(t){case"focusin":case"focusout":us=null;break;case"dragenter":case"dragleave":cs=null;break;case"mouseover":case"mouseout":ds=null;break;case"pointerover":case"pointerout":hl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ml.delete(e.pointerId)}}function Sa(t,e,n,i,s,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[s]},e!==null&&(e=ra(e),e!==null&&T1(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function C_(t,e,n,i,s){switch(e){case"focusin":return us=Sa(us,t,e,n,i,s),!0;case"dragenter":return cs=Sa(cs,t,e,n,i,s),!0;case"mouseover":return ds=Sa(ds,t,e,n,i,s),!0;case"pointerover":var r=s.pointerId;return hl.set(r,Sa(hl.get(r)||null,t,e,n,i,s)),!0;case"gotpointercapture":return r=s.pointerId,ml.set(r,Sa(ml.get(r)||null,t,e,n,i,s)),!0}return!1}function k1(t){var e=br(t.target);if(e!==null){var n=Rl(e);if(n!==null){if(e=n.tag,e===13){if(e=Gx(n),e!==null){t.blockedOn=e,P0(t.priority,function(){Wg(n)});return}}else if(e===31){if(e=Hx(n),e!==null){t.blockedOn=e,P0(t.priority,function(){Wg(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function jo(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Kf(t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);df=i,n.target.dispatchEvent(i),df=null}else return e=ra(n),e!==null&&T1(e),t.blockedOn=n,!1;e.shift()}return!0}function Jg(t,e,n){jo(t)&&n.delete(e)}function I_(){Yf=!1,us!==null&&jo(us)&&(us=null),cs!==null&&jo(cs)&&(cs=null),ds!==null&&jo(ds)&&(ds=null),hl.forEach(Jg),ml.forEach(Jg)}function no(t,e){t.blockedOn===e&&(t.blockedOn=null,Yf||(Yf=!0,Et.unstable_scheduleCallback(Et.unstable_NormalPriority,I_)))}var io=null;function ep(t){io!==t&&(io=t,Et.unstable_scheduleCallback(Et.unstable_NormalPriority,function(){io===t&&(io=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],s=t[e+2];if(typeof i!="function"){if(wm(i||n)===null)continue;break}var r=ra(n);r!==null&&(t.splice(e,3),e-=3,Lf(r,{pending:!0,data:s,method:n.method,action:i},i,s))}}))}function Jr(t){function e(o){return no(o,t)}us!==null&&no(us,t),cs!==null&&no(cs,t),ds!==null&&no(ds,t),hl.forEach(e),ml.forEach(e);for(var n=0;n<Wi.length;n++){var i=Wi[n];i.blockedOn===t&&(i.blockedOn=null)}for(;0<Wi.length&&(n=Wi[0],n.blockedOn===null);)k1(n),n.blockedOn===null&&Wi.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(i=0;i<n.length;i+=3){var s=n[i],r=n[i+1],a=s[Jt]||null;if(typeof r=="function")a||ep(n);else if(a){var l=null;if(r&&r.hasAttribute("formAction")){if(s=r,a=r[Jt]||null)l=a.formAction;else if(wm(s)!==null)continue}else l=a.action;typeof l=="function"?n[i+1]=l:(n.splice(i,3),i-=3),ep(n)}}}function _1(){function t(r){r.canIntercept&&r.info==="react-transition"&&r.intercept({handler:function(){return new Promise(function(a){return s=a})},focusReset:"manual",scroll:"manual"})}function e(){s!==null&&(s(),s=null),i||setTimeout(n,20)}function n(){if(!i&&!navigation.transition){var r=navigation.currentEntry;r&&r.url!=null&&navigation.navigate(r.url,{state:r.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,s=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(n,100),function(){i=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),s!==null&&(s(),s=null)}}}function Cm(t){this._internalRoot=t}fc.prototype.render=Cm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(K(409));var n=e.current,i=Sn();E1(n,i,t,e,null,null)};fc.prototype.unmount=Cm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;E1(t.current,2,null,t,null,null),uc(),e[sa]=null}};function fc(t){this._internalRoot=t}fc.prototype.unstable_scheduleHydration=function(t){if(t){var e=tv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Wi.length&&e!==0&&e<Wi[n].priority;n++);Wi.splice(n,0,t),n===0&&k1(t)}};var tp=$x.version;if(tp!=="19.2.3")throw Error(K(527,tp,"19.2.3"));De.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(K(188)):(t=Object.keys(t).join(","),Error(K(268,t)));return t=lA(e),t=t!==null?Vx(t):null,t=t===null?null:t.stateNode,t};var D_={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:ce,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var so=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!so.isDisabled&&so.supportsFiber)try{wl=so.inject(D_),vn=so}catch{}}Xu.createRoot=function(t,e){if(!zx(t))throw Error(K(299));var n=!1,i="",s=yb,r=xb,a=vb;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(s=e.onUncaughtError),e.onCaughtError!==void 0&&(r=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=b1(t,1,!1,null,null,n,i,null,s,r,a,_1),t[sa]=e.current,Am(t),new Cm(e)};Xu.hydrateRoot=function(t,e,n){if(!zx(t))throw Error(K(299));var i=!1,s="",r=yb,a=xb,l=vb,o=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onUncaughtError!==void 0&&(r=n.onUncaughtError),n.onCaughtError!==void 0&&(a=n.onCaughtError),n.onRecoverableError!==void 0&&(l=n.onRecoverableError),n.formState!==void 0&&(o=n.formState)),e=b1(t,1,!0,e,n??null,i,s,o,r,a,l,_1),e.context=S1(null),n=e.current,i=Sn(),i=Bh(i),s=rs(i),s.callback=null,as(n,s,i),n=i,e.current.lanes=n,Il(e,n),fi(e),t[sa]=e.current,Am(t),new fc(e)};Xu.version="19.2.3";function L1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(L1)}catch(t){console.error(t)}}L1(),Ox.exports=Xu;var N_=Ox.exports;const M_=Yu(N_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O_=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),P_=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase()),np=t=>{const e=P_(t);return e.charAt(0).toUpperCase()+e.slice(1)},R1=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim(),F_=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var B_={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U_=P.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:s="",children:r,iconNode:a,...l},o)=>P.createElement("svg",{ref:o,...B_,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:R1("lucide",s),...!r&&!F_(l)&&{"aria-hidden":"true"},...l},[...a.map(([u,c])=>P.createElement(u,c)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=(t,e)=>{const n=P.forwardRef(({className:i,...s},r)=>P.createElement(U_,{ref:r,iconNode:e,className:R1(`lucide-${O_(np(t))}`,`lucide-${t}`,i),...s}));return n.displayName=np(t),n};/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j_=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],$_=ie("archive",j_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z_=[["path",{d:"M9 13a1 1 0 0 0-1-1H5.061a1 1 0 0 1-.75-1.811l6.836-6.835a1.207 1.207 0 0 1 1.707 0l6.835 6.835a1 1 0 0 1-.75 1.811H16a1 1 0 0 0-1 1v6a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1z",key:"lh0v7k"}]],Cu=ie("arrow-big-up",z_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G_=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],H_=ie("arrow-right",G_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V_=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],K_=ie("arrow-up",V_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y_=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],q_=ie("award",Y_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X_=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ud=ie("brain",X_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q_=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],W_=ie("calendar",Q_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z_=[["rect",{width:"18",height:"14",x:"3",y:"5",rx:"2",ry:"2",key:"12ruh7"}],["path",{d:"M7 15h4M15 15h2M7 11h2M13 11h4",key:"1ueiar"}]],w1=ie("captions",Z_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J_=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],eL=ie("chart-column",J_);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tL=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Iu=ie("check",tL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nL=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],qf=ie("chevron-down",nL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iL=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Im=ie("chevron-left",iL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sL=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],C1=ie("chevron-right",sL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rL=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],aL=ie("chevron-up",rL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],I1=ie("circle-alert",lL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oL=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],uL=ie("circle-check-big",oL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cL=[["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ip=ie("circle-play",cL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],fL=ie("circle-question-mark",dL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],mL=ie("circle-x",hL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gL=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5.782 5.782A7 7 0 0 0 9 19h8.5a4.5 4.5 0 0 0 1.307-.193",key:"yfwify"}],["path",{d:"M21.532 16.5A4.5 4.5 0 0 0 17.5 10h-1.79A7.008 7.008 0 0 0 10 5.07",key:"jlfiyv"}]],pL=ie("cloud-off",gL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yL=[["path",{d:"m15 10 5 5-5 5",key:"qqa56n"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]],xL=ie("corner-down-right",yL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vL=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],D1=ie("download",vL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bL=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],SL=ie("ellipsis",bL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EL=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],js=ie("external-link",EL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TL=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],AL=ie("eye",TL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kL=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],N1=ie("flame",kL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _L=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],sp=ie("funnel",_L);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LL=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],M1=ie("globe",LL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RL=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Xf=ie("hash",RL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wL=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],CL=ie("house",wL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IL=[["path",{d:"m22 11-1.296-1.296a2.4 2.4 0 0 0-3.408 0L11 16",key:"9kzy35"}],["path",{d:"M4 8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2",key:"1t0f0t"}],["circle",{cx:"13",cy:"7",r:"1",fill:"currentColor",key:"1obus6"}],["rect",{x:"8",y:"2",width:"14",height:"14",rx:"2",key:"1gvhby"}]],O1=ie("images",IL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DL=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],NL=ie("key",DL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ML=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],P1=ie("layers",ML);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OL=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],PL=ie("layout-grid",OL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FL=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],rp=ie("leaf",FL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BL=[["path",{d:"M2 5h20",key:"1fs1ex"}],["path",{d:"M6 12h12",key:"8npq4p"}],["path",{d:"M9 19h6",key:"456am0"}]],UL=ie("list-filter",BL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jL=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],$L=ie("list",jL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zL=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],hc=ie("loader-circle",zL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GL=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],F1=ie("maximize-2",GL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HL=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Ys=ie("message-square",HL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VL=[["path",{d:"m14 10 7-7",key:"oa77jy"}],["path",{d:"M20 10h-6V4",key:"mjg0md"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M4 14h6v6",key:"rmj7iw"}]],KL=ie("minimize-2",VL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YL=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],qL=ie("moon",YL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XL=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],gl=ie("plus",XL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QL=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ap=ie("radio",QL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WL=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],ZL=ie("refresh-cw",WL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JL=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],eR=ie("save",JL);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tR=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],$o=ie("scale",tR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nR=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],pl=ie("search",nR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iR=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],lp=ie("share-2",iR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sR=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],B1=ie("settings",sR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],Qf=ie("shield-alert",rR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],U1=ie("shield-check",aR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lR=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],j1=ie("shield",lR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oR=[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]],uR=ie("sliders-vertical",oR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cR=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Dm=ie("sparkles",cR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dR=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],fR=ie("sun",dR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hR=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],mR=ie("trash-2",hR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gR=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],op=ie("triangle-alert",gR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pR=[["path",{d:"M12 4v16",key:"1654pz"}],["path",{d:"M4 7V5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v2",key:"e0r10z"}],["path",{d:"M9 20h6",key:"s66wpe"}]],yR=ie("type",pR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xR=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],vR=ie("upload",xR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bR=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],SR=ie("user",bR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ER=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],TR=ie("users",ER);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AR=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],kR=ie("wind",AR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _R=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],qs=ie("x",_R);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LR=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],RR=ie("zoom-in",LR);/**
 * @license lucide-react v0.560.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wR=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],CR=ie("zoom-out",wR),ri="https://www.reddit.com",IR=2e4,DR=3,NR=2,Ea=new Map,ar={FEED:5*60*1e3,COMMENTS:10*60*1e3,ABOUT:24*60*60*1e3,SEARCH:10*60*1e3,USER:15*60*1e3,DEFAULT:2*60*1e3},MR=t=>t.includes("/about.json")?t.includes("/user/")?ar.USER:ar.ABOUT:t.includes("/comments/")?ar.COMMENTS:t.includes("/search.json")?ar.SEARCH:t.includes("/r/")||t.includes("popular")||t.includes("all")?ar.FEED:ar.DEFAULT;Math.random().toString(36).substring(7);const OR=[t=>`https://corsproxy.io/?${encodeURIComponent(t)}`,t=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(t)}`,t=>`https://corsproxy.io/?url=${encodeURIComponent(t)}`],PR=(t="GET")=>{let e=[...OR];if(t==="POST")return[n=>`https://corsproxy.io/?${encodeURIComponent(n)}`];for(let n=e.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[e[n],e[i]]=[e[i],e[n]]}return e},FR=t=>new Promise(e=>setTimeout(e,t));class BR{constructor(e){kc(this,"queue",[]);kc(this,"activeCount",0);this.maxConcurrent=e}async add(e){return new Promise((n,i)=>{const s=async()=>{this.activeCount++;try{const r=await e();n(r)}catch(r){i(r)}finally{this.activeCount--,this.next()}};this.activeCount<this.maxConcurrent?s():this.queue.push(s)})}next(){if(this.queue.length>0&&this.activeCount<this.maxConcurrent){const e=this.queue.shift();e==null||e()}}}const UR=new BR(NR),jR=async(t,e={})=>{const{signal:n,...i}=e,s=new AbortController,r=()=>s.abort();n&&(n.addEventListener("abort",r),n.aborted&&s.abort());const a=setTimeout(()=>s.abort(),IR);try{const l=await fetch(t,{...i,signal:s.signal});return clearTimeout(a),n&&n.removeEventListener("abort",r),l}catch(l){throw clearTimeout(a),n&&n.removeEventListener("abort",r),n!=null&&n.aborted?l:l.name==="AbortError"?new Error("Request timed out"):l}},nr=async(t,e,n=!1)=>{const i=!(e!=null&&e.method)||e.method==="GET";if(i&&!n){const s=Ea.get(t);if(s&&Date.now()<s.expiry)return JSON.parse(JSON.stringify(s.data))}return UR.add(async()=>{var l,o;let s=null;const r=(e==null?void 0:e.method)||"GET",a=PR(r);for(let u=0;u<=DR;u++){if((l=e==null?void 0:e.signal)!=null&&l.aborted)throw new DOMException("Aborted","AbortError");const c=a[u%a.length];try{const d=t.includes("?")?"&":"?",f=n?`${d}cb=${Date.now()}`:"",h=c(t+f);if(u>0){const x=1e3*Math.pow(2,u)+Math.random()*500;await FR(x)}if((o=e==null?void 0:e.signal)!=null&&o.aborted)throw new DOMException("Aborted","AbortError");const m=await jR(h,e);if(m.status===429)throw console.warn(`Rate limit hit (429) on proxy ${u}. Retrying...`),new Error("RateLimit");if(m.status>=500)throw new Error(`Server Error: ${m.status}`);if(!m.ok){if(m.status===403||m.status===404){const x=new Error(`Reddit Error: ${m.status}`);throw x.status=m.status,x}throw new Error(`Proxy error: ${m.status} ${m.statusText}`)}const y=await m.text();if(y.trim().startsWith("<"))throw new Error("Received HTML instead of JSON (Proxy Error Page)");try{const x=JSON.parse(y);if(x.error)throw new Error(`Reddit API Error: ${x.message||x.error}`);if(i&&(Ea.set(t,{data:x,timestamp:Date.now(),expiry:Date.now()+MR(t)}),Ea.size>100)){const p=Ea.keys().next().value;p&&Ea.delete(p)}return x}catch{throw new Error("Received invalid JSON data")}}catch(d){if(d.name==="AbortError"||e!=null&&e.signal&&e.signal.aborted||d.status===404)throw d;console.warn(`Attempt ${u+1} failed: ${d.message}`),s=d}}throw s||new Error("Unable to connect to Reddit. Please try again later.")})},$R=async(t,e,n=null,i=[],s,r="hot",a="day",l=25,o=!1,u)=>{let c="";if(t==="search"&&s){const d=r==="rising"?"relevance":r;e?c=`${ri}/r/${e}/search.json?q=${encodeURIComponent(s)}&restrict_sr=on&sort=${d}&limit=${l}&raw_json=1`:c=`${ri}/search.json?q=${encodeURIComponent(s)}&sort=${d}&limit=${l}&raw_json=1`}else if(t==="user"&&e)c=`${ri}/user/${e}/submitted.json?limit=${l}&raw_json=1&sort=${r}`;else{let d="";t==="popular"?d="/r/popular":t==="all"?d="/r/all":t==="subreddit"&&e&&(d=`/r/${e}`),c=`${ri}${d}/${r}.json?limit=${l}&raw_json=1`}r==="top"&&(c+=`&t=${a}`),n&&(c+=`&after=${n}`);try{const d=await nr(c,{signal:u},o);return!d||!d.data||!d.data.children?{posts:[],after:null}:{posts:d.data.children.filter(f=>f.kind==="t3"),after:d.data.after}}catch(d){throw d}},zR=async(t,e)=>{const n=`${ri}/user/${t}/about.json?raw_json=1`;try{const i=await nr(n,{signal:e});return i&&i.data?i.data:null}catch(i){return console.error("Failed to fetch user details",i),null}},$1=async(t,e="confidence",n)=>{const i=t.replace(/\/$/,""),s=`${ri}${i}.json?raw_json=1&sort=${e}`;try{const r=await nr(s,{signal:n});return Array.isArray(r)&&r.length>1?r[1].data.children:[]}catch(r){return console.error("Failed to fetch comments",r),[]}},GR=async(t,e)=>{var s;const n=t.replace(/\/$/,""),i=`${ri}${n}.json?raw_json=1`;try{const r=await nr(i,{signal:e});if(Array.isArray(r)&&r.length>0){const a=(s=r[0].data)==null?void 0:s.children;if(a&&a.length>0&&a[0].kind==="t3")return a[0].data}return null}catch(r){return console.error("Failed to fetch specific post",r),null}},HR=async(t,e,n)=>{const s=[];for(let a=0;a<e.length;a+=20)s.push(e.slice(a,a+20));return(await Promise.all(s.map(async a=>{const l=`${ri}/api/morechildren.json`,o=new URLSearchParams;o.append("link_id",t),o.append("children",a.join(",")),o.append("api_type","json");try{const u=await nr(l,{method:"POST",body:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},signal:n});return u&&u.json&&u.json.data&&u.json.data.things?u.json.data.things:[]}catch(u){return console.warn("Failed to fetch specific chunk of children",u),[]}}))).flat()},z1=async(t,e)=>{const n=`${ri}/subreddits/search.json?q=${encodeURIComponent(t)}&limit=5&raw_json=1`;try{const i=await nr(n,{signal:e});return!i||!i.data||!i.data.children?[]:i.data.children.map(s=>s.data.display_name)}catch{return[]}},VR=async(t,e)=>{const n=`${ri}/r/${t}/about.json?raw_json=1`;try{const i=await nr(n,{signal:e});return i&&i.data?i.data:null}catch(i){return console.error("Failed to fetch subreddit details",i),null}},KR=({currentFeed:t,currentSub:e,onNavigate:n,followedSubs:i,onFollow:s,onUnfollow:r,theme:a,toggleTheme:l,blockedCount:o,blockedCommentCount:u,onOpenSettings:c})=>{const[d,f]=P.useState(""),[h,m]=P.useState([]),[y,x]=P.useState(!1),p=async E=>{if(E.preventDefault(),!!d.trim()){x(!0);try{const k=await z1(d);m(k)}catch(k){console.error("Search failed",k)}finally{x(!1)}}},v=()=>{d.trim()&&(n("search",void 0,d),b())},b=()=>{f(""),m([])};return g.jsxs("div",{className:"w-full md:w-64 bg-white dark:bg-stone-900 border-r border-stone-200 dark:border-stone-800 h-full flex flex-col shrink-0 transition-colors",children:[g.jsxs("div",{className:"p-6 border-b border-stone-100 dark:border-stone-800 flex justify-between items-start shrink-0 bg-white/50 dark:bg-stone-900/50 backdrop-blur-sm",children:[g.jsxs("div",{className:"cursor-pointer",onClick:()=>n("popular"),children:[g.jsxs("h1",{className:"text-2xl font-light text-stone-800 dark:text-stone-100 flex items-center gap-2 select-none",children:[g.jsx("span",{className:"w-3 h-3 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)] animate-pulse"}),"ZenReddit"]}),g.jsx("p",{className:"text-xs text-stone-400 mt-1",children:"Peaceful browsing, AI filtered."})]}),g.jsxs("div",{className:"flex gap-1",children:[g.jsx("button",{onClick:c,className:"text-stone-400 hover:text-stone-600 dark:hover:text-stone-200 transition-colors p-1.5 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 btn-press",title:"AI Settings",children:g.jsx(B1,{size:18})}),g.jsx("button",{onClick:l,className:"text-stone-400 hover:text-stone-600 dark:hover:text-stone-200 transition-colors p-1.5 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 btn-press",title:"Toggle Theme",children:a==="light"?g.jsx(qL,{size:18}):g.jsx(fR,{size:18})})]})]}),g.jsx("div",{className:"px-4 py-4 border-b border-stone-100 dark:border-stone-800 shrink-0 bg-stone-50/50 dark:bg-stone-900/50 backdrop-blur-sm z-10",children:g.jsxs("form",{onSubmit:p,className:"relative group",children:[g.jsx(pl,{className:"absolute left-3 top-2.5 text-stone-400 group-focus-within:text-emerald-500 transition-colors",size:14}),g.jsx("input",{type:"text",placeholder:"Search / Add sub...",value:d,onChange:E=>f(E.target.value),className:"w-full bg-white dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-lg pl-9 pr-8 py-2 text-sm text-stone-700 dark:text-stone-200 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 transition-all placeholder-stone-400"}),d&&g.jsx("button",{type:"button",onClick:b,className:"absolute right-2 top-2.5 text-stone-400 hover:text-stone-600 dark:hover:text-stone-300",children:g.jsx(qs,{size:14})})]})}),g.jsxs("nav",{className:"flex-1 overflow-y-auto p-4 space-y-6 custom-scrollbar",children:[d.length>0&&g.jsxs("div",{className:"animate-fade-in",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[g.jsx("h3",{className:"text-xs font-semibold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider",children:"Results"}),g.jsx("button",{onClick:b,className:"text-xs text-stone-400 hover:text-stone-600",children:"Clear"})]}),g.jsxs("div",{className:"bg-white dark:bg-stone-800 border border-stone-200 dark:border-stone-700 rounded-lg shadow-sm overflow-hidden",children:[g.jsxs("button",{onClick:v,className:"w-full text-left px-3 py-2 text-sm text-stone-600 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-700 flex items-center gap-2 border-b border-stone-100 dark:border-stone-800 transition-colors",children:[g.jsx(pl,{size:14,className:"text-emerald-500"}),g.jsxs("span",{className:"truncate font-medium",children:['Search posts for "',d,'"']}),g.jsx(H_,{size:12,className:"ml-auto text-stone-400"})]}),h.map(E=>g.jsxs("div",{className:"w-full flex items-center border-b border-stone-100 dark:border-stone-800 last:border-0 hover:bg-stone-50 dark:hover:bg-stone-700 transition-colors",children:[g.jsxs("button",{onClick:()=>{n("subreddit",E),b()},className:"flex-1 text-left px-3 py-2 text-sm text-stone-600 dark:text-stone-300 truncate",children:["r/",E]}),g.jsx("button",{onClick:k=>{k.stopPropagation(),s(E),b()},className:"p-2 px-3 text-stone-400 hover:text-emerald-500 transition-colors border-l border-stone-100 dark:border-stone-800/50",title:"Follow",children:g.jsx(gl,{size:14})})]},E)),h.length===0&&!y&&g.jsx("div",{className:"px-3 py-4 text-center text-xs text-stone-400",children:"No subreddits found."})]})]}),!d&&g.jsxs("div",{children:[g.jsx("h3",{className:"text-xs font-semibold text-stone-400 uppercase tracking-wider mb-3 px-2",children:"Feeds"}),g.jsxs("div",{className:"space-y-1",children:[g.jsxs("button",{onClick:()=>n("popular"),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${t==="popular"?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":"text-stone-600 dark:text-stone-400 hover:bg-stone-50 dark:hover:bg-stone-800"}`,children:[g.jsx(N1,{size:18}),"Popular"]}),g.jsxs("button",{onClick:()=>n("all"),className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm font-medium transition-all ${t==="all"?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":"text-stone-600 dark:text-stone-400 hover:bg-stone-50 dark:hover:bg-stone-800"}`,children:[g.jsx(M1,{size:18}),"All"]})]})]}),!d&&g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-3 px-2",children:[g.jsx("h3",{className:"text-xs font-semibold text-stone-400 uppercase tracking-wider",children:"Following"}),g.jsx("span",{className:"text-[10px] bg-stone-100 dark:bg-stone-800 text-stone-500 px-1.5 py-0.5 rounded-full",children:i.length})]}),g.jsxs("div",{className:"space-y-1",children:[i.map(E=>g.jsxs("div",{className:`group flex items-center justify-between px-3 py-2 rounded-lg transition-all ${t==="subreddit"&&e===E?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":"text-stone-600 dark:text-stone-400 hover:bg-stone-50 dark:hover:bg-stone-800"}`,children:[g.jsxs("button",{onClick:()=>n("subreddit",E),className:"flex items-center gap-3 flex-1 min-w-0 text-left",children:[g.jsx(Xf,{size:16,className:"shrink-0 opacity-70"}),g.jsxs("span",{className:"text-sm font-medium truncate",children:["r/",E]})]}),g.jsx("button",{onClick:k=>{k.stopPropagation(),confirm(`Unfollow r/${E}?`)&&r(E)},className:"opacity-0 group-hover:opacity-100 p-1 text-stone-400 hover:text-red-500 transition-all",title:"Unfollow",children:g.jsx(mR,{size:14})})]},E)),i.length===0&&g.jsxs("div",{className:"text-center py-6 border border-dashed border-stone-200 dark:border-stone-800 rounded-lg",children:[g.jsx("p",{className:"text-xs text-stone-400",children:"No subscriptions yet."}),g.jsx("p",{className:"text-[10px] text-stone-300 dark:text-stone-600 mt-1",children:"Use search to add some!"})]})]})]})]}),g.jsxs("div",{className:"p-4 border-t border-stone-100 dark:border-stone-800 bg-stone-50/50 dark:bg-stone-900/50 shrink-0",children:[g.jsx("div",{className:"flex items-center justify-between mb-2",children:g.jsxs("span",{className:"text-xs font-semibold text-stone-500 dark:text-stone-400 flex items-center gap-1.5",children:[g.jsx(U1,{size:14,className:"text-emerald-500"}),"Zen Shield Active"]})}),g.jsxs("div",{className:"space-y-1.5",children:[g.jsxs("div",{className:"flex justify-between text-[10px] text-stone-400",children:[g.jsx("span",{children:"Blocked Posts"}),g.jsx("span",{className:"font-mono",children:o})]}),g.jsx("div",{className:"w-full h-1 bg-stone-200 dark:bg-stone-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(o,100)}%`}})}),g.jsxs("div",{className:"flex justify-between text-[10px] text-stone-400 mt-2",children:[g.jsx("span",{children:"Toxic Comments Hidden"}),g.jsx("span",{className:"font-mono",children:u})]}),g.jsx("div",{className:"w-full h-1 bg-stone-200 dark:bg-stone-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(u,100)}%`}})})]})]})]})},ro=43200,up=1440,cp=Symbol.for("constructDateFrom");function Nm(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&cp in t?t[cp](e):t instanceof Date?new t.constructor(e):new Date(e)}function ys(t,e){return Nm(t,t)}let YR={};function qR(){return YR}function dp(t){const e=ys(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function Mm(t,...e){const n=Nm.bind(null,t||e.find(i=>typeof i=="object"));return e.map(n)}function zo(t,e){const n=+ys(t)-+ys(e);return n<0?-1:n>0?1:n}function XR(t){return Nm(t,Date.now())}function QR(t,e,n){const[i,s]=Mm(n==null?void 0:n.in,t,e),r=i.getFullYear()-s.getFullYear(),a=i.getMonth()-s.getMonth();return r*12+a}function WR(t){return e=>{const i=(t?Math[t]:Math.trunc)(e);return i===0?0:i}}function ZR(t,e){return+ys(t)-+ys(e)}function JR(t,e){const n=ys(t);return n.setHours(23,59,59,999),n}function ew(t,e){const n=ys(t),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function tw(t,e){const n=ys(t);return+JR(n)==+ew(n)}function nw(t,e,n){const[i,s,r]=Mm(n==null?void 0:n.in,t,t,e),a=zo(s,r),l=Math.abs(QR(s,r));if(l<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-a*l);let o=zo(s,r)===-a;tw(i)&&l===1&&zo(i,r)===1&&(o=!1);const u=a*(l-+o);return u===0?0:u}function iw(t,e,n){const i=ZR(t,e)/1e3;return WR(n==null?void 0:n.roundingMethod)(i)}const sw={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},rw=(t,e,n)=>{let i;const s=sw[t];return typeof s=="string"?i=s:e===1?i=s.one:i=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+i:i+" ago":i};function cd(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const aw={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lw={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ow={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},uw={date:cd({formats:aw,defaultWidth:"full"}),time:cd({formats:lw,defaultWidth:"full"}),dateTime:cd({formats:ow,defaultWidth:"full"})},cw={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},dw=(t,e,n,i)=>cw[t];function Ta(t){return(e,n)=>{const i=n!=null&&n.context?String(n.context):"standalone";let s;if(i==="formatting"&&t.formattingValues){const a=t.defaultFormattingWidth||t.defaultWidth,l=n!=null&&n.width?String(n.width):a;s=t.formattingValues[l]||t.formattingValues[a]}else{const a=t.defaultWidth,l=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[l]||t.values[a]}const r=t.argumentCallback?t.argumentCallback(e):e;return s[r]}}const fw={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},hw={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},mw={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gw={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},pw={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},yw={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},xw=(t,e)=>{const n=Number(t),i=n%100;if(i>20||i<10)switch(i%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},vw={ordinalNumber:xw,era:Ta({values:fw,defaultWidth:"wide"}),quarter:Ta({values:hw,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Ta({values:mw,defaultWidth:"wide"}),day:Ta({values:gw,defaultWidth:"wide"}),dayPeriod:Ta({values:pw,defaultWidth:"wide",formattingValues:yw,defaultFormattingWidth:"wide"})};function Aa(t){return(e,n={})=>{const i=n.width,s=i&&t.matchPatterns[i]||t.matchPatterns[t.defaultMatchWidth],r=e.match(s);if(!r)return null;const a=r[0],l=i&&t.parsePatterns[i]||t.parsePatterns[t.defaultParseWidth],o=Array.isArray(l)?Sw(l,d=>d.test(a)):bw(l,d=>d.test(a));let u;u=t.valueCallback?t.valueCallback(o):o,u=n.valueCallback?n.valueCallback(u):u;const c=e.slice(a.length);return{value:u,rest:c}}}function bw(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function Sw(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function Ew(t){return(e,n={})=>{const i=e.match(t.matchPattern);if(!i)return null;const s=i[0],r=e.match(t.parsePattern);if(!r)return null;let a=t.valueCallback?t.valueCallback(r[0]):r[0];a=n.valueCallback?n.valueCallback(a):a;const l=e.slice(s.length);return{value:a,rest:l}}}const Tw=/^(\d+)(th|st|nd|rd)?/i,Aw=/\d+/i,kw={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},_w={any:[/^b/i,/^(a|c)/i]},Lw={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Rw={any:[/1/i,/2/i,/3/i,/4/i]},ww={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Cw={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Iw={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Dw={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Nw={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Mw={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ow={ordinalNumber:Ew({matchPattern:Tw,parsePattern:Aw,valueCallback:t=>parseInt(t,10)}),era:Aa({matchPatterns:kw,defaultMatchWidth:"wide",parsePatterns:_w,defaultParseWidth:"any"}),quarter:Aa({matchPatterns:Lw,defaultMatchWidth:"wide",parsePatterns:Rw,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Aa({matchPatterns:ww,defaultMatchWidth:"wide",parsePatterns:Cw,defaultParseWidth:"any"}),day:Aa({matchPatterns:Iw,defaultMatchWidth:"wide",parsePatterns:Dw,defaultParseWidth:"any"}),dayPeriod:Aa({matchPatterns:Nw,defaultMatchWidth:"any",parsePatterns:Mw,defaultParseWidth:"any"})},Pw={code:"en-US",formatDistance:rw,formatLong:uw,formatRelative:dw,localize:vw,match:Ow,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Fw(t,e,n){const i=qR(),s=(n==null?void 0:n.locale)??i.locale??Pw,r=2520,a=zo(t,e);if(isNaN(a))throw new RangeError("Invalid time value");const l=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:a}),[o,u]=Mm(n==null?void 0:n.in,...a>0?[e,t]:[t,e]),c=iw(u,o),d=(dp(u)-dp(o))/1e3,f=Math.round((c-d)/60);let h;if(f<2)return n!=null&&n.includeSeconds?c<5?s.formatDistance("lessThanXSeconds",5,l):c<10?s.formatDistance("lessThanXSeconds",10,l):c<20?s.formatDistance("lessThanXSeconds",20,l):c<40?s.formatDistance("halfAMinute",0,l):c<60?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",1,l):f===0?s.formatDistance("lessThanXMinutes",1,l):s.formatDistance("xMinutes",f,l);if(f<45)return s.formatDistance("xMinutes",f,l);if(f<90)return s.formatDistance("aboutXHours",1,l);if(f<up){const m=Math.round(f/60);return s.formatDistance("aboutXHours",m,l)}else{if(f<r)return s.formatDistance("xDays",1,l);if(f<ro){const m=Math.round(f/up);return s.formatDistance("xDays",m,l)}else if(f<ro*2)return h=Math.round(f/ro),s.formatDistance("aboutXMonths",h,l)}if(h=nw(u,o),h<12){const m=Math.round(f/ro);return s.formatDistance("xMonths",m,l)}else{const m=h%12,y=Math.trunc(h/12);return m<3?s.formatDistance("aboutXYears",y,l):m<9?s.formatDistance("overXYears",y,l):s.formatDistance("almostXYears",y+1,l)}}function yl(t,e){return Fw(t,XR(t),e)}const Wf=({score:t,size:e="sm",className:n=""})=>{let i="",s=rp;t>=80?(i="bg-emerald-100 text-emerald-700 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-800",s=rp):t>=50?(i="bg-sky-100 text-sky-700 border-sky-200 dark:bg-sky-900/30 dark:text-sky-400 dark:border-sky-800",s=kR):(i="bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-800",s=I1);const r=e==="sm"?10:13;return g.jsxs("div",{className:`
        inline-flex items-center gap-1.5 rounded-full border font-bold uppercase tracking-wider whitespace-nowrap shadow-sm select-none
        ${i} 
        ${e==="sm"?"text-[9px] px-2 py-0.5 h-5":"text-[10px] px-2.5 py-1 h-6"}
        ${n}
      `,title:`Zen Score: ${t}/100`,children:[g.jsx(s,{size:r,strokeWidth:2.5}),g.jsx("span",{children:t})]})},Zf=t=>t?t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&nbsp;/g," "):"",ka=()=>{navigator.vibrate&&navigator.vibrate(5)},dd=({text:t,bgColor:e,textColor:n,className:i=""})=>{if(!t)return null;const s=e&&e!=="transparent"&&e!=="",r=n==="light",a={backgroundColor:s?e:void 0};return g.jsx("span",{style:a,className:`
        inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-tight 
        ${s?"":"bg-stone-200 dark:bg-stone-800 text-stone-600 dark:text-stone-400"} 
        ${s&&r?"text-white shadow-[inset_0_0_0_1px_rgba(255,255,255,0.2),0_1px_2px_rgba(0,0,0,0.1)]":""} 
        ${s&&!r?"text-stone-900 shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)]":""} 
        ${i} whitespace-nowrap leading-none border border-black/5 dark:border-white/5
      `,children:Zf(t)})},Bw=({post:t,isSeen:e=!1,onClick:n,onNavigateSub:i,onNavigateUser:s,onImageClick:r,viewMode:a="card"})=>{var y;const[l,o]=P.useState(!1),[u,c]=P.useState(!1),d=async x=>{x.stopPropagation(),ka();const p=`https://www.reddit.com${t.permalink}`;if(navigator.share)try{await navigator.share({title:t.title,url:p})}catch{}else try{await navigator.clipboard.writeText(p),c(!0),setTimeout(()=>c(!1),2e3)}catch(v){console.error("Failed to copy",v)}},f=x=>{var L,C,w,A,I,N,V,G,$,D,j,U,q,R;if(x.stopPropagation(),ka(),t.is_video||!!((L=t.secure_media)!=null&&L.reddit_video)||!!((C=t.preview)!=null&&C.reddit_video_preview)||t.url&&!!t.url.match(/\.(mp4|gifv|webm|mkv|mov)$/i)||t.domain==="v.redd.it"){if(!r)return;let F=(A=(w=t.secure_media)==null?void 0:w.reddit_video)==null?void 0:A.hls_url,B=(N=(I=t.secure_media)==null?void 0:I.reddit_video)==null?void 0:N.fallback_url;!F&&!B&&((V=t.preview)!=null&&V.reddit_video_preview)&&(F=t.preview.reddit_video_preview.hls_url,B=t.preview.reddit_video_preview.fallback_url),!F&&!B&&t.url&&(t.url.match(/\.(mp4|webm|mov)$/i)?B=t.url:t.url.match(/\.gifv$/i)&&(B=t.url.replace(/\.gifv$/i,".mp4"))),!B&&!F&&(t.url.includes(".mp4")||t.domain==="v.redd.it")&&(B=t.url),r([{src:t.thumbnail&&t.thumbnail.startsWith("http")?t.thumbnail:"",caption:t.title,id:t.id,type:"video",videoSources:{hls:F,mp4:B}}],0);return}if(!r){n(t);return}if(t.is_gallery&&t.gallery_data&&t.media_metadata){const F=t.gallery_data.items.map(B=>{var X,Z;const T=t.media_metadata[B.media_id];let Y=((X=T==null?void 0:T.s)==null?void 0:X.u)||((Z=T==null?void 0:T.s)==null?void 0:Z.gif);return Y?(Y=Y.replace(/&amp;/g,"&"),{src:Y,caption:B.caption,id:B.id,type:"image"}):null}).filter(B=>B!==null);if(F.length>0){r(F,0);return}}let v=t.url;(j=(D=($=(G=t.preview)==null?void 0:G.images)==null?void 0:$[0])==null?void 0:D.source)!=null&&j.url&&(v=t.preview.images[0].source.url.replace(/&amp;/g,"&"));const E=v.split("?")[0].toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/i),k=(U=t.domain)==null?void 0:U.includes("i.redd.it"),_=!!((R=(q=t.preview)==null?void 0:q.images)!=null&&R[0]);E||k||_?r([{src:v,caption:t.title,type:"image"}],0):n(t)},h=()=>{var p,v,b,E;let x=null;return t.thumbnail&&t.thumbnail.startsWith("http")?x=t.thumbnail:(E=(b=(v=(p=t.preview)==null?void 0:p.images)==null?void 0:v[0])==null?void 0:b.source)!=null&&E.url&&(x=t.preview.images[0].source.url.replace(/&amp;/g,"&")),x==="self"||x==="default"||x==="image"||!x?null:x},m=P.useMemo(()=>{var b,E,k,_,L,C,w,A,I,N,V;const x=t.is_video||!!((b=t.secure_media)!=null&&b.reddit_video)||!!((E=t.preview)!=null&&E.reddit_video_preview)||t.url&&!!t.url.match(/\.(mp4|gifv|webm|mkv|mov)$/i)||t.domain==="v.redd.it",p=t.is_gallery||t.gallery_data||t.url.includes("imgur.com")&&(t.url.includes("/a/")||t.url.includes("/gallery/"));let v=null;if((C=(L=(_=(k=t.preview)==null?void 0:k.images)==null?void 0:_[0])==null?void 0:L.source)!=null&&C.url){v=t.preview.images[0].source.url.replace(/&amp;/g,"&");const G=t.preview.images[0].resolutions;if(G&&G.length>0){const $=G.find(D=>D.width>=640)||G[G.length-1];$&&(v=$.url.replace(/&amp;/g,"&"))}}else t.thumbnail&&t.thumbnail.startsWith("http")&&t.thumbnail!=="self"&&t.thumbnail!=="default"&&t.thumbnail!=="image"&&(v=t.thumbnail);if(v&&(x||p||t.url.match(/\.(jpg|jpeg|png|gif|webp)$/i)||(w=t.domain)!=null&&w.includes("redd.it")||(A=t.domain)!=null&&A.includes("imgur"))){const G=(V=(N=(I=t.preview)==null?void 0:I.images)==null?void 0:N[0])==null?void 0:V.source,$=!!(G!=null&&G.width&&(G!=null&&G.height)),D=$?{aspectRatio:`${G.width} / ${G.height}`}:void 0;return g.jsxs("div",{className:`relative mt-3 rounded-xl overflow-hidden bg-stone-100 dark:bg-stone-800 cursor-pointer group/media shadow-inner ${$?"max-h-[600px]":""}`,onClick:f,style:D,children:[g.jsx("img",{src:v,alt:"preview",className:`w-full object-cover transition-transform duration-700 ease-out group-hover/media:scale-105 ${$?"h-full":"h-auto max-h-[600px] min-h-[200px]"}`,loading:"lazy"}),x&&g.jsx("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black/10 group-hover/media:bg-black/30 transition-colors duration-300",children:g.jsx("div",{className:"bg-black/50 p-3 rounded-full backdrop-blur-md transform transition-transform duration-300 group-hover/media:scale-110",children:g.jsx(ip,{size:32,className:"text-white fill-white/20"})})}),p&&!x&&g.jsxs("div",{className:"absolute top-2 right-2 bg-black/60 backdrop-blur-md rounded-lg px-2.5 py-1.5 flex items-center gap-1.5 text-xs text-white font-medium border border-white/10",children:[g.jsx(P1,{size:14}),g.jsx("span",{children:"Gallery"})]})]})}return!t.selftext&&t.thumbnail&&t.thumbnail.startsWith("http")?g.jsxs("div",{className:"mt-3 flex gap-3 p-3 rounded-xl bg-stone-50 dark:bg-stone-800/50 border border-stone-100 dark:border-stone-800 hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors cursor-pointer group/link",onClick:G=>{G.stopPropagation(),window.open(t.url,"_blank")},children:[g.jsx("div",{className:"overflow-hidden rounded-lg shrink-0 w-20 h-20 bg-stone-200 dark:bg-stone-700",children:g.jsx("img",{src:t.thumbnail,alt:"thumb",className:"w-full h-full object-cover transition-transform duration-500 group-hover/link:scale-110"})}),g.jsxs("div",{className:"flex flex-col justify-center min-w-0",children:[g.jsxs("span",{className:"text-sm font-medium text-stone-800 dark:text-stone-200 truncate w-full flex items-center gap-1 group-hover/link:text-emerald-600 transition-colors",children:[t.domain,g.jsx(js,{size:12,className:"text-stone-400 group-hover/link:text-emerald-500"})]}),g.jsx("span",{className:"text-xs text-stone-500 dark:text-stone-400 line-clamp-2 mt-1",children:t.url})]})]}):t.selftext?g.jsx("div",{className:"mt-2 text-sm text-stone-600 dark:text-stone-400 leading-relaxed line-clamp-4 hover:text-stone-800 dark:hover:text-stone-300 transition-colors",children:t.selftext}):null},[t]);if(a==="compact"){const x=h(),p=!!x;return g.jsxs("div",{className:`zen-card bg-white dark:bg-stone-900 rounded-lg shadow-sm border border-stone-200 dark:border-stone-800 flex overflow-hidden w-full ${e?"opacity-60":""} touch-manipulation active:scale-[0.99] transition-transform`,onClick:()=>n(t),children:[p&&g.jsxs("div",{className:"w-[80px] min-h-[80px] sm:w-[110px] sm:min-h-[90px] shrink-0 bg-stone-100 dark:bg-stone-800 relative group overflow-hidden cursor-pointer",onClick:v=>{v.stopPropagation(),ka(),a==="compact"?o(!l):f(v)},children:[g.jsx("img",{src:x,alt:"thumb",className:"w-full h-full object-cover absolute inset-0 transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),g.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:l?g.jsx(KL,{size:24,className:"text-white drop-shadow-md"}):g.jsx(F1,{size:24,className:"text-white drop-shadow-md"})}),!l&&(t.is_video||t.domain==="v.redd.it")&&g.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/10 group-hover:hidden transition-colors",children:g.jsx(ip,{size:24,className:"text-white drop-shadow-md"})})]}),g.jsxs("div",{className:"py-2 pr-2 pl-3 sm:p-3 flex flex-col justify-between flex-1 min-w-0",children:[g.jsxs("div",{className:"flex items-start justify-between gap-2",children:[g.jsxs("div",{className:"flex flex-col min-w-0",children:[g.jsx("h3",{className:`text-sm sm:text-base font-medium leading-snug line-clamp-2 ${e?"text-stone-500":"text-stone-800 dark:text-stone-200"}`,children:Zf(t.title)}),t.link_flair_text&&g.jsx("div",{className:"mt-1",children:g.jsx(dd,{text:t.link_flair_text,bgColor:t.link_flair_background_color,textColor:t.link_flair_text_color})})]}),t.zenScore!==void 0&&g.jsx(Wf,{score:t.zenScore,size:"sm",className:"shrink-0"})]}),l&&g.jsx("div",{className:"w-full my-2 animate-list-enter",onClick:v=>v.stopPropagation(),children:m}),g.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-stone-500 dark:text-stone-400 gap-2",children:[g.jsxs("div",{className:"flex items-center gap-1.5 truncate min-w-0",children:[g.jsxs("span",{className:"font-medium hover:text-emerald-600 dark:hover:text-emerald-400 cursor-pointer truncate transition-colors",onClick:v=>{v.stopPropagation(),i&&i(t.subreddit)},children:["r/",t.subreddit]}),g.jsx("span",{className:"text-stone-300 dark:text-stone-700 shrink-0",children:""}),g.jsxs("span",{className:"hover:text-stone-800 dark:hover:text-stone-300 cursor-pointer",onClick:v=>{s&&(v.stopPropagation(),s(t.author))},children:["u/",t.author]}),g.jsx("span",{className:"text-stone-300 dark:text-stone-700 shrink-0",children:""}),g.jsx("span",{className:"shrink-0",children:yl(new Date(t.created_utc*1e3),{addSuffix:!1}).replace("about ","").replace(" hours","h").replace("less than a minute","now")})]}),g.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Cu,{size:14,className:"stroke-[2.5px]"}),g.jsx("span",{children:t.score>1e3?`${(t.score/1e3).toFixed(1)}k`:t.score})]}),g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(Ys,{size:12,className:"stroke-[2.5px]"}),g.jsx("span",{children:t.num_comments>1e3?`${(t.num_comments/1e3).toFixed(1)}k`:t.num_comments})]}),g.jsx("button",{onClick:d,className:"flex items-center gap-1 text-stone-400 hover:text-stone-600 dark:hover:text-stone-300 transition-colors p-2 -m-2",title:"Share",children:u?g.jsx(Iu,{size:12,className:"text-emerald-500"}):g.jsx(lp,{size:12,className:"stroke-[2.5px]"})})]})]})]})]})}return g.jsx("div",{className:`zen-card bg-white dark:bg-stone-900 rounded-xl shadow-sm border border-stone-200 dark:border-stone-800 mb-6 break-inside-avoid flex flex-col cursor-pointer w-full ${e?"opacity-80":""} touch-manipulation`,onClick:()=>{ka(),n(t)},children:g.jsxs("div",{className:"p-4 flex flex-col h-full",children:[g.jsxs("div",{className:"flex items-center justify-between mb-2",children:[g.jsxs("div",{className:"flex items-center text-xs text-stone-500 dark:text-stone-400 gap-2 overflow-hidden flex-wrap",children:[g.jsxs("span",{className:"font-bold text-stone-700 dark:text-stone-300 hover:text-emerald-600 dark:hover:text-emerald-400 hover:underline cursor-pointer transition-colors",onClick:x=>{i&&(x.stopPropagation(),i(t.subreddit))},children:["r/",t.subreddit]}),g.jsx("span",{className:"text-stone-300 dark:text-stone-600",children:""}),g.jsxs("span",{className:"hover:text-stone-800 dark:hover:text-stone-200 cursor-pointer hover:underline transition-colors",onClick:x=>{s&&(x.stopPropagation(),s(t.author))},children:["u/",t.author]}),g.jsx("span",{className:"text-stone-300 dark:text-stone-600",children:""}),g.jsxs("span",{children:[yl(new Date(t.created_utc*1e3))," ago"]}),t.author_flair_text&&g.jsx(dd,{text:t.author_flair_text,bgColor:t.author_flair_background_color,textColor:t.author_flair_text_color,className:"opacity-80 scale-90 origin-left"})]}),t.zenScore!==void 0&&g.jsx(Wf,{score:t.zenScore})]}),g.jsxs("div",{className:"mb-2",children:[g.jsx("h3",{className:`text-base font-semibold leading-snug transition-colors ${e?"text-stone-500 dark:text-stone-500":"text-stone-900 dark:text-stone-100 hover:text-emerald-700 dark:hover:text-emerald-400"}`,children:Zf(t.title)}),t.link_flair_text&&g.jsx("div",{className:"mt-2 flex gap-1",children:g.jsx(dd,{text:t.link_flair_text,bgColor:t.link_flair_background_color,textColor:t.link_flair_text_color})})]}),m,g.jsxs("div",{className:"mt-4 flex items-center gap-4 text-stone-500 dark:text-stone-400 text-sm",children:[g.jsxs("div",{className:"flex items-center gap-1.5 bg-stone-100 dark:bg-stone-800/50 px-2 py-1 rounded-md transition-colors hover:bg-stone-200 dark:hover:bg-stone-800",children:[g.jsx(Cu,{size:18,className:`${t.score>0?"text-orange-600 dark:text-orange-500":""}`}),g.jsx("span",{className:"font-medium text-xs",children:t.score>1e3?`${(t.score/1e3).toFixed(1)}k`:t.score})]}),g.jsxs("div",{className:"flex items-center gap-1.5 hover:bg-stone-100 dark:hover:bg-stone-800 px-2 py-1 rounded-md transition-colors",children:[g.jsx(Ys,{size:16}),g.jsx("span",{className:"text-xs",children:t.num_comments>1e3?`${(t.num_comments/1e3).toFixed(1)}k`:t.num_comments})]}),g.jsxs("button",{onClick:d,className:"flex items-center gap-1.5 hover:bg-stone-100 dark:hover:bg-stone-800 px-2 py-1 rounded-md transition-colors btn-press active:bg-stone-200 dark:active:bg-stone-700",title:"Share",children:[u?g.jsx(Iu,{size:16,className:"text-emerald-500"}):g.jsx(lp,{size:16}),g.jsx("span",{className:`text-xs ${u?"text-emerald-500 font-medium":""}`,children:u?"Copied":"Share"})]}),g.jsx("div",{className:"flex-1"}),t.domain!==`self.${t.subreddit}`&&!((y=t.domain)!=null&&y.includes("reddit.com"))&&g.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",onClick:x=>{x.stopPropagation(),ka()},className:"flex items-center gap-1 text-xs hover:underline text-stone-400 hover:text-stone-600 dark:hover:text-stone-300 transition-colors p-2 -m-2",children:[g.jsx("span",{className:"truncate max-w-[100px]",children:t.domain}),g.jsx(js,{size:10})]})]})]})})},Uw=Ll.memo(Bw),Om=t=>t.replace(/^```json\s*/,"").replace(/^```\s*/,"").replace(/\s*```$/,""),jw=async(t,e)=>{if(t.length===0)return[];const n=t.map(l=>({id:l.id,t:l.title,s:l.subreddit,b:l.selftext?l.selftext.substring(0,200):""})),i=(e==null?void 0:e.minZenScore)??50,r=`
    Task: Filter Reddit posts for a "Zen" feed.
    Filter out: Rage bait, divisive politics, aggression, anxiety-inducing content.
    ${e!=null&&e.customInstructions?`USER PREF: "${e.customInstructions}".`:""}
    Return JSON object with key "results" (array).
    Each item:
    - id: string
    - zenScore: number (0=Toxic/Rage, 100=Calm/Constructive)
    - reason: string (max 6 words)
    - isRageBait: boolean (true if zenScore < ${i})
  `,a=(e==null?void 0:e.openRouterKey)||void 0;return a?$w(n,r,a,e==null?void 0:e.openRouterModel,i):Go(t)},$w=async(t,e,n,i,s)=>{var r,a,l;try{const o=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"ZenReddit"},body:JSON.stringify({model:i||"meta-llama/llama-3-8b-instruct:free",messages:[{role:"system",content:e},{role:"user",content:JSON.stringify(t)}],response_format:{type:"json_object"}})});if(!o.ok)throw new Error(`API Error: ${o.status}`);const c=(l=(a=(r=(await o.json()).choices)==null?void 0:r[0])==null?void 0:a.message)==null?void 0:l.content;if(!c)throw new Error("No content");let d;try{d=JSON.parse(Om(c))}catch{return console.warn("Invalid JSON from AI",c),Go(t)}const f=Array.isArray(d)?d:d.results||d.data;return Array.isArray(f)?f.map(h=>({id:h.id,isRageBait:typeof h.isRageBait=="boolean"?h.isRageBait:h.zenScore<s,zenScore:typeof h.zenScore=="number"?h.zenScore:50,reason:h.reason||"AI analysis"})):Go(t)}catch(o){return console.error("OpenRouter Analysis Failed:",o),Go(t)}},Go=t=>t.map(e=>({id:e.id,isRageBait:!1,zenScore:50,reason:"Analysis unavailable"})),zw=async(t,e,n)=>{var l,o,u;if(t.length===0)return[];const i=(e==null?void 0:e.openRouterKey)||void 0;if(!i)return[];const s=t.slice(0,15).map(c=>{let d=[];return c.data.replies&&typeof c.data.replies!="string"&&c.data.replies.data&&(d=c.data.replies.data.children.filter(f=>f.kind==="t1").slice(0,3).map(f=>`[${f.data.author}]: ${f.data.body.substring(0,60)}`)),{id:c.data.id,author:c.data.author,body:c.data.body.substring(0,250),replies_context:d}}),a=`
    You are a highly nuanced moderator.
    Analyze the following Reddit comments for TOXICITY and FACT CHECKABILITY.

    ${n?`
    SUBREDDIT: r/${n.subreddit}
    POST TITLE: "${n.title}"
    ${n.selftext?`POST CONTEXT: "${n.selftext.substring(0,200)}..."`:""}
  `:"Context: General Reddit Thread"}

    Instructions:
    1. **Toxicity**: Flag genuine abuse, hate, or harm. Ignore friendly banter ("lol I hate you") or dramatic slang ("I'm dying").
    2. **Fact Checkability**: Determine if the comment contains verifiable factual claims (statistics, historical events, scientific assertions, specific news).
       - Set "isFactCheckable": true if it contains checkable facts.
       - Set "isFactCheckable": false if it is pure opinion ("I like this"), personal anecdote ("I went there"), or a joke.

    Return JSON: { "results": [{ "id": "string", "isToxic": boolean, "reason": "string", "isFactCheckable": boolean }] }
  `;try{const c=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"ZenReddit"},body:JSON.stringify({model:(e==null?void 0:e.openRouterModel)||"meta-llama/llama-3-8b-instruct:free",messages:[{role:"system",content:a},{role:"user",content:JSON.stringify(s)}],response_format:{type:"json_object"}})});if(!c.ok)return[];const f=(u=(o=(l=(await c.json()).choices)==null?void 0:l[0])==null?void 0:o.message)==null?void 0:u.content;if(!f)return[];const h=JSON.parse(Om(f)),m=Array.isArray(h)?h:h.results||h.data;return Array.isArray(m)?m.map(y=>({id:y.id,isToxic:!!y.isToxic,reason:y.reason,isFactCheckable:!!y.isFactCheckable})):[]}catch(c){return console.warn("OpenRouter Comment analysis error",c),[]}},Gw=async(t,e,n,i)=>{var r,a,l;const s=n||void 0;if(!s)return{verdict:"Unverified",explanation:"API Key required for fact checking.",sources:[]};try{const o=`
            You are a fact checker for Reddit comments.
            Analyze the following comment from r/${e}.
            
            1. Verify the main claims using your training knowledge.
            2. Determine a verdict: "True", "False", "Misleading", "Unverified", or "Opinion".
            3. Provide a concise explanation (max 2 sentences).
            4. If possible, provide real sources/URLs that verify this, in the "sources" array.

            Return JSON:
            {
                "verdict": "string",
                "explanation": "string",
                "sources": [{ "title": "string", "uri": "string" }]
            }
        `,u=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${s}`,"Content-Type":"application/json","HTTP-Referer":window.location.origin,"X-Title":"ZenReddit"},body:JSON.stringify({model:i||"meta-llama/llama-3-8b-instruct:free",messages:[{role:"system",content:o},{role:"user",content:t.substring(0,500)}],response_format:{type:"json_object"}})});if(!u.ok)throw new Error("API Error");const d=(l=(a=(r=(await u.json()).choices)==null?void 0:r[0])==null?void 0:a.message)==null?void 0:l.content;if(!d)throw new Error("No content");const f=JSON.parse(Om(d));return{verdict:f.verdict||"Unverified",explanation:f.explanation||"No explanation provided.",sources:Array.isArray(f.sources)?f.sources:[]}}catch(o){return console.error("Fact Check Failed:",o),{verdict:"Unverified",explanation:"Could not perform fact check at this time.",sources:[]}}},ee=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)},Hw=Number.isSafeInteger||function(t){return typeof t=="number"&&Math.abs(t)<=Vw},Vw=Number.MAX_SAFE_INTEGER||9007199254740991;let re=function(t){return t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError",t}({}),O=function(t){return t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",t.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",t.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_PARSING_ERROR="levelParsingError",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.FRAG_GAP="fragGap",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.ASSET_LIST_LOAD_ERROR="assetListLoadError",t.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",t.ASSET_LIST_PARSING_ERROR="assetListParsingError",t.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.ATTACH_MEDIA_ERROR="attachMediaError",t.UNKNOWN="unknown",t}({}),S=function(t){return t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.MEDIA_ENDED="hlsMediaEnded",t.STALL_RESOLVED="hlsStallResolved",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFERED_TO_END="hlsBufferedToEnd",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached",t.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",t.ASSET_LIST_LOADING="hlsAssetListLoading",t.ASSET_LIST_LOADED="hlsAssetListLoaded",t.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",t.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",t.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",t.INTERSTITIAL_STARTED="hlsInterstitialStarted",t.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",t.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",t.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",t.INTERSTITIAL_ENDED="hlsInterstitialEnded",t.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",t.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",t.EVENT_CUE_ENTER="hlsEventCueEnter",t}({});var Ee={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ne={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class lr{constructor(e,n=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=n,this.totalWeight_=i}sample(e,n){const i=Math.pow(this.alpha_,e);this.estimate_=n*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Kw{constructor(e,n,i,s=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new lr(e),this.fast_=new lr(n),this.defaultTTFB_=s,this.ttfb_=new lr(e)}update(e,n){const{slow_:i,fast_:s,ttfb_:r}=this;i.halfLife!==e&&(this.slow_=new lr(e,i.getEstimate(),i.getTotalWeight())),s.halfLife!==n&&(this.fast_=new lr(n,s.getEstimate(),s.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new lr(e,r.getEstimate(),r.getTotalWeight()))}sample(e,n){e=Math.max(e,this.minDelayMs_);const i=8*n,s=e/1e3,r=i/s;this.fast_.sample(s,r),this.slow_.sample(s,r)}sampleTTFB(e){const n=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(n,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function Yw(t,e,n){return(e=Xw(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $e(){return $e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)({}).hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},$e.apply(null,arguments)}function fp(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,i)}return n}function Me(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?fp(Object(n),!0).forEach(function(i){Yw(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fp(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}function qw(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Xw(t){var e=qw(t,"string");return typeof e=="symbol"?e:e+""}class Un{constructor(e,n){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=Ki,this.debug=n.debug.bind(null,i),this.log=n.log.bind(null,i),this.warn=n.warn.bind(null,i),this.info=n.info.bind(null,i),this.error=n.error.bind(null,i)}}const Ki=function(){},Qw={trace:Ki,debug:Ki,log:Ki,warn:Ki,info:Ki,error:Ki};function Jf(){return $e({},Qw)}function Ww(t,e){const n=self.console[t];return n?n.bind(self.console,`${e?"["+e+"] ":""}[${t}] >`):Ki}function hp(t,e,n){return e[t]?e[t].bind(e):Ww(t,n)}const eh=Jf();function Zw(t,e,n){const i=Jf();if(typeof console=="object"&&t===!0||typeof t=="object"){const s=["debug","log","info","warn","error"];s.forEach(r=>{i[r]=hp(r,t,n)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Jf()}s.forEach(r=>{eh[r]=hp(r,t)})}else $e(eh,i);return i}const Pe=eh;function xs(t=!0){return typeof self>"u"?void 0:(t||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Jw(t){return typeof self<"u"&&t===self.ManagedMediaSource}function G1(t,e){const n=Object.keys(t),i=Object.keys(e),s=n.length,r=i.length;return!s||!r||s===r&&!n.some(a=>i.indexOf(a)===-1)}function En(t,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(t);if(e){const c=u.indexOf("\0");return c!==-1?u.substring(0,c):u}return u.replace(/\0/g,"")}const n=t.length;let i,s,r,a="",l=0;for(;l<n;){if(i=t[l++],i===0&&e)return a;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(i);break;case 12:case 13:s=t[l++],a+=String.fromCharCode((i&31)<<6|s&63);break;case 14:s=t[l++],r=t[l++],a+=String.fromCharCode((i&15)<<12|(s&63)<<6|(r&63)<<0);break}}return a}function wt(t){let e="";for(let n=0;n<t.length;n++){let i=t[n].toString(16);i.length<2&&(i="0"+i),e+=i}return e}function H1(t){return Uint8Array.from(t.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function eC(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var fd={exports:{}},mp;function tC(){return mp||(mp=1,function(t,e){(function(n){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,s=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,l={buildAbsoluteURL:function(o,u,c){if(c=c||{},o=o.trim(),u=u.trim(),!u){if(!c.alwaysNormalize)return o;var d=l.parseURL(o);if(!d)throw new Error("Error trying to parse base URL.");return d.path=l.normalizePath(d.path),l.buildURLFromParts(d)}var f=l.parseURL(u);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return c.alwaysNormalize?(f.path=l.normalizePath(f.path),l.buildURLFromParts(f)):u;var h=l.parseURL(o);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var m=s.exec(h.path);h.netLoc=m[1],h.path=m[2]}h.netLoc&&!h.path&&(h.path="/");var y={scheme:h.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(y.netLoc=h.netLoc,f.path[0]!=="/"))if(!f.path)y.path=h.path,f.params||(y.params=h.params,f.query||(y.query=h.query));else{var x=h.path,p=x.substring(0,x.lastIndexOf("/")+1)+f.path;y.path=l.normalizePath(p)}return y.path===null&&(y.path=c.alwaysNormalize?l.normalizePath(f.path):f.path),l.buildURLFromParts(y)},parseURL:function(o){var u=i.exec(o);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(o){for(o=o.split("").reverse().join("").replace(r,"");o.length!==(o=o.replace(a,"")).length;);return o.split("").reverse().join("")},buildURLFromParts:function(o){return o.scheme+o.netLoc+o.path+o.params+o.query+o.fragment}};t.exports=l})()}(fd)),fd.exports}var Pm=tC();class Fm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ze={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class V1{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,iC(this,"stats")}setByteRange(e,n){const i=e.split("@",2);let s;i.length===1?s=(n==null?void 0:n.byteRangeEndOffset)||0:s=parseInt(i[1]),this._byteRange=[s,parseInt(i[0])+s]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ze.AUDIO]:null,[ze.VIDEO]:null,[ze.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Fm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Pm.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ze.AUDIO]=null,e[ze.VIDEO]=null,e[ze.AUDIOVIDEO]=null}}function ut(t){return t.sn!=="initSegment"}class hd extends V1{constructor(e,n){super(n),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],n=this.byteRange[1];if(ee(e)&&ee(n))return n-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:n}=this;if(!n||n.NONE)return null;if(n.identity)this._decryptdata||(this._decryptdata=n.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const i=Object.keys(n);if(i.length===1){const s=this._decryptdata=n[i[0]]||null;s&&(this._decryptdata=s.getDecryptData(this.sn,n))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ee(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var n;const i=Object.keys(this.levelkeys),s=i.length;if(s>1||s===1&&(n=this.levelkeys[i[0]])!=null&&n.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ee(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return ut(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const n=this.levelkeys;if(n){var i;const s=n[e];s&&!((i=this._decryptdata)!=null&&i.keyId)&&(this._decryptdata=s.getDecryptData(this.sn,n))}}abortRequests(){var e,n;(e=this.loader)==null||e.abort(),(n=this.keyLoader)==null||n.abort()}setElementaryStreamInfo(e,n,i,s,r,a=!1){const{elementaryStreams:l}=this,o=l[e];if(!o){l[e]={startPTS:n,endPTS:i,startDTS:s,endDTS:r,partial:a};return}o.startPTS=Math.min(o.startPTS,n),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,s),o.endDTS=Math.max(o.endDTS,r)}}class nC extends V1{constructor(e,n,i,s,r){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=n,this.index=s;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function K1(t,e){const n=Object.getPrototypeOf(t);if(n){const i=Object.getOwnPropertyDescriptor(n,e);return i||K1(n,e)}}function iC(t,e){const n=K1(t,e);n&&(n.enumerable=!0,Object.defineProperty(t,e,n))}const gp=Math.pow(2,32)-1,sC=[].push,Y1={video:1,audio:2,id3:3,text:4};function vt(t){return String.fromCharCode.apply(null,t)}function q1(t,e){const n=t[e]<<8|t[e+1];return n<0?65536+n:n}function de(t,e){const n=X1(t,e);return n<0?4294967296+n:n}function pp(t,e){let n=de(t,e);return n*=Math.pow(2,32),n+=de(t,e+4),n}function X1(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function rC(t){const e=t.byteLength;for(let n=0;n<e;){const i=de(t,n);if(i>8&&t[n+4]===109&&t[n+5]===111&&t[n+6]===111&&t[n+7]===102)return!0;n=i>1?n+i:e}return!1}function ve(t,e){const n=[];if(!e.length)return n;const i=t.byteLength;for(let s=0;s<i;){const r=de(t,s),a=vt(t.subarray(s+4,s+8)),l=r>1?s+r:i;if(a===e[0])if(e.length===1)n.push(t.subarray(s+8,l));else{const o=ve(t.subarray(s+8,l),e.slice(1));o.length&&sC.apply(n,o)}s=l}return n}function aC(t){const e=[],n=t[0];let i=8;const s=de(t,i);i+=4;let r=0,a=0;n===0?(r=de(t,i),a=de(t,i+4),i+=8):(r=pp(t,i),a=pp(t,i+8),i+=16),i+=2;let l=t.length+a;const o=q1(t,i);i+=2;for(let u=0;u<o;u++){let c=i;const d=de(t,c);c+=4;const f=d&2147483647;if((d&2147483648)>>>31===1)return Pe.warn("SIDX has hierarchical references (not supported)"),null;const m=de(t,c);c+=4,e.push({referenceSize:f,subsegmentDuration:m,info:{duration:m/s,start:l,end:l+f-1}}),l+=f,c+=4,i=c}return{earliestPresentationTime:r,timescale:s,version:n,referencesCount:o,references:e}}function Q1(t){const e=[],n=ve(t,["moov","trak"]);for(let s=0;s<n.length;s++){const r=n[s],a=ve(r,["tkhd"])[0];if(a){let l=a[0];const o=de(a,l===0?12:20),u=ve(r,["mdia","mdhd"])[0];if(u){l=u[0];const c=de(u,l===0?12:20),d=ve(r,["mdia","hdlr"])[0];if(d){const f=vt(d.subarray(8,12)),h={soun:ze.AUDIO,vide:ze.VIDEO}[f],m=ve(r,["mdia","minf","stbl","stsd"])[0],y=lC(m);h?(e[o]={timescale:c,type:h,stsd:y},e[h]=Me({timescale:c,id:o},y)):e[o]={timescale:c,type:f,stsd:y}}}}}return ve(t,["moov","mvex","trex"]).forEach(s=>{const r=de(s,4),a=e[r];a&&(a.default={duration:de(s,12),flags:de(s,20)})}),e}function lC(t){const e=t.subarray(8),n=e.subarray(86),i=vt(e.subarray(4,8));let s=i,r;const a=i==="enca"||i==="encv";if(a){const u=ve(e,[i])[0].subarray(i==="enca"?28:78);ve(u,["sinf"]).forEach(d=>{const f=ve(d,["schm"])[0];if(f){const h=vt(f.subarray(4,8));if(h==="cbcs"||h==="cenc"){const m=ve(d,["frma"])[0];m&&(s=vt(m))}}})}const l=s;switch(s){case"avc1":case"avc2":case"avc3":case"avc4":{const o=ve(n,["avcC"])[0];o&&o.length>3&&(s+="."+lo(o[1])+lo(o[2])+lo(o[3]),r=ao(l==="avc1"?"dva1":"dvav",n));break}case"mp4a":{const o=ve(e,[i])[0],u=ve(o.subarray(28),["esds"])[0];if(u&&u.length>7){let c=4;if(u[c++]!==3)break;c=md(u,c),c+=2;const d=u[c++];if(d&128&&(c+=2),d&64&&(c+=u[c++]),u[c++]!==4)break;c=md(u,c);const f=u[c++];if(f===64)s+="."+lo(f);else break;if(c+=12,u[c++]!==5)break;c=md(u,c);const h=u[c++];let m=(h&248)>>3;m===31&&(m+=1+((h&7)<<3)+((u[c]&224)>>5)),s+="."+m}break}case"hvc1":case"hev1":{const o=ve(n,["hvcC"])[0];if(o&&o.length>12){const u=o[1],c=["","A","B","C"][u>>6],d=u&31,f=de(o,2),h=(u&32)>>5?"H":"L",m=o[12],y=o.subarray(6,12);s+="."+c+d,s+="."+oC(f).toString(16).toUpperCase(),s+="."+h+m;let x="";for(let p=y.length;p--;){const v=y[p];(v||x)&&(x="."+v.toString(16).toUpperCase()+x)}s+=x}r=ao(l=="hev1"?"dvhe":"dvh1",n);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{s=ao(s,n)||s;break}case"vp09":{const o=ve(n,["vpcC"])[0];if(o&&o.length>6){const u=o[4],c=o[5],d=o[6]>>4&15;s+="."+Jn(u)+"."+Jn(c)+"."+Jn(d)}break}case"av01":{const o=ve(n,["av1C"])[0];if(o&&o.length>2){const u=o[1]>>>5,c=o[1]&31,d=o[2]>>>7?"H":"M",f=(o[2]&64)>>6,h=(o[2]&32)>>5,m=u===2&&f?h?12:10:f?10:8,y=(o[2]&16)>>4,x=(o[2]&8)>>3,p=(o[2]&4)>>2,v=o[2]&3;s+="."+u+"."+Jn(c)+d+"."+Jn(m)+"."+y+"."+x+p+v+"."+Jn(1)+"."+Jn(1)+"."+Jn(1)+"."+0,r=ao("dav1",n)}break}}return{codec:s,encrypted:a,supplemental:r}}function ao(t,e){const n=ve(e,["dvvC"]),i=n.length?n[0]:ve(e,["dvcC"])[0];if(i){const s=i[2]>>1&127,r=i[2]<<5&32|i[3]>>3&31;return t+"."+Jn(s)+"."+Jn(r)}}function oC(t){let e=0;for(let n=0;n<32;n++)e|=(t>>n&1)<<31-n;return e>>>0}function md(t,e){const n=e+5;for(;t[e++]&128&&e<n;);return e}function lo(t){return("0"+t.toString(16).toUpperCase()).slice(-2)}function Jn(t){return(t<10?"0":"")+t}function uC(t,e){if(!t||!e)return;const n=e.keyId;n&&e.isCommonEncryption&&W1(t,(i,s)=>{const r=i.subarray(8,24);r.some(a=>a!==0)||(Pe.log(`[eme] Patching keyId in 'enc${s?"a":"v"}>sinf>>tenc' box: ${wt(r)} -> ${wt(n)}`),i.set(n,8))})}function cC(t){const e=[];return W1(t,n=>e.push(n.subarray(8,24))),e}function W1(t,e){ve(t,["moov","trak"]).forEach(i=>{const s=ve(i,["mdia","minf","stbl","stsd"])[0];if(!s)return;const r=s.subarray(8);let a=ve(r,["enca"]);const l=a.length>0;l||(a=ve(r,["encv"])),a.forEach(o=>{const u=l?o.subarray(28):o.subarray(78);ve(u,["sinf"]).forEach(d=>{const f=Z1(d);f&&e(f,l)})})})}function Z1(t){const e=ve(t,["schm"])[0];if(e){const n=vt(e.subarray(4,8));if(n==="cbcs"||n==="cenc"){const i=ve(t,["schi","tenc"])[0];if(i)return i}}}function dC(t,e,n){const i={},s=ve(t,["moof","traf"]);for(let r=0;r<s.length;r++){const a=s[r],l=ve(a,["tfhd"])[0],o=de(l,4),u=e[o];if(!u)continue;i[o]||(i[o]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const c=i[o],d=ve(a,["tfdt"])[0];if(d){const b=d[0];let E=de(d,4);b===1&&(E===gp?n.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(E*=gp+1,E+=de(d,8))),ee(E)&&(!ee(c.start)||E<c.start)&&(c.start=E)}const f=u.default,h=de(l,0)|(f==null?void 0:f.flags);let m=(f==null?void 0:f.duration)||0;h&8&&(h&2?m=de(l,12):m=de(l,8));const y=ve(a,["trun"]);let x=c.start||0,p=0,v=m;for(let b=0;b<y.length;b++){const E=y[b],k=de(E,4),_=c.sampleCount;c.sampleCount+=k;const L=E[3]&1,C=E[3]&4,w=E[2]&1,A=E[2]&2,I=E[2]&4,N=E[2]&8;let V=8,G=k;for(L&&(V+=4),C&&k&&(!(E[V+1]&1)&&c.keyFrameIndex===void 0&&(c.keyFrameIndex=_),V+=4,w?(v=de(E,V),V+=4):v=m,A&&(V+=4),N&&(V+=4),x+=v,p+=v,G--);G--;)w?(v=de(E,V),V+=4):v=m,A&&(V+=4),I&&(E[V+1]&1||c.keyFrameIndex===void 0&&(c.keyFrameIndex=c.sampleCount-(G+1),c.keyFrameStart=x),V+=4),N&&(V+=4),x+=v,p+=v;!p&&m&&(p+=m*k)}c.duration+=p}if(!Object.keys(i).some(r=>i[r].duration)){let r=1/0,a=0;const l=ve(t,["sidx"]);for(let o=0;o<l.length;o++){const u=aC(l[o]);if(u!=null&&u.references){r=Math.min(r,u.earliestPresentationTime/u.timescale);const c=u.references.reduce((d,f)=>d+f.info.duration||0,0);a=Math.max(a,c+u.earliestPresentationTime/u.timescale)}}a&&ee(a)&&Object.keys(i).forEach(o=>{i[o].duration||(i[o].duration=a*i[o].timescale-i[o].start)})}return i}function fC(t){const e={valid:null,remainder:null},n=ve(t,["moof"]);if(n.length<2)return e.remainder=t,e;const i=n[n.length-1];return e.valid=t.slice(0,i.byteOffset-8),e.remainder=t.slice(i.byteOffset-8),e}function Bn(t,e){const n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}function yp(t,e){const n=[],i=e.samples,s=e.timescale,r=e.id;let a=!1;return ve(i,["moof"]).map(o=>{const u=o.byteOffset-8;ve(o,["traf"]).map(d=>{const f=ve(d,["tfdt"]).map(h=>{const m=h[0];let y=de(h,4);return m===1&&(y*=Math.pow(2,32),y+=de(h,8)),y/s})[0];return f!==void 0&&(t=f),ve(d,["tfhd"]).map(h=>{const m=de(h,4),y=de(h,0)&16777215,x=(y&1)!==0,p=(y&2)!==0,v=(y&8)!==0;let b=0;const E=(y&16)!==0;let k=0;const _=(y&32)!==0;let L=8;m===r&&(x&&(L+=8),p&&(L+=4),v&&(b=de(h,L),L+=4),E&&(k=de(h,L),L+=4),_&&(L+=4),e.type==="video"&&(a=mc(e.codec)),ve(d,["trun"]).map(C=>{const w=C[0],A=de(C,0)&16777215,I=(A&1)!==0;let N=0;const V=(A&4)!==0,G=(A&256)!==0;let $=0;const D=(A&512)!==0;let j=0;const U=(A&1024)!==0,q=(A&2048)!==0;let R=0;const F=de(C,4);let B=8;I&&(N=de(C,B),B+=4),V&&(B+=4);let T=N+u;for(let Y=0;Y<F;Y++){if(G?($=de(C,B),B+=4):$=b,D?(j=de(C,B),B+=4):j=k,U&&(B+=4),q&&(w===0?R=de(C,B):R=X1(C,B),B+=4),e.type===ze.VIDEO){let X=0;for(;X<j;){const Z=de(i,T);if(T+=4,hC(a,i[T])){const le=i.subarray(T,T+Z);Bm(le,a?2:1,t+R/s,n)}T+=Z,X+=Z+4}}t+=$/s}}))})})}),n}function mc(t){if(!t)return!1;const e=t.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function hC(t,e){if(t){const n=e>>1&63;return n===39||n===40}else return(e&31)===6}function Bm(t,e,n,i){const s=J1(t);let r=0;r+=e;let a=0,l=0,o=0;for(;r<s.length;){a=0;do{if(r>=s.length)break;o=s[r++],a+=o}while(o===255);l=0;do{if(r>=s.length)break;o=s[r++],l+=o}while(o===255);const u=s.length-r;let c=r;if(l<u)r+=l;else if(l>u){Pe.error(`Malformed SEI payload. ${l} is too small, only ${u} bytes left to parse.`);break}if(a===4){if(s[c++]===181){const f=q1(s,c);if(c+=2,f===49){const h=de(s,c);if(c+=4,h===1195456820){const m=s[c++];if(m===3){const y=s[c++],x=31&y,p=64&y,v=p?2+x*3:0,b=new Uint8Array(v);if(p){b[0]=y;for(let E=1;E<v;E++)b[E]=s[c++]}i.push({type:m,payloadType:a,pts:n,bytes:b})}}}}}else if(a===5&&l>16){const d=[];for(let m=0;m<16;m++){const y=s[c++].toString(16);d.push(y.length==1?"0"+y:y),(m===3||m===5||m===7||m===9)&&d.push("-")}const f=l-16,h=new Uint8Array(f);for(let m=0;m<f;m++)h[m]=s[c++];i.push({payloadType:a,pts:n,uuid:d.join(""),userData:En(h),userDataBytes:h})}}}function J1(t){const e=t.byteLength,n=[];let i=1;for(;i<e-2;)t[i]===0&&t[i+1]===0&&t[i+2]===3?(n.push(i+2),i+=2):i++;if(n.length===0)return t;const s=e-n.length,r=new Uint8Array(s);let a=0;for(i=0;i<s;a++,i++)a===n[0]&&(a++,n.shift()),r[i]=t[a];return r}function mC(t){const e=t[0];let n="",i="",s=0,r=0,a=0,l=0,o=0,u=0;if(e===0){for(;vt(t.subarray(u,u+1))!=="\0";)n+=vt(t.subarray(u,u+1)),u+=1;for(n+=vt(t.subarray(u,u+1)),u+=1;vt(t.subarray(u,u+1))!=="\0";)i+=vt(t.subarray(u,u+1)),u+=1;i+=vt(t.subarray(u,u+1)),u+=1,s=de(t,12),r=de(t,16),l=de(t,20),o=de(t,24),u=28}else if(e===1){u+=4,s=de(t,u),u+=4;const d=de(t,u);u+=4;const f=de(t,u);for(u+=4,a=2**32*d+f,Hw(a)||(a=Number.MAX_SAFE_INTEGER,Pe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),l=de(t,u),u+=4,o=de(t,u),u+=4;vt(t.subarray(u,u+1))!=="\0";)n+=vt(t.subarray(u,u+1)),u+=1;for(n+=vt(t.subarray(u,u+1)),u+=1;vt(t.subarray(u,u+1))!=="\0";)i+=vt(t.subarray(u,u+1)),u+=1;i+=vt(t.subarray(u,u+1)),u+=1}const c=t.subarray(u,t.byteLength);return{schemeIdUri:n,value:i,timeScale:s,presentationTime:a,presentationTimeDelta:r,eventDuration:l,id:o,payload:c}}function gC(t,...e){const n=e.length;let i=8,s=n;for(;s--;)i+=e[s].byteLength;const r=new Uint8Array(i);for(r[0]=i>>24&255,r[1]=i>>16&255,r[2]=i>>8&255,r[3]=i&255,r.set(t,4),s=0,i=8;s<n;s++)r.set(e[s],i),i+=e[s].byteLength;return r}function pC(t,e,n){if(t.byteLength!==16)throw new RangeError("Invalid system id");let i,s;i=0,s=new Uint8Array;let r;i>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const a=new Uint8Array(4);return n.byteLength>0&&new DataView(a.buffer).setUint32(0,n.byteLength,!1),gC([112,115,115,104],new Uint8Array([i,0,0,0]),t,r,s,a,n)}function yC(t){const e=[];if(t instanceof ArrayBuffer){const n=t.byteLength;let i=0;for(;i+32<n;){const s=new DataView(t,i),r=xC(s);e.push(r),i+=r.size}}return e}function xC(t){const e=t.getUint32(0),n=t.byteOffset,i=t.byteLength;if(i<e)return{offset:n,size:i};if(t.getUint32(4)!==1886614376)return{offset:n,size:e};const r=t.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:n,size:e};const a=t.buffer,l=wt(new Uint8Array(a,n+12,16));let o=null,u=null,c=0;if(r===0)c=28;else{const f=t.getUint32(28);if(!f||i<32+f*16)return{offset:n,size:e};o=[];for(let h=0;h<f;h++)o.push(new Uint8Array(a,n+32+h*16,16));c=32+f*16}if(!c)return{offset:n,size:e};const d=t.getUint32(c);return e-32<d?{offset:n,size:e}:(u=new Uint8Array(a,n+c+4,d),{version:r,systemId:l,kids:o,data:u,offset:n,size:e})}const eS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ea={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Um(t,e){const n=ea[e];return!!n&&!!n[t.slice(0,4)]}function xl(t,e,n=!0){return!t.split(",").some(i=>!jm(i,e,n))}function jm(t,e,n=!0){var i;const s=xs(n);return(i=s==null?void 0:s.isTypeSupported(vl(t,e)))!=null?i:!1}function vl(t,e){return`${e}/mp4;codecs=${t}`}function xp(t){if(t){const e=t.substring(0,4);return ea.video[e]}return 2}function Du(t){const e=eS();return t.split(",").reduce((n,i)=>{const r=e&&mc(i)?9:ea.video[i];return r?(r*2+n)/(n?3:2):(ea.audio[i]+n)/(n?2:1)},0)}const gd={};function vC(t,e=!0){if(gd[t])return gd[t];const n={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[t];for(let s=0;s<n.length;s++){var i;if(jm(n[s],"audio",e))return gd[t]=n[s],n[s];if(n[s]==="mp3"&&(i=xs(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return t}const bC=/flac|opus|mp4a\.40\.34/i;function Nu(t,e=!0){return t.replace(bC,n=>vC(n.toLowerCase(),e))}function SC(t,e){const n=[];if(t){const i=t.split(",");for(let s=0;s<i.length;s++)Um(i[s],"video")||n.push(i[s])}return e&&n.push(e),n.join(",")}function Ho(t,e){if(t&&(t.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(t)!==-1)&&(vp(t,"audio")||vp(t,"video")))return t;if(e){const n=e.split(",");if(n.length>1){if(t){for(let i=n.length;i--;)if(n[i].substring(0,4)===t.substring(0,4))return n[i]}return n[0]}}return e||t}function vp(t,e){return Um(t,e)&&jm(t,e)}function EC(t){const e=t.split(",");for(let n=0;n<e.length;n++){const i=e[n].split(".");i.length>2&&i[0]==="avc1"&&(e[n]=`avc1.${parseInt(i[1]).toString(16)}${("000"+parseInt(i[2]).toString(16)).slice(-4)}`)}return e.join(",")}function TC(t){if(t.startsWith("av01.")){const e=t.split("."),n=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=n[i-4];return e.join(".")}return t}function bp(t){const e=xs(t)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function th(t){return t.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const AC={supported:!0,powerEfficient:!0,smooth:!0},kC={supported:!1,smooth:!1,powerEfficient:!1},tS={supported:!0,configurations:[],decodingInfoResults:[AC]};function nS(t,e){return{supported:!1,configurations:e,decodingInfoResults:[kC],error:t}}function _C(t,e,n,i,s,r){const a=t.videoCodec,l=t.audioCodec?t.audioGroups:null,o=r==null?void 0:r.audioCodec,u=r==null?void 0:r.channels,c=u?parseInt(u):o?1/0:2;let d=null;if(l!=null&&l.length)try{l.length===1&&l[0]?d=e.groups[l[0]].channels:d=l.reduce((f,h)=>{if(h){const m=e.groups[h];if(!m)throw new Error(`Audio track group ${h} not found`);Object.keys(m.channels).forEach(y=>{f[y]=(f[y]||0)+m.channels[y]})}return f},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(f=>mc(f))||t.width>1920&&t.height>1088||t.height>1920&&t.width>1088||t.frameRate>Math.max(i,30)||t.videoRange!=="SDR"&&t.videoRange!==n||t.bitrate>Math.max(s,8e6))||!!d&&ee(c)&&Object.keys(d).some(f=>parseInt(f)>c)}function iS(t,e,n,i={}){const s=t.videoCodec;if(!s&&!t.audioCodec||!n)return Promise.resolve(tS);const r=[],a=LC(t),l=a.length,o=RC(t,e,l>0),u=o.length;for(let c=l||1*u||1;c--;){const d={type:"media-source"};if(l&&(d.video=a[c%l]),u){d.audio=o[c%u];const f=d.audio.bitrate;d.video&&f&&(d.video.bitrate-=f)}r.push(d)}if(s){const c=navigator.userAgent;if(s.split(",").some(d=>mc(d))&&eS())return Promise.resolve(nS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${c})`),r))}return Promise.all(r.map(c=>{const d=CC(c);return i[d]||(i[d]=n.decodingInfo(c))})).then(c=>({supported:!c.some(d=>!d.supported),configurations:r,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:r,decodingInfoResults:[],error:c}))}function LC(t){var e;const n=(e=t.videoCodec)==null?void 0:e.split(","),i=sS(t),s=t.width||640,r=t.height||480,a=t.frameRate||30,l=t.videoRange.toLowerCase();return n?n.map(o=>{const u={contentType:vl(TC(o),"video"),width:s,height:r,bitrate:i,framerate:a};return l!=="sdr"&&(u.transferFunction=l),u}):[]}function RC(t,e,n){var i;const s=(i=t.audioCodec)==null?void 0:i.split(","),r=sS(t);return s&&t.audioGroups?t.audioGroups.reduce((a,l)=>{var o;const u=l?(o=e.groups[l])==null?void 0:o.tracks:null;return u?u.reduce((c,d)=>{if(d.groupId===l){const f=parseFloat(d.channels||"");s.forEach(h=>{const m={contentType:vl(h,"audio"),bitrate:n?wC(h,r):r};f&&(m.channels=""+f),c.push(m)})}return c},a):a},[]):[]}function wC(t,e){if(e<=1)return 1;let n=128e3;return t==="ec-3"?n=768e3:t==="ac-3"&&(n=64e4),Math.min(e/2,n)}function sS(t){return Math.ceil(Math.max(t.bitrate*.9,t.averageBitrate)/1e3)*1e3||1}function CC(t){let e="";const{audio:n,video:i}=t;if(i){const s=th(i.contentType);e+=`${s}_r${i.height}x${i.width}f${Math.ceil(i.framerate)}${i.transferFunction||"sd"}_${Math.ceil(i.bitrate/1e5)}`}if(n){const s=th(n.contentType);e+=`${i?"_":""}${s}_c${n.channels}`}return e}const nh=["NONE","TYPE-0","TYPE-1",null];function IC(t){return nh.indexOf(t)>-1}const Mu=["SDR","PQ","HLG"];function DC(t){return!!t&&Mu.indexOf(t)>-1}var Vo={No:"",Yes:"YES",v2:"v2"};function Sp(t){const{canSkipUntil:e,canSkipDateRanges:n,age:i}=t,s=i<e/2;return e&&s?n?Vo.v2:Vo.Yes:Vo.No}class Ep{constructor(e,n,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=n,this.skip=i}addDirectives(e){const n=new self.URL(e);return this.msn!==void 0&&n.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&n.searchParams.set("_HLS_part",this.part.toString()),this.skip&&n.searchParams.set("_HLS_skip",this.skip),n.href}}class bl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var n;this.supplemental=e.supplemental;const i=(n=e.supplemental)==null?void 0:n.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Tp(this._audioGroups,e)}hasSubtitleGroup(e){return Tp(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,n){if(n){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(n)===-1&&i.push(n)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(n)===-1&&i.push(n)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Tp(t,e){return!e||!t?!1:t.indexOf(e)!==-1}function NC(){if(typeof matchMedia=="function"){const t=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(t.media!==e.media)return t.matches===!0}return!1}function MC(t,e){let n=!1,i=[];if(t&&(n=t!=="SDR",i=[t]),e){i=e.allowedVideoRanges||Mu.slice(0);const s=i.join("")!=="SDR"&&!e.videoCodec;n=e.preferHDR!==void 0?e.preferHDR:s&&NC(),n||(i=["SDR"])}return{preferHDR:n,allowedVideoRanges:i}}const OC=t=>{const e=new WeakSet;return(n,i)=>{if(t&&(i=t(n,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},Ge=(t,e)=>JSON.stringify(t,OC(e));function PC(t,e,n,i,s){const r=Object.keys(t),a=i==null?void 0:i.channels,l=i==null?void 0:i.audioCodec,o=s==null?void 0:s.videoCodec,u=a&&parseInt(a)===2;let c=!1,d=!1,f=1/0,h=1/0,m=1/0,y=1/0,x=0,p=[];const{preferHDR:v,allowedVideoRanges:b}=MC(e,s);for(let C=r.length;C--;){const w=t[r[C]];c||(c=w.channels[2]>0),f=Math.min(f,w.minHeight),h=Math.min(h,w.minFramerate),m=Math.min(m,w.minBitrate),b.filter(I=>w.videoRanges[I]>0).length>0&&(d=!0)}f=ee(f)?f:0,h=ee(h)?h:0;const E=Math.max(1080,f),k=Math.max(30,h);m=ee(m)?m:n,n=Math.max(m,n),d||(e=void 0);const _=r.length>1;return{codecSet:r.reduce((C,w)=>{const A=t[w];if(w===C)return C;if(p=d?b.filter(I=>A.videoRanges[I]>0):[],_){if(A.minBitrate>n)return Wn(w,`min bitrate of ${A.minBitrate} > current estimate of ${n}`),C;if(!A.hasDefaultAudio)return Wn(w,"no renditions with default or auto-select sound found"),C;if(l&&w.indexOf(l.substring(0,4))%5!==0)return Wn(w,`audio codec preference "${l}" not found`),C;if(a&&!u){if(!A.channels[a])return Wn(w,`no renditions with ${a} channel sound found (channels options: ${Object.keys(A.channels)})`),C}else if((!l||u)&&c&&A.channels[2]===0)return Wn(w,"no renditions with stereo sound found"),C;if(A.minHeight>E)return Wn(w,`min resolution of ${A.minHeight} > maximum of ${E}`),C;if(A.minFramerate>k)return Wn(w,`min framerate of ${A.minFramerate} > maximum of ${k}`),C;if(!p.some(I=>A.videoRanges[I]>0))return Wn(w,`no variants with VIDEO-RANGE of ${Ge(p)} found`),C;if(o&&w.indexOf(o.substring(0,4))%5!==0)return Wn(w,`video codec preference "${o}" not found`),C;if(A.maxScore<x)return Wn(w,`max score of ${A.maxScore} < selected max of ${x}`),C}return C&&(Du(w)>=Du(C)||A.fragmentError>t[C].fragmentError)?C:(y=A.minIndex,x=A.maxScore,w)},void 0),videoRanges:p,preferHDR:v,minFramerate:h,minBitrate:m,minIndex:y}}function Wn(t,e){Pe.log(`[abr] start candidates with "${t}" ignored because ${e}`)}function rS(t){return t.reduce((e,n)=>{let i=e.groups[n.groupId];i||(i=e.groups[n.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(n);const s=n.channels||"2";return i.channels[s]=(i.channels[s]||0)+1,i.hasDefault=i.hasDefault||n.default,i.hasAutoSelect=i.hasAutoSelect||n.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function FC(t,e,n,i){return t.slice(n,i+1).reduce((s,r,a)=>{if(!r.codecSet)return s;const l=r.audioGroups;let o=s[r.codecSet];o||(s[r.codecSet]=o={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),o.minBitrate=Math.min(o.minBitrate,r.bitrate);const u=Math.min(r.height,r.width);return o.minHeight=Math.min(o.minHeight,u),o.minFramerate=Math.min(o.minFramerate,r.frameRate),o.minIndex=Math.min(o.minIndex,a),o.maxScore=Math.max(o.maxScore,r.score),o.fragmentError+=r.fragmentError,o.videoRanges[r.videoRange]=(o.videoRanges[r.videoRange]||0)+1,l&&l.forEach(c=>{if(!c)return;const d=e.groups[c];d&&(o.hasDefaultAudio=o.hasDefaultAudio||e.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(d.channels).forEach(f=>{o.channels[f]=(o.channels[f]||0)+d.channels[f]}))}),s},{})}function Ap(t){if(!t)return t;const{lang:e,assocLang:n,characteristics:i,channels:s,audioCodec:r}=t;return{lang:e,assocLang:n,characteristics:i,channels:s,audioCodec:r}}function ai(t,e,n){if("attrs"in t){const i=e.indexOf(t);if(i!==-1)return i}for(let i=0;i<e.length;i++){const s=e[i];if($s(t,s,n))return i}return-1}function $s(t,e,n){const{groupId:i,name:s,lang:r,assocLang:a,default:l}=t,o=t.forced;return(i===void 0||e.groupId===i)&&(s===void 0||e.name===s)&&(r===void 0||BC(r,e.lang))&&(r===void 0||e.assocLang===a)&&(l===void 0||e.default===l)&&(o===void 0||e.forced===o)&&(!("characteristics"in t)||UC(t.characteristics||"",e.characteristics))&&(n===void 0||n(t,e))}function BC(t,e="--"){return t.length===e.length?t===e:t.startsWith(e)||e.startsWith(t)}function UC(t,e=""){const n=t.split(","),i=e.split(",");return n.length===i.length&&!n.some(s=>i.indexOf(s)===-1)}function Ns(t,e){const{audioCodec:n,channels:i}=t;return(n===void 0||(e.audioCodec||"").substring(0,4)===n.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function jC(t,e,n,i,s){const r=e[i],l=e.reduce((f,h,m)=>{const y=h.uri;return(f[y]||(f[y]=[])).push(m),f},{})[r.uri];l.length>1&&(i=Math.max.apply(Math,l));const o=r.videoRange,u=r.frameRate,c=r.codecSet.substring(0,4),d=kp(e,i,f=>{if(f.videoRange!==o||f.frameRate!==u||f.codecSet.substring(0,4)!==c)return!1;const h=f.audioGroups,m=n.filter(y=>!h||h.indexOf(y.groupId)!==-1);return ai(t,m,s)>-1});return d>-1?d:kp(e,i,f=>{const h=f.audioGroups,m=n.filter(y=>!h||h.indexOf(y.groupId)!==-1);return ai(t,m,s)>-1})}function kp(t,e,n){for(let i=e;i>-1;i--)if(n(t[i]))return i;for(let i=e+1;i<t.length;i++)if(n(t[i]))return i;return-1}function Ou(t,e){var n;return!!t&&t!==((n=e.loadLevelObj)==null?void 0:n.uri)}class $C extends Un{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=n=>{var i;const{fragCurrent:s,partCurrent:r,hls:a}=this,{autoLevelEnabled:l,media:o}=a;if(!s||!o)return;const u=performance.now(),c=r?r.stats:s.stats,d=r?r.duration:s.duration,f=u-c.loading.start,h=a.minAutoLevel,m=s.level,y=this._nextAutoLevel;if(c.aborted||c.loaded&&c.loaded===c.total||m<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!l)return;const x=y>-1&&y!==m,p=!!n||x;if(!p&&(o.paused||!o.playbackRate||!o.readyState))return;const v=a.mainForwardBufferInfo;if(!p&&v===null)return;const b=this.bwEstimator.getEstimateTTFB(),E=Math.abs(o.playbackRate);if(f<=Math.max(b,1e3*(d/(E*2))))return;const k=v?v.len/E:0,_=c.loading.first?c.loading.first-c.loading.start:-1,L=c.loaded&&_>-1,C=this.getBwEstimate(),w=a.levels,A=w[m],I=Math.max(c.loaded,Math.round(d*(s.bitrate||A.averageBitrate)/8));let N=L?f-_:f;N<1&&L&&(N=Math.min(f,c.loaded*8/C));const V=L?c.loaded*1e3/N:0,G=b/1e3,$=V?(I-c.loaded)/V:I*8/C+G;if($<=k)return;const D=V?V*8:C,j=((i=(n==null?void 0:n.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,U=this.hls.config.abrBandWidthUpFactor;let q=Number.POSITIVE_INFINITY,R;for(R=m-1;R>h;R--){const Y=w[R].maxBitrate,X=!w[R].details||j;if(q=this.getTimeToLoadFrag(G,D,d*Y,X),q<Math.min(k,d+G))break}if(q>=$||q>d*10)return;L?this.bwEstimator.sample(f-Math.min(b,_),c.loaded):this.bwEstimator.sampleTTFB(f);const F=w[R].maxBitrate;this.getBwEstimate()*U>F&&this.resetEstimator(F);const B=this.findBestLevel(F,h,R,0,k,1,1);B>-1&&(R=B),this.warn(`Fragment ${s.sn}${r?" part "+r.index:""} of level ${m} is loading too slowly;
      Fragment duration: ${s.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${$.toFixed(3)} s
      Estimated load time for down switch fragment: ${q.toFixed(3)} s
      TTFB estimate: ${_|0} ms
      Current BW estimate: ${ee(C)?C|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${R} @ ${F|0} bps`),a.nextLoadLevel=a.nextAutoLevel=R,this.clearTimer();const T=()=>{if(this.clearTimer(),this.fragCurrent===s&&this.hls.loadLevel===R&&R>0){const Y=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${R>0?"and switching down":""}
      Fragment duration: ${s.duration.toFixed(3)} s
      Time to underbuffer: ${Y.toFixed(3)} s`),s.abortRequests(),this.fragCurrent=this.partCurrent=null,R>h){let X=this.findBestLevel(this.hls.levels[h].bitrate,h,R,0,Y,1,1);X===-1&&(X=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=X,this.resetEstimator(this.hls.levels[X].bitrate)}}};x||$>q*2?T():this.timer=self.setInterval(T,q*1e3),a.trigger(S.FRAG_LOAD_EMERGENCY_ABORTED,{frag:s,part:r,stats:c})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Kw(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(S.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,n){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,n){const i=n.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var s;this.fragCurrent=i,this.partCurrent=(s=n.part)!=null?s:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,n){this.clearTimer()}onError(e,n){if(!n.fatal)switch(n.details){case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case O.FRAG_LOAD_TIMEOUT:{const i=n.frag,{fragCurrent:s,partCurrent:r}=this;if(i&&s&&i.sn===s.sn&&i.level===s.level){const a=performance.now(),l=r?r.stats:i.stats,o=a-l.loading.start,u=l.loading.first?l.loading.first-l.loading.start:-1;if(l.loaded&&u>-1){const d=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(o-Math.min(d,u),l.loaded)}else this.bwEstimator.sampleTTFB(o)}break}}}getTimeToLoadFrag(e,n,i,s){const r=e+i/n,a=s?e+this.lastLevelLoadSec:0;return r+a}onLevelLoaded(e,n){const i=this.hls.config,{loading:s}=n.stats,r=s.end-s.first;ee(r)&&(this.lastLevelLoadSec=r/1e3),n.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(n.levelInfo)}onFragLoaded(e,{frag:n,part:i}){const s=i?i.stats:n.stats;if(n.type===ne.MAIN&&this.bwEstimator.sampleTTFB(s.loading.first-s.loading.start),!this.ignoreFragment(n)){if(this.clearTimer(),n.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=i?i.duration:n.duration,a=this.hls.levels[n.level],l=(a.loaded?a.loaded.bytes:0)+s.loaded,o=(a.loaded?a.loaded.duration:0)+r;a.loaded={bytes:l,duration:o},a.realBitrate=Math.round(8*l/o)}if(n.bitrateTest){const r={stats:s,frag:n,part:i,id:n.type};this.onFragBuffered(S.FRAG_BUFFERED,r),n.bitrateTest=!1}else this.lastLoadedFragLevel=n.level}}onFragBuffered(e,n){const{frag:i,part:s}=n,r=s!=null&&s.stats.loaded?s.stats:i.stats;if(r.aborted||this.ignoreFragment(i))return;const a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ne.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:n}=this.hls,i=this.getBwEstimate(),s=this.hls.config.maxStarvationDelay,r=this.findBestLevel(i,n,e,0,s,1,1);if(r>-1)return r;const a=this.hls.firstLevel,l=Math.min(Math.max(a,n),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${l}`),l}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),s=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!s||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=i&&s?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,r)&&a[e].loadError<=a[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:n,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:s,config:r,minAutoLevel:a}=i,l=n?n.duration:e?e.duration:0,o=this.getBwEstimate(),u=this.getStarvationDelay();let c=r.abrBandWidthFactor,d=r.abrBandWidthUpFactor;if(u){const x=this.findBestLevel(o,a,s,u,0,c,d);if(x>=0)return this.rebufferNotice=-1,x}let f=l?Math.min(l,r.maxStarvationDelay):r.maxStarvationDelay;if(!u){const x=this.bitrateTestDelay;x&&(f=(l?Math.min(l,r.maxLoadingDelay):r.maxLoadingDelay)-x,this.info(`bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),c=d=1)}const h=this.findBestLevel(o,a,s,u,f,c,d);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const m=i.levels[a],y=i.loadLevelObj;return y&&(m==null?void 0:m.bitrate)<y.bitrate?a:i.loadLevel}getStarvationDelay(){const e=this.hls,n=e.media;if(!n)return 1/0;const i=n&&n.playbackRate!==0?Math.abs(n.playbackRate):1,s=e.mainForwardBufferInfo;return(s?s.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,n,i,s,r,a,l){var o;const u=s+r,c=this.lastLoadedFragLevel,d=c===-1?this.hls.firstLevel:c,{fragCurrent:f,partCurrent:h}=this,{levels:m,allAudioTracks:y,loadLevel:x,config:p}=this.hls;if(m.length===1)return 0;const v=m[d],b=!!((o=this.hls.latestLevelDetails)!=null&&o.live),E=x===-1||c===-1;let k,_="SDR",L=(v==null?void 0:v.frameRate)||0;const{audioPreference:C,videoPreference:w}=p,A=this.audioTracksByGroup||(this.audioTracksByGroup=rS(y));let I=-1;if(E){if(this.firstSelection!==-1)return this.firstSelection;const D=this.codecTiers||(this.codecTiers=FC(m,A,n,i)),j=PC(D,_,e,C,w),{codecSet:U,videoRanges:q,minFramerate:R,minBitrate:F,minIndex:B,preferHDR:T}=j;I=B,k=U,_=T?q[q.length-1]:q[0],L=R,e=Math.max(e,F),this.log(`picked start tier ${Ge(j)}`)}else k=v==null?void 0:v.codecSet,_=v==null?void 0:v.videoRange;const N=h?h.duration:f?f.duration:0,V=this.bwEstimator.getEstimateTTFB()/1e3,G=[];for(let D=i;D>=n;D--){var $;const j=m[D],U=D>d;if(!j)continue;if(p.useMediaCapabilities&&!j.supportedResult&&!j.supportedPromise){const X=navigator.mediaCapabilities;typeof(X==null?void 0:X.decodingInfo)=="function"&&_C(j,A,_,L,e,C)?(j.supportedPromise=iS(j,A,X,this.supportedCache),j.supportedPromise.then(Z=>{if(!this.hls)return;j.supportedResult=Z;const le=this.hls.levels,se=le.indexOf(j);Z.error?this.warn(`MediaCapabilities decodingInfo error: "${Z.error}" for level ${se} ${Ge(Z)}`):Z.supported?Z.decodingInfoResults.some(fe=>fe.smooth===!1||fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${se} not smooth or powerEfficient: ${Ge(Z)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${se} ${Ge(Z)}`),se>-1&&le.length>1&&(this.log(`Removing unsupported level ${se}`),this.hls.removeLevel(se),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Z=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Z}`)})):j.supportedResult=tS}if((k&&j.codecSet!==k||_&&j.videoRange!==_||U&&L>j.frameRate||!U&&L>0&&L<j.frameRate||($=j.supportedResult)!=null&&($=$.decodingInfoResults)!=null&&$.some(X=>X.smooth===!1))&&(!E||D!==I)){G.push(D);continue}const q=j.details,R=(h?q==null?void 0:q.partTarget:q==null?void 0:q.averagetargetduration)||N;let F;U?F=l*e:F=a*e;const B=N&&s>=N*2&&r===0?j.averageBitrate:j.maxBitrate,T=this.getTimeToLoadFrag(V,F,B*R,q===void 0);if(F>=B&&(D===c||j.loadError===0&&j.fragmentError===0)&&(T<=V||!ee(T)||b&&!this.bitrateTestDelay||T<u)){const X=this.forcedAutoLevel;return D!==x&&(X===-1||X!==x)&&(G.length&&this.trace(`Skipped level(s) ${G.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${m[G[0]].codecs}" ${m[G[0]].videoRange}; not compatible with "${k}" ${_}`),this.info(`switch candidate:${d}->${D} adjustedbw(${Math.round(F)})-bitrate=${Math.round(F-B)} ttfb:${V.toFixed(1)} avgDuration:${R.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${T.toFixed(1)} firstSelection:${E} codecSet:${j.codecSet} videoRange:${j.videoRange} hls.loadLevel:${x}`)),E&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const n=this.deriveNextAutoLevel(e);this._nextAutoLevel!==n&&(this.nextAutoLevelKey="",this._nextAutoLevel=n)}deriveNextAutoLevel(e){const{maxAutoLevel:n,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),n)}}const aS={search:function(t,e){let n=0,i=t.length-1,s=null,r=null;for(;n<=i;){s=(n+i)/2|0,r=t[s];const a=e(r);if(a>0)n=s+1;else if(a<0)i=s-1;else return r}return null}};function zC(t,e,n){if(e===null||!Array.isArray(t)||!t.length||!ee(e))return null;const i=t[0].programDateTime;if(e<(i||0))return null;const s=t[t.length-1].endProgramDateTime;if(e>=(s||0))return null;for(let r=0;r<t.length;++r){const a=t[r];if(HC(e,n,a))return a}return null}function Xs(t,e,n=0,i=0,s=.005){let r=null;if(t){r=e[1+t.sn-e[0].sn]||null;const l=t.endDTS-n;l>0&&l<15e-7&&(n+=15e-7),r&&t.level!==r.level&&r.end<=t.end&&(r=e[2+t.sn-e[0].sn]||null)}else n===0&&e[0].start===0&&(r=e[0]);if(r&&((!t||t.level===r.level)&&_p(n,i,r)===0||GC(r,t,Math.min(s,i))))return r;const a=aS.search(e,_p.bind(null,n,i));return a&&(a!==t||!r)?a:r}function GC(t,e,n){if(e&&e.start===0&&e.level<t.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((s,r)=>(r[0]==="INF"&&(s+=parseFloat(r[1])),s),n);return t.start<=i}return!1}function _p(t=0,e=0,n){if(n.start<=t&&n.start+n.duration>t)return 0;const i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=t?1:n.start-i>t&&n.start?-1:0}function HC(t,e,n){const i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0))*1e3;return(n.endProgramDateTime||0)-i>t}function lS(t,e,n){if(t&&t.startCC<=e&&t.endCC>=e){let i=t.fragments;const{fragmentHint:s}=t;s&&(i=i.concat(s));let r;return aS.search(i,a=>a.cc<e?1:a.cc>e?-1:(r=a,a.end<=n?1:a.start>n?-1:0)),r||null}return null}function Pu(t){switch(t.details){case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_TIMEOUT:case O.LEVEL_LOAD_TIMEOUT:case O.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function oS(t){return t.details.startsWith("key")}function uS(t){return oS(t)&&!!t.frag&&!t.frag.decryptdata}function Lp(t,e){const n=Pu(e);return t.default[`${n?"timeout":"error"}Retry`]}function $m(t,e){const n=t.backoff==="linear"?1:Math.pow(2,e);return Math.min(n*t.retryDelayMs,t.maxRetryDelayMs)}function Rp(t){return Me(Me({},t),{errorRetry:null,timeoutRetry:null})}function Fu(t,e,n,i){if(!t)return!1;const s=i==null?void 0:i.code,r=e<t.maxNumRetry&&(VC(s)||!!n);return t.shouldRetry?t.shouldRetry(t,e,n,i,r):r}function VC(t){return ih(t)||!!t&&(t<400||t>499)}function ih(t){return t===0&&navigator.onLine===!1}var Rt={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},cn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class KC extends Un{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.ERROR,this.onError,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.ERROR,this.onError,this),e.off(S.ERROR,this.onErrorOut,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ne.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const n=this.hls,i=n.currentLevel;return(e=n.loadLevelObj)!=null&&e.details||i===-1?n.loadLevel:i}variantHasKey(e,n){if(e){var i;if((i=e.details)!=null&&i.hasKey(n))return!0;const s=e.audioGroups;if(s)return this.hls.allAudioTracks.filter(a=>s.indexOf(a.groupId)>=0).some(a=>{var l;return(l=a.details)==null?void 0:l.hasKey(n)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,n){var i;if(n.fatal)return;const s=this.hls,r=n.context;switch(n.details){case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:n.errorAction=this.getFragRetryOrSwitchAction(n);return;case O.FRAG_PARSING_ERROR:if((i=n.frag)!=null&&i.gap){n.errorAction=Br();return}case O.FRAG_GAP:case O.FRAG_DECRYPT_ERROR:{n.errorAction=this.getFragRetryOrSwitchAction(n),n.errorAction.action=Rt.SendAlternateToPenaltyBox;return}case O.LEVEL_EMPTY_ERROR:case O.LEVEL_PARSING_ERROR:{var a;const o=n.parent===ne.MAIN?n.level:s.loadLevel;n.details===O.LEVEL_EMPTY_ERROR&&((a=n.context)!=null&&(a=a.levelDetails)!=null&&a.live)?n.errorAction=this.getPlaylistRetryOrSwitchAction(n,o):(n.levelRetry=!1,n.errorAction=this.getLevelSwitchAction(n,o))}return;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:typeof(r==null?void 0:r.level)=="number"&&(n.errorAction=this.getPlaylistRetryOrSwitchAction(n,r.level));return;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.SUBTITLE_LOAD_ERROR:case O.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const o=s.loadLevelObj;if(o&&(r.type===Ee.AUDIO_TRACK&&o.hasAudioGroup(r.groupId)||r.type===Ee.SUBTITLE_TRACK&&o.hasSubtitleGroup(r.groupId))){n.errorAction=this.getPlaylistRetryOrSwitchAction(n,s.loadLevel),n.errorAction.action=Rt.SendAlternateToPenaltyBox,n.errorAction.flags=cn.MoveAllAlternatesMatchingHost;return}}return;case O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:n.errorAction={action:Rt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHDCP};return;case O.KEY_SYSTEM_SESSION_UPDATE_FAILED:case O.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case O.KEY_SYSTEM_NO_SESSION:n.errorAction={action:Rt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingKey};return;case O.BUFFER_ADD_CODEC_ERROR:case O.REMUX_ALLOC_ERROR:case O.BUFFER_APPEND_ERROR:if(!n.errorAction){var l;n.errorAction=this.getLevelSwitchAction(n,(l=n.level)!=null?l:s.loadLevel)}return;case O.INTERNAL_EXCEPTION:case O.BUFFER_APPENDING_ERROR:case O.BUFFER_FULL_ERROR:case O.LEVEL_SWITCH_ERROR:case O.BUFFER_STALLED_ERROR:case O.BUFFER_SEEK_OVER_HOLE:case O.BUFFER_NUDGE_ON_STALL:n.errorAction=Br();return}n.type===re.KEY_SYSTEM_ERROR&&(n.levelRetry=!1,n.errorAction=Br())}getPlaylistRetryOrSwitchAction(e,n){const i=this.hls,s=Lp(i.config.playlistLoadPolicy,e),r=this.playlistError++;if(Fu(s,r,Pu(e),e.response))return{action:Rt.RetryRequest,flags:cn.None,retryConfig:s,retryCount:r};const l=this.getLevelSwitchAction(e,n);return s&&(l.retryConfig=s,l.retryCount=r),l}getFragRetryOrSwitchAction(e){const n=this.hls,i=this.getVariantLevelIndex(e.frag),s=n.levels[i],{fragLoadPolicy:r,keyLoadPolicy:a}=n.config,l=Lp(oS(e)?a:r,e),o=n.levels.reduce((c,d)=>c+d.fragmentError,0);if(s&&(e.details!==O.FRAG_GAP&&s.fragmentError++,!uS(e)&&Fu(l,o,Pu(e),e.response)))return{action:Rt.RetryRequest,flags:cn.None,retryConfig:l,retryCount:o};const u=this.getLevelSwitchAction(e,i);return l&&(u.retryConfig=l,u.retryCount=o),u}getLevelSwitchAction(e,n){const i=this.hls;n==null&&(n=i.loadLevel);const s=this.hls.levels[n];if(s){var r,a;const u=e.details;s.loadError++,u===O.BUFFER_APPEND_ERROR&&s.fragmentError++;let c=-1;const{levels:d,loadLevel:f,minAutoLevel:h,maxAutoLevel:m}=i;!i.autoLevelEnabled&&!i.config.preserveManualLevelOnError&&(i.loadLevel=-1);const y=(r=e.frag)==null?void 0:r.type,p=(y===ne.AUDIO&&u===O.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR))&&d.some(({audioCodec:_})=>s.audioCodec!==_),b=e.sourceBufferName==="video"&&(u===O.BUFFER_ADD_CODEC_ERROR||u===O.BUFFER_APPEND_ERROR)&&d.some(({codecSet:_,audioCodec:L})=>s.codecSet!==_&&s.audioCodec===L),{type:E,groupId:k}=(a=e.context)!=null?a:{};for(let _=d.length;_--;){const L=(_+f)%d.length;if(L!==f&&L>=h&&L<=m&&d[L].loadError===0){var l,o;const C=d[L];if(u===O.FRAG_GAP&&y===ne.MAIN&&e.frag){const w=d[L].details;if(w){const A=Xs(e.frag,w.fragments,e.frag.start);if(A!=null&&A.gap)continue}}else{if(E===Ee.AUDIO_TRACK&&C.hasAudioGroup(k)||E===Ee.SUBTITLE_TRACK&&C.hasSubtitleGroup(k))continue;if(y===ne.AUDIO&&(l=s.audioGroups)!=null&&l.some(w=>C.hasAudioGroup(w))||y===ne.SUBTITLE&&(o=s.subtitleGroups)!=null&&o.some(w=>C.hasSubtitleGroup(w))||p&&s.audioCodec===C.audioCodec||b&&s.codecSet===C.codecSet||!p&&s.codecSet!==C.codecSet)continue}c=L;break}}if(c>-1&&i.loadLevel!==c)return e.levelRetry=!0,this.playlistError=0,{action:Rt.SendAlternateToPenaltyBox,flags:cn.None,nextAutoLevel:c}}return{action:Rt.SendAlternateToPenaltyBox,flags:cn.MoveAllAlternatesMatchingHost}}onErrorOut(e,n){var i;switch((i=n.errorAction)==null?void 0:i.action){case Rt.DoNothing:break;case Rt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(n),!n.errorAction.resolved&&n.details!==O.FRAG_GAP?n.fatal=!0:/MediaSource readyState: ended/.test(n.error.message)&&(this.warn(`MediaSource ended after "${n.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(n.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const n=this.hls,i=e.errorAction;if(!i)return;const{flags:s}=i,r=i.nextAutoLevel;switch(s){case cn.None:this.switchLevel(e,r);break;case cn.MoveAllAlternatesMatchingHDCP:{const o=this.getVariantLevelIndex(e.frag),u=n.levels[o],c=u==null?void 0:u.attrs["HDCP-LEVEL"];if(i.hdcpLevel=c,c==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(c){n.maxHdcpLevel=nh[nh.indexOf(c)-1],i.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${n.maxHdcpLevel}" or lower`);break}}case cn.MoveAllAlternatesMatchingKey:{const o=e.decryptdata;if(o){const u=this.hls.levels,c=u.length;for(let f=c;f--;)if(this.variantHasKey(u[f],o)){var a,l;this.log(`Banned key found in level ${f} (${u[f].bitrate}bps) or audio group "${(a=u[f].audioGroups)==null?void 0:a.join(",")}" (${(l=e.frag)==null?void 0:l.type} fragment) ${wt(o.keyId||[])}`),u[f].fragmentError++,u[f].loadError++,this.log(`Removing level ${f} with key error (${e.error})`),this.hls.removeLevel(f)}const d=e.frag;if(this.hls.levels.length<c)i.resolved=!0;else if(d&&d.type!==ne.MAIN){const f=d.decryptdata;f&&!o.matches(f)&&(i.resolved=!0)}}break}}i.resolved||this.switchLevel(e,r)}switchLevel(e,n){if(n!==void 0&&e.errorAction&&(this.warn(`switching to level ${n} after ${e.details}`),this.hls.nextAutoLevel=n,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===O.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=th(e.mimeType),s=this.hls.levels;for(let r=s.length;r--;)s[r][`${e.sourceBufferName}Codec`]===i&&(this.log(`Removing level ${r} for ${e.details} ("${i}" not supported)`),this.hls.removeLevel(r))}}}function Br(t){const e={action:Rt.DoNothing,flags:cn.None};return t&&(e.resolved=!0),e}var bt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class YC{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,n){const i=this.activePartLists[n];if(i)for(let s=i.length;s--;){const r=i[s];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,n)}getBufferedFrag(e,n){return this.getFragAtPos(e,n,!0)}getFragAtPos(e,n,i){const{fragments:s}=this,r=Object.keys(s);for(let a=r.length;a--;){const l=s[r[a]];if((l==null?void 0:l.body.type)===n&&(!i||l.buffered)){const o=l.body;if(o.start<=e&&e<=o.end)return o}}return null}detectEvictedFragments(e,n,i,s,r){this.timeRanges&&(this.timeRanges[e]=n);const a=(s==null?void 0:s.fragment.sn)||-1;Object.keys(this.fragments).forEach(l=>{const o=this.fragments[l];if(!o||a>=o.body.sn)return;if(!o.buffered&&(!o.loaded||r)){o.body.type===i&&this.removeFragment(o.body);return}const u=o.range[e];if(u){if(u.time.length===0){this.removeFragment(o.body);return}u.time.some(c=>{const d=!this.isTimeBuffered(c.startPTS,c.endPTS,n);return d&&this.removeFragment(o.body),d})}})}detectPartialFragments(e){const n=this.timeRanges;if(!n||e.frag.sn==="initSegment")return;const i=e.frag,s=or(i),r=this.fragments[s];if(!r||r.buffered&&i.gap)return;const a=!i.relurl;Object.keys(n).forEach(l=>{const o=i.elementaryStreams[l];if(!o)return;const u=n[l],c=a||o.partial===!0;r.range[l]=this.getBufferedTimes(i,e.part,c,u)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,i),oo(r)||this.removeParts(i.sn-1,i.type)):this.removeFragment(r.body)}bufferedEnd(e,n){e.buffered=!0,(e.body.endList=n.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,n){const i=this.activePartLists[n];i&&(this.activePartLists[n]=wp(i,s=>s.fragment.sn>=e))}fragBuffered(e,n){const i=or(e);let s=this.fragments[i];!s&&n&&(s=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),s&&(s.loaded=null,this.bufferedEnd(s,e))}getBufferedTimes(e,n,i,s){const r={time:[],partial:i},a=e.start,l=e.end,o=e.minEndPTS||l,u=e.maxStartPTS||a;for(let c=0;c<s.length;c++){const d=s.start(c)-this.bufferPadding,f=s.end(c)+this.bufferPadding;if(u>=d&&o<=f){r.time.push({startPTS:Math.max(a,s.start(c)),endPTS:Math.min(l,s.end(c))});break}else if(a<f&&l>d){const h=Math.max(a,s.start(c)),m=Math.min(l,s.end(c));m>h&&(r.partial=!0,r.time.push({startPTS:h,endPTS:m}))}else if(l<=d)break}return r}getPartialFragment(e){let n=null,i,s,r,a=0;const{bufferPadding:l,fragments:o}=this;return Object.keys(o).forEach(u=>{const c=o[u];c&&oo(c)&&(s=c.body.start-l,r=c.body.end+l,e>=s&&e<=r&&(i=Math.min(e-s,r-e),a<=i&&(n=c.body,a=i)))}),n}isEndListAppended(e){const n=this.endListFragments[e];return n!==void 0&&(n.buffered||oo(n))}getState(e){const n=or(e),i=this.fragments[n];return i?i.buffered?oo(i)?bt.PARTIAL:bt.OK:bt.APPENDING:bt.NOT_LOADED}isTimeBuffered(e,n,i){let s,r;for(let a=0;a<i.length;a++){if(s=i.start(a)-this.bufferPadding,r=i.end(a)+this.bufferPadding,e>=s&&n<=r)return!0;if(n<=s)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,n){if(n.frag.sn==="initSegment"||n.frag.bitrateTest)return;const i=n.frag,s=n.part?null:n,r=or(i);this.fragments[r]={body:i,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(e,n){const{frag:i,part:s,timeRanges:r,type:a}=n;if(i.sn==="initSegment")return;const l=i.type;if(s){let u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(s)}this.timeRanges=r;const o=r[a];this.detectEvictedFragments(a,o,l,s)}onFragBuffered(e,n){this.detectPartialFragments(n)}hasFragment(e){const n=or(e);return!!this.fragments[n]}hasFragments(e){const{fragments:n}=this,i=Object.keys(n);if(!e)return i.length>0;for(let s=i.length;s--;){const r=n[i[s]];if((r==null?void 0:r.body.type)===e)return!0}return!1}hasParts(e){var n;return!!((n=this.activePartLists[e])!=null&&n.length)}removeFragmentsInRange(e,n,i,s,r){s&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const l=this.fragments[a];if(!l)return;const o=l.body;o.type!==i||s&&!o.gap||o.start<n&&o.end>e&&(l.buffered||r)&&this.removeFragment(o)})}removeFragment(e){const n=or(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const s=e.sn;this.activePartLists[e.type]=wp(i,r=>r.fragment.sn!==s)}delete this.fragments[n],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const n=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;n&&n.forEach(i=>i.clearElementaryStreamInfo())}}function oo(t){var e,n,i;return t.buffered&&!!(t.body.gap||(e=t.range.video)!=null&&e.partial||(n=t.range.audio)!=null&&n.partial||(i=t.range.audiovideo)!=null&&i.partial)}function or(t){return`${t.type}_${t.level}_${t.sn}`}function wp(t,e){return t.filter(n=>{const i=e(n);return i||n.clearElementaryStreamInfo(),i})}var vs={cbc:0,ctr:1};class qC{constructor(e,n,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=n,this.aesMode=i}decrypt(e,n){switch(this.aesMode){case vs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},n,e);case vs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},n,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function XC(t){const e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?t.slice(0,e-n):t}class QC{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const n=new DataView(e),i=new Uint32Array(4);for(let s=0;s<4;s++)i[s]=n.getUint32(s*4);return i}initTable(){const e=this.sBox,n=this.invSBox,i=this.subMix,s=i[0],r=i[1],a=i[2],l=i[3],o=this.invSubMix,u=o[0],c=o[1],d=o[2],f=o[3],h=new Uint32Array(256);let m=0,y=0,x=0;for(x=0;x<256;x++)x<128?h[x]=x<<1:h[x]=x<<1^283;for(x=0;x<256;x++){let p=y^y<<1^y<<2^y<<3^y<<4;p=p>>>8^p&255^99,e[m]=p,n[p]=m;const v=h[m],b=h[v],E=h[b];let k=h[p]*257^p*16843008;s[m]=k<<24|k>>>8,r[m]=k<<16|k>>>16,a[m]=k<<8|k>>>24,l[m]=k,k=E*16843009^b*65537^v*257^m*16843008,u[p]=k<<24|k>>>8,c[p]=k<<16|k>>>16,d[p]=k<<8|k>>>24,f[p]=k,m?(m=v^h[h[h[E^v]]],y^=h[h[y]]):m=y=1}}expandKey(e){const n=this.uint8ArrayToUint32Array_(e);let i=!0,s=0;for(;s<n.length&&i;)i=n[s]===this.key[s],s++;if(i)return;this.key=n;const r=this.keySize=n.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const a=this.ksRows=(r+6+1)*4;let l,o;const u=this.keySchedule=new Uint32Array(a),c=this.invKeySchedule=new Uint32Array(a),d=this.sBox,f=this.rcon,h=this.invSubMix,m=h[0],y=h[1],x=h[2],p=h[3];let v,b;for(l=0;l<a;l++){if(l<r){v=u[l]=n[l];continue}b=v,l%r===0?(b=b<<8|b>>>24,b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255],b^=f[l/r|0]<<24):r>6&&l%r===4&&(b=d[b>>>24]<<24|d[b>>>16&255]<<16|d[b>>>8&255]<<8|d[b&255]),u[l]=v=(u[l-r]^b)>>>0}for(o=0;o<a;o++)l=a-o,o&3?b=u[l]:b=u[l-4],o<4||l<=4?c[o]=b:c[o]=m[d[b>>>24]]^y[d[b>>>16&255]]^x[d[b>>>8&255]]^p[d[b&255]],c[o]=c[o]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,n,i){const s=this.keySize+6,r=this.invKeySchedule,a=this.invSBox,l=this.invSubMix,o=l[0],u=l[1],c=l[2],d=l[3],f=this.uint8ArrayToUint32Array_(i);let h=f[0],m=f[1],y=f[2],x=f[3];const p=new Int32Array(e),v=new Int32Array(p.length);let b,E,k,_,L,C,w,A,I,N,V,G,$,D;const j=this.networkToHostOrderSwap;for(;n<p.length;){for(I=j(p[n]),N=j(p[n+1]),V=j(p[n+2]),G=j(p[n+3]),L=I^r[0],C=G^r[1],w=V^r[2],A=N^r[3],$=4,D=1;D<s;D++)b=o[L>>>24]^u[C>>16&255]^c[w>>8&255]^d[A&255]^r[$],E=o[C>>>24]^u[w>>16&255]^c[A>>8&255]^d[L&255]^r[$+1],k=o[w>>>24]^u[A>>16&255]^c[L>>8&255]^d[C&255]^r[$+2],_=o[A>>>24]^u[L>>16&255]^c[C>>8&255]^d[w&255]^r[$+3],L=b,C=E,w=k,A=_,$=$+4;b=a[L>>>24]<<24^a[C>>16&255]<<16^a[w>>8&255]<<8^a[A&255]^r[$],E=a[C>>>24]<<24^a[w>>16&255]<<16^a[A>>8&255]<<8^a[L&255]^r[$+1],k=a[w>>>24]<<24^a[A>>16&255]<<16^a[L>>8&255]<<8^a[C&255]^r[$+2],_=a[A>>>24]<<24^a[L>>16&255]<<16^a[C>>8&255]<<8^a[w&255]^r[$+3],v[n]=j(b^h),v[n+1]=j(_^m),v[n+2]=j(k^y),v[n+3]=j(E^x),h=I,m=N,y=V,x=G,n=n+4}return v.buffer}}class WC{constructor(e,n,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=n,this.aesMode=i}expandKey(){const e=ZC(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function ZC(t){switch(t){case vs.cbc:return"AES-CBC";case vs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${t}`)}}const JC=16;class zm{constructor(e,{removePKCS7Padding:n=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=n,n)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:n}=this;if(!e||n)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?XC(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,n,i,s){return this.useSoftware?new Promise((r,a)=>{const l=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(l,n,i,s);const o=this.flush();o?r(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),n,i,s)}softwareDecrypt(e,n,i,s){const{currentIV:r,currentResult:a,remainderData:l}=this;if(s!==vs.cbc||n.byteLength!==16)return Pe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),l&&(e=Bn(l,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;r&&(i=r);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new QC),u.expandKey(n);const c=a;return this.currentResult=u.decrypt(o.buffer,0,i),this.currentIV=o.slice(-16).buffer,c||null}webCryptoDecrypt(e,n,i,s){if(this.key!==n||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,n,i,s));this.key=n,this.fastAesKey=new WC(this.subtle,n,s)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new qC(this.subtle,new Uint8Array(i),s).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Pe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,n,i,s)))}onWebCryptoError(e,n,i,s){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,n,i,s);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let n=e;const i=e.length-e.length%JC;return i!==e.length&&(n=e.slice(0,i),this.remainderData=e.slice(i)),n}logOnce(e){this.logEnabled&&(Pe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Cp=Math.pow(2,17);class eI{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,n){const i=e.url;if(!i)return Promise.reject(new Si({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((l,o)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(m=>m[0]==="GAP")){o(Dp(e));return}else e.gap=!1;const u=this.loader=r?new r(s):new a(s),c=Ip(e);e.loader=u;const d=Rp(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Cp};e.stats=u.stats;const h={onSuccess:(m,y,x,p)=>{this.resetLoader(e,u);let v=m.data;x.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(v.slice(0,16)),v=v.slice(16)),l({frag:e,part:null,payload:v,networkDetails:p})},onError:(m,y,x,p)=>{this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Me({url:i,data:void 0},m),error:new Error(`HTTP Error ${m.code} ${m.text}`),networkDetails:x,stats:p}))},onAbort:(m,y,x)=>{this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:x,stats:m}))},onTimeout:(m,y,x)=>{this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:x,stats:m}))}};n&&(h.onProgress=(m,y,x,p)=>n({frag:e,part:null,payload:x,networkDetails:p})),u.load(c,f,h)})}loadPart(e,n,i){this.abort();const s=this.config,r=s.fLoader,a=s.loader;return new Promise((l,o)=>{if(this.loader&&this.loader.destroy(),e.gap||n.gap){o(Dp(e,n));return}const u=this.loader=r?new r(s):new a(s),c=Ip(e,n);e.loader=u;const d=Rp(s.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Cp};n.stats=u.stats,u.load(c,f,{onSuccess:(h,m,y,x)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,n);const p={frag:e,part:n,payload:h.data,networkDetails:x};i(p),l(p)},onError:(h,m,y,x)=>{this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:n,response:Me({url:c.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:y,stats:x}))},onAbort:(h,m,y)=>{e.stats.aborted=n.stats.aborted,this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.INTERNAL_ABORTED,fatal:!1,frag:e,part:n,error:new Error("Aborted"),networkDetails:y,stats:h}))},onTimeout:(h,m,y)=>{this.resetLoader(e,u),o(new Si({type:re.NETWORK_ERROR,details:O.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:n,error:new Error(`Timeout after ${f.timeout}ms`),networkDetails:y,stats:h}))}})})}updateStatsFromPart(e,n){const i=e.stats,s=n.stats,r=s.total;if(i.loaded+=s.loaded,r){const o=Math.round(e.duration/n.duration),u=Math.min(Math.round(i.loaded/r),o),d=(o-u)*Math.round(i.loaded/u);i.total=i.loaded+d}else i.total=Math.max(i.loaded,i.total);const a=i.loading,l=s.loading;a.start?a.first+=l.first-l.start:(a.start=l.start,a.first=l.first),a.end=l.end}resetLoader(e,n){e.loader=null,this.loader===n&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),n.destroy()}}function Ip(t,e=null){const n=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,r=n.byteRangeEndOffset;if(ee(s)&&ee(r)){var a;let l=s,o=r;if(t.sn==="initSegment"&&tI((a=t.decryptdata)==null?void 0:a.method)){const u=r-s;u%16&&(o=r+(16-u%16)),s!==0&&(i.resetIV=!0,l=s-16)}i.rangeStart=l,i.rangeEnd=o}return i}function Dp(t,e){const n=new Error(`GAP ${t.gap?"tag":"attribute"} found`),i={type:re.MEDIA_ERROR,details:O.FRAG_GAP,fatal:!1,frag:t,error:n,networkDetails:null};return e&&(i.part=e),(e||t).stats.aborted=!0,new Si(i)}function tI(t){return t==="AES-128"||t==="AES-256"}class Si extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class cS extends Un{constructor(e,n){super(e,n),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Gm{constructor(e,n,i,s=0,r=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=uo(),this.buffering={audio:uo(),video:uo(),audiovideo:uo()},this.level=e,this.sn=n,this.id=i,this.size=s,this.part=r,this.partial=a}}function uo(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Np={length:0,start:()=>0,end:()=>0};class he{static isBuffered(e,n){if(e){const i=he.getBuffered(e);for(let s=i.length;s--;)if(n>=i.start(s)&&n<=i.end(s))return!0}return!1}static bufferedRanges(e){if(e){const n=he.getBuffered(e);return he.timeRangesToArray(n)}return[]}static timeRangesToArray(e){const n=[];for(let i=0;i<e.length;i++)n.push({start:e.start(i),end:e.end(i)});return n}static bufferInfo(e,n,i){if(e){const s=he.bufferedRanges(e);if(s.length)return he.bufferedInfo(s,n,i)}return{len:0,start:n,end:n,bufferedIndex:-1}}static bufferedInfo(e,n,i){n=Math.max(0,n),e.length>1&&e.sort((c,d)=>c.start-d.start||d.end-c.end);let s=-1,r=[];if(i)for(let c=0;c<e.length;c++){n>=e[c].start&&n<=e[c].end&&(s=c);const d=r.length;if(d){const f=r[d-1].end;e[c].start-f<i?e[c].end>f&&(r[d-1].end=e[c].end):r.push(e[c])}else r.push(e[c])}else r=e;let a=0,l,o=n,u=n;for(let c=0;c<r.length;c++){const d=r[c].start,f=r[c].end;if(s===-1&&n>=d&&n<=f&&(s=c),n+i>=d&&n<f)o=d,u=f,a=u-n;else if(n+i<d){l=d;break}}return{len:a,start:o||0,end:u||0,nextStart:l,buffered:e,bufferedIndex:s}}static getBuffered(e){try{return e.buffered||Np}catch(n){return Pe.log("failed to get media.buffered",n),Np}}}const dS=/\{\$([a-zA-Z0-9-_]+)\}/g;function Mp(t){return dS.test(t)}function sh(t,e){if(t.variableList!==null||t.hasVariableRefs){const n=t.variableList;return e.replace(dS,i=>{const s=i.substring(2,i.length-1),r=n==null?void 0:n[s];return r===void 0?(t.playlistParsingError||(t.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${s}"`)),i):r})}return e}function Op(t,e,n){let i=t.variableList;i||(t.variableList=i={});let s,r;if("QUERYPARAM"in e){s=e.QUERYPARAM;try{const a=new self.URL(n).searchParams;if(a.has(s))r=a.get(s);else throw new Error(`"${s}" does not match any query parameter in URI: "${n}"`)}catch(a){t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else s=e.NAME,r=e.VALUE;s in i?t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${s}"`)):i[s]=r||""}function nI(t,e,n){const i=e.IMPORT;if(n&&i in n){let s=t.variableList;s||(t.variableList=s={}),s[i]=n[i]}else t.playlistParsingError||(t.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const iI=/^(\d+)x(\d+)$/,Pp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class tt{constructor(e,n){typeof e=="string"&&(e=tt.parseAttrList(e,n)),$e(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const n=parseInt(this[e],10);return n>Number.MAX_SAFE_INTEGER?1/0:n}hexadecimalInteger(e){if(this[e]){let n=(this[e]||"0x").slice(2);n=(n.length&1?"0":"")+n;const i=new Uint8Array(n.length/2);for(let s=0;s<n.length/2;s++)i[s]=parseInt(n.slice(s*2,s*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const n=parseInt(this[e],16);return n>Number.MAX_SAFE_INTEGER?1/0:n}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,n){const i=this[e];return i?parseFloat(i):n}enumeratedString(e){return this[e]}enumeratedStringList(e,n){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((s,r)=>(s[r.toLowerCase()]=!0,s),n)}bool(e){return this[e]==="YES"}decimalResolution(e){const n=iI.exec(this[e]);if(n!==null)return{width:parseInt(n[1],10),height:parseInt(n[2],10)}}static parseAttrList(e,n){let i;const s={},r='"';for(Pp.lastIndex=0;(i=Pp.exec(e))!==null;){const a=i[1].trim();let l=i[2];const o=l.indexOf(r)===0&&l.lastIndexOf(r)===l.length-1;let u=!1;if(o)l=l.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(n&&(o||u))l=sh(n,l);else if(!u&&!o)switch(a){case"CLOSED-CAPTIONS":if(l==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Pe.warn(`${e}: attribute ${a} is missing quotes`)}s[a]=l}return s}}const sI="com.apple.hls.interstitial";function rI(t){return t!=="ID"&&t!=="CLASS"&&t!=="CUE"&&t!=="START-DATE"&&t!=="DURATION"&&t!=="END-DATE"&&t!=="END-ON-NEXT"}function aI(t){return t==="SCTE35-OUT"||t==="SCTE35-IN"||t==="SCTE35-CMD"}class fS{constructor(e,n,i=0){var s;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(n==null?void 0:n.tagAnchor)||null,this.tagOrder=(s=n==null?void 0:n.tagOrder)!=null?s:i,n){const r=n.attr;for(const a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){Pe.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=$e(new tt({}),r,e)}if(this.attr=e,n?(this._startDate=n._startDate,this._cue=n._cue,this._endDate=n._endDate,this._dateAtEnd=n._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=(n==null?void 0:n.endDate)||new Date(this.attr["END-DATE"]);ee(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Pe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const n=this.duration;return n!==null?this._dateAtEnd=new Date(this._startDate.getTime()+n*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ee(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===sI}get isValid(){return!!this.id&&!this._badValueForSameId&&ee(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const lI=10;class oI{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const n=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!n||!this.live,this.advanced=this.endSN>e.endSN||n>0||n===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(n=>{let i=n.decryptdata;return i||(n.setKeyFormat(e.keyFormat),i=n.decryptdata),!!i&&e.matches(i)})}get hasProgramDateTime(){return this.fragments.length?ee(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||lI}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const n=this.lastPartIndex;if(n!==-1){for(let i=e.length;i--;)if(e[i].index>n)return e[i].index;return n}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Bu(t,e){return t.length===e.length?!t.some((n,i)=>n!==e[i]):!1}function Fp(t,e){return!t&&!e?!0:!t||!e?!1:Bu(t,e)}function Ur(t){return t==="AES-128"||t==="AES-256"||t==="AES-256-CTR"}function Hm(t){switch(t){case"AES-128":case"AES-256":return vs.cbc;case"AES-256-CTR":return vs.ctr;default:throw new Error(`invalid full segment method ${t}`)}}function Vm(t){return Uint8Array.from(atob(t),e=>e.charCodeAt(0))}function rh(t){return Uint8Array.from(unescape(encodeURIComponent(t)),e=>e.charCodeAt(0))}function uI(t){const e=rh(t).subarray(0,16),n=new Uint8Array(16);return n.set(e,16-e.length),n}function hS(t){const e=function(i,s,r){const a=i[s];i[s]=i[r],i[r]=a};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function mS(t){const e=t.split(":");let n=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),s=i[i.length-1].split(",");if(s.length===2){const r=s[0]==="base64",a=s[1];r?(i.splice(-1,1),n=Vm(a)):n=uI(a)}}return n}const Uu=typeof self<"u"?self:void 0;var nt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Ct={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Ko(t){switch(t){case Ct.FAIRPLAY:return nt.FAIRPLAY;case Ct.PLAYREADY:return nt.PLAYREADY;case Ct.WIDEVINE:return nt.WIDEVINE;case Ct.CLEARKEY:return nt.CLEARKEY}}function pd(t){switch(t){case nt.FAIRPLAY:return Ct.FAIRPLAY;case nt.PLAYREADY:return Ct.PLAYREADY;case nt.WIDEVINE:return Ct.WIDEVINE;case nt.CLEARKEY:return Ct.CLEARKEY}}function Ma(t){const{drmSystems:e,widevineLicenseUrl:n}=t,i=e?[nt.FAIRPLAY,nt.WIDEVINE,nt.PLAYREADY,nt.CLEARKEY].filter(s=>!!e[s]):[];return!i[nt.WIDEVINE]&&n&&i.push(nt.WIDEVINE),i}const gS=function(t){return Uu!=null&&(t=Uu.navigator)!=null&&t.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function cI(t,e,n,i){let s;switch(t){case nt.FAIRPLAY:s=["cenc","sinf"];break;case nt.WIDEVINE:case nt.PLAYREADY:s=["cenc"];break;case nt.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${t}`)}return dI(s,e,n,i)}function dI(t,e,n,i){return[{initDataTypes:t,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:n.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function fI(t){var e;return!!t&&(t.sessionType==="persistent-license"||!!((e=t.sessionTypes)!=null&&e.some(n=>n==="persistent-license")))}function pS(t){const e=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2),n=String.fromCharCode.apply(null,Array.from(e)),i=n.substring(n.indexOf("<"),n.length),a=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(a){const l=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(l){const o=Vm(l).subarray(0,16);return hS(o),o}}return null}let ur={};class fs{static clearKeyUriToKeyIdMap(){ur={}}static setKeyIdForUri(e,n){ur[e]=n}static addKeyIdForUri(e){const n=Object.keys(ur).length%Number.MAX_SAFE_INTEGER,i=new Uint8Array(16);return new DataView(i.buffer,12,4).setUint32(0,n),ur[e]=i,i}constructor(e,n,i,s=[1],r=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=n,this.keyFormat=i,this.keyFormatVersions=s,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ur(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array(H1(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Bu(e.keyFormatVersions,this.keyFormatVersions)&&Fp(e.iv,this.iv)&&Fp(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ur(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Ct.FAIRPLAY:case Ct.WIDEVINE:case Ct.PLAYREADY:case Ct.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,n){if(!this.encrypted||!this.uri)return null;if(Ur(this.method)){let r=this.iv;return r||(typeof e!="number"&&(Pe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=mI(e)),new fs(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=ur[this.uri];if(r&&!Bu(this.keyId,r)&&fs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const i=mS(this.uri);if(i)switch(this.keyFormat){case Ct.WIDEVINE:if(this.pssh=i,!this.keyId){const r=yC(i.buffer);if(r.length){var s;const a=r[0];this.keyId=(s=a.kids)!=null&&s.length?a.kids[0]:null}}this.keyId||(this.keyId=Bp(n));break;case Ct.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=pC(r,null,i),this.keyId=pS(i);break}default:{let r=i.subarray(0,16);if(r.length!==16){const a=new Uint8Array(16);a.set(r,16-r.length),r=a}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=hI(n),r||(r=Bp(n),r||(r=ur[this.uri])),r&&(this.keyId=r,fs.setKeyIdForUri(this.uri,r))}return this}}function hI(t){const e=t==null?void 0:t[Ct.WIDEVINE];return e?e.keyId:null}function Bp(t){const e=t==null?void 0:t[Ct.PLAYREADY];if(e){const n=mS(e.uri);if(n)return pS(n)}return null}function mI(t){const e=new Uint8Array(16);for(let n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e}const Up=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,jp=/#EXT-X-MEDIA:(.*)/g,gI=/^#EXT(?:INF|-X-TARGETDURATION):/m,yd=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),pI=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class li{static findGroup(e,n){for(let i=0;i<e.length;i++){const s=e[i];if(s.id===n)return s}}static resolve(e,n){return Pm.buildAbsoluteURL(n,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return gI.test(e)}static parseMasterPlaylist(e,n){const i=Mp(e),s={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},r=[];if(Up.lastIndex=0,!e.startsWith("#EXTM3U"))return s.playlistParsingError=new Error("no EXTM3U delimiter"),s;let a;for(;(a=Up.exec(e))!=null;)if(a[1]){var l;const u=new tt(a[1],s),c=sh(s,a[2]),d={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:li.resolve(c,n)},f=u.decimalResolution("RESOLUTION");f&&(d.width=f.width,d.height=f.height),Gp(u.CODECS,d);const h=u["SUPPLEMENTAL-CODECS"];h&&(d.supplemental={},Gp(h,d.supplemental)),(l=d.unknownCodecs)!=null&&l.length||r.push(d),s.levels.push(d)}else if(a[3]){const u=a[3],c=a[4];switch(u){case"SESSION-DATA":{const d=new tt(c,s),f=d["DATA-ID"];f&&(s.sessionData===null&&(s.sessionData={}),s.sessionData[f]=d);break}case"SESSION-KEY":{const d=$p(c,n,s);d.encrypted&&d.isSupported()?(s.sessionKeys===null&&(s.sessionKeys=[]),s.sessionKeys.push(d)):Pe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${c}"`);break}case"DEFINE":{{const d=new tt(c,s);Op(s,d,n)}break}case"CONTENT-STEERING":{const d=new tt(c,s);s.contentSteering={uri:li.resolve(d["SERVER-URI"],n),pathwayId:d["PATHWAY-ID"]||"."};break}case"START":{s.startTimeOffset=zp(c);break}}}const o=r.length>0&&r.length<s.levels.length;return s.levels=o?r:s.levels,s.levels.length===0&&(s.playlistParsingError=new Error("no levels found in manifest")),s}static parseMasterPlaylistMedia(e,n,i){let s;const r={},a=i.levels,l={AUDIO:a.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:a.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(jp.lastIndex=0;(s=jp.exec(e))!==null;){const u=new tt(s[1],i),c=u.TYPE;if(c){const d=l[c],f=r[c]||[];r[c]=f;const h=u.LANGUAGE,m=u["ASSOC-LANGUAGE"],y=u.CHANNELS,x=u.CHARACTERISTICS,p=u["INSTREAM-ID"],v={attrs:u,bitrate:0,id:o++,groupId:u["GROUP-ID"]||"",name:u.NAME||h||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:h,url:u.URI?li.resolve(u.URI,n):""};if(m&&(v.assocLang=m),y&&(v.channels=y),x&&(v.characteristics=x),p&&(v.instreamId=p),d!=null&&d.length){const b=li.findGroup(d,v.groupId)||d[0];Hp(v,b,"audioCodec"),Hp(v,b,"textCodec")}f.push(v)}}return r}static parseLevelPlaylist(e,n,i,s,r,a){var l;const o={url:n},u=new oI(n),c=u.fragments,d=[];let f=null,h=0,m=0,y=0,x=0,p=0,v=null,b=new hd(s,o),E,k,_,L=-1,C=!1,w=null,A;if(yd.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Mp(e),((l=yd.exec(e))==null?void 0:l[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(E=yd.exec(e))!==null;){C&&(C=!1,b=new hd(s,o),b.playlistOffset=y,b.setStart(y),b.sn=h,b.cc=x,p&&(b.bitrate=p),b.level=i,f&&(b.initSegment=f,f.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null),w&&(b.setByteRange(w),w=null)));const G=E[1];if(G){b.duration=parseFloat(G);const $=(" "+E[2]).slice(1);b.title=$||null,b.tagList.push($?["INF",G,$]:["INF",G])}else if(E[3]){if(ee(b.duration)){b.playlistOffset=y,b.setStart(y),_&&Kp(b,_,u),b.sn=h,b.level=i,b.cc=x,c.push(b);const $=(" "+E[3]).slice(1);b.relurl=sh(u,$),ah(b,v,d),v=b,y+=b.duration,h++,m=0,C=!0}}else{if(E=E[0].match(pI),!E){Pe.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<E.length&&E[k]===void 0;k++);const $=(" "+E[k]).slice(1),D=(" "+E[k+1]).slice(1),j=E[k+2]?(" "+E[k+2]).slice(1):null;switch($){case"BYTERANGE":v?b.setByteRange(D,v):b.setByteRange(D);break;case"PROGRAM-DATE-TIME":b.rawProgramDateTime=D,b.tagList.push(["PROGRAM-DATE-TIME",D]),L===-1&&(L=c.length);break;case"PLAYLIST-TYPE":u.type&&xi(u,$,E),u.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?xi(u,$,E):c.length>0&&Yp(u,$,E),h=u.startSN=parseInt(D);break;case"SKIP":{u.skippedSegments&&xi(u,$,E);const U=new tt(D,u),q=U.decimalInteger("SKIPPED-SEGMENTS");if(ee(q)){u.skippedSegments+=q;for(let F=q;F--;)c.push(null);h+=q}const R=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");R&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(R.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&xi(u,$,E),u.targetduration=Math.max(parseInt(D),1);break;case"VERSION":u.version!==null&&xi(u,$,E),u.version=parseInt(D);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||xi(u,$,E),u.live=!1;break;case"#":(D||j)&&b.tagList.push(j?[D,j]:[D]);break;case"DISCONTINUITY":x++,b.tagList.push(["DIS"]);break;case"GAP":b.gap=!0,b.tagList.push([$]);break;case"BITRATE":b.tagList.push([$,D]),p=parseInt(D)*1e3,ee(p)?b.bitrate=p:p=0;break;case"DATERANGE":{const U=new tt(D,u),q=new fS(U,u.dateRanges[U.ID],u.dateRangeTagCount);u.dateRangeTagCount++,q.isValid||u.skippedSegments?u.dateRanges[q.id]=q:Pe.warn(`Ignoring invalid DATERANGE tag: "${D}"`),b.tagList.push(["EXT-X-DATERANGE",D]);break}case"DEFINE":{{const U=new tt(D,u);"IMPORT"in U?nI(u,U,a):Op(u,U,n)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?xi(u,$,E):c.length>0&&Yp(u,$,E),u.startCC=x=parseInt(D);break;case"KEY":{const U=$p(D,n,u);if(U.isSupported()){if(U.method==="NONE"){_=void 0;break}_||(_={});const q=_[U.keyFormat];q!=null&&q.matches(U)||(q&&(_=$e({},_)),_[U.keyFormat]=U)}else Pe.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${D}"`);break}case"START":u.startTimeOffset=zp(D);break;case"MAP":{const U=new tt(D,u);if(b.duration){const q=new hd(s,o);Vp(q,U,i,_),f=q,b.initSegment=f,f.rawProgramDateTime&&!b.rawProgramDateTime&&(b.rawProgramDateTime=f.rawProgramDateTime)}else{const q=b.byteRangeEndOffset;if(q){const R=b.byteRangeStartOffset;w=`${q-R}@${R}`}else w=null;Vp(b,U,i,_),f=b,C=!0}f.cc=x;break}case"SERVER-CONTROL":{A&&xi(u,$,E),A=new tt(D),u.canBlockReload=A.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=A.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&A.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=A.optionalFloat("PART-HOLD-BACK",0),u.holdBack=A.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&xi(u,$,E);const U=new tt(D);u.partTarget=U.decimalFloatingPoint("PART-TARGET");break}case"PART":{let U=u.partList;U||(U=u.partList=[]);const q=m>0?U[U.length-1]:void 0,R=m++,F=new tt(D,u),B=new nC(F,b,o,R,q);U.push(B),b.duration+=B.duration;break}case"PRELOAD-HINT":{const U=new tt(D,u);u.preloadHint=U;break}case"RENDITION-REPORT":{const U=new tt(D,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(U);break}default:Pe.warn(`line parsed but not handled: ${E}`);break}}}v&&!v.relurl?(c.pop(),y-=v.duration,u.partList&&(u.fragmentHint=v)):u.partList&&(ah(b,v,d),b.cc=x,u.fragmentHint=b,_&&Kp(b,_,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const I=c.length,N=c[0],V=c[I-1];if(y+=u.skippedSegments*u.targetduration,y>0&&I&&V){u.averagetargetduration=y/I;const G=V.sn;u.endSN=G!=="initSegment"?G:0,u.live||(V.endList=!0),L>0&&(xI(c,L),N&&d.unshift(N))}return u.fragmentHint&&(y+=u.fragmentHint.duration),u.totalduration=y,d.length&&u.dateRangeTagCount&&N&&yS(d,u),u.endCC=x,u}}function yS(t,e){let n=t.length;if(!n)if(e.hasProgramDateTime){const l=e.fragments[e.fragments.length-1];t.push(l),n++}else return;const i=t[n-1],s=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let l=r.length;l--;){const o=e.dateRanges[r[l]],u=o.startDate.getTime();o.tagAnchor=i.ref;for(let c=n;c--;){var a;if(((a=t[c])==null?void 0:a.sn)<e.startSN)break;const d=yI(e,u,t,c,s);if(d!==-1){o.tagAnchor=e.fragments[d].ref;break}}}}function yI(t,e,n,i,s){const r=n[i];if(r){const l=r.programDateTime;if(e>=l||i===0){var a;const o=(((a=n[i+1])==null?void 0:a.start)||s)-r.start;if(e<=l+o*1e3){const u=n[i].sn-t.startSN;if(u<0)return-1;const c=t.fragments;if(c.length>n.length){const f=(n[i+1]||c[c.length-1]).sn-t.startSN;for(let h=f;h>u;h--){const m=c[h].programDateTime;if(e>=m&&e<m+c[h].duration*1e3)return h}}return u}}}return-1}function $p(t,e,n){var i,s;const r=new tt(t,n),a=(i=r.METHOD)!=null?i:"",l=r.URI,o=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,c=(s=r.KEYFORMAT)!=null?s:"identity";l&&r.IV&&!o&&Pe.error(`Invalid IV: ${r.IV}`);const d=l?li.resolve(l,e):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new fs(a,d,c,f,o,r.KEYID)}function zp(t){const n=new tt(t).decimalFloatingPoint("TIME-OFFSET");return ee(n)?n:null}function Gp(t,e){let n=(t||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const s=n.filter(r=>Um(r,i));s.length&&(e[`${i}Codec`]=s.map(r=>r.split("/")[0]).join(","),n=n.filter(r=>s.indexOf(r)===-1))}),e.unknownCodecs=n}function Hp(t,e,n){const i=e[n];i&&(t[n]=i)}function xI(t,e){let n=t[e];for(let i=e;i--;){const s=t[i];if(!s)return;s.programDateTime=n.programDateTime-s.duration*1e3,n=s}}function ah(t,e,n){t.rawProgramDateTime?n.push(t):e!=null&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime)}function Vp(t,e,n,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=n,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function Kp(t,e,n){t.levelkeys=e;const{encryptedFragments:i}=n;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(s=>e[s].isCommonEncryption)&&i.push(t)}function xi(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${n[0]})`)}function Yp(t,e,n){t.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${n[0]})`)}function xd(t,e){const n=e.startPTS;if(ee(n)){let i=0,s;e.sn>t.sn?(i=n-t.start,s=t):(i=t.start-n,s=e),s.duration!==i&&s.setDuration(i)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.setStart(t.start+(t.minEndPTS-t.start)):e.setStart(t.start+t.duration):e.setStart(Math.max(t.start-e.duration,0))}function xS(t,e,n,i,s,r,a){i-n<=0&&(a.warn("Fragment should have a positive duration",e),i=n+e.duration,r=s+e.duration);let o=n,u=i;const c=e.startPTS,d=e.endPTS;if(ee(c)){const p=Math.abs(c-n);t&&p>t.totalduration?a.warn(`media timestamps and playlist times differ by ${p}s for level ${e.level} ${t.url}`):ee(e.deltaPTS)?e.deltaPTS=Math.max(p,e.deltaPTS):e.deltaPTS=p,o=Math.max(n,c),n=Math.min(n,c),s=e.startDTS!==void 0?Math.min(s,e.startDTS):s,u=Math.min(i,d),i=Math.max(i,d),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const f=n-e.start;e.start!==0&&e.setStart(n),e.setDuration(i-e.start),e.startPTS=n,e.maxStartPTS=o,e.startDTS=s,e.endPTS=i,e.minEndPTS=u,e.endDTS=r;const h=e.sn;if(!t||h<t.startSN||h>t.endSN)return 0;let m;const y=h-t.startSN,x=t.fragments;for(x[y]=e,m=y;m>0;m--)xd(x[m],x[m-1]);for(m=y;m<x.length-1;m++)xd(x[m],x[m+1]);return t.fragmentHint&&xd(x[x.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,f}function vI(t,e,n){if(t===e)return;let i=null;const s=t.fragments;for(let c=s.length-1;c>=0;c--){const d=s[c].initSegment;if(d){i=d;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;let r;EI(t,e,(c,d,f,h)=>{if((!e.startCC||e.skippedSegments)&&d.cc!==c.cc){const m=c.cc-d.cc;for(let y=f;y<h.length;y++)h[y].cc+=m;e.endCC=h[h.length-1].cc}ee(c.startPTS)&&ee(c.endPTS)&&(d.setStart(d.startPTS=c.startPTS),d.startDTS=c.startDTS,d.maxStartPTS=c.maxStartPTS,d.endPTS=c.endPTS,d.endDTS=c.endDTS,d.minEndPTS=c.minEndPTS,d.setDuration(c.endPTS-c.startPTS),d.duration&&(r=d),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(d.elementaryStreams=c.elementaryStreams),d.loader=c.loader,c.hasStats&&(d.stats=c.stats),c.initSegment&&(d.initSegment=c.initSegment,i=c.initSegment)});const a=e.fragments,l=e.fragmentHint?a.concat(e.fragmentHint):a;if(i&&l.forEach(c=>{var d;c&&(!c.initSegment||c.initSegment.relurl===((d=i)==null?void 0:d.relurl))&&(c.initSegment=i)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){n.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=bI(t.dateRanges,e,n));const c=t.fragments.filter(d=>d.rawProgramDateTime);if(t.hasProgramDateTime&&!e.hasProgramDateTime)for(let d=1;d<l.length;d++)l[d].programDateTime===null&&ah(l[d],l[d-1],c);yS(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var o;const c=SS(t,e.startSN-1);e.startCC=(o=c==null?void 0:c.cc)!=null?o:a[0].cc}SI(t.partList,e.partList,(c,d)=>{d.elementaryStreams=c.elementaryStreams,d.stats=c.stats}),r?xS(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,n):vS(t,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const c=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=c),e.driftEndTime=u,e.driftEnd=c}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=t.requestScheduled)}function bI(t,e,n){const{dateRanges:i,recentlyRemovedDateranges:s}=e,r=$e({},t);s&&s.forEach(o=>{delete r[o]});const l=Object.keys(r).length;return l?(Object.keys(i).forEach(o=>{const u=r[o],c=new fS(i[o].attr,u);c.isValid?(r[o]=c,u||(c.tagOrder+=l)):n.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ge(i[o].attr)}"`)}),r):i}function SI(t,e,n){if(t&&e){let i=0;for(let s=0,r=t.length;s<=r;s++){const a=t[s],l=e[s+i];a&&l&&a.index===l.index&&a.fragment.sn===l.fragment.sn?n(a,l):i--}}}function EI(t,e,n){const i=e.skippedSegments,s=Math.max(t.startSN,e.startSN)-e.startSN,r=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;for(let u=s;u<=r;u++){const c=o[a+u];let d=l[u];if(i&&!d&&c&&(d=e.fragments[u]=c),c&&d){n(c,d,u,l);const f=c.relurl,h=d.relurl;if(f&&TI(f,h)){e.playlistParsingError=qp(`media sequence mismatch ${d.sn}:`,t,e,c,d);return}else if(c.cc!==d.cc){e.playlistParsingError=qp(`discontinuity sequence mismatch (${c.cc}!=${d.cc})`,t,e,c,d);return}}}}function qp(t,e,n,i,s){return new Error(`${t} ${s.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${n.startSN}
${n.m3u8}`)}function vS(t,e,n=!0){const i=e.startSN+e.skippedSegments-t.startSN,s=t.fragments,r=i>=0;let a=0;if(r&&i<s.length)a=s[i].start;else if(r&&e.startSN===t.endSN+1)a=t.fragmentEnd;else if(r&&n)a=t.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=t.fragmentStart;else return;lh(e,a)}function lh(t,e){if(e){const n=t.fragments;for(let i=t.skippedSegments;i<n.length;i++)n[i].addStart(e);t.fragmentHint&&t.fragmentHint.addStart(e)}}function bS(t,e=1/0){let n=1e3*t.targetduration;if(t.updated){const i=t.fragments;if(i.length&&n*4>e){const r=i[i.length-1].duration*1e3;r<n&&(n=r)}}else n/=2;return Math.round(n)}function SS(t,e,n){if(!t)return null;let i=t.fragments[e-t.startSN];return i||(i=t.fragmentHint,i&&i.sn===e)?i:e<t.startSN&&n&&n.sn===e?n:null}function Xp(t,e,n){return t?ES(t.partList,e,n):null}function ES(t,e,n){if(t)for(let i=t.length;i--;){const s=t[i];if(s.index===n&&s.fragment.sn===e)return s}return null}function TS(t){t.forEach((e,n)=>{var i;(i=e.details)==null||i.fragments.forEach(s=>{s.level=n,s.initSegment&&(s.initSegment.level=n)})})}function TI(t,e){return t!==e&&e?Qp(t)!==Qp(e):!1}function Qp(t){return t.replace(/\?[^?]*$/,"")}function Xa(t,e){for(let i=0,s=t.length;i<s;i++){var n;if(((n=t[i])==null?void 0:n.cc)===e)return t[i]}return null}function AI(t,e){return!!(t&&e.startCC<t.endCC&&e.endCC>t.startCC)}function Wp(t,e){const n=t.start+e;t.startPTS=n,t.setStart(n),t.endPTS=n+t.duration}function AS(t,e){const n=e.fragments;for(let i=0,s=n.length;i<s;i++)Wp(n[i],t);e.fragmentHint&&Wp(e.fragmentHint,t),e.alignedSliding=!0}function kI(t,e){t&&(kS(e,t),e.alignedSliding||ju(e,t),!e.alignedSliding&&!e.skippedSegments&&vS(t,e,!1))}function kS(t,e){if(!AI(e,t))return;const n=Math.min(e.endCC,t.endCC),i=Xa(e.fragments,n),s=Xa(t.fragments,n);if(!i||!s)return;Pe.log(`Aligning playlist at start of dicontinuity sequence ${n}`);const r=i.start-s.start;AS(r,t)}function ju(t,e){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;const n=t.fragments,i=e.fragments;if(!n.length||!i.length)return;let s,r;const a=Math.min(e.endCC,t.endCC);e.startCC<a&&t.startCC<a&&(s=Xa(i,a),r=Xa(n,a)),(!s||!r)&&(s=i[Math.floor(i.length/2)],r=Xa(n,s.cc)||n[Math.floor(n.length/2)]);const l=s.programDateTime,o=r.programDateTime;if(!l||!o)return;const u=(o-l)/1e3-(r.start-s.start);AS(u,t)}function zt(t,e,n){Wt(t,e,n),t.addEventListener(e,n)}function Wt(t,e,n){t.removeEventListener(e,n)}const _I={toString:function(t){let e="";const n=t.length;for(let i=0;i<n;i++)e+=`[${t.start(i).toFixed(3)}-${t.end(i).toFixed(3)}]`;return e}},H={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Km extends cS{constructor(e,n,i,s,r){super(s,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=H.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:l,media:o,mediaBuffer:u,state:c}=this,d=o?o.currentTime:0,f=he.bufferInfo(u||o,d,a.maxBufferHole),h=!f.len;if(this.log(`Media seeking to ${ee(d)?d.toFixed(3):d}, state: ${c}, ${h?"out of":"in"} buffer`),this.state===H.ENDED)this.resetLoadingState();else if(l){const m=a.maxFragLookUpTolerance,y=l.start-m,x=l.start+l.duration+m;if(h||x<f.start||y>f.end){const p=d>x;(d<y||p)&&(p&&l.loader&&(this.log(`Cancelling fragment load for seek (sn: ${l.sn})`),l.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(o){this.fragmentTracker.removeFragmentsInRange(d,1/0,this.playlistType,!0);const m=this.lastCurrentTime;if(d>m&&(this.lastCurrentTime=d),!this.loadingParts){const y=Math.max(f.end,d),x=this.shouldLoadParts(this.getLevelDetails(),y);x&&(this.log(`LL-Part loading ON after seeking to ${d.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=x)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${d} for seek without enough to start`),this.nextLoadPosition=d,h&&(this.startPosition=d)),h&&this.state===H.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new eI(e.config),this.keyLoader=i,this.fragmentTracker=n,this.config=e.config,this.decrypter=new zm(e.config)}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===H.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=H.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:n}=this;return n===-1&&e?e:n}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,n){if(n.live||!this.media)return!1;const i=e.end||0,s=this.config.timelineOffset||0;if(i<=s)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=he.bufferedInfo(r,e.start,0));const a=e.nextStart;if(a&&a>s&&a<n.edge||this.media.currentTime<e.start)return!1;const o=n.partList;if(o!=null&&o.length){const c=o[o.length-1];return he.isBuffered(this.media,c.start+c.duration/2)}const u=n.fragments[n.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var n;return((n=this.getLevelDetails())==null?void 0:n.appliedTimelineOffset)||e}return 0}onMediaAttached(e,n){const i=this.media=this.mediaBuffer=n.media;zt(i,"seeking",this.onMediaSeeking),zt(i,"ended",this.onMediaEnded);const s=this.config;this.levels&&s.autoStartLoad&&this.state===H.STOPPED&&this.startLoad(s.startPosition)}onMediaDetaching(e,n){const i=!!n.transferMedia,s=this.media;if(s!==null){if(s.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Wt(s,"seeking",this.onMediaSeeking),Wt(s,"ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,n){}onManifestLoaded(e,n){this.startTimeOffset=n.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=H.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,n,i){this.startFragRequested=!0,this._loadFragForPlayback(e,n,i)}_loadFragForPlayback(e,n,i){const s=r=>{const a=r.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(a,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,n,i,s).then(r=>{if(!r)return;const a=this.state,l=r.frag;if(this.fragContextChanged(l)){(a===H.FRAG_LOADING||!this.fragCurrent&&a===H.PARSING)&&(this.fragmentTracker.removeFragment(l),this.state=H.IDLE);return}"payload"in r&&(this.log(`Loaded ${l.type} sn: ${l.sn} of ${this.playlistLabel()} ${l.level}`),this.hls.trigger(S.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===H.STOPPED||this.state===H.ERROR||(this.warn(`Frag error: ${(r==null?void 0:r.message)||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var n;const{fragmentTracker:i}=this;if(i.getState(e)===bt.APPENDING){const r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),l=Math.max(e.duration,a?a.len:this.config.maxBufferLength),o=this.backtrackFragment;((o?e.sn-o.sn:0)===1||this.reduceMaxBufferLength(l,e.duration))&&i.removeFragment(e)}else((n=this.mediaBuffer)==null?void 0:n.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===bt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const n=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:n,part:null,stats:n.stats,id:n.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const n=e.details;return(n==null?void 0:n.live)&&n.type!=="EVENT"&&(this.levelLastLoaded!==e||n.expired)}flushMainBuffer(e,n,i=null){if(!(e-n))return;const s={startOffset:e,endOffset:n,type:i};this.hls.trigger(S.BUFFER_FLUSHING,s)}_loadInitSegment(e,n){this._doFragLoad(e,n).then(i=>{const s=i==null?void 0:i.frag;if(!s||this.fragContextChanged(s)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:s}=this,{frag:r,payload:a}=i,l=r.decryptdata;if(a&&a.byteLength>0&&l!=null&&l.key&&l.iv&&Ur(l.method)){const o=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),l.key.buffer,l.iv.buffer,Hm(l.method)).catch(u=>{throw s.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const c=self.performance.now();return s.trigger(S.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:o,tdecrypt:c}}),i.payload=u,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===H.STOPPED||this.state===H.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:n}=this;if(!n)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==H.STOPPED&&(this.state=H.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,n){var i,s;const r=e.tracks;if(r&&!n.encrypted&&((i=r.audio)!=null&&i.encrypted||(s=r.video)!=null&&s.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,l=new Error(`Encrypted track with no key in ${this.fragInfo(n)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(l.message),!a||a.mediaKeys?!1:(this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,fatal:!1,error:l,frag:n}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:n}=this;return!e||!n||e.sn!==n.sn||e.level!==n.level}fragBufferedComplete(e,n){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${n?" part: "+n.index:""} of ${this.fragInfo(e,!1,n)} > buffer:${i?_I.toString(he.getBuffered(i)):"(detached)"})`),ut(e)){var s;if(e.type!==ne.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(l=>!!a[l])){this.state=H.IDLE;return}}const r=(s=this.levels)==null?void 0:s[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=H.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:n}=this;if(!n)return;const{frag:i,part:s,partsLoaded:r}=e,a=!r||r.length===0||r.some(o=>!o),l=new Gm(i.level,i.sn,i.stats.chunkCount+1,0,s?s.index:-1,!a);n.flush(l)}_handleFragmentLoadProgress(e){}_doFragLoad(e,n,i=null,s){var r;this.fragCurrent=e;const a=n.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let l=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=H.KEY_LOADING,this.fragCurrent=e,l=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(S.KEY_LOADED,f),this.state===H.KEY_LOADING&&(this.state=H.IDLE),f}),this.hls.trigger(S.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(l=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),l&&this.log("[eme] blocking frag load until media-keys acquired"));const o=this.fragPrevious;if(ut(e)&&(!o||e.sn!==o.sn)){const f=this.shouldLoadParts(n.details,e.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} loading sn ${o==null?void 0:o.sn}->${e.sn}`),this.loadingParts=f)}if(i=Math.max(e.start,i||0),this.loadingParts&&ut(e)){const f=a.partList;if(f&&s){i>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(f,e,i);if(h>-1){const m=f[h];e=this.fragCurrent=m.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${m.index} (${h}/${f.length-1}) of ${this.fragInfo(e,!1,m)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=m.start+m.duration,this.state=H.FRAG_LOADING;let y;return l?y=l.then(x=>!x||this.fragContextChanged(x.frag)?null:this.doFragPartsLoad(e,m,n,s)).catch(x=>this.handleFragLoadError(x)):y=this.doFragPartsLoad(e,m,n,s).catch(x=>this.handleFragLoadError(x)),this.hls.trigger(S.FRAG_LOADING,{frag:e,part:m,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,i))return Promise.resolve(null)}}if(ut(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=a.partList)==null?void 0:u.filter(f=>f.loaded).map(f=>`[${f.start}-${f.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(i.toFixed(3))}`),ee(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=H.FRAG_LOADING;const c=this.config.progressive&&e.type!==ne.SUBTITLE;let d;return c&&l?d=l.then(f=>!f||this.fragContextChanged(f.frag)?null:this.fragmentLoader.load(e,s)).catch(f=>this.handleFragLoadError(f)):d=Promise.all([this.fragmentLoader.load(e,c?s:void 0),l]).then(([f])=>(!c&&s&&s(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(S.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d}doFragPartsLoad(e,n,i,s){return new Promise((r,a)=>{var l;const o=[],u=(l=i.details)==null?void 0:l.partList,c=d=>{this.fragmentLoader.loadPart(e,d,s).then(f=>{o[d.index]=f;const h=f.part;this.hls.trigger(S.FRAG_LOADED,f);const m=Xp(i.details,e.sn,d.index+1)||ES(u,e.sn,d.index+1);if(m)c(m);else return r({frag:e,part:h,partsLoaded:o})}).catch(a)};c(n)})}handleFragLoadError(e){if("data"in e){const n=e.data;n.frag&&n.details===O.INTERNAL_ABORTED?this.handleFragLoadAborted(n.frag,n.part):n.frag&&n.type===re.KEY_SYSTEM_ERROR?(n.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(n.frag)):this.hls.trigger(S.ERROR,n)}else this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const n=this.getCurrentContext(e);if(!n||this.state!==H.PARSING){!this.fragCurrent&&this.state!==H.STOPPED&&this.state!==H.ERROR&&(this.state=H.IDLE);return}const{frag:i,part:s,level:r}=n,a=self.performance.now();i.stats.parsing.end=a,s&&(s.stats.parsing.end=a);const l=this.getLevelDetails(),u=l&&i.sn>l.endSN||this.shouldLoadParts(l,i.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(i,s,r,e.partial)}shouldLoadParts(e,n){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var i;const r=e.partList[0];if(r.fragment.type===ne.SUBTITLE)return!1;const a=r.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(n>=a){var s;if((this.hls.hasEnoughToStart?((s=this.media)==null?void 0:s.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:n,fragCurrent:i}=this,{level:s,sn:r,part:a}=e;if(!(n!=null&&n[s]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${s}. The current chunk will not be buffered.`),null;const l=n[s],o=l.details,u=a>-1?Xp(o,r,a):null,c=u?u.fragment:SS(o,r,i);return c?(i&&i!==c&&(c.stats=i.stats),{frag:c,part:u,level:l}):null}bufferFragmentData(e,n,i,s,r){if(this.state!==H.PARSING)return;const{data1:a,data2:l}=e;let o=a;if(l&&(o=Bn(a,l)),!o.length)return;const u=this.initPTS[n.cc],c=u?-u.baseTime/u.timescale:void 0,d={type:e.type,frag:n,part:i,chunkMeta:s,offset:c,parent:n.type,data:o};if(this.hls.trigger(S.BUFFER_APPENDING,d),e.dropped&&e.independent&&!i){if(r)return;this.flushBufferGap(n)}}flushBufferGap(e){const n=this.media;if(!n)return;if(!he.isBuffered(n,n.currentTime)){this.flushMainBuffer(0,e.start);return}const i=n.currentTime,s=he.bufferInfo(n,i,0),r=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),l=Math.max(Math.min(e.start-a,s.end-a),i+a);e.start-l>a&&this.flushMainBuffer(l,e.start)}getFwdBufferInfo(e,n){var i;const s=this.getLoadPosition();if(!ee(s))return null;const a=this.lastCurrentTime>s||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,s,n,a)}getFwdBufferInfoAtPos(e,n,i,s){const r=he.bufferInfo(e,n,s);if(r.len===0&&r.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(n,i);if(a&&(r.nextStart<=a.end||a.gap)){const l=Math.max(Math.min(r.nextStart,a.end)-n,s);return he.bufferInfo(e,n,l)}}return r}getMaxBufferLength(e){const{config:n}=this;let i;return e?i=Math.max(8*n.maxBufferSize/e,n.maxBufferLength):i=n.maxBufferLength,Math.min(i,n.maxMaxBufferLength)}reduceMaxBufferLength(e,n){const i=this.config,s=Math.max(Math.min(e-n,i.maxBufferLength),n),r=Math.max(e-n*3,i.maxMaxBufferLength/2,s);return r>=s?(i.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,n=ne.MAIN){const i=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,n):null;return i&&"fragment"in i?i.fragment:i}getNextFragment(e,n){const i=n.fragments,s=i.length;if(!s)return null;const{config:r}=this,a=i[0].start,l=r.lowLatencyMode&&!!n.partList;let o=null;if(n.live){const d=r.initialLiveManifestSize;if(s<d)return this.warn(`Not enough fragments to start playback (have: ${s}, need: ${d})`),null;if(!n.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var u;l&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(n);const f=this.hls.startPosition,h=this.hls.liveSyncPosition,m=o?(f!==-1&&f>=a?f:h)||o.start:e;this.log(`Setting startPosition to ${m} to match start frag at live edge. mainStart: ${f} liveSyncPosition: ${h} frag.start: ${(u=o)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=m}}else e<=a&&(o=i[0]);if(!o){const d=this.loadingParts?n.partEnd:n.fragmentEnd;o=this.getFragmentAtPosition(e,d,n)}let c=this.filterReplacedPrimary(o,n);if(!c&&o){const d=o.sn-n.startSN;c=this.filterReplacedPrimary(i[d+1]||null,n)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(e,n){const i=this.fragmentTracker.getState(e);return(i===bt.OK||i===bt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>n}getNextFragmentLoopLoading(e,n,i,s,r){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,n),a&&!a.gap&&i.nextStart)){const l=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,s,0);if(l!==null&&i.len+l.len>=r){const o=a.sn;return this.loopSn!==o&&(this.log(`buffer full after gaps in "${s}" playlist starting at sn: ${o}`),this.loopSn=o),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Zp(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,n){if(!e)return e;if(Zp(this.config)&&e.type!==ne.SUBTITLE){const i=this.hls.interstitialsManager,s=i==null?void 0:i.bufferingItem;if(s){const a=s.event;if(a){if(a.appendInPlace||Math.abs(e.start-s.start)>1||s.start===0)return null}else if(e.end<=s.start&&(n==null?void 0:n.live)===!1||e.start>s.end&&s.nextEvent&&(s.nextEvent.appendInPlace||e.start-s.end>1))return null}const r=i==null?void 0:i.playerQueue;if(r)for(let a=r.length;a--;){const l=r[a].interstitial;if(l.appendInPlace&&e.start>=l.startTime&&e.end<=l.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,n,i){let s=-1,r=!1,a=!0;for(let l=0,o=e.length;l<o;l++){const u=e[l];if(a=a&&!u.independent,s>-1&&i<u.start)break;const c=u.loaded;c?s=-1:(r||(u.independent||a)&&u.fragment===n)&&(u.fragment!==n&&this.warn(`Need buffer at ${i} but next unloaded part starts at ${u.start}`),s=l),r=c}return s}loadedEndOfParts(e,n){let i;for(let s=e.length;s--;){if(i=e[s],!i.loaded)return!1;if(n>i.start)return!0}return!1}getInitialLiveFragment(e){const n=e.fragments,i=this.fragPrevious;let s=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),s=zC(n,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!s){const r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){const a=n[r-e.startSN];i.cc===a.cc&&(s=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${s.sn}`))}s||(s=lS(e,i.cc,i.end),s&&this.log(`Live playlist, switching playlist, load frag with same CC: ${s.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(s=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return s}getFragmentAtPosition(e,n,i){const{config:s}=this;let{fragPrevious:r}=this,{fragments:a,endSN:l}=i;const{fragmentHint:o}=i,{maxFragLookUpTolerance:u}=s,c=i.partList,d=!!(this.loadingParts&&c!=null&&c.length&&o);d&&!this.bitrateTest&&c[c.length-1].fragment.sn===o.sn&&(a=a.concat(o),l=o.sn);let f;if(e<n){var h;const y=e<this.lastCurrentTime||e>n-u||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:u;f=Xs(r,a,e,y)}else f=a[a.length-1];if(f){const m=f.sn-i.startSN,y=this.fragmentTracker.getState(f);if((y===bt.OK||y===bt.PARTIAL&&f.gap)&&(r=f),r&&f.sn===r.sn&&(!d||c[0].fragment.sn>f.sn||!i.live)&&f.level===r.level){const p=a[m+1];f.sn<l&&this.fragmentTracker.getState(p)!==bt.OK?f=p:f=null}}return f}alignPlaylists(e,n,i){const s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,a=!n,l=e.alignedSliding&&ee(r);if(a||!l&&!r){kI(i,e);const o=e.fragmentStart;return this.log(`Live playlist sliding: ${o.toFixed(2)} start-sn: ${n?n.startSN:"na"}->${e.startSN} fragments: ${s}`),o}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,n){let i=this.startPosition;i<n&&(i=-1);const s=this.timelineOffset;if(i===-1){const r=this.startTimeOffset!==null,a=r?this.startTimeOffset:e.startTimeOffset;a!==null&&ee(a)?(i=n+a,a<0&&(i+=e.edge),i=Math.min(Math.max(n,i),n+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${a} found in ${r?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||n,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+s}this.nextLoadPosition=i+s}getLoadPosition(){var e;const{media:n}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&n?i=n.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,n){this.transmuxer&&e.type===this.playlistType&&ut(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${n?" part "+n.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==H.FRAG_LOADING_WAITING_RETRY)&&(this.state=H.IDLE)}onFragmentOrKeyLoadError(e,n){var i;if(n.chunkMeta&&!n.frag){const p=this.getCurrentContext(n.chunkMeta);p&&(n.frag=p.frag)}const s=n.frag;if(!s||s.type!==e||!this.levels)return;if(this.fragContextChanged(s)){var r;this.warn(`Frag load error must match current frag to retry ${s.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=n.details===O.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(s,!0);const l=n.errorAction;if(!l){this.state=H.ERROR;return}const{action:o,flags:u,retryCount:c=0,retryConfig:d}=l,f=!!d,h=f&&o===Rt.RetryRequest,m=f&&!l.resolved&&u===cn.MoveAllAlternatesMatchingHost,y=(i=this.hls.latestLevelDetails)==null?void 0:i.live;if(!h&&m&&ut(s)&&!s.endList&&y&&!uS(n))this.resetFragmentErrors(e),this.treatAsGap(s),l.resolved=!0;else if((h||m)&&c<d.maxNumRetry){var x;const p=ih((x=n.response)==null?void 0:x.code),v=$m(d,c);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+v,this.state=H.FRAG_LOADING_WAITING_RETRY,l.resolved=!0,p){this.log("Waiting for connection (offline)"),this.retryDate=1/0,n.reason="offline";return}this.warn(`Fragment ${s.sn} of ${e} ${s.level} errored with ${n.details}, retrying loading ${c+1}/${d.maxNumRetry} in ${v}ms`)}else if(d)if(this.resetFragmentErrors(e),c<d.maxNumRetry)!a&&o!==Rt.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${n.details} reached or exceeded max retry (${c})`);return}else o===Rt.SendAlternateToPenaltyBox?this.state=H.WAITING_LEVEL:this.state=H.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),n=this.retryDate,i=n===1/0;(!n||e>=n||i&&!ih(0))&&(i&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=H.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===H.PARSING||this.state===H.PARSED){const n=e.frag,i=e.parent,s=this.getFwdBufferInfo(this.mediaBuffer,i),r=s&&s.len>.5;r&&this.reduceMaxBufferLength(s.len,(n==null?void 0:n.duration)||10);const a=!r;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${i} buffer`),n&&(this.fragmentTracker.removeFragment(n),this.nextLoadPosition=n.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===ne.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==H.STOPPED&&(this.state=H.IDLE)}afterBufferFlushed(e,n,i){if(!e)return;const s=he.getBuffered(e);this.fragmentTracker.detectEvictedFragments(n,s,i),this.state===H.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==H.STOPPED&&(this.state=H.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,n=e?e.details:null;n!=null&&n.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(n,n.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,n,i,s){const r=i.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((o,u)=>{const c=e.elementaryStreams[u];if(c){const d=c.endPTS-c.startPTS;if(d<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${d})`),o||!1;const f=s?0:xS(r,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS,this);return this.hls.trigger(S.LEVEL_PTS_UPDATED,{details:r,level:i,drift:f,type:u,frag:e,start:c.startPTS,end:c.endPTS}),!0}return o},!1)){var l;const o=((l=this.transmuxer)==null?void 0:l.error)===null;if((i.fragmentError===0||o&&(i.fragmentError<2||e.endList))&&this.treatAsGap(e,i),o){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=H.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${n?" part: "+n.index:""} of ${this.fragInfo(e,!1,n)})`),this.hls.trigger(S.FRAG_PARSED,{frag:e,part:n})}playlistLabel(){return this.playlistType===ne.MAIN?"level":"track"}fragInfo(e,n=!0,i){var s,r;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((s=n&&!i?e.startPTS:(i||e).start)!=null?s:NaN).toFixed(3)}-${((r=n&&!i?e.endPTS:(i||e).end)!=null?r:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,n){n&&n.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const n=this._state;n!==e&&(this._state=e,this.log(`${n}->${e}`))}get state(){return this._state}}function Zp(t){return!!t.interstitialsController&&t.enableInterstitialPlayback!==!1}class _S{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:n}=this;let i;if(e.length)e.length===1?i=e[0]:i=LI(e,n);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function LI(t,e){const n=new Uint8Array(e);let i=0;for(let s=0;s<t.length;s++){const r=t[s];n.set(r,i),i+=r.length}return n}var vd={exports:{}},Jp;function RI(){return Jp||(Jp=1,function(t){var e=Object.prototype.hasOwnProperty,n="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(n=!1));function s(o,u,c){this.fn=o,this.context=u,this.once=c||!1}function r(o,u,c,d,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var h=new s(c,d||o,f),m=n?n+u:u;return o._events[m]?o._events[m].fn?o._events[m]=[o._events[m],h]:o._events[m].push(h):(o._events[m]=h,o._eventsCount++),o}function a(o,u){--o._eventsCount===0?o._events=new i:delete o._events[u]}function l(){this._events=new i,this._eventsCount=0}l.prototype.eventNames=function(){var u=[],c,d;if(this._eventsCount===0)return u;for(d in c=this._events)e.call(c,d)&&u.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},l.prototype.listeners=function(u){var c=n?n+u:u,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,h=d.length,m=new Array(h);f<h;f++)m[f]=d[f].fn;return m},l.prototype.listenerCount=function(u){var c=n?n+u:u,d=this._events[c];return d?d.fn?1:d.length:0},l.prototype.emit=function(u,c,d,f,h,m){var y=n?n+u:u;if(!this._events[y])return!1;var x=this._events[y],p=arguments.length,v,b;if(x.fn){switch(x.once&&this.removeListener(u,x.fn,void 0,!0),p){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,c),!0;case 3:return x.fn.call(x.context,c,d),!0;case 4:return x.fn.call(x.context,c,d,f),!0;case 5:return x.fn.call(x.context,c,d,f,h),!0;case 6:return x.fn.call(x.context,c,d,f,h,m),!0}for(b=1,v=new Array(p-1);b<p;b++)v[b-1]=arguments[b];x.fn.apply(x.context,v)}else{var E=x.length,k;for(b=0;b<E;b++)switch(x[b].once&&this.removeListener(u,x[b].fn,void 0,!0),p){case 1:x[b].fn.call(x[b].context);break;case 2:x[b].fn.call(x[b].context,c);break;case 3:x[b].fn.call(x[b].context,c,d);break;case 4:x[b].fn.call(x[b].context,c,d,f);break;default:if(!v)for(k=1,v=new Array(p-1);k<p;k++)v[k-1]=arguments[k];x[b].fn.apply(x[b].context,v)}}return!0},l.prototype.on=function(u,c,d){return r(this,u,c,d,!1)},l.prototype.once=function(u,c,d){return r(this,u,c,d,!0)},l.prototype.removeListener=function(u,c,d,f){var h=n?n+u:u;if(!this._events[h])return this;if(!c)return a(this,h),this;var m=this._events[h];if(m.fn)m.fn===c&&(!f||m.once)&&(!d||m.context===d)&&a(this,h);else{for(var y=0,x=[],p=m.length;y<p;y++)(m[y].fn!==c||f&&!m[y].once||d&&m[y].context!==d)&&x.push(m[y]);x.length?this._events[h]=x.length===1?x[0]:x:a(this,h)}return this},l.prototype.removeAllListeners=function(u){var c;return u?(c=n?n+u:u,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,t.exports=l}(vd)),vd.exports}var wI=RI(),Ym=eC(wI);const Sl="1.6.15",ta={};function CI(){return typeof __HLS_WORKER_BUNDLE__=="function"}function II(){const t=ta[Sl];if(t)return t.clientCount++,t;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),n=self.URL.createObjectURL(e),s={worker:new self.Worker(n),objectURL:n,clientCount:1};return ta[Sl]=s,s}function DI(t){const e=ta[t];if(e)return e.clientCount++,e;const n=new self.URL(t,self.location.href).href,s={worker:new self.Worker(n),scriptURL:n,clientCount:1};return ta[t]=s,s}function NI(t){const e=ta[t||Sl];if(e&&e.clientCount--===1){const{worker:i,objectURL:s}=e;delete ta[t||Sl],s&&self.URL.revokeObjectURL(s),i.terminate()}}function LS(t,e){return e+10<=t.length&&t[e]===51&&t[e+1]===68&&t[e+2]===73&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function qm(t,e){return e+10<=t.length&&t[e]===73&&t[e+1]===68&&t[e+2]===51&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128}function gc(t,e){let n=0;return n=(t[e]&127)<<21,n|=(t[e+1]&127)<<14,n|=(t[e+2]&127)<<7,n|=t[e+3]&127,n}function El(t,e){const n=e;let i=0;for(;qm(t,e);){i+=10;const s=gc(t,e+6);i+=s,LS(t,e+10)&&(i+=10),e+=i}if(i>0)return t.subarray(n,n+i)}function MI(t,e,n,i){const s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[n+2],a=r>>2&15;if(a>12){const h=new Error(`invalid ADTS sampling index:${a}`);t.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const l=(r>>6&3)+1,o=e[n+3]>>6&3|(r&1)<<2,u="mp4a.40."+l,c=s[a];let d=a;(l===5||l===29)&&(d-=3);const f=[l<<3|(d&14)>>1,(d&1)<<7|o<<3];return Pe.log(`manifest codec:${i}, parsed codec:${u}, channels:${o}, rate:${c} (ADTS object type:${l} sampling index:${a})`),{config:f,samplerate:c,channelCount:o,codec:u,parsedCodec:u,manifestCodec:i}}function RS(t,e){return t[e]===255&&(t[e+1]&246)===240}function wS(t,e){return t[e+1]&1?7:9}function Xm(t,e){return(t[e+3]&3)<<11|t[e+4]<<3|(t[e+5]&224)>>>5}function OI(t,e){return e+5<t.length}function $u(t,e){return e+1<t.length&&RS(t,e)}function PI(t,e){return OI(t,e)&&RS(t,e)&&Xm(t,e)<=t.length-e}function FI(t,e){if($u(t,e)){const n=wS(t,e);if(e+n>=t.length)return!1;const i=Xm(t,e);if(i<=n)return!1;const s=e+i;return s===t.length||$u(t,s)}return!1}function CS(t,e,n,i,s){if(!t.samplerate){const r=MI(e,n,i,s);if(!r)return;$e(t,r)}}function IS(t){return 1024*9e4/t}function BI(t,e){const n=wS(t,e);if(e+n<=t.length){const i=Xm(t,e)-n;if(i>0)return{headerLength:n,frameLength:i}}}function DS(t,e,n,i,s){const r=IS(t.samplerate),a=i+s*r,l=BI(e,n);let o;if(l){const{frameLength:d,headerLength:f}=l,h=f+d,m=Math.max(0,n+h-e.length);m?(o=new Uint8Array(h-f),o.set(e.subarray(n+f,e.length),0)):o=e.subarray(n+f,n+h);const y={unit:o,pts:a};return m||t.samples.push(y),{sample:y,length:h,missing:m}}const u=e.length-n;return o=new Uint8Array(u),o.set(e.subarray(n,e.length),0),{sample:{unit:o,pts:a},length:u,missing:-1}}function UI(t,e){return qm(t,e)&&gc(t,e+6)+10<=t.length-e}function jI(t){return t instanceof ArrayBuffer?t:t.byteOffset==0&&t.byteLength==t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer}function bd(t,e=0,n=1/0){return $I(t,e,n,Uint8Array)}function $I(t,e,n,i){const s=zI(t);let r=1;"BYTES_PER_ELEMENT"in i&&(r=i.BYTES_PER_ELEMENT);const a=GI(t)?t.byteOffset:0,l=(a+t.byteLength)/r,o=(a+e)/r,u=Math.floor(Math.max(0,Math.min(o,l))),c=Math.floor(Math.min(u+Math.max(n,0),l));return new i(s,u,c-u)}function zI(t){return t instanceof ArrayBuffer?t:t.buffer}function GI(t){return t&&t.buffer instanceof ArrayBuffer&&t.byteLength!==void 0&&t.byteOffset!==void 0}function HI(t){const e={key:t.type,description:"",data:"",mimeType:null,pictureType:null},n=3;if(t.size<2)return;if(t.data[0]!==n){console.log("Ignore frame with unrecognized character encoding");return}const i=t.data.subarray(1).indexOf(0);if(i===-1)return;const s=En(bd(t.data,1,i)),r=t.data[2+i],a=t.data.subarray(3+i).indexOf(0);if(a===-1)return;const l=En(bd(t.data,3+i,a));let o;return s==="-->"?o=En(bd(t.data,4+i+a)):o=jI(t.data.subarray(4+i+a)),e.mimeType=s,e.pictureType=r,e.description=l,e.data=o,e}function VI(t){if(t.size<2)return;const e=En(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}}function KI(t){if(t.size<2)return;if(t.type==="TXXX"){let n=1;const i=En(t.data.subarray(n),!0);n+=i.length+1;const s=En(t.data.subarray(n));return{key:t.type,info:i,data:s}}const e=En(t.data.subarray(1));return{key:t.type,info:"",data:e}}function YI(t){if(t.type==="WXXX"){if(t.size<2)return;let n=1;const i=En(t.data.subarray(n),!0);n+=i.length+1;const s=En(t.data.subarray(n));return{key:t.type,info:i,data:s}}const e=En(t.data);return{key:t.type,info:"",data:e}}function qI(t){return t.type==="PRIV"?VI(t):t.type[0]==="W"?YI(t):t.type==="APIC"?HI(t):KI(t)}function XI(t){const e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=gc(t,4),i=10;return{type:e,size:n,data:t.subarray(i,i+n)}}const co=10,QI=10;function NS(t){let e=0;const n=[];for(;qm(t,e);){const i=gc(t,e+6);t[e+5]>>6&1&&(e+=co),e+=co;const s=e+i;for(;e+QI<s;){const r=XI(t.subarray(e)),a=qI(r);a&&n.push(a),e+=r.size+co}LS(t,e)&&(e+=co)}return n}function MS(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"}function WI(t){if(t.data.byteLength===8){const e=new Uint8Array(t.data),n=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,n&&(i+=4772185884e-2),Math.round(i)}}function Qm(t){const e=NS(t);for(let n=0;n<e.length;n++){const i=e[n];if(MS(i))return WI(i)}}let mn=function(t){return t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3",t.misbklv="urn:misb:KLV:bin:1910.1",t}({});function ti(t="",e=9e4){return{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Wm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,n,i,s){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,n){return!1}appendFrame(e,n,i){}demux(e,n){this.cachedData&&(e=Bn(this.cachedData,e),this.cachedData=null);let i=El(e,0),s=i?i.length:0,r;const a=this._audioTrack,l=this._id3Track,o=i?Qm(i):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&ee(o))&&(this.basePTS=ZI(o,n,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:mn.audioId3,duration:Number.POSITIVE_INFINITY});s<u;){if(this.canParse(e,s)){const c=this.appendFrame(a,e,s);c?(this.frameIndex++,this.lastPTS=c.sample.pts,s+=c.length,r=s):s=u}else UI(e,s)?(i=El(e,s),l.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:mn.audioId3,duration:Number.POSITIVE_INFINITY}),s+=i.length,r=s):s++;if(s===u&&r!==u){const c=e.slice(r);this.cachedData?this.cachedData=Bn(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:ti(),id3Track:l,textTrack:ti()}}demuxSampleAes(e,n,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const n=this.cachedData;return n&&(this.cachedData=null,this.demux(n,0)),{audioTrack:this._audioTrack,videoTrack:ti(),id3Track:this._id3Track,textTrack:ti()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const ZI=(t,e,n)=>{if(ee(t))return t*90;const i=n?n.baseTime*9e4/n.timescale:0;return e*9e4+i};let fo=null;const JI=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],eD=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],tD=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],nD=[0,1,1,4];function OS(t,e,n,i,s){if(n+24>e.length)return;const r=PS(e,n);if(r&&n+r.frameLength<=e.length){const a=r.samplesPerFrame*9e4/r.sampleRate,l=i+s*a,o={unit:e.subarray(n,n+r.frameLength),pts:l,dts:l};return t.config=[],t.channelCount=r.channelCount,t.samplerate=r.sampleRate,t.samples.push(o),{sample:o,length:r.frameLength,missing:0}}}function PS(t,e){const n=t[e+1]>>3&3,i=t[e+1]>>1&3,s=t[e+2]>>4&15,r=t[e+2]>>2&3;if(n!==1&&s!==0&&s!==15&&r!==3){const a=t[e+2]>>1&1,l=t[e+3]>>6,o=n===3?3-i:i===3?3:4,u=JI[o*14+s-1]*1e3,d=eD[(n===3?0:n===2?1:2)*3+r],f=l===3?1:2,h=tD[n][i],m=nD[i],y=h*8*m,x=Math.floor(h*u/d+a)*m;if(fo===null){const b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fo=b?parseInt(b[1]):0}return!!fo&&fo<=87&&i===2&&u>=224e3&&l===0&&(t[e+3]=t[e+3]|128),{sampleRate:d,channelCount:f,frameLength:x,samplesPerFrame:y}}}function Zm(t,e){return t[e]===255&&(t[e+1]&224)===224&&(t[e+1]&6)!==0}function FS(t,e){return e+1<t.length&&Zm(t,e)}function iD(t,e){return Zm(t,e)&&4<=t.length-e}function BS(t,e){if(e+1<t.length&&Zm(t,e)){const i=PS(t,e);let s=4;i!=null&&i.frameLength&&(s=i.frameLength);const r=e+s;return r===t.length||FS(t,r)}return!1}class sD extends Wm{constructor(e,n){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=n}resetInitSegment(e,n,i,s){super.resetInitSegment(e,n,i,s),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:n,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e,n){if(!e)return!1;const i=El(e,0);let s=(i==null?void 0:i.length)||0;if(BS(e,s))return!1;for(let r=e.length;s<r;s++)if(FI(e,s))return n.log("ADTS sync word found !"),!0;return!1}canParse(e,n){return PI(e,n)}appendFrame(e,n,i){CS(e,this.observer,n,i,e.manifestCodec);const s=DS(e,n,i,this.basePTS,this.frameIndex);if(s&&s.missing===0)return s}}const US=(t,e)=>{let n=0,i=5;e+=i;const s=new Uint32Array(1),r=new Uint32Array(1),a=new Uint8Array(1);for(;i>0;){a[0]=t[e];const l=Math.min(i,8),o=8-l;r[0]=4278190080>>>24+o<<o,s[0]=(a[0]&r[0])>>o,n=n?n<<l|s[0]:s[0],e+=1,i-=l}return n};class rD extends Wm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,n,i,s){super.resetInitSegment(e,n,i,s),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:n,duration:s,inputTimeScale:9e4,dropped:0}}canParse(e,n){return n+64<e.length}appendFrame(e,n,i){const s=jS(e,n,i,this.basePTS,this.frameIndex);if(s!==-1)return{sample:e.samples[e.samples.length-1],length:s,missing:0}}static probe(e){if(!e)return!1;const n=El(e,0);if(!n)return!1;const i=n.length;return e[i]===11&&e[i+1]===119&&Qm(n)!==void 0&&US(e,i)<16}}function jS(t,e,n,i,s){if(n+8>e.length||e[n]!==11||e[n+1]!==119)return-1;const r=e[n+4]>>6;if(r>=3)return-1;const l=[48e3,44100,32e3][r],o=e[n+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][o*3+r]*2;if(n+c>e.length)return-1;const d=e[n+6]>>5;let f=0;d===2?f+=2:(d&1&&d!==1&&(f+=2),d&4&&(f+=2));const h=(e[n+6]<<8|e[n+7])>>12-f&1,y=[2,1,2,3,3,4,4,5][d]+h,x=e[n+5]>>3,p=e[n+5]&7,v=new Uint8Array([r<<6|x<<1|p>>2,(p&3)<<6|d<<3|h<<2|o>>4,o<<4&224]),b=1536/l*9e4,E=i+s*b,k=e.subarray(n,n+c);return t.config=v,t.channelCount=y,t.samplerate=l,t.samples.push({unit:k,pts:E}),c}class aD extends Wm{resetInitSegment(e,n,i,s){super.resetInitSegment(e,n,i,s),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:n,duration:s,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const n=El(e,0);let i=(n==null?void 0:n.length)||0;if(n&&e[i]===11&&e[i+1]===119&&Qm(n)!==void 0&&US(e,i)<=16)return!1;for(let s=e.length;i<s;i++)if(BS(e,i))return Pe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,n){return iD(e,n)}appendFrame(e,n,i){if(this.basePTS!==null)return OS(e,n,i,this.basePTS,this.frameIndex)}}const lD=/\/emsg[-/]ID3/i;class oD{constructor(e,n){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=n}resetTimeStamp(){}resetInitSegment(e,n,i,s){const r=this.videoTrack=ti("video",1),a=this.audioTrack=ti("audio",1),l=this.txtTrack=ti("text",1);if(this.id3Track=ti("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const o=Q1(e);if(o.video){const{id:u,timescale:c,codec:d,supplemental:f}=o.video;r.id=u,r.timescale=l.timescale=c,r.codec=d,r.supplemental=f}if(o.audio){const{id:u,timescale:c,codec:d}=o.audio;a.id=u,a.timescale=c,a.codec=d}l.id=Y1.text,r.sampleDuration=0,r.duration=a.duration=s}resetContiguity(){this.remainderData=null}static probe(e){return rC(e)}demux(e,n){this.timeOffset=n;let i=e;const s=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Bn(this.remainderData,e));const l=fC(i);this.remainderData=l.remainder,s.samples=l.valid||new Uint8Array}else s.samples=i;const a=this.extractID3Track(s,n);return r.samples=yp(n,s),{videoTrack:s,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,n=this.videoTrack,i=this.txtTrack;n.samples=this.remainderData||new Uint8Array,this.remainderData=null;const s=this.extractID3Track(n,this.timeOffset);return i.samples=yp(e,n),{videoTrack:n,audioTrack:ti(),id3Track:s,textTrack:ti()}}extractID3Track(e,n){const i=this.id3Track;if(e.samples.length){const s=ve(e.samples,["emsg"]);s&&s.forEach(r=>{const a=mC(r);if(lD.test(a.schemeIdUri)){const l=ey(a,n);let o=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;o<=.001&&(o=Number.POSITIVE_INFINITY);const u=a.payload;i.samples.push({data:u,len:u.byteLength,dts:l,pts:l,type:mn.emsg,duration:o})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const l=ey(a,n);i.samples.push({data:a.payload,len:a.payload.byteLength,dts:l,pts:l,type:mn.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,n,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function ey(t,e){return ee(t.presentationTime)?t.presentationTime/t.timeScale:e+t.presentationTimeDelta/t.timeScale}class uD{constructor(e,n,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new zm(n,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,vs.cbc)}decryptAacSample(e,n,i){const s=e[n].unit;if(s.length<=16)return;const r=s.subarray(16,s.length-s.length%16),a=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(a).then(l=>{const o=new Uint8Array(l);s.set(o,16),this.decrypter.isSync()||this.decryptAacSamples(e,n+1,i)}).catch(i)}decryptAacSamples(e,n,i){for(;;n++){if(n>=e.length){i();return}if(!(e[n].unit.length<32)&&(this.decryptAacSample(e,n,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const n=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(n);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)i.set(e.subarray(r,r+16),s);return i}getAvcDecryptedUnit(e,n){const i=new Uint8Array(n);let s=0;for(let r=32;r<e.length-16;r+=160,s+=16)e.set(i.subarray(s,s+16),r);return e}decryptAvcSample(e,n,i,s,r){const a=J1(r.data),l=this.getAvcEncryptedData(a);this.decryptBuffer(l.buffer).then(o=>{r.data=this.getAvcDecryptedUnit(a,o),this.decrypter.isSync()||this.decryptAvcSamples(e,n,i+1,s)}).catch(s)}decryptAvcSamples(e,n,i,s){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;n++,i=0){if(n>=e.length){s();return}const r=e[n].units;for(;!(i>=r.length);i++){const a=r[i];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,n,i,s,a),!this.decrypter.isSync()))return}}}}class $S{constructor(){this.VideoSample=null}createVideoSample(e,n,i){return{key:e,frame:!1,pts:n,dts:i,units:[],length:0}}getLastNalUnit(e){var n;let i=this.VideoSample,s;if((!i||i.units.length===0)&&(i=e[e.length-1]),(n=i)!=null&&n.units){const r=i.units;s=r[r.length-1]}return s}pushAccessUnit(e,n){if(e.units.length&&e.frame){if(e.pts===void 0){const i=n.samples,s=i.length;if(s){const r=i[s-1];e.pts=r.pts,e.dts=r.dts}else{n.dropped++;return}}n.samples.push(e)}}parseNALu(e,n,i){const s=n.byteLength;let r=e.naluState||0;const a=r,l=[];let o=0,u,c,d,f=-1,h=0;for(r===-1&&(f=0,h=this.getNALuType(n,0),r=0,o=1);o<s;){if(u=n[o++],!r){r=u?0:1;continue}if(r===1){r=u?0:2;continue}if(!u)r=3;else if(u===1){if(c=o-r-1,f>=0){const m={data:n.subarray(f,c),type:h};l.push(m)}else{const m=this.getLastNalUnit(e.samples);m&&(a&&o<=4-a&&m.state&&(m.data=m.data.subarray(0,m.data.byteLength-a)),c>0&&(m.data=Bn(m.data,n.subarray(0,c)),m.state=0))}o<s?(d=this.getNALuType(n,o),f=o,h=d,r=0):r=-1}else r=0}if(f>=0&&r>=0){const m={data:n.subarray(f,s),type:h,state:r};l.push(m)}if(l.length===0){const m=this.getLastNalUnit(e.samples);m&&(m.data=Bn(m.data,n))}return e.naluState=r,l}}class Qa{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,n=this.bytesAvailable,i=e.byteLength-n,s=new Uint8Array(4),r=Math.min(4,n);if(r===0)throw new Error("no bytes available");s.set(e.subarray(i,i+r)),this.word=new DataView(s.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let n;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,n=e>>3,e-=n<<3,this.bytesAvailable-=n,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let n=Math.min(this.bitsAvailable,e);const i=this.word>>>32-n;if(e>32&&Pe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=n,this.bitsAvailable>0)this.word<<=n;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return n=e-n,n>0&&this.bitsAvailable?i<<n|this.readBits(n):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class cD extends $S{parsePES(e,n,i,s){const r=this.parseNALu(e,i.data,s);let a=this.VideoSample,l,o=!1;i.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(u=>{var c,d;switch(u.type){case 1:{let y=!1;l=!0;const x=u.data;if(o&&x.length>4){const p=this.readSliceType(x);(p===2||p===4||p===7||p===9)&&(y=!0)}if(y){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.frame=!0,a.key=y;break}case 5:l=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 6:{l=!0,Bm(u.data,1,i.pts,n.samples);break}case 7:{var h,m;l=!0,o=!0;const y=u.data,x=this.readSPS(y);if(!e.sps||e.width!==x.width||e.height!==x.height||((h=e.pixelRatio)==null?void 0:h[0])!==x.pixelRatio[0]||((m=e.pixelRatio)==null?void 0:m[1])!==x.pixelRatio[1]){e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.sps=[y];const p=y.subarray(1,4);let v="avc1.";for(let b=0;b<3;b++){let E=p[b].toString(16);E.length<2&&(E="0"+E),v+=E}e.codec=v}break}case 8:l=!0,e.pps=[u.data];break;case 9:l=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:l=!0;break;default:l=!1;break}a&&l&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,n){return e[n]&31}readSliceType(e){const n=new Qa(e);return n.readUByte(),n.readUEG(),n.readUEG()}skipScalingList(e,n){let i=8,s=8,r;for(let a=0;a<e;a++)s!==0&&(r=n.readEG(),s=(i+r+256)%256),i=s===0?i:s}readSPS(e){const n=new Qa(e);let i=0,s=0,r=0,a=0,l,o,u;const c=n.readUByte.bind(n),d=n.readBits.bind(n),f=n.readUEG.bind(n),h=n.readBoolean.bind(n),m=n.skipBits.bind(n),y=n.skipEG.bind(n),x=n.skipUEG.bind(n),p=this.skipScalingList.bind(this);c();const v=c();if(d(5),m(3),c(),x(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){const C=f();if(C===3&&m(1),x(),x(),m(1),h())for(o=C!==3?8:12,u=0;u<o;u++)h()&&(u<6?p(16,n):p(64,n))}x();const b=f();if(b===0)f();else if(b===1)for(m(1),y(),y(),l=f(),u=0;u<l;u++)y();x(),m(1);const E=f(),k=f(),_=d(1);_===0&&m(1),m(1),h()&&(i=f(),s=f(),r=f(),a=f());let L=[1,1];if(h()&&h())switch(c()){case 1:L=[1,1];break;case 2:L=[12,11];break;case 3:L=[10,11];break;case 4:L=[16,11];break;case 5:L=[40,33];break;case 6:L=[24,11];break;case 7:L=[20,11];break;case 8:L=[32,11];break;case 9:L=[80,33];break;case 10:L=[18,11];break;case 11:L=[15,11];break;case 12:L=[64,33];break;case 13:L=[160,99];break;case 14:L=[4,3];break;case 15:L=[3,2];break;case 16:L=[2,1];break;case 255:{L=[c()<<8|c(),c()<<8|c()];break}}return{width:Math.ceil((E+1)*16-i*2-s*2),height:(2-_)*(k+1)*16-(_?2:4)*(r+a),pixelRatio:L}}}class dD extends $S{constructor(...e){super(...e),this.initVPS=null}parsePES(e,n,i,s){const r=this.parseNALu(e,i.data,s);let a=this.VideoSample,l,o=!1;i.data=null,a&&r.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),r.forEach(u=>{var c,d;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),a.frame=!0,l=!0;break;case 16:case 17:case 18:case 21:if(l=!0,o){var f;(f=a)!=null&&f.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:l=!0,(c=a)!=null&&c.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0,a.frame=!0;break;case 39:l=!0,Bm(u.data,2,i.pts,n.samples);break;case 32:l=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=$e(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(l=!0,o=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(u.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const m in h.params)e.params[m]=h.params[m]}this.pushParameterSet(e.sps,u.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),a.key=!0;break;case 34:if(l=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(u.data);for(const m in h)e.params[m]=h[m]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:l=!0,e.audFound=!0,(d=a)!=null&&d.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:l=!1;break}a&&l&&a.units.push(u)}),s&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,n,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(n)}getNALuType(e,n){return(e[n]&126)>>>1}ebsp2rbsp(e){const n=new Uint8Array(e.byteLength);let i=0;for(let s=0;s<e.byteLength;s++)s>=2&&e[s]===3&&e[s-1]===0&&e[s-2]===0||(n[i]=e[s],i++);return new Uint8Array(n.buffer,0,i)}pushAccessUnit(e,n){super.pushAccessUnit(e,n),this.initVPS&&(this.initVPS=null)}readVPS(e){const n=new Qa(e);n.readUByte(),n.readUByte(),n.readBits(4),n.skipBits(2),n.readBits(6);const i=n.readBits(3),s=n.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:s}}readSPS(e){const n=new Qa(this.ebsp2rbsp(e));n.readUByte(),n.readUByte(),n.readBits(4);const i=n.readBits(3);n.readBoolean();const s=n.readBits(2),r=n.readBoolean(),a=n.readBits(5),l=n.readUByte(),o=n.readUByte(),u=n.readUByte(),c=n.readUByte(),d=n.readUByte(),f=n.readUByte(),h=n.readUByte(),m=n.readUByte(),y=n.readUByte(),x=n.readUByte(),p=n.readUByte(),v=[],b=[];for(let ae=0;ae<i;ae++)v.push(n.readBoolean()),b.push(n.readBoolean());if(i>0)for(let ae=i;ae<8;ae++)n.readBits(2);for(let ae=0;ae<i;ae++)v[ae]&&(n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte(),n.readUByte()),b[ae]&&n.readUByte();n.readUEG();const E=n.readUEG();E==3&&n.skipBits(1);const k=n.readUEG(),_=n.readUEG(),L=n.readBoolean();let C=0,w=0,A=0,I=0;L&&(C+=n.readUEG(),w+=n.readUEG(),A+=n.readUEG(),I+=n.readUEG());const N=n.readUEG(),V=n.readUEG(),G=n.readUEG(),$=n.readBoolean();for(let ae=$?0:i;ae<=i;ae++)n.skipUEG(),n.skipUEG(),n.skipUEG();if(n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG(),n.readBoolean()&&n.readBoolean())for(let be=0;be<4;be++)for(let lt=0;lt<(be===3?2:6);lt++)if(!n.readBoolean())n.readUEG();else{const ht=Math.min(64,1<<4+(be<<1));be>1&&n.readEG();for(let nn=0;nn<ht;nn++)n.readEG()}n.readBoolean(),n.readBoolean(),n.readBoolean()&&(n.readUByte(),n.skipUEG(),n.skipUEG(),n.readBoolean());const U=n.readUEG();let q=0;for(let ae=0;ae<U;ae++){let be=!1;if(ae!==0&&(be=n.readBoolean()),be){ae===U&&n.readUEG(),n.readBoolean(),n.readUEG();let lt=0;for(let Ot=0;Ot<=q;Ot++){const ht=n.readBoolean();let nn=!1;ht||(nn=n.readBoolean()),(ht||nn)&&lt++}q=lt}else{const lt=n.readUEG(),Ot=n.readUEG();q=lt+Ot;for(let ht=0;ht<lt;ht++)n.readUEG(),n.readBoolean();for(let ht=0;ht<Ot;ht++)n.readUEG(),n.readBoolean()}}if(n.readBoolean()){const ae=n.readUEG();for(let be=0;be<ae;be++){for(let lt=0;lt<G+4;lt++)n.readBits(1);n.readBits(1)}}let F=0,B=1,T=1,Y=!0,X=1,Z=0;n.readBoolean(),n.readBoolean();let le=!1;if(n.readBoolean()){if(n.readBoolean()){const sn=n.readUByte(),Ht=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],jn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];sn>0&&sn<16?(B=Ht[sn-1],T=jn[sn-1]):sn===255&&(B=n.readBits(16),T=n.readBits(16))}if(n.readBoolean()&&n.readBoolean(),n.readBoolean()&&(n.readBits(3),n.readBoolean(),n.readBoolean()&&(n.readUByte(),n.readUByte(),n.readUByte())),n.readBoolean()&&(n.readUEG(),n.readUEG()),n.readBoolean(),n.readBoolean(),n.readBoolean(),le=n.readBoolean(),le&&(n.skipUEG(),n.skipUEG(),n.skipUEG(),n.skipUEG()),n.readBoolean()&&(X=n.readBits(32),Z=n.readBits(32),n.readBoolean()&&n.readUEG(),n.readBoolean())){const jn=n.readBoolean(),Xn=n.readBoolean();let z=!1;(jn||Xn)&&(z=n.readBoolean(),z&&(n.readUByte(),n.readBits(5),n.readBoolean(),n.readBits(5)),n.readBits(4),n.readBits(4),z&&n.readBits(4),n.readBits(5),n.readBits(5),n.readBits(5));for(let Q=0;Q<=i;Q++){Y=n.readBoolean();const ue=Y||n.readBoolean();let xe=!1;ue?n.readEG():xe=n.readBoolean();const we=xe?1:n.readUEG()+1;if(jn)for(let ot=0;ot<we;ot++)n.readUEG(),n.readUEG(),z&&(n.readUEG(),n.readUEG()),n.skipBits(1);if(Xn)for(let ot=0;ot<we;ot++)n.readUEG(),n.readUEG(),z&&(n.readUEG(),n.readUEG()),n.skipBits(1)}}n.readBoolean()&&(n.readBoolean(),n.readBoolean(),n.readBoolean(),F=n.readUEG())}let fe=k,te=_;if(L){let ae=1,be=1;E===1?ae=be=2:E==2&&(ae=2),fe=k-ae*w-ae*C,te=_-be*I-be*A}const ge=s?["A","B","C"][s]:"",Ce=l<<24|o<<16|u<<8|c;let Fe=0;for(let ae=0;ae<32;ae++)Fe=(Fe|(Ce>>ae&1)<<31-ae)>>>0;let ft=Fe.toString(16);return a===1&&ft==="2"&&(ft="6"),{codecString:`hvc1.${ge}${a}.${ft}.${r?"H":"L"}${p}.B0`,params:{general_tier_flag:r,general_profile_idc:a,general_profile_space:s,general_profile_compatibility_flags:[l,o,u,c],general_constraint_indicator_flags:[d,f,h,m,y,x],general_level_idc:p,bit_depth:N+8,bit_depth_luma_minus8:N,bit_depth_chroma_minus8:V,min_spatial_segmentation_idc:F,chroma_format_idc:E,frame_rate:{fixed:Y,fps:Z/X}},width:fe,height:te,pixelRatio:[B,T]}}readPPS(e){const n=new Qa(this.ebsp2rbsp(e));n.readUByte(),n.readUByte(),n.skipUEG(),n.skipUEG(),n.skipBits(2),n.skipBits(3),n.skipBits(2),n.skipUEG(),n.skipUEG(),n.skipEG(),n.skipBits(2),n.readBoolean()&&n.skipUEG(),n.skipEG(),n.skipEG(),n.skipBits(4);const s=n.readBoolean(),r=n.readBoolean();let a=1;return r&&s?a=0:r?a=3:s&&(a=2),{parallelismType:a}}matchSPS(e,n){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,n).substr(3)}}const Tt=188;class Yi{constructor(e,n,i,s){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=n,this.typeSupported=i,this.logger=s,this.videoParser=null}static probe(e,n){const i=Yi.syncOffset(e);return i>0&&n.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const n=e.length;let i=Math.min(Tt*5,n-Tt)+1,s=0;for(;s<i;){let r=!1,a=-1,l=0;for(let o=s;o<n;o+=Tt)if(e[o]===71&&(n-o===Tt||e[o+Tt]===71)){if(l++,a===-1&&(a=o,a!==0&&(i=Math.min(a+Tt*99,e.length-Tt)+1)),r||(r=oh(e,o)===0),r&&l>1&&(a===0&&l>2||o+Tt>i))return a}else{if(l)return-1;break}s++}return-1}static createTrack(e,n){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Y1[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?n:void 0}}resetInitSegment(e,n,i,s){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Yi.createTrack("video"),this._videoTrack.duration=s,this._audioTrack=Yi.createTrack("audio",s),this._id3Track=Yi.createTrack("id3"),this._txtTrack=Yi.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=n,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:n,_id3Track:i}=this;e&&(e.pesData=null),n&&(n.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,n,i=!1,s=!1){i||(this.sampleAes=null);let r;const a=this._videoTrack,l=this._audioTrack,o=this._id3Track,u=this._txtTrack;let c=a.pid,d=a.pesData,f=l.pid,h=o.pid,m=l.pesData,y=o.pesData,x=null,p=this.pmtParsed,v=this._pmtId,b=e.length;if(this.remainderData&&(e=Bn(this.remainderData,e),b=e.length,this.remainderData=null),b<Tt&&!s)return this.remainderData=e,{audioTrack:l,videoTrack:a,id3Track:o,textTrack:u};const E=Math.max(0,Yi.syncOffset(e));b-=(b-E)%Tt,b<e.byteLength&&!s&&(this.remainderData=new Uint8Array(e.buffer,b,e.buffer.byteLength-b));let k=0;for(let L=E;L<b;L+=Tt)if(e[L]===71){const C=!!(e[L+1]&64),w=oh(e,L),A=(e[L+3]&48)>>4;let I;if(A>1){if(I=L+5+e[L+4],I===L+Tt)continue}else I=L+4;switch(w){case c:C&&(d&&(r=cr(d,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,u,r,!1)),d={data:[],size:0}),d&&(d.data.push(e.subarray(I,L+Tt)),d.size+=L+Tt-I);break;case f:if(C){if(m&&(r=cr(m,this.logger)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,r);break;case"mp3":this.parseMPEGPES(l,r);break;case"ac3":this.parseAC3PES(l,r);break}m={data:[],size:0}}m&&(m.data.push(e.subarray(I,L+Tt)),m.size+=L+Tt-I);break;case h:C&&(y&&(r=cr(y,this.logger))&&this.parseID3PES(o,r),y={data:[],size:0}),y&&(y.data.push(e.subarray(I,L+Tt)),y.size+=L+Tt-I);break;case 0:C&&(I+=e[I]+1),v=this._pmtId=fD(e,I);break;case v:{C&&(I+=e[I]+1);const N=hD(e,I,this.typeSupported,i,this.observer,this.logger);c=N.videoPid,c>0&&(a.pid=c,a.segmentCodec=N.segmentVideoCodec),f=N.audioPid,f>0&&(l.pid=f,l.segmentCodec=N.segmentAudioCodec),h=N.id3Pid,h>0&&(o.pid=h),x!==null&&!p&&(this.logger.warn(`MPEG-TS PMT found at ${L} after unknown PID '${x}'. Backtracking to sync byte @${E} to parse all TS packets.`),x=null,L=E-188),p=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=w;break}}else k++;k>0&&uh(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=d,l.pesData=m,o.pesData=y;const _={audioTrack:l,videoTrack:a,id3Track:o,textTrack:u};return s&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;this.remainderData=null;let n;return e?n=this.demux(e,-1,!1,!0):n={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(n),this.sampleAes?this.decrypt(n,this.sampleAes):n}extractRemainingSamples(e){const{audioTrack:n,videoTrack:i,id3Track:s,textTrack:r}=e,a=i.pesData,l=n.pesData,o=s.pesData;let u;if(a&&(u=cr(a,this.logger))?(this.readyVideoParser(i.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(i,r,u,!0),i.pesData=null)):i.pesData=a,l&&(u=cr(l,this.logger))){switch(n.segmentCodec){case"aac":this.parseAACPES(n,u);break;case"mp3":this.parseMPEGPES(n,u);break;case"ac3":this.parseAC3PES(n,u);break}n.pesData=null}else l!=null&&l.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=l;o&&(u=cr(o,this.logger))?(this.parseID3PES(s,u),s.pesData=null):s.pesData=o}demuxSampleAes(e,n,i){const s=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new uD(this.observer,this.config,n);return this.decrypt(s,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new cD:e==="hevc"&&(this.videoParser=new dD))}decrypt(e,n){return new Promise(i=>{const{audioTrack:s,videoTrack:r}=e;s.samples&&s.segmentCodec==="aac"?n.decryptAacSamples(s.samples,0,()=>{r.samples?n.decryptAvcSamples(r.samples,0,0,()=>{i(e)}):i(e)}):r.samples&&n.decryptAvcSamples(r.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,n){let i=0;const s=this.aacOverFlow;let r=n.data;if(s){this.aacOverFlow=null;const d=s.missing,f=s.sample.unit.byteLength;if(d===-1)r=Bn(s.sample.unit,r);else{const h=f-d;s.sample.unit.set(r.subarray(0,d),h),e.samples.push(s.sample),i=s.missing}}let a,l;for(a=i,l=r.length;a<l-1&&!$u(r,a);a++);if(a!==i){let d;const f=a<l-1;if(f?d=`AAC PES did not start with ADTS header,offset:${a}`:d="No ADTS header found in AAC PES",uh(this.observer,new Error(d),f,this.logger),!f)return}CS(e,this.observer,r,a,this.audioCodec);let o;if(n.pts!==void 0)o=n.pts;else if(s){const d=IS(e.samplerate);o=s.sample.pts+d}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,c;for(;a<l;)if(c=DS(e,r,a,o,u),a+=c.length,c.missing){this.aacOverFlow=c;break}else for(u++;a<l-1&&!$u(r,a);a++);}parseMPEGPES(e,n){const i=n.data,s=i.length;let r=0,a=0;const l=n.pts;if(l===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<s;)if(FS(i,a)){const o=OS(e,i,a,l,r);if(o)a+=o.length,r++;else break}else a++}parseAC3PES(e,n){{const i=n.data,s=n.pts;if(s===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=i.length;let a=0,l=0,o;for(;l<r&&(o=jS(e,i,l,s,a++))>0;)l+=o}}parseID3PES(e,n){if(n.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=$e({},n,{type:this._videoTrack?mn.emsg:mn.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function oh(t,e){return((t[e+1]&31)<<8)+t[e+2]}function fD(t,e){return(t[e+10]&31)<<8|t[e+11]}function hD(t,e,n,i,s,r){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(t[e+1]&15)<<8|t[e+2],o=e+3+l-4,u=(t[e+10]&15)<<8|t[e+11];for(e+=12+u;e<o;){const c=oh(t,e),d=(t[e+3]&15)<<8|t[e+4];switch(t[e]){case 207:if(!i){Sd("ADTS AAC",r);break}case 15:a.audioPid===-1&&(a.audioPid=c);break;case 21:a.id3Pid===-1&&(a.id3Pid=c);break;case 219:if(!i){Sd("H.264",r);break}case 27:a.videoPid===-1&&(a.videoPid=c);break;case 3:case 4:!n.mpeg&&!n.mp3?r.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="mp3");break;case 193:if(!i){Sd("AC-3",r);break}case 129:n.ac3?a.audioPid===-1&&(a.audioPid=c,a.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&d>0){let f=e+5,h=d;for(;h>2;){switch(t[f]){case 106:n.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=c,a.segmentAudioCodec="ac3");break}const y=t[f+1]+2;f+=y,h-=y}}break;case 194:case 135:return uh(s,new Error("Unsupported EC-3 in M2TS found"),void 0,r),a;case 36:a.videoPid===-1&&(a.videoPid=c,a.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=d+5}return a}function uh(t,e,n,i){i.warn(`parsing error: ${e.message}`),t.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,levelRetry:n,error:e,reason:e.message})}function Sd(t,e){e.log(`${t} with AES-128-CBC encryption found in unencrypted stream`)}function cr(t,e){let n=0,i,s,r,a,l;const o=t.data;if(!t||t.size===0)return null;for(;o[0].length<19&&o.length>1;)o[0]=Bn(o[0],o[1]),o.splice(1,1);if(i=o[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(s=(i[4]<<8)+i[5],s&&s>t.size-6)return null;const c=i[7];c&192&&(a=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,c&64?(l=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,a-l>60*9e4&&(e.warn(`${Math.round((a-l)/9e4)}s delta between PTS and DTS, align them`),a=l)):l=a),r=i[8];let d=r+9;if(t.size<=d)return null;t.size-=d;const f=new Uint8Array(t.size);for(let h=0,m=o.length;h<m;h++){i=o[h];let y=i.byteLength;if(d)if(d>y){d-=y;continue}else i=i.subarray(d),y-=d,d=0;f.set(i,n),n+=y}return s&&(s-=r+3),{data:f,pts:a,dts:l,len:s}}return null}class mD{static getSilentFrame(e,n){switch(e){case"mp4a.40.2":if(n===1)return new Uint8Array([0,200,0,128,35,128]);if(n===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(n===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(n===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(n===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(n===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(n===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(n===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const $i=Math.pow(2,32)-1;class M{static init(){M.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in M.types)M.types.hasOwnProperty(e)&&(M.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);M.HDLR_TYPES={video:n,audio:i};const s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);M.STTS=M.STSC=M.STCO=r,M.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),M.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),M.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),M.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);M.FTYP=M.box(M.types.ftyp,a,o,a,l),M.DINF=M.box(M.types.dinf,M.box(M.types.dref,s))}static box(e,...n){let i=8,s=n.length;const r=s;for(;s--;)i+=n[s].byteLength;const a=new Uint8Array(i);for(a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=i&255,a.set(e,4),s=0,i=8;s<r;s++)a.set(n[s],i),i+=n[s].byteLength;return a}static hdlr(e){return M.box(M.types.hdlr,M.HDLR_TYPES[e])}static mdat(e){return M.box(M.types.mdat,e)}static mdhd(e,n){n*=e;const i=Math.floor(n/($i+1)),s=Math.floor(n%($i+1));return M.box(M.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,85,196,0,0]))}static mdia(e){return M.box(M.types.mdia,M.mdhd(e.timescale||0,e.duration||0),M.hdlr(e.type),M.minf(e))}static mfhd(e){return M.box(M.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?M.box(M.types.minf,M.box(M.types.smhd,M.SMHD),M.DINF,M.stbl(e)):M.box(M.types.minf,M.box(M.types.vmhd,M.VMHD),M.DINF,M.stbl(e))}static moof(e,n,i){return M.box(M.types.moof,M.mfhd(e),M.traf(i,n))}static moov(e){let n=e.length;const i=[];for(;n--;)i[n]=M.trak(e[n]);return M.box.apply(null,[M.types.moov,M.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(M.mvex(e)))}static mvex(e){let n=e.length;const i=[];for(;n--;)i[n]=M.trex(e[n]);return M.box.apply(null,[M.types.mvex,...i])}static mvhd(e,n){n*=e;const i=Math.floor(n/($i+1)),s=Math.floor(n%($i+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,s>>24,s>>16&255,s>>8&255,s&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return M.box(M.types.mvhd,r)}static sdtp(e){const n=e.samples||[],i=new Uint8Array(4+n.length);let s,r;for(s=0;s<n.length;s++)r=n[s].flags,i[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return M.box(M.types.sdtp,i)}static stbl(e){return M.box(M.types.stbl,M.stsd(e),M.box(M.types.stts,M.STTS),M.box(M.types.stsc,M.STSC),M.box(M.types.stsz,M.STSZ),M.box(M.types.stco,M.STCO))}static avc1(e){let n=[],i=[],s,r,a;for(s=0;s<e.sps.length;s++)r=e.sps[s],a=r.byteLength,n.push(a>>>8&255),n.push(a&255),n=n.concat(Array.prototype.slice.call(r));for(s=0;s<e.pps.length;s++)r=e.pps[s],a=r.byteLength,i.push(a>>>8&255),i.push(a&255),i=i.concat(Array.prototype.slice.call(r));const l=M.box(M.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|e.sps.length].concat(n).concat([e.pps.length]).concat(i))),o=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return M.box(M.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,o&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,c&255,d>>24,d>>16&255,d>>8&255,d&255])))}static esds(e){const n=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...n,6,1,2])}static audioStsd(e){const n=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,n>>8&255,n&255,0,0])}static mp4a(e){return M.box(M.types.mp4a,M.audioStsd(e),M.box(M.types.esds,M.esds(e)))}static mp3(e){return M.box(M.types[".mp3"],M.audioStsd(e))}static ac3(e){return M.box(M.types["ac-3"],M.audioStsd(e),M.box(M.types.dac3,e.config))}static stsd(e){const{segmentCodec:n}=e;if(e.type==="audio"){if(n==="aac")return M.box(M.types.stsd,M.STSD,M.mp4a(e));if(n==="ac3"&&e.config)return M.box(M.types.stsd,M.STSD,M.ac3(e));if(n==="mp3"&&e.codec==="mp3")return M.box(M.types.stsd,M.STSD,M.mp3(e))}else if(e.pps&&e.sps){if(n==="avc")return M.box(M.types.stsd,M.STSD,M.avc1(e));if(n==="hevc"&&e.vps)return M.box(M.types.stsd,M.STSD,M.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${n}/${e.codec})`)}static tkhd(e){const n=e.id,i=(e.duration||0)*(e.timescale||0),s=e.width||0,r=e.height||0,a=Math.floor(i/($i+1)),l=Math.floor(i%($i+1));return M.box(M.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,n&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,s&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,n){const i=M.sdtp(e),s=e.id,r=Math.floor(n/($i+1)),a=Math.floor(n%($i+1));return M.box(M.types.traf,M.box(M.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,s&255])),M.box(M.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,a>>24,a>>16&255,a>>8&255,a&255])),M.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,M.box(M.types.trak,M.tkhd(e),M.mdia(e))}static trex(e){const n=e.id;return M.box(M.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,n){const i=e.samples||[],s=i.length,r=12+16*s,a=new Uint8Array(r);let l,o,u,c,d,f;for(n+=8+r,a.set([e.type==="video"?1:0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,s&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255],0),l=0;l<s;l++)o=i[l],u=o.duration,c=o.size,d=o.flags,f=o.cts,a.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,c>>>24&255,c>>>16&255,c>>>8&255,c&255,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.paddingValue<<1|d.isNonSync,d.degradPrio&61440,d.degradPrio&15,f>>>24&255,f>>>16&255,f>>>8&255,f&255],12+16*l);return M.box(M.types.trun,a)}static initSegment(e){M.types||M.init();const n=M.moov(e);return Bn(M.FTYP,n)}static hvc1(e){const n=e.params,i=[e.vps,e.sps,e.pps],s=4,r=new Uint8Array([1,n.general_profile_space<<6|(n.general_tier_flag?32:0)|n.general_profile_idc,n.general_profile_compatibility_flags[0],n.general_profile_compatibility_flags[1],n.general_profile_compatibility_flags[2],n.general_profile_compatibility_flags[3],n.general_constraint_indicator_flags[0],n.general_constraint_indicator_flags[1],n.general_constraint_indicator_flags[2],n.general_constraint_indicator_flags[3],n.general_constraint_indicator_flags[4],n.general_constraint_indicator_flags[5],n.general_level_idc,240|n.min_spatial_segmentation_idc>>8,255&n.min_spatial_segmentation_idc,252|n.parallelismType,252|n.chroma_format_idc,248|n.bit_depth_luma_minus8,248|n.bit_depth_chroma_minus8,0,parseInt(n.frame_rate.fps),s-1|n.temporal_id_nested<<2|n.num_temporal_layers<<3|(n.frame_rate.fixed?64:0),i.length]);let a=r.length;for(let m=0;m<i.length;m+=1){a+=3;for(let y=0;y<i[m].length;y+=1)a+=2+i[m][y].length}const l=new Uint8Array(a);l.set(r,0),a=r.length;const o=i.length-1;for(let m=0;m<i.length;m+=1){l.set(new Uint8Array([32+m|(m===o?128:0),0,i[m].length]),a),a+=3;for(let y=0;y<i[m].length;y+=1)l.set(new Uint8Array([i[m][y].length>>8,i[m][y].length&255]),a),a+=2,l.set(i[m][y],a),a+=i[m][y].length}const u=M.box(M.types.hvcC,l),c=e.width,d=e.height,f=e.pixelRatio[0],h=e.pixelRatio[1];return M.box(M.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,M.box(M.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),M.box(M.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,h>>24,h>>16&255,h>>8&255,h&255])))}}M.types=void 0;M.HDLR_TYPES=void 0;M.STTS=void 0;M.STSC=void 0;M.STCO=void 0;M.STSZ=void 0;M.VMHD=void 0;M.SMHD=void 0;M.STSD=void 0;M.FTYP=void 0;M.DINF=void 0;const zS=9e4;function Jm(t,e,n=1,i=!1){const s=t*e*n;return i?Math.round(s):s}function gD(t,e,n=1,i=!1){return Jm(t,e,1/n,i)}function _a(t,e=!1){return Jm(t,1e3,1/zS,e)}function pD(t,e=1){return Jm(t,zS,1/e)}function ty(t){const{baseTime:e,timescale:n,trackId:i}=t;return`${e/n} (${e}/${n}) trackId: ${i}`}const yD=10*1e3,xD=1024,vD=1152,bD=1536;let dr=null,Ed=null;function ny(t,e,n,i){return{duration:e,size:n,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:t?2:1,isNonSync:t?0:1}}}class Yo extends Un{constructor(e,n,i,s){if(super("mp4-remuxer",s),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=n,this.typeSupported=i,this.ISGenerated=!1,dr===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);dr=a?parseInt(a[1]):0}if(Ed===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Ed=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const n=this._initPTS;(!n||!e||e.trackId!==n.trackId||e.baseTime!==n.baseTime||e.timescale!==n.timescale)&&this.log(`Reset initPTS: ${n&&ty(n)} > ${e&&ty(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let n=!1;const i=e[0].pts,s=e.reduce((r,a)=>{let l=a.pts,o=l-r;return o<-4294967296&&(n=!0,l=dn(l,i),o=l-r),o>0?r:l},i);return n&&this.debug("PTS rollover detected"),s}remux(e,n,i,s,r,a,l,o){let u,c,d,f,h,m,y=r,x=r;const p=e.pid>-1,v=n.pid>-1,b=n.samples.length,E=e.samples.length>0,k=l&&b>0||b>1;if((!p||E)&&(!v||k)||this.ISGenerated||l){if(this.ISGenerated){var L,C,w,A;const G=this.videoTrackConfig;(G&&(n.width!==G.width||n.height!==G.height||((L=n.pixelRatio)==null?void 0:L[0])!==((C=G.pixelRatio)==null?void 0:C[0])||((w=n.pixelRatio)==null?void 0:w[1])!==((A=G.pixelRatio)==null?void 0:A[1]))||!G&&k||this.nextAudioTs===null&&E)&&this.resetInitSegment()}this.ISGenerated||(d=this.generateIS(e,n,r,a));const I=this.isVideoContiguous;let N=-1,V;if(k&&(N=SD(n.samples),!I&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,N>0){this.warn(`Dropped ${N} out of ${b} video samples due to a missing keyframe`);const G=this.getVideoStartPts(n.samples);n.samples=n.samples.slice(N),n.dropped+=N,x+=(n.samples[0].pts-G)/n.inputTimeScale,V=x}else N===-1&&(this.warn(`No keyframe found out of ${b} video samples`),m=!1);if(this.ISGenerated){if(E&&k){const G=this.getVideoStartPts(n.samples),D=(dn(e.samples[0].pts,G)-G)/n.inputTimeScale;y+=Math.max(0,D),x+=Math.max(0,-D)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),d=this.generateIS(e,n,r,a)),c=this.remuxAudio(e,y,this.isAudioContiguous,a,v||k||o===ne.AUDIO?x:void 0),k){const G=c?c.endPTS-c.startPTS:0;n.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),d=this.generateIS(e,n,r,a)),u=this.remuxVideo(n,x,I,G)}}else k&&(u=this.remuxVideo(n,x,I,0));u&&(u.firstKeyFrame=N,u.independent=N!==-1,u.firstKeyFramePTS=V)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(h=GS(i,r,this._initPTS,this._initDTS)),s.samples.length&&(f=HS(s,r,this._initPTS))),{audio:c,video:u,initSegment:d,independent:m,text:f,id3:h}}computeInitPts(e,n,i,s){const r=Math.round(i*n);let a=dn(e,r);if(a<r+n)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-a)/n} ${s}`);a<r+n;)a+=8589934592;return a-r}generateIS(e,n,i,s){const r=e.samples,a=n.samples,l=this.typeSupported,o={},u=this._initPTS;let c=!u||s,d="audio/mp4",f,h,m,y=-1;if(c&&(f=h=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(d="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}o.audio={id:"audio",container:d,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&l.mpeg?new Uint8Array(0):M.initSegment([e]),metadata:{channelCount:e.channelCount}},c&&(y=e.id,m=e.inputTimeScale,!u||m!==u.timescale?f=h=this.computeInitPts(r[0].pts,m,i,"audio"):c=!1)}if(n.sps&&n.pps&&a.length){if(n.timescale=n.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:n.codec,initSegment:M.initSegment([n]),metadata:{width:n.width,height:n.height}},c)if(y=n.id,m=n.inputTimeScale,!u||m!==u.timescale){const x=this.getVideoStartPts(a),p=dn(a[0].dts,x),v=this.computeInitPts(p,m,i,"video"),b=this.computeInitPts(x,m,i,"video");h=Math.min(h,v),f=Math.min(f,b)}else c=!1;this.videoTrackConfig={width:n.width,height:n.height,pixelRatio:n.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,c?(u&&this.warn(`Timestamps at playlist time: ${s?"":"~"}${i} ${f/m} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${f/m} (${f}/${m}) trackId: ${y}`),this._initPTS={baseTime:f,timescale:m,trackId:y},this._initDTS={baseTime:h,timescale:m,trackId:y}):f=m=void 0,{tracks:o,initPTS:f,timescale:m,trackId:y}}remuxVideo(e,n,i,s){const r=e.inputTimeScale,a=e.samples,l=[],o=a.length,u=this._initPTS,c=u.baseTime*r/u.timescale;let d=this.nextVideoTs,f=8,h=this.videoSampleDuration,m,y,x=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,v=!1;if(!i||d===null){const F=c+n*r,B=a[0].pts-dn(a[0].dts,a[0].pts);dr&&d!==null&&Math.abs(F-B-(d+c))<15e3?i=!0:d=F-B-c}const b=d+c;for(let F=0;F<o;F++){const B=a[F];B.pts=dn(B.pts,b),B.dts=dn(B.dts,b),B.dts<a[F>0?F-1:F].dts&&(v=!0)}v&&a.sort(function(F,B){const T=F.dts-B.dts,Y=F.pts-B.pts;return T||Y}),m=a[0].dts,y=a[a.length-1].dts;const E=y-m,k=E?Math.round(E/(o-1)):h||e.inputTimeScale/30;if(i){const F=m-b,B=F>k,T=F<-1;if((B||T)&&(B?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(F,!0)} ms (${F}dts) hole between fragments detected at ${n.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(-F,!0)} ms (${F}dts) overlapping between fragments detected at ${n.toFixed(3)}`),!T||b>=a[0].pts||dr)){m=b;const Y=a[0].pts-F;if(B)a[0].dts=m,a[0].pts=Y;else{let X=!0;for(let Z=0;Z<a.length&&!(a[Z].dts>Y&&X);Z++){const le=a[Z].pts;if(a[Z].dts-=F,a[Z].pts-=F,Z<a.length-1){const se=a[Z+1].pts,fe=a[Z].pts,te=se<=fe,ge=se<=le;X=te==ge}}}this.log(`Video: Initial PTS/DTS adjusted: ${_a(Y,!0)}/${_a(m,!0)}, delta: ${_a(F,!0)} ms`)}}m=Math.max(0,m);let _=0,L=0,C=m;for(let F=0;F<o;F++){const B=a[F],T=B.units,Y=T.length;let X=0;for(let Z=0;Z<Y;Z++)X+=T[Z].data.length;L+=X,_+=Y,B.length=X,B.dts<C?(B.dts=C,C+=k/4|0||1):C=B.dts,x=Math.min(B.pts,x),p=Math.max(B.pts,p)}y=a[o-1].dts;const w=L+4*_+8;let A;try{A=new Uint8Array(w)}catch(F){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:F,bytes:w,reason:`fail allocating video mdat ${w}`});return}const I=new DataView(A.buffer);I.setUint32(0,w),A.set(M.types.mdat,4);let N=!1,V=Number.POSITIVE_INFINITY,G=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,D=Number.NEGATIVE_INFINITY;for(let F=0;F<o;F++){const B=a[F],T=B.units;let Y=0;for(let le=0,se=T.length;le<se;le++){const fe=T[le],te=fe.data,ge=fe.data.byteLength;I.setUint32(f,ge),f+=4,A.set(te,f),f+=ge,Y+=4+ge}let X;if(F<o-1)h=a[F+1].dts-B.dts,X=a[F+1].pts-B.pts;else{const le=this.config,se=F>0?B.dts-a[F-1].dts:k;if(X=F>0?B.pts-a[F-1].pts:k,le.stretchShortVideoTrack&&this.nextAudioTs!==null){const fe=Math.floor(le.maxBufferHole*r),te=(s?x+s*r:this.nextAudioTs+c)-B.pts;te>fe?(h=te-se,h<0?h=se:N=!0,this.log(`It is approximately ${te/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=se}else h=se}const Z=Math.round(B.pts-B.dts);V=Math.min(V,h),$=Math.max($,h),G=Math.min(G,X),D=Math.max(D,X),l.push(ny(B.key,h,Y,Z))}if(l.length){if(dr){if(dr<70){const F=l[0].flags;F.dependsOn=2,F.isNonSync=0}}else if(Ed&&D-G<$-V&&k/$<.025&&l[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let F=m;for(let B=0,T=l.length;B<T;B++){const Y=F+l[B].duration,X=F+l[B].cts;if(B<T-1){const Z=Y+l[B+1].cts;l[B].duration=Z-X}else l[B].duration=B?l[B-1].duration:k;l[B].cts=0,F=Y}}}h=N||!h?k:h;const j=y+h;this.nextVideoTs=d=j-c,this.videoSampleDuration=h,this.isVideoContiguous=!0;const R={data1:M.moof(e.sequenceNumber++,m,$e(e,{samples:l})),data2:A,startPTS:(x-c)/r,endPTS:(p+h-c)/r,startDTS:(m-c)/r,endDTS:d/r,type:"video",hasAudio:!1,hasVideo:!0,nb:l.length,dropped:e.dropped};return e.samples=[],e.dropped=0,R}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return vD;case"ac3":return bD;default:return xD}}remuxAudio(e,n,i,s,r){const a=e.inputTimeScale,l=e.samplerate?e.samplerate:a,o=a/l,u=this.getSamplesPerFrame(e),c=u*o,d=this._initPTS,f=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],m=r!==void 0;let y=e.samples,x=f?0:8,p=this.nextAudioTs||-1;const v=d.baseTime*a/d.timescale,b=v+n*a;if(this.isAudioContiguous=i=i||y.length&&p>0&&(s&&Math.abs(b-(p+v))<9e3||Math.abs(dn(y[0].pts,b)-(p+v))<20*c),y.forEach(function(D){D.pts=dn(D.pts,b)}),!i||p<0){const D=y.length;if(y=y.filter(j=>j.pts>=0),D!==y.length&&this.warn(`Removed ${y.length-D} of ${D} samples (initPTS ${v} / ${a})`),!y.length)return;r===0?p=0:s&&!m?p=Math.max(0,b-v):p=y[0].pts-v}if(e.segmentCodec==="aac"){const D=this.config.maxAudioFramesDrift;for(let j=0,U=p+v;j<y.length;j++){const q=y[j],R=q.pts,F=R-U,B=Math.abs(1e3*F/a);if(F<=-D*c&&m)j===0&&(this.warn(`Audio frame @ ${(R/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*F/a)} ms.`),this.nextAudioTs=p=R-v,U=R);else if(F>=D*c&&B<yD&&m){let T=Math.round(F/c);for(U=R-T*c;U<0&&T&&c;)T--,U+=c;j===0&&(this.nextAudioTs=p=U-v),this.warn(`Injecting ${T} audio frames @ ${((U-v)/a).toFixed(3)}s due to ${Math.round(1e3*F/a)} ms gap.`);for(let Y=0;Y<T;Y++){let X=mD.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);X||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),X=q.unit.subarray()),y.splice(j,0,{unit:X,pts:U}),U+=c,j++}}q.pts=U,U+=c}}let E=null,k=null,_,L=0,C=y.length;for(;C--;)L+=y[C].unit.byteLength;for(let D=0,j=y.length;D<j;D++){const U=y[D],q=U.unit;let R=U.pts;if(k!==null){const B=h[D-1];B.duration=Math.round((R-k)/o)}else if(i&&e.segmentCodec==="aac"&&(R=p+v),E=R,L>0){L+=x;try{_=new Uint8Array(L)}catch(B){this.observer.emit(S.ERROR,S.ERROR,{type:re.MUX_ERROR,details:O.REMUX_ALLOC_ERROR,fatal:!1,error:B,bytes:L,reason:`fail allocating audio mdat ${L}`});return}f||(new DataView(_.buffer).setUint32(0,L),_.set(M.types.mdat,4))}else return;_.set(q,x);const F=q.byteLength;x+=F,h.push(ny(!0,u,F,0)),k=R}const w=h.length;if(!w)return;const A=h[h.length-1];p=k-v,this.nextAudioTs=p+o*A.duration;const I=f?new Uint8Array(0):M.moof(e.sequenceNumber++,E/o,$e({},e,{samples:h}));e.samples=[];const N=(E-v)/a,V=this.nextAudioTs/a,$={data1:I,data2:_,startPTS:N,endPTS:V,startDTS:N,endDTS:V,type:"audio",hasAudio:!0,hasVideo:!1,nb:w};return this.isAudioContiguous=!0,$}}function dn(t,e){let n;if(e===null)return t;for(e<t?n=-8589934592:n=8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}function SD(t){for(let e=0;e<t.length;e++)if(t[e].key)return e;return-1}function GS(t,e,n,i){const s=t.samples.length;if(!s)return;const r=t.inputTimeScale;for(let l=0;l<s;l++){const o=t.samples[l];o.pts=dn(o.pts-n.baseTime*r/n.timescale,e*r)/r,o.dts=dn(o.dts-i.baseTime*r/i.timescale,e*r)/r}const a=t.samples;return t.samples=[],{samples:a}}function HS(t,e,n){const i=t.samples.length;if(!i)return;const s=t.inputTimeScale;for(let a=0;a<i;a++){const l=t.samples[a];l.pts=dn(l.pts-n.baseTime*s/n.timescale,e*s)/s}t.samples.sort((a,l)=>a.pts-l.pts);const r=t.samples;return t.samples=[],{samples:r}}class ED extends Un{constructor(e,n,i,s){super("passthrough-remuxer",s),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const n=this.initPTS;n&&e&&n.baseTime===e.baseTime&&n.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,n,i,s){this.audioCodec=n,this.videoCodec=i,this.generateInitSegment(e,s),this.emitInitSegment=!0}generateInitSegment(e,n){let{audioCodec:i,videoCodec:s}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:a}=this.initData=Q1(e);if(n)uC(e,n);else{const o=r||a;o!=null&&o.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${o.codec}")!`)}r&&(i=iy(r,ze.AUDIO,this)),a&&(s=iy(a,ze.VIDEO,this));const l={};r&&a?l.audiovideo={container:"video/mp4",codec:i+","+s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:r?l.audio={container:"audio/mp4",codec:i,encrypted:r.encrypted,initSegment:e,id:"audio"}:a?l.video={container:"video/mp4",codec:s,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,n,i,s,r,a){var l,o;let{initPTS:u,lastEndTime:c}=this;const d={audio:void 0,video:void 0,text:s,id3:i,initSegment:void 0};ee(c)||(c=this.lastEndTime=r||0);const f=n.samples;if(!f.length)return d;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let m=this.initData;if((l=m)!=null&&l.length||(this.generateInitSegment(f),m=this.initData),!((o=m)!=null&&o.length))return this.warn("Failed to generate initSegment."),d;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const y=dC(f,m,this),x=m.audio?y[m.audio.id]:null,p=m.video?y[m.video.id]:null,v=ho(p,1/0),b=ho(x,1/0),E=ho(p,0,!0),k=ho(x,0,!0);let _=r,L=0;const C=x&&(!p||!u&&b<v||u&&u.trackId===m.audio.id),w=C?x:p;if(w){const U=w.timescale,q=w.start-r*U,R=C?m.audio.id:m.video.id;_=w.start/U,L=C?k-b:E-v,(a||!u)&&(TD(u,_,r,L)||U!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${r} ${q/U} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${_-r} (${q}/${U}) trackId: ${R}`),u=null,h.initPTS=q,h.timescale=U,h.trackId=R)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);u?(h.initPTS=u.baseTime,h.timescale=u.timescale,h.trackId=u.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=_,h.timescale=1,h.trackId=-1),this.initPTS=u={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const A=_-u.baseTime/u.timescale,I=A+L;L>0?this.lastEndTime=I:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const N=!!m.audio,V=!!m.video;let G="";N&&(G+="audio"),V&&(G+="video");const $=(m.audio?m.audio.encrypted:!1)||(m.video?m.video.encrypted:!1),D={data1:f,startPTS:A,startDTS:A,endPTS:I,endDTS:I,type:G,hasAudio:N,hasVideo:V,nb:1,dropped:0,encrypted:$};d.audio=N&&!V?D:void 0,d.video=V?D:void 0;const j=p==null?void 0:p.sampleCount;if(j){const U=p.keyFrameIndex,q=U!==-1;D.nb=j,D.dropped=U===0||this.isVideoContiguous?0:q?U:j,D.independent=q,D.firstKeyFrame=U,q&&p.keyFrameStart&&(D.firstKeyFramePTS=(p.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(d.independent=q),this.isVideoContiguous||(this.isVideoContiguous=q),D.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${U}/${j} dropped: ${D.dropped} start: ${D.firstKeyFramePTS||"NA"}`)}return d.initSegment=h,d.id3=GS(i,r,u,u),s.samples.length&&(d.text=HS(s,r,u)),d}}function ho(t,e,n=!1){return(t==null?void 0:t.start)!==void 0?(t.start+(n?t.duration:0))/t.timescale:e}function TD(t,e,n,i){if(t===null)return!0;const s=Math.max(i,1),r=e-t.baseTime/t.timescale;return Math.abs(r-n)>s}function iy(t,e,n){const i=t.codec;return i&&i.length>4?i:e===ze.AUDIO?i==="ec-3"||i==="ac-3"||i==="alac"?i:i==="fLaC"||i==="Opus"?Nu(i,!1):(n.warn(`Unhandled audio codec "${i}" in mp4 MAP`),i||"mp4a"):(n.warn(`Unhandled video codec "${i}" in mp4 MAP`),i||"avc1")}let Ei;try{Ei=self.performance.now.bind(self.performance)}catch{Ei=Date.now}const qo=[{demux:oD,remux:ED},{demux:Yi,remux:Yo},{demux:sD,remux:Yo},{demux:aD,remux:Yo}];qo.splice(2,0,{demux:rD,remux:Yo});class sy{constructor(e,n,i,s,r,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=n,this.config=i,this.id=r,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,n,i,s){const r=i.transmuxing;r.executeStart=Ei();let a=new Uint8Array(e);const{currentTransmuxState:l,transmuxConfig:o}=this;s&&(this.currentTransmuxState=s);const{contiguous:u,discontinuity:c,trackSwitch:d,accurateTimeOffset:f,timeOffset:h,initSegmentChange:m}=s||l,{audioCodec:y,videoCodec:x,defaultInitPts:p,duration:v,initSegmentData:b}=o,E=AD(a,n);if(E&&Ur(E.method)){const C=this.getDecrypter(),w=Hm(E.method);if(C.isSync()){let A=C.softwareDecrypt(a,E.key.buffer,E.iv.buffer,w);if(i.part>-1){const N=C.flush();A=N&&N.buffer}if(!A)return r.executeEnd=Ei(),Td(i);a=new Uint8Array(A)}else return this.asyncResult=!0,this.decryptionPromise=C.webCryptoDecrypt(a,E.key.buffer,E.iv.buffer,w).then(A=>{const I=this.push(A,null,i);return this.decryptionPromise=null,I}),this.decryptionPromise}const k=this.needsProbing(c,d);if(k){const C=this.configureTransmuxer(a);if(C)return this.logger.warn(`[transmuxer] ${C.message}`),this.observer.emit(S.ERROR,S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,fatal:!1,error:C,reason:C.message}),r.executeEnd=Ei(),Td(i)}(c||d||m||k)&&this.resetInitSegment(b,y,x,v,n),(c||m||k)&&this.resetInitialTimestamp(p),u||this.resetContiguity();const _=this.transmux(a,E,h,f,i);this.asyncResult=Tl(_);const L=this.currentTransmuxState;return L.contiguous=!0,L.discontinuity=!1,L.trackSwitch=!1,r.executeEnd=Ei(),_}flush(e){const n=e.transmuxing;n.executeStart=Ei();const{decrypter:i,currentTransmuxState:s,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const a=[],{timeOffset:l}=s;if(i){const d=i.flush();d&&a.push(this.push(d.buffer,null,e))}const{demuxer:o,remuxer:u}=this;if(!o||!u){n.executeEnd=Ei();const d=[Td(e)];return this.asyncResult?Promise.resolve(d):d}const c=o.flush(l);return Tl(c)?(this.asyncResult=!0,c.then(d=>(this.flushRemux(a,d,e),a))):(this.flushRemux(a,c,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,n,i){const{audioTrack:s,videoTrack:r,id3Track:a,textTrack:l}=n,{accurateTimeOffset:o,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ne.MAIN?"level":"track"} ${i.level}`);const c=this.remuxer.remux(s,r,a,l,u,o,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=Ei()}resetInitialTimestamp(e){const{demuxer:n,remuxer:i}=this;!n||!i||(n.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:n}=this;!e||!n||(e.resetContiguity(),n.resetNextTimestamp())}resetInitSegment(e,n,i,s,r){const{demuxer:a,remuxer:l}=this;!a||!l||(a.resetInitSegment(e,n,i,s),l.resetInitSegment(e,n,i,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,n,i,s,r){let a;return n&&n.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,n,i,s,r):a=this.transmuxUnencrypted(e,i,s,r),a}transmuxUnencrypted(e,n,i,s){const{audioTrack:r,videoTrack:a,id3Track:l,textTrack:o}=this.demuxer.demux(e,n,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,a,l,o,n,i,!1,this.id),chunkMeta:s}}transmuxSampleAes(e,n,i,s,r){return this.demuxer.demuxSampleAes(e,n,i).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,i,s,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:n,observer:i,typeSupported:s}=this;let r;for(let d=0,f=qo.length;d<f;d++){var a;if((a=qo[d].demux)!=null&&a.probe(e,this.logger)){r=qo[d];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const l=this.demuxer,o=this.remuxer,u=r.remux,c=r.demux;(!o||!(o instanceof u))&&(this.remuxer=new u(i,n,s,this.logger)),(!l||!(l instanceof c))&&(this.demuxer=new c(i,n,s,this.logger),this.probe=c.probe)}needsProbing(e,n){return!this.demuxer||!this.remuxer||e||n}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new zm(this.config)),e}}function AD(t,e){let n=null;return t.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(n=e),n}const Td=t=>({remuxResult:{},chunkMeta:t});function Tl(t){return"then"in t&&t.then instanceof Function}class kD{constructor(e,n,i,s,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=n,this.initSegmentData=i,this.duration=s,this.defaultInitPts=r||null}}class _D{constructor(e,n,i,s,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=n,this.accurateTimeOffset=i,this.trackSwitch=s,this.timeOffset=r,this.initSegmentChange=a}}let ry=0;class VS{constructor(e,n,i,s){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ry++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=o=>{const u=o.data,c=this.hls;if(!(!c||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var d;const f=(d=this.workerContext)==null?void 0:d.objectURL;f&&self.URL.revokeObjectURL(f);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{c.logger[u.data.logType]&&c.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,c.trigger(u.event,u.data);break}}},this.onWorkerError=o=>{if(!this.hls)return;const u=new Error(`${o.message}  (${o.filename}:${o.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const r=e.config;this.hls=e,this.id=n,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=i,this.onFlush=s;const a=(o,u)=>{u=u||{},u.frag=this.frag||void 0,o===S.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(o,u)};this.observer=new Ym,this.observer.on(S.FRAG_DECRYPTED,a),this.observer.on(S.ERROR,a);const l=bp(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const o=this.hls.logger;if(r.workerPath||CI()){try{r.workerPath?(o.log(`loading Web Worker ${r.workerPath} for "${n}"`),this.workerContext=DI(r.workerPath)):(o.log(`injecting Web Worker for "${n}"`),this.workerContext=II());const{worker:c}=this.workerContext;c.addEventListener("message",this.onWorkerMessage),c.addEventListener("error",this.onWorkerError),c.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:l,id:n,config:Ge(r)})}catch(c){o.warn(`Error setting up "${n}" Web Worker, fallback to inline`,c),this.terminateWorker(),this.error=null,this.transmuxer=new sy(this.observer,l,r,"",n,e.logger)}return}}this.transmuxer=new sy(this.observer,l,r,"",n,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ry++;const n=this.hls.config,i=bp(n.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:Ge(n)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),NI(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const n=this.transmuxer;n&&(n.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,n,i,s,r,a,l,o,u,c){var d,f;u.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:m}=this,y=a?a.start:r.start,x=r.decryptdata,p=this.frag,v=!(p&&r.cc===p.cc),b=!(p&&u.level===p.level),E=p?u.sn-p.sn:-1,k=this.part?u.part-this.part.index:-1,_=E===0&&u.id>1&&u.id===(p==null?void 0:p.stats.chunkCount),L=!b&&(E===1||E===0&&(k===1||_&&k<=0)),C=self.performance.now();(b||E||r.stats.parsing.start===0)&&(r.stats.parsing.start=C),a&&(k||!L)&&(a.stats.parsing.start=C);const w=!(p&&((d=r.initSegment)==null?void 0:d.url)===((f=p.initSegment)==null?void 0:f.url)),A=new _D(v,L,o,b,y,w);if(!L||v||w){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ne.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${v}
        trackSwitch: ${b}
        contiguous: ${L}
        accurateTimeOffset: ${o}
        timeOffset: ${y}
        initSegmentChange: ${w}`);const I=new kD(i,s,n,l,c);this.configureTransmuxer(I)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:x,chunkMeta:u,state:A},e instanceof ArrayBuffer?[e]:[]);else if(m){const I=m.push(e,x,u,A);Tl(I)?I.then(N=>{this.handleTransmuxComplete(N)}).catch(N=>{this.transmuxerError(N,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(I)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:n,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:n,cmd:"flush",chunkMeta:e});else if(i){const s=i.flush(e);Tl(s)?s.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(s,e)}}transmuxerError(e,n,i){this.hls&&(this.error=e,this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_PARSING_ERROR,chunkMeta:n,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,n){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(n)}configureTransmuxer(e){const{instanceNo:n,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:n,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const ay=100;class LD extends Km{constructor(e,n,i){super(e,n,i,"audio-stream-controller",ne.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:n,id:i,initPTS:s,timescale:r,trackId:a}){if(i===ne.MAIN){const l=n.cc,o=this.fragCurrent;if(this.initPTS[l]={baseTime:s,timescale:r,trackId:a},this.log(`InitPTS for cc: ${l} found from main: ${s/r} (${s}/${r}) trackId: ${a}`),this.mainAnchor=n,this.state===H.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==l)&&this.syncWithAnchor(n,u==null?void 0:u.frag)}else!this.hls.hasEnoughToStart&&o&&o.cc!==l?(o.abortRequests(),this.syncWithAnchor(n,o)):this.state===H.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,n){var i;const s=((i=this.mainFragLoading)==null?void 0:i.frag)||null;if(n&&(s==null?void 0:s.cc)===n.cc)return;const r=(s||e).cc,a=this.getLevelDetails(),l=this.getLoadPosition(),o=lS(a,r,l);o&&(this.log(`Syncing with main frag at ${o.start} cc ${o.cc}`),this.startFragRequested=!1,this.nextLoadPosition=o.start,this.resetLoadingState(),this.state===H.IDLE&&this.doTickIdle())}startLoad(e,n){if(!this.levels){this.startPosition=e,this.state=H.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(ay),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=H.IDLE):this.state=H.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}doTick(){switch(this.state){case H.IDLE:this.doTickIdle();break;case H.WAITING_TRACK:{const{levels:e,trackId:n}=this,i=e==null?void 0:e[n],s=i==null?void 0:i.details;if(s&&!this.waitForLive(i)){if(this.waitForCdnTuneIn(s))break;this.state=H.WAITING_INIT_PTS}break}case H.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case H.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:n,part:i,cache:s,complete:r}=e,a=this.mainAnchor;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.state=H.FRAG_LOADING;const l=s.flush().buffer,o={frag:n,part:i,payload:l,networkDetails:null};this._handleFragmentLoadProgress(o),r&&super._handleFragmentLoadComplete(o)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=H.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:n,levels:i,media:s,trackId:r}=this,a=n.config;if(!this.buffering||!s&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(i!=null&&i[r]))return;const l=i[r],o=l.details;if(!o||this.waitForLive(l)||this.waitForCdnTuneIn(o)){this.state=H.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,ze.AUDIO,ne.AUDIO));const c=this.getFwdBufferInfo(u,ne.AUDIO);if(c===null)return;if(!this.switchingTrack&&this._streamEnded(c,o)){n.trigger(S.BUFFER_EOS,{type:"audio"}),this.state=H.ENDED;return}const d=c.len,f=n.maxBufferLength,h=o.fragments,m=h[0].start,y=this.getLoadPosition(),x=this.flushing?y:c.end;if(this.switchingTrack&&s){const b=y;o.PTSKnown&&b<m&&(c.end>m||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),s.currentTime=m+.05)}if(d>=f&&!this.switchingTrack&&x<h[h.length-1].start)return;let p=this.getNextFragment(x,o);if(p&&this.isLoopLoading(p,x)&&(p=this.getNextFragmentLoopLoading(p,o,c,ne.MAIN,f)),!p){this.bufferFlushed=!0;return}let v=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&ut(p)&&!p.endList&&(!o.live||!this.loadingParts&&x<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===bt.OK&&(this.mainFragLoading=v=null),v&&ut(v))){if(p.start>v.end){const E=this.fragmentTracker.getFragAtPos(x,ne.MAIN);E&&E.end>v.end&&(v=E,this.mainFragLoading={frag:E,targetBufferTime:null})}if(p.start>v.end)return}this.loadFragment(p,l,x)}onMediaDetaching(e,n){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,n)}onAudioTracksUpdated(e,{audioTracks:n}){this.resetTransmuxer(),this.levels=n.map(i=>new bl(i))}onAudioTrackSwitching(e,n){const i=!!n.url;this.trackId=n.id;const{fragCurrent:s}=this;s&&(s.abortRequests(),this.removeUnbufferedFrags(s.start)),this.resetLoadingState(),i?(this.switchingTrack=n,this.flushAudioIfNeeded(n),this.state!==H.STOPPED&&(this.setInterval(ay),this.state=H.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=n,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,n){this.mainDetails=n.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(S.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,n){var i;const{levels:s}=this,{details:r,id:a,groupId:l,track:o}=n;if(!s){this.warn(`Audio tracks reset while loading track ${a} "${o.name}" of "${l}"`);return}const u=this.mainDetails;if(!u||r.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=n,this.state!==H.STOPPED&&(this.state=H.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${o.name}" of "${l}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const c=s[a];let d=0;if(r.live||(i=c.details)!=null&&i.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(c.details){var f;d=this.alignPlaylists(r,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}r.alignedSliding||(kS(r,u),r.alignedSliding||ju(r,u),d=r.fragmentStart)}c.details=r,this.levelLastLoaded=c,this.startFragRequested||this.setStartPosition(u,d),this.hls.trigger(S.AUDIO_TRACK_UPDATED,{details:r,id:a,groupId:n.groupId}),this.state===H.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=H.IDLE),this.tick()}_handleFragmentLoadProgress(e){var n;const i=e.frag,{part:s,payload:r}=e,{config:a,trackId:l,levels:o}=this;if(!o){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=o[l];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const c=u.details;if(!c){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const d=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let f=this.transmuxer;f||(f=this.transmuxer=new VS(this.hls,ne.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[i.cc],m=(n=i.initSegment)==null?void 0:n.data;if(h!==void 0){const x=s?s.index:-1,p=x!==-1,v=new Gm(i.level,i.sn,i.stats.chunkCount,r.byteLength,x,p);f.push(r,m,d,"",i,s,c.totalduration,!1,v,h)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${c.startSN} ,${c.endSN}],track ${l}`);const{cache:y}=this.waitingData=this.waitingData||{frag:i,part:s,cache:new _S,complete:!1};y.push(new Uint8Array(r)),this.state!==H.STOPPED&&(this.state=H.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,n){this.bufferFlushed=this.flushing=!1;const i=n.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,n){!this.audioOnly&&n.frag.type===ne.MAIN&&ut(n.frag)&&(this.mainFragLoading=n,this.state===H.IDLE&&this.tick())}onFragBuffered(e,n){const{frag:i,part:s}=n;if(i.type!==ne.AUDIO){!this.audioOnly&&i.type===ne.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ut(i)){this.fragPrevious=i;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(S.AUDIO_TRACK_SWITCHED,Me({},r)))}this.fragBufferedComplete(i,s),this.media&&this.tick()}onError(e,n){var i;if(n.fatal){this.state=H.ERROR;return}switch(n.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.AUDIO,n);break;case O.AUDIO_TRACK_LOAD_ERROR:case O.AUDIO_TRACK_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!n.levelRetry&&this.state===H.WAITING_TRACK&&((i=n.context)==null?void 0:i.type)===Ee.AUDIO_TRACK&&(this.state=H.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(n.parent!=="audio")return;this.reduceLengthAndFlushBuffer(n)||this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(n.parent!=="audio")return;this.reduceLengthAndFlushBuffer(n)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(n);break}}onBufferFlushing(e,{type:n}){n!==ze.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:n}){if(n!==ze.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===H.ENDED&&(this.state=H.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,n,ne.AUDIO),this.tick())}}_handleTransmuxComplete(e){var n;const i="audio",{hls:s}=this,{remuxResult:r,chunkMeta:a}=e,l=this.getCurrentContext(a);if(!l){this.resetWhenMissingContext(a);return}const{frag:o,part:u,level:c}=l,{details:d}=c,{audio:f,text:h,id3:m,initSegment:y}=r;if(this.fragContextChanged(o)||!d){this.fragmentTracker.removeFragment(o);return}if(this.state=H.PARSING,this.switchingTrack&&f&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const x=o.initSegment||o;if(this.unhandledEncryptionError(y,o))return;this._bufferInitSegment(c,y.tracks,x,a),s.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:i,tracks:y.tracks})}if(f){const{startPTS:x,endPTS:p,startDTS:v,endDTS:b}=f;u&&(u.elementaryStreams[ze.AUDIO]={startPTS:x,endPTS:p,startDTS:v,endDTS:b}),o.setElementaryStreamInfo(ze.AUDIO,x,p,v,b),this.bufferFragmentData(f,o,u,a)}if(m!=null&&(n=m.samples)!=null&&n.length){const x=$e({id:i,frag:o,details:d},m);s.trigger(S.FRAG_PARSING_METADATA,x)}if(h){const x=$e({id:i,frag:o,details:d},h);s.trigger(S.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(e,n,i,s){if(this.state!==H.PARSING||(n.video&&delete n.video,n.audiovideo&&delete n.audiovideo,!n.audio))return;const r=n.audio;r.id=ne.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${a}/${r.codec}]`),a&&a.split(",").length===1&&(r.levelCodec=a),this.hls.trigger(S.BUFFER_CODECS,n);const l=r.initSegment;if(l!=null&&l.byteLength){const o={type:"audio",frag:i,part:null,chunkMeta:s,parent:i.type,data:l};this.hls.trigger(S.BUFFER_APPENDING,o)}this.tickImmediate()}loadFragment(e,n,i){const s=this.fragmentTracker.getState(e);if(this.switchingTrack||s===bt.NOT_LOADED||s===bt.PARTIAL){var r;if(!ut(e))this._loadInitSegment(e,n);else if((r=n.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=H.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==n.details.fragmentStart&&ju(n.details,a)}else super.loadFragment(e,n,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:n,lang:i,assocLang:s,characteristics:r,audioCodec:a,channels:l}=this.bufferedTrack;$s({name:n,lang:i,assocLang:s,characteristics:r,audioCodec:a,channels:l},e,Ns)||(Ou(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:n}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,n.trigger(S.AUDIO_TRACK_SWITCHED,Me({},e))}}class e0 extends Un{constructor(e,n){super(n,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,n,i){const s=n==null?void 0:n.renditionReports;if(s){let r=-1;for(let a=0;a<s.length;a++){const l=s[a];let o;try{o=new self.URL(l.URI,n.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),o=l.URI||""}if(o===e){r=a;break}else o===e.substring(0,o.length)&&(r=a)}if(r!==-1){const a=s[r],l=parseInt(a["LAST-MSN"])||n.lastPartSn;let o=parseInt(a["LAST-PART"])||n.lastPartIndex;if(this.hls.config.lowLatencyMode){const c=Math.min(n.age-n.partTarget,n.targetduration);o>=0&&c>n.partTarget&&(o+=1)}const u=i&&Sp(i);return new Ep(l,o>=0?o:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,n){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,n){if(n)try{return n.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,n,i){const{details:s,stats:r}=n,a=self.performance.now(),l=r.loading.first?Math.max(0,a-r.loading.first):0;s.advancedDateTime=Date.now()-l;const o=this.hls.config.timelineOffset;if(o!==s.appliedTimelineOffset){const c=Math.max(o||0,0);s.appliedTimelineOffset=c,s.fragments.forEach(d=>{d.setStart(d.playlistOffset+c)})}if(s.live||i!=null&&i.live){const c="levelInfo"in n?n.levelInfo:n.track;if(s.reloaded(i),i&&s.fragments.length>0){vI(i,s,this);const v=s.playlistParsingError;if(v){this.warn(v);const b=this.hls;if(!b.config.ignorePlaylistParsingErrors){var u;const{networkDetails:E}=n;b.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:s.url,error:v,reason:v.message,level:n.level||void 0,parent:(u=s.fragments[0])==null?void 0:u.type,networkDetails:E,stats:r});return}s.playlistParsingError=null}}s.requestScheduled===-1&&(s.requestScheduled=r.loading.start);const d=this.hls.mainForwardBufferInfo,f=d?d.end-d.len:0,h=(s.edge-f)*1e3,m=bS(s,h);if(s.requestScheduled+m<a?s.requestScheduled=a:s.requestScheduled+=m,this.log(`live playlist ${e} ${s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:s.updated?"UPDATED":"MISSED"}`),!this.canLoad||!s.live)return;let y,x,p;if(s.canBlockReload&&s.endSN&&s.advanced){const v=this.hls.config.lowLatencyMode,b=s.lastPartSn,E=s.endSN,k=s.lastPartIndex,_=k!==-1,L=b===E;_?L?(x=E+1,p=v?0:k):(x=b,p=v?k+1:s.maxPartIndex):x=E+1;const C=s.age,w=C+s.ageHeader;let A=Math.min(w-s.partTarget,s.targetduration*1.5);if(A>0){if(w>s.targetduration*3)this.log(`Playlist last advanced ${C.toFixed(2)}s ago. Omitting segment and part directives.`),x=void 0,p=void 0;else if(i!=null&&i.tuneInGoal&&w-s.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${A} with playlist age: ${s.age}`),A=0;else{const I=Math.floor(A/s.targetduration);if(x+=I,p!==void 0){const N=Math.round(A%s.targetduration/s.partTarget);p+=N}this.log(`CDN Tune-in age: ${s.ageHeader}s last advanced ${C.toFixed(2)}s goal: ${A} skip sn ${I} to part ${p}`)}s.tuneInGoal=A}if(y=this.getDeliveryDirectives(s,n.deliveryDirectives,x,p),v||!L){s.requestScheduled=a,this.loadingPlaylist(c,y);return}}else(s.canBlockReload||s.canSkipUntil)&&(y=this.getDeliveryDirectives(s,n.deliveryDirectives,x,p));y&&x!==void 0&&s.canBlockReload&&(s.requestScheduled=r.loading.first+Math.max(m-l*2,m/2)),this.scheduleLoading(c,y,s)}else this.clearTimer()}scheduleLoading(e,n,i){const s=i||e.details;if(!s){this.loadingPlaylist(e,n);return}const r=self.performance.now(),a=s.requestScheduled;if(r>=a){this.loadingPlaylist(e,n);return}const l=a-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(l)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,n),l)}getDeliveryDirectives(e,n,i,s){let r=Sp(e);return n!=null&&n.skip&&e.deltaUpdateFailed&&(i=n.msn,s=n.part,r=Vo.No),new Ep(i,s,r)}checkRetry(e){const n=e.details,i=Pu(e),s=e.errorAction,{action:r,retryCount:a=0,retryConfig:l}=s||{},o=!!s&&!!l&&(r===Rt.RetryRequest||!s.resolved&&r===Rt.SendAlternateToPenaltyBox);if(o){var u;if(a>=l.maxNumRetry)return!1;if(i&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${n}" without delivery-directives`),this.loadPlaylist();else{const c=$m(l,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),c),this.warn(`Retrying playlist loading ${a+1}/${l.maxNumRetry} after "${n}" in ${c}ms`)}e.levelRetry=!0,s.resolved=!0}return o}}function KS(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Al(t[n].attrs,e[n].attrs))return!1;return!0}function Al(t,e,n){const i=t["STABLE-RENDITION-ID"];return i&&!n?i===e["STABLE-RENDITION-ID"]:!(n||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(s=>t[s]!==e[s])}function ch(t,e){return e.label.toLowerCase()===t.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(t.lang||"").toLowerCase())}class RD extends e0{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(S.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,n){this.tracks=n.audioTracks||[]}onAudioTrackLoaded(e,n){const{id:i,groupId:s,details:r}=n,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Audio track with id:${i} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const l=a.details;a.details=n.details,this.log(`Audio track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,n,l)}onLevelLoading(e,n){this.switchLevel(n.level)}onLevelSwitching(e,n){this.switchLevel(n.level)}switchLevel(e){const n=this.hls.levels[e];if(!n)return;const i=n.audioGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(l=>(s==null?void 0:s.indexOf(l))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!i||i.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,h)=>{f.id=h});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const o=this.hls.config.audioPreference;if(!r&&o){const f=ai(o,l,Ns);if(f>-1)r=l[f];else{const h=ai(o,this.tracks);r=this.tracks[h]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const c={audioTracks:l};this.log(`Updating audio tracks, ${l.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(S.AUDIO_TRACKS_UPDATED,c);const d=this.trackId;if(u!==-1&&d===-1)this.setAudioTrack(u);else if(l.length&&d===-1){var a;const f=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${l.length}`);this.warn(f.message),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:f})}}}onError(e,n){n.fatal||!n.context||n.context.type===Ee.AUDIO_TRACK&&n.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(n.context.groupId)!==-1)&&this.checkRetry(n)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const n=this.hls;if(n.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const s=this.currentTrack;if(s&&$s(e,s,Ns))return s;const r=ai(e,this.tracksInGroup,Ns);if(r>-1){const a=this.tracksInGroup[r];return this.setAudioTrack(r),a}else if(s){let a=n.loadLevel;a===-1&&(a=n.firstAutoLevel);const l=jC(e,n.levels,i,a,Ns);if(l===-1)return null;n.nextLoadLevel=l}if(e.channels||e.audioCodec){const a=ai(e,i);if(a>-1)return i[a]}}}return null}setAudioTrack(e){const n=this.tracksInGroup;if(e<0||e>=n.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=n[e],r=s.details&&!s.details.live;if(e===this.trackId&&s===i&&r||(this.log(`Switching to audio-track ${e} "${s.name}" lang:${s.lang} group:${s.groupId} channels:${s.channels}`),this.trackId=e,this.currentTrack=s,this.hls.trigger(S.AUDIO_TRACK_SWITCHING,Me({},s)),r))return;const a=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(a)}findTrackId(e){const n=this.tracksInGroup;for(let i=0;i<n.length;i++){const s=n[i];if(!(this.selectDefaultTrack&&!s.default)&&(!e||$s(e,s,Ns)))return i}if(e){const{name:i,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:o}=e;for(let u=0;u<n.length;u++){const c=n[u];if($s({name:i,lang:s,assocLang:r,characteristics:a,audioCodec:l,channels:o},c,Ns))return u}for(let u=0;u<n.length;u++){const c=n[u];if(Al(e.attrs,c.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<n.length;u++){const c=n[u];if(Al(e.attrs,c.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const n=this.currentTrack;this.shouldLoadPlaylist(n)&&Ou(n.url,this.hls)&&this.scheduleLoading(n,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,n),a=e.details,l=a==null?void 0:a.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${s}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.AUDIO_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:n||null,track:e})}}class wD{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,n,i){if(this.queues===null||this.tracks===null)return;const s=this.queues[n];s.push(e),s.length===1&&!i&&this.executeNext(n)}appendBlocker(e){return new Promise(n=>{const i={label:"async-blocker",execute:n,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(n=>{if(this.queues){const i={label:"async-blocker-prepend",execute:n,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var n;const i=(n=e[0])==null?void 0:n.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const n=this.queues[e];if(n.length){const s=n[0];try{s.execute()}catch(r){var i;if(s.onError(r),this.queues===null||this.tracks===null)return;const a=(i=this.tracks[e])==null?void 0:i.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var n;return((n=this.queues)==null?void 0:n[e][0])||null}toString(){const{queues:e,tracks:n}=this;return e===null||n===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var n,i;return(n=this.queues)!=null&&n[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var n;const i=(n=this.tracks)==null?void 0:n[e],s=i==null?void 0:i.buffer;return s?`SourceBuffer${s.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var n;return((n=this.queues)==null?void 0:n[e].map(i=>i.label).join(", "))||""}}const ly=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,YS="HlsJsTrackRemovedError";class CD extends Error{constructor(e){super(e),this.name=YS}}class ID extends Un{constructor(e,n){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var s;this.hls&&((s=this.mediaSource)==null?void 0:s.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:s,mediaSource:r}=this;i&&this.log("Media source opened"),!(!s||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(S.MEDIA_ATTACHED,{media:s,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:s}=this;i!==s&&this.error(`Media element src was set while attaching MediaSource (${s} > ${i})`)},this.hls=e,this.fragmentTracker=n,this.appendSource=Jw(xs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.BUFFER_RESET,this.onBufferReset,this),e.on(S.BUFFER_APPENDING,this.onBufferAppending,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.BUFFER_EOS,this.onBufferEos,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.FRAG_PARSED,this.onFragParsed,this),e.on(S.FRAG_CHANGED,this.onFragChanged,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.BUFFER_RESET,this.onBufferReset,this),e.off(S.BUFFER_APPENDING,this.onBufferAppending,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_EOS,this.onBufferEos,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.FRAG_PARSED,this.onFragParsed,this),e.off(S.FRAG_CHANGED,this.onFragChanged,this),e.off(S.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:n}=this;if(!e)return null;const i={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const a=this.isQueued();(r||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const s=this.transferData;return!this.sourceBufferCount&&s&&s.mediaSource===n?$e(i,s.tracks):this.sourceBuffers.forEach(r=>{const[a]=r;a&&(i[a]=$e({},this.tracks[a]),this.removeBuffer(a)),r[0]=r[1]=null}),{media:e,mediaSource:n,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,n){var i;let s=2;(n.audio&&!n.video||!n.altAudio)&&(s=1),this.bufferCodecEventsTotal=s,this.log(`${s} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&s&&this.bufferCreated()}onMediaAttaching(e,n){const i=this.media=n.media;this.transferData=this.overrides=void 0;const s=xs(this.appendSource);if(s){const r=!!n.mediaSource;(r||n.overrides)&&(this.transferData=n,this.overrides=n.overrides);const a=this.mediaSource=n.mediaSource||new s;if(this.assignMediaSource(a),r)this._objectUrl=i.src,this.attachTransferred();else{const l=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{i.removeAttribute("src");const o=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||o&&a instanceof o,oy(i),DD(i,l),i.load()}catch{i.src=l}else i.src=l}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var n,i;this.log(`${((n=this.transferData)==null?void 0:n.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,n=this.transferData;if(!n||!e)return;const i=this.tracks,s=n.tracks,r=s?Object.keys(s):null,a=r?r.length:0,l=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(s&&r&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ge(i,(o,u)=>o==="initSegment"?void 0:u)};
transfer tracks: ${Ge(s,(o,u)=>o==="initSegment"?void 0:u)}}`),!G1(s,i)){n.mediaSource=null,n.tracks=void 0;const o=e.currentTime,u=this.details,c=Math.max(o,(u==null?void 0:u.fragments[0].start)||0);if(c-o>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${o} -> ${c}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(s)}"->"${Object.keys(i)}") start time: ${c} currentTime: ${o}`),this.onMediaDetaching(S.MEDIA_DETACHING,{}),this.onMediaAttaching(S.MEDIA_ATTACHING,n),e.currentTime=c;return}this.transferData=void 0,r.forEach(o=>{const u=o,c=s[u];if(c){const d=c.buffer;if(d){const f=this.fragmentTracker,h=c.id;if(f.hasFragments(h)||f.hasParts(h)){const x=he.getBuffered(d);f.detectEvictedFragments(u,x,h,null,!0)}const m=Ad(u),y=[u,d];this.sourceBuffers[m]=y,d.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,c)}}}),l(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),l()}get mediaSourceOpenOrEnded(){var e;const n=(e=this.mediaSource)==null?void 0:e.readyState;return n==="open"||n==="ended"}onMediaDetaching(e,n){const i=!!n.transferMedia;this.transferData=this.overrides=void 0;const{media:s,mediaSource:r,_objectUrl:a}=this;if(r){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([l])=>{l&&this.removeBuffer(l)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const l=r.readyState==="open";try{const o=r.sourceBuffers;for(let u=o.length;u--;)l&&o[u].abort(),r.removeSourceBuffer(o[u]);l&&r.endOfStream()}catch(o){this.warn(`onMediaDetaching: ${o.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}s&&(s.removeEventListener("emptied",this._onMediaEmptied),i||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(s.removeAttribute("src"),this.appendSource&&oy(s),s.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(S.MEDIA_DETACHED,n)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var n;const i=(n=this.tracks[e])==null?void 0:n.buffer;if(this.removeBuffer(e),i)try{var s;(s=this.mediaSource)!=null&&s.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ad(e)]=[null,null];const n=this.tracks[e];n&&(n.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new wD(this.tracks)}onBufferCodecs(e,n){var i;const s=this.tracks,r=Object.keys(n);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in n&&(s.audio||s.video)||s.audiovideo&&("audio"in n||"video"in n),l=!a&&this.sourceBufferCount&&this.media&&r.some(o=>!s[o]);if(a||l){this.warn(`Unsupported transition between "${Object.keys(s)}" and "${r}" SourceBuffers`);return}r.forEach(o=>{var u,c;const d=n[o],{id:f,codec:h,levelCodec:m,container:y,metadata:x,supplemental:p}=d;let v=s[o];const b=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[o],E=b!=null&&b.buffer?b:v,k=(E==null?void 0:E.pendingCodec)||(E==null?void 0:E.codec),_=E==null?void 0:E.levelCodec;v||(v=s[o]={buffer:void 0,listeners:[],codec:h,supplemental:p,container:y,levelCodec:m,metadata:x,id:f});const L=Ho(k,_),C=L==null?void 0:L.replace(ly,"$1");let w=Ho(h,m);const A=(c=w)==null?void 0:c.replace(ly,"$1");w&&L&&C!==A&&(o.slice(0,5)==="audio"&&(w=Nu(w,this.appendSource)),this.log(`switching codec ${k} to ${w}`),w!==(v.pendingCodec||v.codec)&&(v.pendingCodec=w),v.container=y,this.appendChangeType(o,y,w))}),(this.tracksReady||this.sourceBufferCount)&&(n.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!n.video&&((i=n.audio)==null?void 0:i.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,n)=>{const i=this.tracks[n];return e[n]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,n,i){const s=`${n};codecs=${i}`,r={label:`change-type=${s}`,execute:()=>{const a=this.tracks[e];if(a){const l=a.buffer;l!=null&&l.changeType&&(this.log(`changing ${e} sourceBuffer type to ${s}`),l.changeType(s),a.codec=i,a.container=n)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var n;const i=e.start,s=i+e.duration*.05;if(((n=this.fragmentTracker.getAppendedFrag(i,ne.MAIN))==null?void 0:n.gap)===!0)return;const a={label:"block-audio",execute:()=>{var l;const o=this.tracks.video;(this.lastVideoAppendEnd>s||o!=null&&o.buffer&&he.isBuffered(o.buffer,s)||((l=this.fragmentTracker.getAppendedFrag(s,ne.MAIN))==null?void 0:l.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn("Error executing block-audio operation",l)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:n}=this;e&&n&&(this.blockedAudioAppend=null,n.unblockAudio(e.op))}onBufferAppending(e,n){const{tracks:i}=this,{data:s,type:r,parent:a,frag:l,part:o,chunkMeta:u,offset:c}=n,d=u.buffering[r],{sn:f,cc:h}=l,m=self.performance.now();d.start=m;const y=l.stats.buffering,x=o?o.stats.buffering:null;y.start===0&&(y.start=m),x&&x.start===0&&(x.start=m);const p=i.audio;let v=!1;r==="audio"&&(p==null?void 0:p.container)==="audio/mpeg"&&(v=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const b=i.video,E=b==null?void 0:b.buffer;if(E&&f!=="initSegment"){const L=o||l,C=this.blockedAudioAppend;if(r==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(b.ending||b.ended)){const A=L.start+L.duration*.05,I=E.buffered,N=this.currentOp("video");!I.length&&!N?this.blockAudio(L):!N&&!he.isBuffered(E,A)&&this.lastVideoAppendEnd<A&&this.blockAudio(L)}else if(r==="video"){const w=L.end;if(C){const A=C.frag.start;(w>A||w<this.lastVideoAppendEnd||he.isBuffered(E,A))&&this.unblockAudio()}this.lastVideoAppendEnd=w}}const k=(o||l).start,_={label:`append-${r}`,execute:()=>{var L;d.executeStart=self.performance.now();const C=(L=this.tracks[r])==null?void 0:L.buffer;C&&(v?this.updateTimestampOffset(C,k,.1,r,f,h):c!==void 0&&ee(c)&&this.updateTimestampOffset(C,c,1e-6,r,f,h)),this.appendExecutor(s,r)},onStart:()=>{},onComplete:()=>{const L=self.performance.now();d.executeEnd=d.end=L,y.first===0&&(y.first=L),x&&x.first===0&&(x.first=L);const C={};this.sourceBuffers.forEach(([w,A])=>{w&&(C[w]=he.getBuffered(A))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(S.BUFFER_APPENDED,{type:r,frag:l,part:o,chunkMeta:u,parent:l.type,timeRanges:C})},onError:L=>{var C;const w={type:re.MEDIA_ERROR,parent:l.type,details:O.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:l,part:o,chunkMeta:u,error:L,err:L,fatal:!1},A=(C=this.media)==null?void 0:C.error;if(L.code===DOMException.QUOTA_EXCEEDED_ERR||L.name=="QuotaExceededError"||"quota"in L)w.details=O.BUFFER_FULL_ERROR;else if(L.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!A)w.errorAction=Br(!0);else if(L.name===YS&&this.sourceBufferCount===0)w.errorAction=Br(!0);else{const I=++this.appendErrors[r];this.warn(`Failed ${I}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${A||"no media error"})`),(I>=this.hls.config.appendErrorMaxRetry||A)&&(w.fatal=!0)}this.hls.trigger(S.ERROR,w)}};this.log(`queuing "${r}" append sn: ${f}${o?" p: "+o.index:""} of ${l.type===ne.MAIN?"level":"track"} ${l.level} cc: ${h}`),this.append(_,r,this.isPending(this.tracks[r]))}getFlushOp(e,n,i){return this.log(`queuing "${e}" remove ${n}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,n,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(S.BUFFER_FLUSHED,{type:e})},onError:s=>{this.warn(`Failed to remove ${n}-${i} from "${e}" SourceBuffer`,s)}}}onBufferFlushing(e,n){const{type:i,startOffset:s,endOffset:r}=n;i?this.append(this.getFlushOp(i,s,r),i):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,s,r),a)})}onFragParsed(e,n){const{frag:i,part:s}=n,r=[],a=s?s.elementaryStreams:i.elementaryStreams;a[ze.AUDIOVIDEO]?r.push("audiovideo"):(a[ze.AUDIO]&&r.push("audio"),a[ze.VIDEO]&&r.push("video"));const l=()=>{const o=self.performance.now();i.stats.buffering.end=o,s&&(s.stats.buffering.end=o);const u=s?s.stats:i.stats;this.hls.trigger(S.FRAG_BUFFERED,{frag:i,part:s,stats:u,id:i.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(l,r).catch(o=>{this.warn(`Fragment buffered callback ${o}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,n){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const n=this.tracks[e];if(n)return!n.ended||n.ending}return!1})}onBufferEos(e,n){var i;this.sourceBuffers.forEach(([a])=>{if(a){const l=this.tracks[a];(!n.type||n.type===a)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${a} buffer reached EOS`)))}});const s=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var l;return a&&!((l=this.tracks[a])!=null&&l.ended)})?s?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(S.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(S.BUFFERED_TO_END,void 0)):n.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const n=this.tracks[e];n&&(n.ending=!1)}})}onLevelUpdated(e,{details:n}){n.fragments.length&&(this.details=n,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,n){if(n.details===O.BUFFER_APPEND_ERROR&&n.frag){var i;const s=(i=n.errorAction)==null?void 0:i.nextAutoLevel;ee(s)&&s!==n.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:n,media:i}=this;if(!i||n===null||!this.sourceBufferCount)return;const s=e.config,r=i.currentTime,a=n.levelTargetDuration,l=n.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(ee(l)&&l>=0){const u=Math.max(l,a),c=Math.floor(r/a)*a-u;this.flushBackBuffer(r,a,c)}const o=s.frontBufferFlushThreshold;if(ee(o)&&o>0){const u=Math.max(s.maxBufferLength,o),c=Math.max(u,a),d=Math.floor(r/a)*a+c;this.flushFrontBuffer(r,a,d)}}flushBackBuffer(e,n,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const l=he.getBuffered(r);if(l.length>0&&i>l.start(0)){var a;this.hls.trigger(S.BACK_BUFFER_REACHED,{bufferEnd:i});const o=this.tracks[s];if((a=this.details)!=null&&a.live)this.hls.trigger(S.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(o!=null&&o.ended){this.log(`Cannot flush ${s} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:s})}}})}flushFrontBuffer(e,n,i){this.sourceBuffers.forEach(([s,r])=>{if(r){const a=he.getBuffered(r),l=a.length;if(l<2)return;const o=a.start(l-1),u=a.end(l-1);if(i>o||e>=o&&e<=u)return;this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:o,endOffset:1/0,type:s})}})}getDurationAndRange(){var e;const{details:n,mediaSource:i}=this;if(!n||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const s=n.edge;if(n.live&&this.hls.config.liveDurationInfinity){if(n.fragments.length&&i.setLiveSeekableRange){const u=Math.max(0,n.fragmentStart),c=Math.max(u,s);return{duration:1/0,start:u,end:c}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return ee(r)?{duration:r}:null;const a=this.media.duration,l=ee(i.duration)?i.duration:0;return s>l&&s>a||!ee(a)?{duration:s}:null}updateMediaSource({duration:e,start:n,end:i}){const s=this.mediaSource;!this.media||!s||s.readyState!=="open"||(s.duration!==e&&(ee(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),s.duration=e),n!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${s.duration}. Setting seekable range to ${n}-${i}.`),s.setLiveSeekableRange(n,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:n,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${n} codec events expected: ${e}) ${Ge(i)}`),this.tracksReady){var s;const r=(s=this.transferData)==null?void 0:s.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([n,i])=>{if(n){const s=this.tracks[n];e[n]={buffer:i,container:s.container,codec:s.codec,supplemental:s.supplemental,levelCodec:s.levelCodec,id:s.id,metadata:s.metadata}}}),this.hls.trigger(S.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([n])=>{this.executeNext(n)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:n,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const a=r,l=e[a];if(this.isPending(l)){const o=this.getTrackCodec(l,a),u=`${l.container};codecs=${o}`;l.codec=o,this.log(`creating sourceBuffer(${u})${this.currentOp(a)?" Queued":""} ${Ge(l)}`);try{const c=i.addSourceBuffer(u),d=Ad(a),f=[a,c];n[d]=f,l.buffer=c}catch(c){var s;this.error(`error while trying to add sourceBuffer: ${c.message}`),this.shiftAndExecuteNext(a),(s=this.operationQueue)==null||s.removeBlockers(),delete this.tracks[a],this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:a,mimeType:u,parent:l.id});return}this.trackSourceBuffer(a,l)}}this.bufferCreated()}getTrackCodec(e,n){const i=e.supplemental;let s=e.codec;i&&(n==="video"||n==="audiovideo")&&xl(i,"video")&&(s=SC(s,i));const r=Ho(s,e.levelCodec);return r?n.slice(0,5)==="audio"?Nu(r,this.appendSource):r:""}trackSourceBuffer(e,n){const i=n.buffer;if(!i)return;const s=this.getTrackCodec(n,e);this.tracks[e]={buffer:i,codec:s,container:n.container,levelCodec:n.levelCodec,supplemental:n.supplemental,metadata:n.metadata,id:n.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,a)=>{const l=a.removedRanges;l!=null&&l.length&&this.hls.trigger(S.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,n;const i=((e=this.media)==null||(n=e.querySelector)==null?void 0:n.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const n=this.currentOp(e);n&&n.onStart()}onSBUpdateEnd(e){var n;if(((n=this.mediaSource)==null?void 0:n.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,n){var i;const s=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${s}`,n),this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:s,fatal:!1});const r=this.currentOp(e);r&&r.onError(s)}updateTimestampOffset(e,n,i,s,r,a){const l=n-e.timestampOffset;Math.abs(l)>=i&&(this.log(`Updating ${s} SourceBuffer timestampOffset to ${n} (sn: ${r} cc: ${a})`),e.timestampOffset=n)}removeExecutor(e,n,i){const{media:s,mediaSource:r}=this,a=this.tracks[e],l=a==null?void 0:a.buffer;if(!s||!r||!l){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const o=ee(s.duration)?s.duration:1/0,u=ee(r.duration)?r.duration:1/0,c=Math.max(0,n),d=Math.min(i,o,u);d>c&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${c},${d}] from the ${e} SourceBuffer`),l.remove(c,d)):this.shiftAndExecuteNext(e)}appendExecutor(e,n){const i=this.tracks[n],s=i==null?void 0:i.buffer;if(!s)throw new CD(`Attempting to append to the ${n} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,s.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(n=>{this.warn(`SourceBuffer blocked callback ${n}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(n){this.warn(`Callback run without blocking ${this.operationQueue} ${n}`)}}isUpdating(){return this.sourceBuffers.some(([e,n])=>e&&n.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,n=this.sourceBufferTypes){if(!n.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,s=n.map(a=>this.appendBlocker(a));return n.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(s).then(a=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(n=>{var i;const s=(i=this.tracks[n])==null?void 0:i.buffer;!s||s.updating||this.shiftAndExecuteNext(n)})}append(e,n,i){this.operationQueue&&this.operationQueue.append(e,n,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,n)=>e+(this.isPending(this.tracks[n])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[n])=>e+(n?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,n,i){const s=this.tracks[e];if(!s)return;const r=s.buffer;if(!r)return;const a=i.bind(this,e);s.listeners.push({event:n,listener:a}),r.addEventListener(n,a)}removeBufferListeners(e){const n=this.tracks[e];if(!n)return;const i=n.buffer;i&&(n.listeners.forEach(s=>{i.removeEventListener(s.event,s.listener)}),n.listeners.length=0)}}function oy(t){const e=t.querySelectorAll("source");[].slice.call(e).forEach(n=>{t.removeChild(n)})}function DD(t,e){const n=self.document.createElement("source");n.type="video/mp4",n.src=e,t.appendChild(n)}function Ad(t){return t==="audio"?1:0}class t0{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.BUFFER_CODECS,this.onBufferCodecs,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(S.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,n){const i=this.hls.levels[n.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,n){this.media=n.media instanceof HTMLVideoElement?n.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,n){const i=this.hls;this.restrictedLevels=[],this.firstLevel=n.firstLevel,i.config.capLevelToPlayerSize&&n.video&&this.startCapping()}onLevelsUpdated(e,n){this.timer&&ee(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,n){this.hls.config.capLevelToPlayerSize&&n.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const n=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&n.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),n.autoLevelCapping=i,n.autoLevelEnabled&&n.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=n.autoLevelCapping}}}getMaxLevel(e){const n=this.hls.levels;if(!n.length)return-1;const i=n.filter((s,r)=>this.isLevelAllowed(s)&&r<=e);return this.clientRect=null,t0.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,n={width:0,height:0};if(e){const i=e.getBoundingClientRect();n.width=i.width,n.height=i.height,!n.width&&!n.height&&(n.width=i.right-i.left||e.width||0,n.height=i.bottom-i.top||e.height||0)}return this.clientRect=n,n}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,n,i){if(!(e!=null&&e.length))return-1;const s=(l,o)=>o?l.width!==o.width||l.height!==o.height:!0;let r=e.length-1;const a=Math.max(n,i);for(let l=0;l<e.length;l+=1){const o=e[l];if((o.width>=a||o.height>=a)&&s(o,e[l+1])){r=l;break}}return r}}const ND={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Yt=ND,MD={HLS:"h"},OD=MD;class ui{constructor(e,n){Array.isArray(e)&&(e=e.map(i=>i instanceof ui?i:new ui(i))),this.value=e,this.params=n}}const PD="Dict";function FD(t){return Array.isArray(t)?JSON.stringify(t):t instanceof Map?"Map{}":t instanceof Set?"Set{}":typeof t=="object"?JSON.stringify(t):String(t)}function BD(t,e,n,i){return new Error(`failed to ${t} "${FD(e)}" as ${n}`,{cause:i})}function ci(t,e,n){return BD("serialize",t,e,n)}class qS{constructor(e){this.description=e}}const uy="Bare Item",UD="Boolean";function jD(t){if(typeof t!="boolean")throw ci(t,UD);return t?"?1":"?0"}function $D(t){return btoa(String.fromCharCode(...t))}const zD="Byte Sequence";function GD(t){if(ArrayBuffer.isView(t)===!1)throw ci(t,zD);return`:${$D(t)}:`}const HD="Integer";function VD(t){return t<-999999999999999||999999999999999<t}function XS(t){if(VD(t))throw ci(t,HD);return t.toString()}function KD(t){return`@${XS(t.getTime()/1e3)}`}function QS(t,e){if(t<0)return-QS(-t,e);const n=Math.pow(10,e);if(Math.abs(t*n%1-.5)<Number.EPSILON){const s=Math.floor(t*n);return(s%2===0?s:s+1)/n}else return Math.round(t*n)/n}const YD="Decimal";function qD(t){const e=QS(t,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ci(t,YD);const n=e.toString();return n.includes(".")?n:`${n}.0`}const XD="String",QD=/[\x00-\x1f\x7f]+/;function WD(t){if(QD.test(t))throw ci(t,XD);return`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function ZD(t){return t.description||t.toString().slice(7,-1)}const JD="Token";function cy(t){const e=ZD(t);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ci(e,JD);return e}function dh(t){switch(typeof t){case"number":if(!ee(t))throw ci(t,uy);return Number.isInteger(t)?XS(t):qD(t);case"string":return WD(t);case"symbol":return cy(t);case"boolean":return jD(t);case"object":if(t instanceof Date)return KD(t);if(t instanceof Uint8Array)return GD(t);if(t instanceof qS)return cy(t);default:throw ci(t,uy)}}const e2="Key";function fh(t){if(/^[a-z*][a-z0-9\-_.*]*$/.test(t)===!1)throw ci(t,e2);return t}function n0(t){return t==null?"":Object.entries(t).map(([e,n])=>n===!0?`;${fh(e)}`:`;${fh(e)}=${dh(n)}`).join("")}function WS(t){return t instanceof ui?`${dh(t.value)}${n0(t.params)}`:dh(t)}function t2(t){return`(${t.value.map(WS).join(" ")})${n0(t.params)}`}function n2(t,e={whitespace:!0}){if(typeof t!="object"||t==null)throw ci(t,PD);const n=t instanceof Map?t.entries():Object.entries(t),i=e!=null&&e.whitespace?" ":"";return Array.from(n).map(([s,r])=>{r instanceof ui||(r=new ui(r));let a=fh(s);return r.value===!0?a+=n0(r.params):(a+="=",Array.isArray(r.value)?a+=t2(r):a+=WS(r)),a}).join(`,${i}`)}function ZS(t,e){return n2(t,e)}const Zn="CMCD-Object",rt="CMCD-Request",_s="CMCD-Session",zi="CMCD-Status",i2={br:Zn,ab:Zn,d:Zn,ot:Zn,tb:Zn,tpb:Zn,lb:Zn,tab:Zn,lab:Zn,url:Zn,pb:rt,bl:rt,tbl:rt,dl:rt,ltc:rt,mtp:rt,nor:rt,nrr:rt,rc:rt,sn:rt,sta:rt,su:rt,ttfb:rt,ttfbb:rt,ttlb:rt,cmsdd:rt,cmsds:rt,smrt:rt,df:rt,cs:rt,ts:rt,cid:_s,pr:_s,sf:_s,sid:_s,st:_s,v:_s,msd:_s,bs:zi,bsd:zi,cdn:zi,rtp:zi,bg:zi,pt:zi,ec:zi,e:zi},s2={REQUEST:rt};function r2(t){return Object.keys(t).reduce((e,n)=>{var i;return(i=t[n])===null||i===void 0||i.forEach(s=>e[s]=n),e},{})}function a2(t,e){const n={};if(!t)return n;const i=Object.keys(t),s=e?r2(e):{};return i.reduce((r,a)=>{var l;const o=i2[a]||s[a]||s2.REQUEST,u=(l=r[o])!==null&&l!==void 0?l:r[o]={};return u[a]=t[a],r},n)}function l2(t){return["ot","sf","st","e","sta"].includes(t)}function o2(t){return typeof t=="number"?ee(t):t!=null&&t!==""&&t!==!1}const JS="event";function u2(t,e){const n=new URL(t),i=new URL(e);if(n.origin!==i.origin)return t;const s=n.pathname.split("/").slice(1),r=i.pathname.split("/").slice(1,-1);for(;s[0]===r[0];)s.shift(),r.shift();for(;r.length;)r.shift(),s.unshift("..");return s.join("/")+n.search+n.hash}const Xo=t=>Math.round(t),hh=(t,e)=>Array.isArray(t)?t.map(n=>hh(n,e)):t instanceof ui&&typeof t.value=="string"?new ui(hh(t.value,e),t.params):(e.baseUrl&&(t=u2(t,e.baseUrl)),e.version===1?encodeURIComponent(t):t),mo=t=>Xo(t/100)*100,c2=(t,e)=>{let n=t;return e.version>=2&&(t instanceof ui&&typeof t.value=="string"?n=new ui([t]):typeof t=="string"&&(n=[t])),hh(n,e)},d2={br:Xo,d:Xo,bl:mo,dl:mo,mtp:mo,nor:c2,rtp:mo,tb:Xo},eE="request",tE="response",i0=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],f2=["e"],h2=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function pc(t){return h2.test(t)}function m2(t){return i0.includes(t)||f2.includes(t)||pc(t)}const nE=["d","dl","nor","ot","rtp","su"];function g2(t){return i0.includes(t)||nE.includes(t)||pc(t)}const p2=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function y2(t){return i0.includes(t)||nE.includes(t)||p2.includes(t)||pc(t)}const x2=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function v2(t){return x2.includes(t)||pc(t)}const b2={[tE]:y2,[JS]:m2,[eE]:g2};function iE(t,e={}){const n={};if(t==null||typeof t!="object")return n;const i=e.version||t.v||1,s=e.reportingMode||eE,r=i===1?v2:b2[s];let a=Object.keys(t).filter(r);const l=e.filter;typeof l=="function"&&(a=a.filter(l));const o=s===tE||s===JS;o&&!a.includes("ts")&&a.push("ts"),i>1&&!a.includes("v")&&a.push("v");const u=$e({},d2,e.formatters),c={version:i,reportingMode:s,baseUrl:e.baseUrl};return a.sort().forEach(d=>{let f=t[d];const h=u[d];if(typeof h=="function"&&(f=h(f,c)),d==="v"){if(i===1)return;f=i}d=="pr"&&f===1||(o&&d==="ts"&&!ee(f)&&(f=Date.now()),o2(f)&&(l2(d)&&typeof f=="string"&&(f=new qS(f)),n[d]=f))}),n}function S2(t,e={}){const n={};if(!t)return n;const i=iE(t,e),s=a2(i,e==null?void 0:e.customHeaderMap);return Object.entries(s).reduce((r,[a,l])=>{const o=ZS(l,{whitespace:!1});return o&&(r[a]=o),r},n)}function E2(t,e,n){return $e(t,S2(e,n))}const T2="CMCD";function A2(t,e={}){return t?ZS(iE(t,e),{whitespace:!1}):""}function k2(t,e={}){if(!t)return"";const n=A2(t,e);return encodeURIComponent(n)}function _2(t,e={}){if(!t)return"";const n=k2(t,e);return`${T2}=${n}`}const dy=/CMCD=[^&#]+/;function L2(t,e,n){const i=_2(e,n);if(!i)return t;if(dy.test(t))return t.replace(dy,i);const s=t.includes("?")?"&":"?";return`${t}${s}${i}`}class R2{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=s=>{try{this.apply(s,{ot:Yt.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=s=>{try{const{frag:r,part:a}=s,l=this.hls.levels[r.level],o=this.getObjectType(r),u={d:(a||r).duration*1e3,ot:o};(o===Yt.VIDEO||o===Yt.AUDIO||o==Yt.MUXED)&&(u.br=l.bitrate/1e3,u.tb=this.getTopBandwidth(o)/1e3,u.bl=this.getBufferLength(o));const c=a?this.getNextPart(a):this.getNextFrag(r);c!=null&&c.url&&c.url!==r.url&&(u.nor=c.url),this.apply(s,u)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const n=this.config=e.config,{cmcd:i}=n;i!=null&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHED,this.onMediaDetached,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHED,this.onMediaDetached,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,n){this.media=n.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,n){var i,s;this.audioBuffer=(i=n.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(s=n.tracks.video)==null?void 0:s.buffer}createData(){var e;return{v:1,sf:OD.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,n={}){$e(n,this.createData());const i=n.ot===Yt.INIT||n.ot===Yt.VIDEO||n.ot===Yt.MUXED;this.starved&&i&&(n.bs=!0,n.su=!0,this.starved=!1),n.su==null&&(n.su=this.buffering);const{includeKeys:s}=this;s&&(n=Object.keys(n).reduce((a,l)=>(s.includes(l)&&(a[l]=n[l]),a),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),E2(e.headers,n,r)):e.url=L2(e.url,n,r)}getNextFrag(e){var n;const i=(n=this.hls.levels[e.level])==null?void 0:n.details;if(i){const s=e.sn-i.startSN;return i.fragments[s+1]}}getNextPart(e){var n;const{index:i,fragment:s}=e,r=(n=this.hls.levels[s.level])==null||(n=n.details)==null?void 0:n.partList;if(r){const{sn:a}=s;for(let l=r.length-1;l>=0;l--){const o=r[l];if(o.index===i&&o.fragment.sn===a)return r[l+1]}}}getObjectType(e){const{type:n}=e;if(n==="subtitle")return Yt.TIMED_TEXT;if(e.sn==="initSegment")return Yt.INIT;if(n==="audio")return Yt.AUDIO;if(n==="main")return this.hls.audioTracks.length?Yt.VIDEO:Yt.MUXED}getTopBandwidth(e){let n=0,i;const s=this.hls;if(e===Yt.AUDIO)i=s.audioTracks;else{const r=s.maxAutoLevel,a=r>-1?r+1:s.levels.length;i=s.levels.slice(0,a)}return i.forEach(r=>{r.bitrate>n&&(n=r.bitrate)}),n>0?n:NaN}getBufferLength(e){const n=this.media,i=e===Yt.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!n?NaN:he.bufferInfo(i,n.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,n=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){n(r),this.loader.load(r,a,l)}}}createFragmentLoader(){const{fLoader:e}=this.config,n=this.applyFragmentData,i=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new i(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,a,l){n(r),this.loader.load(r,a,l)}}}}const w2=3e5;class C2 extends Un{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,n)=>(e.indexOf(n.pathwayId)===-1&&e.push(n.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const n=this.levels;n&&(this.levels=n.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,n){const{contentSteering:i}=n;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,n){this.audioTracks=n.audioTracks,this.subtitleTracks=n.subtitleTracks}onError(e,n){const{errorAction:i}=n;if((i==null?void 0:i.action)===Rt.SendAlternateToPenaltyBox&&i.flags===cn.MoveAllAlternatesMatchingHost){const s=this.levels;let r=this._pathwayPriority,a=this.pathwayId;if(n.context){const{groupId:l,pathwayId:o,type:u}=n.context;l&&s?a=this.getPathwayForGroupId(l,u,a):o&&(a=o)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!r&&s&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),i.resolved=this.pathwayId!==a),n.details===O.BUFFER_APPEND_ERROR&&!n.fatal?i.resolved=!0:i.resolved||this.warn(`Could not resolve ${n.details} ("${n.error.message}") with content-steering for Pathway: ${a} levels: ${s&&s.length} priorities: ${Ge(r)} penalized: ${Ge(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let n=this.getLevelsForPathway(this.pathwayId);if(n.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),n=this.getLevelsForPathway(i),this.pathwayId=i}return n.length!==e.length&&this.log(`Found ${n.length}/${e.length} levels in Pathway "${this.pathwayId}"`),n}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(n=>e===n.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let n;const i=this.penalizedPathways,s=performance.now();Object.keys(i).forEach(r=>{s-i[r]>w2&&delete i[r]});for(let r=0;r<e.length;r++){const a=e[r];if(a in i)continue;if(a===this.pathwayId)return;const l=this.hls.nextLoadLevel,o=this.hls.levels[l];if(n=this.getLevelsForPathway(a),n.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,TS(n),this.hls.trigger(S.LEVELS_UPDATED,{levels:n});const u=this.hls.levels[l];o&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==o.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==o.bitrate&&this.log(`Unstable Pathways change from bitrate ${o.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=l);break}}}getPathwayForGroupId(e,n,i){const s=this.getLevelsForPathway(i).concat(this.levels||[]);for(let r=0;r<s.length;r++)if(n===Ee.AUDIO_TRACK&&s[r].hasAudioGroup(e)||n===Ee.SUBTITLE_TRACK&&s[r].hasSubtitleGroup(e))return s[r].pathwayId;return i}clonePathways(e){const n=this.levels;if(!n)return;const i={},s={};e.forEach(r=>{const{ID:a,"BASE-ID":l,"URI-REPLACEMENT":o}=r;if(n.some(c=>c.pathwayId===a))return;const u=this.getLevelsForPathway(l).map(c=>{const d=new tt(c.attrs);d["PATHWAY-ID"]=a;const f=d.AUDIO&&`${d.AUDIO}_clone_${a}`,h=d.SUBTITLES&&`${d.SUBTITLES}_clone_${a}`;f&&(i[d.AUDIO]=f,d.AUDIO=f),h&&(s[d.SUBTITLES]=h,d.SUBTITLES=h);const m=sE(c.uri,d["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",o),y=new bl({attrs:d,audioCodec:c.audioCodec,bitrate:c.bitrate,height:c.height,name:c.name,url:m,videoCodec:c.videoCodec,width:c.width});if(c.audioGroups)for(let x=1;x<c.audioGroups.length;x++)y.addGroupId("audio",`${c.audioGroups[x]}_clone_${a}`);if(c.subtitleGroups)for(let x=1;x<c.subtitleGroups.length;x++)y.addGroupId("text",`${c.subtitleGroups[x]}_clone_${a}`);return y});n.push(...u),fy(this.audioTracks,i,o,a),fy(this.subtitleTracks,s,o,a)})}loadSteeringManifest(e){const n=this.hls.config,i=n.loader;this.loader&&this.loader.destroy(),this.loader=new i(n);let s;try{s=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(s.protocol!=="data:"){const c=(this.hls.bandwidthEstimate||n.abrEwmaDefaultEstimate)|0;s.searchParams.set("_HLS_pathway",this.pathwayId),s.searchParams.set("_HLS_throughput",""+c)}const r={responseType:"json",url:s.href},a=n.steeringManifestLoadPolicy.default,l=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},u={onSuccess:(c,d,f,h)=>{this.log(`Loaded steering manifest: "${s}"`);const m=c.data;if((m==null?void 0:m.VERSION)!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":p}=m;if(y)try{this.uri=new self.URL(y,s).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||f.url),x&&this.clonePathways(x);const v={steeringManifest:m,url:s.toString()};this.hls.trigger(S.STEERING_MANIFEST_LOADED,v),p&&this.updatePathwayPriority(p)},onError:(c,d,f,h)=>{if(this.log(`Error loading steering manifest: ${c.code} ${c.text} (${d.url})`),this.stopLoad(),c.code===410){this.enabled=!1,this.log(`Steering manifest ${d.url} no longer available`);return}let m=this.timeToLoad*1e3;if(c.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const x=y.getResponseHeader("Retry-After");x&&(m=parseFloat(x)*1e3)}this.log(`Steering manifest ${d.url} rate limited`);return}this.scheduleRefresh(this.uri||d.url,m)},onTimeout:(c,d,f)=>{this.log(`Timeout loading steering manifest (${d.url})`),this.scheduleRefresh(this.uri||d.url)}};this.log(`Requesting steering manifest: ${s}`),this.loader.load(r,o,u)}scheduleRefresh(e,n=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const s=(i=this.hls)==null?void 0:i.media;if(s&&!s.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},n)}}function fy(t,e,n,i){t&&Object.keys(e).forEach(s=>{const r=t.filter(a=>a.groupId===s).map(a=>{const l=$e({},a);return l.details=void 0,l.attrs=new tt(l.attrs),l.url=l.attrs.URI=sE(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",n),l.groupId=l.attrs["GROUP-ID"]=e[s],l.attrs["PATHWAY-ID"]=i,l});t.push(...r)})}function sE(t,e,n,i){const{HOST:s,PARAMS:r,[n]:a}=i;let l;e&&(l=a==null?void 0:a[e],l&&(t=l));const o=new self.URL(t);return s&&!l&&(o.host=s),r&&Object.keys(r).sort().forEach(u=>{u&&o.searchParams.set(u,r[u])}),o.href}class jr extends Un{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=jr.CDMCleanupPromise?[jr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=n=>{const{initDataType:i,initData:s}=n,r=`"${n.type}" event: init data type: "${i}"`;if(this.debug(r),s!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Ma(this.config));const l=a.map(pd).filter(o=>!!o);this.keyFormatPromise=this.getKeyFormatPromise(l)}this.keyFormatPromise.then(a=>{const l=Ko(a);if(i!=="sinf"||l!==nt.FAIRPLAY){this.log(`Ignoring "${n.type}" event with init data type: "${i}" for selected key-system ${l}`);return}let o;try{const h=vt(new Uint8Array(s)),m=Vm(JSON.parse(h).sinf),y=Z1(m);if(!y)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");o=new Uint8Array(y.subarray(8,24))}catch(h){this.warn(`${r} Failed to parse sinf: ${h}`);return}const u=wt(o),{keyIdToKeySessionPromise:c,mediaKeySessions:d}=this;let f=c[u];for(let h=0;h<d.length;h++){const m=d[h],y=m.decryptdata;if(!y.keyId)continue;const x=wt(y.keyId);if(Bu(o,y.keyId)||y.uri.replace(/-/g,"").indexOf(u)!==-1){if(f=c[x],!f)continue;if(y.pssh)break;delete c[x],y.pssh=new Uint8Array(s),y.keyId=o,f=c[u]=f.then(()=>this.generateRequestWithPreferredKeySession(m,i,s,"encrypted-event-key-match")),f.catch(p=>this.handleError(p));break}}f||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${d.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=n=>{this.log(`"${n.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(S.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(S.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(S.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(S.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:n,widevineLicenseUrl:i}=this.config,s=n==null?void 0:n[e];if(s)return s.licenseUrl;if(e===nt.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const n=this.getLicenseServerUrl(e);if(n===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return n}getServerCertificateUrl(e){const{drmSystems:n}=this.config,i=n==null?void 0:n[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const n=this.hls.levels,i=(a,l,o)=>!!a&&o.indexOf(a)===l,s=n.map(a=>a.audioCodec).filter(i),r=n.map(a=>a.videoCodec).filter(i);return s.length+r.length===0&&r.push("avc1.42e01e"),new Promise((a,l)=>{const o=u=>{const c=u.shift();this.getMediaKeysPromise(c,s,r).then(d=>a({keySystem:c,mediaKeys:d})).catch(d=>{u.length?o(u):d instanceof on?l(d):l(new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_ACCESS,error:d,fatal:!0},d.message))})};o(e)})}requestMediaKeySystemAccess(e,n){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let s=`Configured requestMediaKeySystemAccess is not a function ${i}`;return gS===null&&self.location.protocol==="http:"&&(s=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(s))}return i(e,n)}getMediaKeysPromise(e,n,i){var s;const r=cI(e,n,i,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],l=(s=a)==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ge(r)}`),l=this.requestMediaKeySystemAccess(e,r);const o=a=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),l.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const c=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const d=o.mediaKeys=u.createMediaKeys().then(f=>(this.log(`Media-keys created for "${e}"`),o.hasMediaKeys=!0,c.then(h=>h?this.setMediaKeysServerCertificate(f,e,h):f)));return d.catch(f=>{this.error(`Failed to create media-keys for "${e}"}: ${f}`)}),d})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:n,mediaKeys:i}){this.log(`Creating key-system session "${n}" keyId: ${wt(e.keyId||[])} keyUri: ${e.uri}`);const s=i.createSession(),r={decryptdata:e,keySystem:n,mediaKeys:i,mediaKeysSession:s,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const n=e.decryptdata;if(n.pssh){const i=this.createMediaKeySessionContext(e),s=go(n),r="cenc";this.keyIdToKeySessionPromise[s]=this.generateRequestWithPreferredKeySession(i,r,n.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,n){const i=e.mediaKeysSession;return this.log(`Updating key-session "${i.sessionId}" for keyId ${wt(e.decryptdata.keyId||[])}
      } (data length: ${n.byteLength})`),i.update(n)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>pd(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:n,mediaKeys:i})=>this.attemptSetMediaKeys(n,i))}selectKeySystem(e){return new Promise((n,i)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:s})=>{const r=pd(s);r?n(r):i(new Error(`Unable to find format for key-system "${s}"`))}).catch(i)})}selectKeySystemFormat(e){const n=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)),this.keyFormatPromise}getKeyFormatPromise(e){const n=Ma(this.config),i=e.map(Ko).filter(s=>!!s&&n.indexOf(s)!==-1);return this.selectKeySystem(i)}getKeyStatus(e){const{mediaKeySessions:n}=this;for(let i=0;i<n.length;i++){const s=I2(e,n[i]);if(s)return s}}loadKey(e){const n=e.keyInfo.decryptdata,i=go(n),s=this.bannedKeyIds[i];if(s||this.getKeyStatus(n)==="internal-error"){const l=hy(s||"internal-error",n);return this.handleError(l,e.frag),Promise.reject(l)}const r=`(keyId: ${i} format: "${n.keyFormat}" method: ${n.method} uri: ${n.uri})`;this.log(`Starting session for key ${r}`);const a=this.keyIdToKeySessionPromise[i];if(!a){const l=this.getKeySystemForKeyPromise(n).then(({keySystem:o,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(o,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:o,mediaKeys:u,decryptdata:n}))))).then(o=>{const u="cenc",c=n.pssh?n.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(o,u,c,"playlist-key")});return l.catch(o=>this.handleError(o,e.frag)),this.keyIdToKeySessionPromise[i]=l,l}return a.catch(l=>{if(l instanceof on){const o=Me({},l.data);this.getKeyStatus(n)==="internal-error"&&(o.decryptdata=n);const u=new on(o,l.message);this.handleError(u,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,n){if(this.hls)if(e instanceof on){n&&(e.data.frag=n);const i=e.data.decryptdata;this.error(`${e.message}${i?` (${wt(i.keyId||[])})`:""}`),this.hls.trigger(S.ERROR,e.data)}else this.error(e.message),this.hls.trigger(S.ERROR,{type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const n=go(e),i=this.keyIdToKeySessionPromise[n];if(!i){const s=Ko(e.keyFormat),r=s?[s]:Ma(this.config);return this.attemptKeySystemAccess(r)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=Ma(this.config)),e.length===0)throw new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ge({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,n){if(this.mediaResolved=void 0,this.mediaKeys===n)return Promise.resolve();const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const s=Promise.all(i).then(()=>this.media?this.media.setMediaKeys(n):new Promise((r,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=n,this.media.setMediaKeys(n).then(r).catch(a)}}));return this.mediaKeys=n,this.setMediaKeysQueue.push(s),s.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(s),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>i.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,n,i,s){var r;const a=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(a)try{const m=a.call(this.hls,n,i,e);if(!m)throw new Error("Invalid response from configured generateRequest filter");n=m.initDataType,i=m.initData?m.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(m){if(this.warn(m.message),this.hls&&this.hls.config.debug)throw m}if(i===null)return this.log(`Skipping key-session request for "${s}" (no initData)`),Promise.resolve(e);const l=go(e.decryptdata),o=e.decryptdata.uri;this.log(`Generating key-session request for "${s}" keyId: ${l} URI: ${o} (init data type: ${n} length: ${i.byteLength})`);const u=new Ym,c=e._onmessage=m=>{const y=e.mediaKeysSession;if(!y){u.emit("error",new Error("invalid state"));return}const{messageType:x,message:p}=m;this.log(`"${x}" message event for session "${y.sessionId}" message size: ${p.byteLength}`),x==="license-request"||x==="license-renewal"?this.renewLicense(e,p).catch(v=>{u.eventNames().length?u.emit("error",v):this.handleError(v)}):x==="license-release"?e.keySystem===nt.FAIRPLAY&&this.updateKeySession(e,rh("acknowledged")).then(()=>this.removeSession(e)).catch(v=>this.handleError(v)):this.warn(`unhandled media key message type "${x}"`)},d=(m,y)=>{y.keyStatus=m;let x;m.startsWith("usable")?u.emit("resolved"):m==="internal-error"||m==="output-restricted"||m==="output-downscaled"?x=hy(m,y.decryptdata):m==="expired"?x=new Error(`key expired (keyId: ${l})`):m==="released"?x=new Error("key released"):m==="status-pending"||this.warn(`unhandled key status change "${m}" (keyId: ${l})`),x&&(u.eventNames().length?u.emit("error",x):this.handleError(x))},f=e._onkeystatuseschange=m=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const x=this.getKeyStatuses(e);if(!Object.keys(x).some(E=>x[E]!=="status-pending"))return;if(x[l]==="expired"){this.log(`Expired key ${Ge(x)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let v=x[l];if(v)d(v,e);else{var b;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(b=e.keyStatusTimeouts)[l]||(b[l]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${l} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),d(k,e);this.log(`key status for ${l} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),v="internal-error",d(v,e)},1e3)),this.log(`No status for keyId ${l} (${Ge(x)}).`)}};zt(e.mediaKeysSession,"message",c),zt(e.mediaKeysSession,"keystatuseschange",f);const h=new Promise((m,y)=>{u.on("error",y),u.on("resolved",m)});return e.mediaKeysSession.generateRequest(n,i).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${l} URI: ${o}`)}).catch(m=>{throw new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_NO_SESSION,error:m,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>h).catch(m=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw m}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const n={};return e.mediaKeysSession.keyStatuses.forEach((i,s)=>{if(typeof s=="string"&&typeof i=="object"){const l=s;s=i,i=l}const r="buffer"in s?new Uint8Array(s.buffer,s.byteOffset,s.byteLength):new Uint8Array(s);if(e.keySystem===nt.PLAYREADY&&r.length===16){const l=wt(r);n[l]=i,hS(r)}const a=wt(r);i==="internal-error"&&(this.bannedKeyIds[a]=i),this.log(`key status change "${i}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),n[a]=i}),n}fetchServerCertificate(e){const n=this.config,i=n.loader,s=new i(n),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,l)=>{const o={responseType:"arraybuffer",url:r},u=n.certLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,y)=>{a(f.data)},onError:(f,h,m,y)=>{l(new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:Me({url:o.url,data:void 0},f)},`"${e}" certificate request failed (${r}). Status: ${f.code} (${f.text})`))},onTimeout:(f,h,m)=>{l(new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:o.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(f,h,m)=>{l(new Error("aborted"))}};s.load(o,c,d)})):Promise.resolve()}setMediaKeysServerCertificate(e,n,i){return new Promise((s,r)=>{e.setServerCertificate(i).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${i.byteLength}) on "${n}"`),s(e)}).catch(a=>{r(new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,n){return this.requestLicense(e,new Uint8Array(n)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(s=>{throw new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:s,fatal:!1},s.message)}))}unpackPlayReadyKeyMessage(e,n){const i=String.fromCharCode.apply(null,new Uint16Array(n.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),n;const s=new DOMParser().parseFromString(i,"application/xml"),r=s.querySelectorAll("HttpHeader");if(r.length>0){let c;for(let d=0,f=r.length;d<f;d++){var a,l;c=r[d];const h=(a=c.querySelector("name"))==null?void 0:a.textContent,m=(l=c.querySelector("value"))==null?void 0:l.textContent;h&&m&&e.setRequestHeader(h,m)}}const o=s.querySelector("Challenge"),u=o==null?void 0:o.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return rh(atob(u))}setupLicenseXHR(e,n,i,s){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,n,i,s)}).catch(a=>{if(!i.decryptdata)throw a;return e.open("POST",n,!0),r.call(this.hls,e,n,i,s)}).then(a=>(e.readyState||e.open("POST",n,!0),{xhr:e,licenseChallenge:a||s})):(e.open("POST",n,!0),Promise.resolve({xhr:e,licenseChallenge:s}))}requestLicense(e,n){const i=this.config.keyLoadPolicy.default;return new Promise((s,r)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(l.readyState===4)if(l.status===200){this._requestLicenseFailureCount=0;let o=l.response;this.log(`License received ${o instanceof ArrayBuffer?o.byteLength:o}`);const u=this.config.licenseResponseCallback;if(u)try{o=u.call(this.hls,l,a,e)}catch(c){this.error(c)}s(o)}else{const o=i.errorRetry,u=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||l.status>=400&&l.status<500)r(new on({type:re.KEY_SYSTEM_ERROR,details:O.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:l,response:{url:a,data:void 0,code:l.status,text:l.statusText}},`License Request XHR failed (${a}). Status: ${l.status} (${l.statusText})`));else{const c=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${c} attempts left`),this.requestLicense(e,n).then(s,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=l,this.setupLicenseXHR(l,a,e,n).then(({xhr:o,licenseChallenge:u})=>{e.keySystem==nt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(o,u)),o.send(u)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,n){if(!this.config.emeEnabled)return;const i=n.media;this.media=i,zt(i,"encrypted",this.onMediaEncrypted),zt(i,"waitingforkey",this.onWaitingForKey);const s=this.mediaResolved;s?s():this.mediaKeys=i.mediaKeys}onMediaDetached(){const e=this.media;e&&(Wt(e,"encrypted",this.onMediaEncrypted),Wt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const n=this.mediaResolved;if(n&&n(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const i=this.media,s=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,fs.clearKeyUriToKeyIdMap();const r=s.length;jr.CDMCleanupPromise=Promise.all(s.map(a=>this.removeSession(a)).concat((i==null||(e=i.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:n}){if(!(!n||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=n.reduce((s,r)=>(s.indexOf(r.keyFormat)===-1&&s.push(r.keyFormat),s),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:n,licenseXhr:i,decryptdata:s}=e;if(n){this.log(`Remove licenses and keys and close session "${n.sessionId}" keyId: ${wt((s==null?void 0:s.keyId)||[])}`),e._onmessage&&(n.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(n.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(u=>self.clearTimeout(a[u]));const{drmSystemOptions:l}=this.config;return(fI(l)?new Promise((u,c)=>{self.setTimeout(()=>c(new Error("MediaKeySession.remove() timeout")),8e3),n.remove().then(u).catch(c)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>n.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}jr.CDMCleanupPromise=void 0;function go(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return wt(t.keyId)}function I2(t,e){if(t.keyId&&e.mediaKeysSession.keyStatuses.has(t.keyId))return e.mediaKeysSession.keyStatuses.get(t.keyId);if(t.matches(e.decryptdata))return e.keyStatus}class on extends Error{constructor(e,n){super(n),this.data=void 0,e.error||(e.error=new Error(n)),this.data=e,e.err=e.error}}function hy(t,e){const n=t==="output-restricted",i=n?O.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:O.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new on({type:re.KEY_SYSTEM_ERROR,details:i,fatal:!1,decryptdata:e},n?"HDCP level output restricted":`key status changed to "${t}"`)}class D2{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(S.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(S.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,n){const i=this.hls.config;if(i.capLevelOnFPSDrop){const s=n.media instanceof self.HTMLVideoElement?n.media:null;this.media=s,s&&typeof s.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,n,i){const s=performance.now();if(n){if(this.lastTime){const r=s-this.lastTime,a=i-this.lastDroppedFrames,l=n-this.lastDecodedFrames,o=1e3*a/r,u=this.hls;if(u.trigger(S.FPS_DROP,{currentDropped:a,currentDecoded:l,totalDroppedFrames:i}),o>0&&a>u.config.fpsDroppedMonitoringThreshold*l){let c=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=c)&&(c=c-1,u.trigger(S.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=i,this.lastDecodedFrames=n}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const n=e.getVideoPlaybackQuality();this.checkFPS(e,n.totalVideoFrames,n.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function rE(t,e){let n;try{n=new Event("addtrack")}catch{n=document.createEvent("Event"),n.initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function aE(t,e){const n=t.mode;if(n==="disabled"&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Pe.debug(`[texttrack-utils]: ${i}`);try{const s=new self.TextTrackCue(e.startTime,e.endTime,e.text);s.id=e.id,t.addCue(s)}catch(s){Pe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${s}`)}}n==="disabled"&&(t.mode=n)}function Cr(t,e){const n=t.mode;if(n==="disabled"&&(t.mode="hidden"),t.cues)for(let i=t.cues.length;i--;)e&&t.cues[i].removeEventListener("enter",e),t.removeCue(t.cues[i]);n==="disabled"&&(t.mode=n)}function mh(t,e,n,i){const s=t.mode;if(s==="disabled"&&(t.mode="hidden"),t.cues&&t.cues.length>0){const r=M2(t.cues,e,n);for(let a=0;a<r.length;a++)(!i||i(r[a]))&&t.removeCue(r[a])}s==="disabled"&&(t.mode=s)}function N2(t,e){if(e<=t[0].startTime)return 0;const n=t.length-1;if(e>t[n].endTime)return-1;let i=0,s=n,r;for(;i<=s;)if(r=Math.floor((s+i)/2),e<t[r].startTime)s=r-1;else if(e>t[r].startTime&&i<n)i=r+1;else return r;return t[i].startTime-e<e-t[s].startTime?i:s}function M2(t,e,n){const i=[],s=N2(t,e);if(s>-1)for(let r=s,a=t.length;r<a;r++){const l=t[r];if(l.startTime>=e&&l.endTime<=n)i.push(l);else if(l.startTime>n)return i}return i}function Qo(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(t[n])}return e}class O2 extends e0{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let n=null;const i=Qo(this.media.textTracks);for(let r=0;r<i.length;r++)if(i[r].mode==="hidden")n=i[r];else if(i[r].mode==="showing"){n=i[r];break}const s=this.findTrackForTextTrack(n);this.subtitleTrack!==s&&this.setSubtitleTrack(s)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.ERROR,this.onError,this)}onMediaAttached(e,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,n){const i=this.media;if(!i)return;const s=!!n.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,s)return;Qo(i.textTracks).forEach(a=>{Cr(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,n){this.tracks=n.subtitleTracks}onSubtitleTrackLoaded(e,n){const{id:i,groupId:s,details:r}=n,a=this.tracksInGroup[i];if(!a||a.groupId!==s){this.warn(`Subtitle track with id:${i} and group:${s} not found in active group ${a==null?void 0:a.groupId}`);return}const l=a.details;a.details=n.details,this.log(`Subtitle track ${i} "${a.name}" lang:${a.lang} group:${s} loaded [${r.startSN}-${r.endSN}]`),i===this.trackId&&this.playlistLoaded(i,n,l)}onLevelLoading(e,n){this.switchLevel(n.level)}onLevelSwitching(e,n){this.switchLevel(n.level)}switchLevel(e){const n=this.hls.levels[e];if(!n)return;const i=n.subtitleGroups||null,s=this.groupIds;let r=this.currentTrack;if(!i||(s==null?void 0:s.length)!==(i==null?void 0:i.length)||i!=null&&i.some(a=>(s==null?void 0:s.indexOf(a))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(c=>!i||i.indexOf(c.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(c=>c.default)&&(this.selectDefaultTrack=!1),a.forEach((c,d)=>{c.id=d});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const l=this.hls.config.subtitlePreference;if(!r&&l){this.selectDefaultTrack=!1;const c=ai(l,a);if(c>-1)r=a[c];else{const d=ai(l,this.tracks);r=this.tracks[d]}}let o=this.findTrackId(r);o===-1&&r&&(o=this.findTrackId(null));const u={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(S.SUBTITLE_TRACKS_UPDATED,u),o!==-1&&this.trackId===-1&&this.setSubtitleTrack(o)}}findTrackId(e){const n=this.tracksInGroup,i=this.selectDefaultTrack;for(let s=0;s<n.length;s++){const r=n[s];if(!(i&&!r.default||!i&&!e)&&(!e||$s(r,e)))return s}if(e){for(let s=0;s<n.length;s++){const r=n[s];if(Al(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return s}for(let s=0;s<n.length;s++){const r=n[s];if(Al(e.attrs,r.attrs,["LANGUAGE"]))return s}}return-1}findTrackForTextTrack(e){if(e){const n=this.tracksInGroup;for(let i=0;i<n.length;i++){const s=n[i];if(ch(s,e))return i}}return-1}onError(e,n){n.fatal||!n.context||n.context.type===Ee.SUBTITLE_TRACK&&n.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(n.context.groupId)!==-1)&&this.checkRetry(n)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const n=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,n.length){const i=this.currentTrack;if(i&&$s(e,i))return i;const s=ai(e,this.tracksInGroup);if(s>-1){const r=this.tracksInGroup[s];return this.setSubtitleTrack(s),r}else{if(i)return null;{const r=ai(e,n);if(r>-1)return n[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=e.id,s=e.groupId,r=this.getUrlWithDirectives(e.url,n),a=e.details,l=a==null?void 0:a.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${s}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(S.SUBTITLE_TRACK_LOADING,{url:r,id:i,groupId:s,deliveryDirectives:n||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const n=Qo(e.textTracks),i=this.currentTrack;let s;if(i&&(s=n.filter(r=>ch(i,r))[0],s||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(n).forEach(r=>{r.mode!=="disabled"&&r!==s&&(r.mode="disabled")}),s){const r=this.subtitleDisplay?"showing":"hidden";s.mode!==r&&(s.mode=r)}}setSubtitleTrack(e){const n=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=n.length||!ee(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,s=n[e]||null;if(this.trackId=e,this.currentTrack=s,this.toggleTrackModes(),!s){this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!s.details&&!s.details.live;if(e===this.trackId&&s===i&&r)return;this.log(`Switching to subtitle-track ${e}`+(s?` "${s.name}" lang:${s.lang} group:${s.groupId}`:""));const{id:a,groupId:l="",name:o,type:u,url:c}=s;this.hls.trigger(S.SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:o,type:u,url:c});const d=this.switchParams(s.url,i==null?void 0:i.details,s.details);this.loadPlaylist(d)}}function P2(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),n=e.toString();return URL.revokeObjectURL(e),n.slice(n.lastIndexOf("/")+1)}catch{let n=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const r=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(s=="x"?r:r&3|8).toString(16)})}}}function Wa(t){let e=5381,n=t.length;for(;n;)e=e*33^t.charCodeAt(--n);return(e>>>0).toString()}const $r=.025;let zu=function(t){return t[t.Point=0]="Point",t[t.Range=1]="Range",t}({});function F2(t,e,n){return`${t.identifier}-${n+1}-${Wa(e)}`}class B2{constructor(e,n){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=n,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var n;if(e>0&&e>=this.assetList.length)return!0;const i=this.playoutLimit;return e<=0||isNaN(i)?!1:i===0?!0:(((n=this.assetList[e])==null?void 0:n.startOffset)||0)>i}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const n=this.dateRange.tagAnchor;if(n)return kd(e,n)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const n=this.dateRange.startTime,i=kd(n,e);return n-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,n=ee(e)?e:this.duration;return this.cumulativeDuration+n}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const n=this.resumeAnchor;if(n)return kd(e,n)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<$r))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let n;return this._duration!==null?n=this._duration:this.dateRange.duration?n=this.dateRange.duration:n=this.dateRange.plannedDuration||0,!isNaN(e)&&e<n&&(n=e),n}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?zu.Range:zu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return U2(this)}}function kd(t,e){return t-e.start<e.duration/2&&!(Math.abs(t-(e.start+e.duration))<$r)?e.start:e.start+e.duration}function lE(t,e,n){const i=new self.URL(t,n);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function _d(t,e){for(;(n=t.assetList[++e])!=null&&n.error;)var n;return e}function U2(t){return`["${t.identifier}" ${t.cue.pre?"<pre>":t.cue.post?"<post>":""}${t.timelineStart.toFixed(2)}-${t.resumeTime.toFixed(2)}]`}function pr(t){const e=t.timelineStart,n=t.duration||0;return`["${t.identifier}" ${e.toFixed(2)}-${(e+n).toFixed(2)}]`}class j2{constructor(e,n,i,s){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(S.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(n);this.interstitial=i,this.assetItem=s;const a=()=>{this.hasDetails=!0};r.once(S.LEVEL_LOADED,a),r.once(S.AUDIO_TRACK_LOADED,a),r.once(S.SUBTITLE_TRACK_LOADED,a),r.on(S.MEDIA_ATTACHING,(l,{media:o})=>{this.removeMediaListeners(),this.mediaAttached=o,this.interstitial.playoutLimit&&(o.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(S.BUFFER_APPENDED,()=>{const c=this.bufferedEnd;this.reachedPlayout(c)&&(this._bufferedEosTime=c,r.trigger(S.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let n=this.assetItem.uri;try{n=lE(n,e.config.primarySessionId||"").href}catch{}e.loadSource(n)}}bufferedInPlaceToEnd(e){var n;if(!this.appendInPlace)return!1;if((n=this.hls)!=null&&n.bufferedToEnd)return!0;if(!e)return!1;const i=Math.min(this._bufferedEosTime||1/0,this.duration),s=this.timelineOffset,r=he.bufferInfo(e,s,0);return this.getAssetTime(r.end)>=i-.02}reachedPlayout(e){const i=this.interstitial.playoutLimit;return this.startOffset+e>=i}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const n=he.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(n.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const n=this.interstitial.playoutLimit;if(n){const i=n-this.startOffset;if(i>0&&i<e)return i}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const n=this.timelineOffset;if(e!==n){const i=e-n;if(Math.abs(i)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const n=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-n),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var n;this.loadSource(),(n=this.hls)==null||n.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const n=i=>delete i.details;e.levels.forEach(n),e.allAudioTracks.forEach(n),e.allSubtitleTracks.forEach(n),this.hasDetails=!1}}on(e,n,i){var s;(s=this.hls)==null||s.on(e,n)}once(e,n,i){var s;(s=this.hls)==null||s.once(e,n)}off(e,n,i){var s;(s=this.hls)==null||s.off(e,n)}toString(){var e;return`HlsAssetPlayer: ${pr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const my=.033;class $2 extends Un{constructor(e,n){super("interstitials-sched",n),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,n){return this.events?this.events.reduce((i,s)=>e<=s.startOffset&&n>s.startOffset?(delete s.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,n){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const s=this.items;if(s)for(s[i]||(n===void 0&&(n=e.start),i=this.findItemIndexAtTime(n));i>=0&&(r=s[i])!=null&&r.event;){var r;i--}return i}findItemIndexAtTime(e,n){const i=this.items;if(i)for(let s=0;s<i.length;s++){let r=i[s];if(n&&n!=="primary"&&(r=r[n]),e===r.start||e>r.start&&e<r.end)return s}return-1}findJumpRestrictedIndex(e,n){const i=this.items;if(i)for(let s=e;s<=n&&i[s];s++){const r=i[s].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return s}return-1}findEventIndex(e){const n=this.items;if(n)for(let s=n.length;s--;){var i;if(((i=n[s].event)==null?void 0:i.identifier)===e)return s}return-1}findAssetIndex(e,n){const i=e.assetList,s=i.length;if(s>1)for(let r=0;r<s;r++){const a=i[r];if(!a.error){const l=a.timelineStart;if(n===l||n>l&&(n<l+(a.duration||0)||r===s-1))return r}}return 0}get assetIdAtEnd(){var e;const n=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(n){const i=n.assetList,s=i[i.length-1];if(s)return s.identifier}return null}parseInterstitialDateRanges(e,n){const i=e.main.details,{dateRanges:s}=i,r=this.events,a=this.parseDateRanges(s,{url:i.url},n),l=Object.keys(s),o=r?r.filter(u=>!l.includes(u.identifier)):[];a.length&&a.sort((u,c)=>{const d=u.cue.pre,f=u.cue.post,h=c.cue.pre,m=c.cue.post;if(d&&!h)return-1;if(h&&!d||f&&!m)return 1;if(m&&!f)return-1;if(!d&&!h&&!f&&!m){const y=u.startTime,x=c.startTime;if(y!==x)return y-x}return u.dateRange.tagOrder-c.dateRange.tagOrder}),this.events=a,o.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,o)}updateSchedule(e,n=[],i=!1){const s=this.events||[];if(s.length||n.length||this.length<2){const r=this.items,a=this.parseSchedule(s,e);(i||n.length||(r==null?void 0:r.length)!==a.length||a.some((o,u)=>Math.abs(o.playout.start-r[u].playout.start)>.005||Math.abs(o.playout.end-r[u].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(n,r))}}parseDateRanges(e,n,i){const s=[],r=Object.keys(e);for(let a=0;a<r.length;a++){const l=r[a],o=e[l];if(o.isInterstitial){let u=this.eventMap[l];u?u.setDateRange(o):(u=new B2(o,n),this.eventMap[l]=u,i===!1&&(u.appendInPlace=i)),s.push(u)}}return s}parseSchedule(e,n){const i=[],s=n.main.details,r=s.live?1/0:s.edge;let a=0;if(e=e.filter(o=>!o.error&&!(o.cue.once&&o.hasPlayed)),e.length){this.resolveOffsets(e,n);let o=0,u=0;if(e.forEach((c,d)=>{const f=c.cue.pre,h=c.cue.post,m=e[d-1]||null,y=c.appendInPlace,x=h?r:c.startOffset,p=c.duration,v=c.timelineOccupancy===zu.Range?p:0,b=c.resumptionOffset,E=(m==null?void 0:m.startTime)===x,k=x+c.cumulativeDuration;let _=y?k+p:x+b;if(f||!h&&x<=0){const C=u;u+=v,c.timelineStart=k;const w=a;a+=p,i.push({event:c,start:k,end:_,playout:{start:w,end:a},integrated:{start:C,end:u}})}else if(x<=r){if(!E){const A=x-o;if(A>my){const I=o,N=u;u+=A;const V=a;a+=A;const G={previousEvent:e[d-1]||null,nextEvent:c,start:I,end:I+A,playout:{start:V,end:a},integrated:{start:N,end:u}};i.push(G)}else A>0&&m&&(m.cumulativeDuration+=A,i[i.length-1].end=x)}h&&(_=k),c.timelineStart=k;const C=u;u+=v;const w=a;a+=p,i.push({event:c,start:k,end:_,playout:{start:w,end:a},integrated:{start:C,end:u}})}else return;const L=c.resumeTime;h||L>r?o=r:o=L}),o<r){var l;const c=o,d=u,f=r-o;u+=f;const h=a;a+=f,i.push({previousEvent:((l=i[i.length-1])==null?void 0:l.event)||null,nextEvent:null,start:o,end:c+f,playout:{start:h,end:a},integrated:{start:d,end:u}})}this.setDurations(r,a,u)}else i.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return i}setDurations(e,n,i){this.durations={primary:e,playout:n,integrated:i}}resolveOffsets(e,n){const i=n.main.details,s=i.live?1/0:i.edge;let r=0,a=-1;e.forEach((l,o)=>{const u=l.cue.pre,c=l.cue.post,d=u?0:c?s:l.startTime;this.updateAssetDurations(l),a===d?l.cumulativeDuration=r:(r=0,a=d),!c&&l.snapOptions.in&&(l.resumeAnchor=Xs(null,i.fragments,l.startOffset+l.resumptionOffset,0,0)||void 0),l.appendInPlace&&!l.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(l,n)||(l.appendInPlace=!1)),!l.appendInPlace&&o+1<e.length&&e[o+1].startTime-e[o].resumeTime<my&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${l}`));const h=ee(l.resumeOffset)?l.resumeOffset:l.duration;r+=h})}primaryCanResumeInPlaceAt(e,n){const i=e.resumeTime,s=e.startTime+e.resumptionOffset;return Math.abs(i-s)>$r?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${s}`),!1):!Object.keys(n).some(a=>{const l=n[a].details,o=l.edge;if(i>=o)return this.log(`"${e.identifier}" resumption ${i} past ${a} playlist end ${o}`),!1;const u=Xs(null,l.fragments,i);if(!u)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${a} playlist (${l.fragStart}-${l.fragmentEnd})`),!0;const c=a==="audio"?.175:0;return Math.abs(u.start-i)<$r+c||Math.abs(u.end-i)<$r+c?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${a} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const n=e.timelineStart;let i=0,s=!1,r=!1;for(let a=0;a<e.assetList.length;a++){const l=e.assetList[a],o=n+i;l.startOffset=i,l.timelineStart=o,s||(s=l.duration===null),r||(r=!!l.error);const u=l.error?0:l.duration||0;i+=u}s&&!r?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Hn(t){return`[${t.event?'"'+t.event.identifier+'"':"primary"}: ${t.start.toFixed(2)}-${t.end.toFixed(2)}]`}class z2{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,n){const i=e.assetListUrl;let s;try{s=lE(i,this.hls.sessionId,e.baseUrl)}catch(f){const h=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,f,i);this.hls.trigger(S.ERROR,h);return}n&&s.protocol!=="data:"&&s.searchParams.set("_HLS_start_offset",""+n);const r=this.hls.config,a=r.loader,l=new a(r),o={responseType:"json",url:s.href},u=r.interstitialAssetListLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,y)=>{const x=f.data,p=x==null?void 0:x.ASSETS;if(!Array.isArray(p)){const v=this.assignAssetListError(e,O.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),m.url,h,y);this.hls.trigger(S.ERROR,v);return}e.assetListResponse=x,this.hls.trigger(S.ASSET_LIST_LOADED,{event:e,assetListResponse:x,networkDetails:y})},onError:(f,h,m,y)=>{const x=this.assignAssetListError(e,O.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${f.code} ${f.text} (${h.url})`),h.url,y,m);this.hls.trigger(S.ERROR,x)},onTimeout:(f,h,m)=>{const y=this.assignAssetListError(e,O.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,f,m);this.hls.trigger(S.ERROR,y)}};return l.load(o,c,d),this.hls.trigger(S.ASSET_LIST_LOADING,{event:e}),l}assignAssetListError(e,n,i,s,r,a){return e.error=i,{type:re.NETWORK_ERROR,details:n,fatal:!1,interstitial:e,url:s,error:i,networkDetails:a,stats:r}}}function gy(t){var e;t==null||(e=t.play())==null||e.catch(()=>{})}function po(t,e){return`[${t}] Advancing timeline position to ${e}`}class G2 extends Un{constructor(e,n){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled||!this.schedule)return;const s=i-this.timelinePos;if(Math.abs(s)<1/7056e5)return;const a=s<=-.01;this.timelinePos=i,this.bufferedPos=i;const l=this.playingItem;if(!l){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(i,i-s)&&this.updateSchedule(!0),this.checkBuffer(),a&&i<l.start||i>=l.end){var o;const h=this.findItemIndex(l);let m=this.schedule.findItemIndexAtTime(i);if(m===-1&&(m=h+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${i} (resolving from ${h} to ${m})`)),!this.isInterstitial(l)&&(o=this.media)!=null&&o.paused&&(this.shouldPlay=!1),!a&&m>h){const y=this.schedule.findJumpRestrictedIndex(h+1,m);if(y>h){this.setSchedulePosition(y);return}}this.setSchedulePosition(m);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(l)){const h=l.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,h))}return}const c=u.timelineStart,d=u.duration||0;if(a&&i<c||i>=c+d){var f;(f=l.event)!=null&&f.appendInPlace&&(this.clearAssetPlayers(l.event,l),this.flushFrontBuffer(i)),this.setScheduleToAssetAtTime(i,u)}},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const s=this.playingItem;if(!s||this.playingLastItem)return;if(i>=s.end){this.timelinePos=s.end;const l=this.findItemIndex(s);this.setSchedulePosition(l+1)}const r=this.playingAsset;if(!r)return;const a=r.timelineStart+(r.duration||0);i>=a&&this.setScheduleToAssetAtTime(i,r)},this.onScheduleUpdate=(i,s)=>{const r=this.schedule;if(!r)return;const a=this.playingItem,l=r.events||[],o=r.items||[],u=r.durations,c=i.map(y=>y.identifier),d=!!(l.length||c.length);(d||s)&&this.log(`INTERSTITIALS_UPDATED (${l.length}): ${l}
Schedule: ${o.map(y=>Hn(y))} pos: ${this.timelinePos}`),c.length&&this.log(`Removed events ${c}`);let f=null,h=null;a&&(f=this.updateItem(a,this.timelinePos),this.itemsMatch(a,f)?this.playingItem=f:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const m=this.bufferingItem;if(m&&(h=this.updateItem(m,this.bufferedPos),this.itemsMatch(m,h)?this.bufferingItem=h:m.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(m.event,null))),i.forEach(y=>{y.assetList.forEach(x=>{this.clearAssetPlayer(x.identifier,null)})}),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const x=y.assetItem.timelineStart,p=y.timelineOffset-x;if(p)try{y.timelineOffset=x}catch(v){Math.abs(p)>$r&&this.warn(`${v} ("${y.assetId}" ${y.timelineOffset}->${x})`)}}}),d||s){if(this.hls.trigger(S.INTERSTITIALS_UPDATED,{events:l.slice(0),schedule:o.slice(0),durations:u,removedIds:c}),this.isInterstitial(a)&&c.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(f,a),m&&h!==f&&this.trimInPlace(h,m),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=n,this.assetListLoader=new z2(e),this.schedule=new $2(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(S.MEDIA_ENDED,this.onMediaEnded,this),e.on(S.ERROR,this.onError,this),e.on(S.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(S.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(S.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(S.BUFFER_CODECS,this.onBufferCodecs,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(S.MEDIA_ENDED,this.onMediaEnded,this),e.off(S.ERROR,this.onError,this),e.off(S.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Wt(e,"play",this.onPlay),Wt(e,"pause",this.onPause),Wt(e,"seeking",this.onSeeking),Wt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,n){const i=this.media=n.media;zt(i,"seeking",this.onSeeking),zt(i,"timeupdate",this.onTimeupdate),zt(i,"play",this.onPlay),zt(i,"pause",this.onPause)}onMediaAttached(e,n){const i=this.effectivePlayingItem,s=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!s){this.clearScheduleState();const r=this.findItemIndex(i);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,n){const i=!!n.transferMedia,s=this.media;if(this.media=null,!i&&(s&&this.removeMediaListeners(s),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,n=()=>e.bufferingItem||e.waitingItem,i=d=>d&&e.getAssetPlayer(d.identifier),s=(d,f,h,m,y)=>{if(d){let x=d[f].start;const p=d.event;if(p){if(f==="playout"||p.timelineOccupancy!==zu.Point){const v=i(h);(v==null?void 0:v.interstitial)===p&&(x+=v.assetItem.startOffset+v[y])}}else{const v=m==="bufferedPos"?a():e[m];x+=v-d.start}return x}return 0},r=(d,f)=>{var h;if(d!==0&&f!=="primary"&&(h=e.schedule)!=null&&h.length){var m;const y=e.schedule.findItemIndexAtTime(d),x=(m=e.schedule.items)==null?void 0:m[y];if(x){const p=x[f].start-x.start;return d+p}}return d},a=()=>{const d=e.bufferedPos;return d===Number.MAX_VALUE?l("primary"):Math.max(d,0)},l=d=>{var f,h;return(f=e.primaryDetails)!=null&&f.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[d])||0},o=(d,f)=>{var h,m;const y=e.effectivePlayingItem;if(y!=null&&(h=y.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${d} "${f}"`);const x=e.effectivePlayingItem,p=e.schedule.findItemIndexAtTime(d,f),v=(m=e.schedule.items)==null?void 0:m[p],b=e.getBufferingPlayer(),E=b==null?void 0:b.interstitial,k=E==null?void 0:E.appendInPlace,_=x&&e.itemsMatch(x,v);if(x&&(k||_)){const L=i(e.playingAsset),C=(L==null?void 0:L.media)||e.primaryMedia;if(C){const w=f==="primary"?C.currentTime:s(x,f,e.playingAsset,"timelinePos","currentTime"),A=d-w,I=(k?w:C.currentTime)+A;if(I>=0&&(!L||k||I<=L.duration)){C.currentTime=I;return}}}if(v){let L=d;if(f!=="primary"){const w=v[f].start,A=d-w;L=v.start+A}const C=!e.isInterstitial(v);if((!e.isInterstitial(x)||x.event.appendInPlace)&&(C||v.event.appendInPlace)){const w=e.media||(k?b==null?void 0:b.media:null);w&&(w.currentTime=L)}else if(x){const w=e.findItemIndex(x);if(p>w){const I=e.schedule.findJumpRestrictedIndex(w+1,p);if(I>w){e.setSchedulePosition(I);return}}let A=0;if(C)e.timelinePos=L,e.checkBuffer();else{const I=v.event.assetList,N=d-(v[f]||v).start;for(let V=I.length;V--;){const G=I[V];if(G.duration&&N>=G.startOffset&&N<G.startOffset+G.duration){A=V;break}}}e.setSchedulePosition(p,A)}}},u=()=>{const d=e.effectivePlayingItem;if(e.isInterstitial(d))return d;const f=n();return e.isInterstitial(f)?f:null},c={get bufferedEnd(){const d=n(),f=e.bufferingItem;if(f&&f===d){var h;return s(f,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-f.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const d=u(),f=e.effectivePlayingItem;return f&&f===d?s(f,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-f.playout.start:0},set currentTime(d){const f=u(),h=e.effectivePlayingItem;h&&h===f&&o(d+h.playout.start,"playout")},get duration(){const d=u();return d?d.playout.end-d.playout.start:0},get assetPlayers(){var d;const f=(d=u())==null?void 0:d.event.assetList;return f?f.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var d;const f=(d=u())==null?void 0:d.event;return f&&e.effectivePlayingAsset?f.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var d;return((d=e.schedule)==null||(d=d.events)==null?void 0:d.slice(0))||[]},get schedule(){var d;return((d=e.schedule)==null||(d=d.items)==null?void 0:d.slice(0))||[]},get interstitialPlayer(){return u()?c:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return n()},get bufferingIndex(){const d=n();return e.findItemIndex(d)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const d=e.effectivePlayingItem;return e.findItemIndex(d)},primary:{get bufferedEnd(){return a()},get currentTime(){const d=e.timelinePos;return d>0?d:0},set currentTime(d){o(d,"primary")},get duration(){return l("primary")},get seekableStart(){var d;return((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0}},integrated:{get bufferedEnd(){return s(n(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return s(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(d){o(d,"integrated")},get duration(){return l("integrated")},get seekableStart(){var d;return r(((d=e.primaryDetails)==null?void 0:d.fragmentStart)||0,"integrated")}},skip:()=>{const d=e.effectivePlayingItem,f=d==null?void 0:d.event;if(f&&!f.restrictions.skip){const h=e.findItemIndex(d);if(f.appendInPlace){const m=d.playout.start+d.event.duration;o(m+.001,"playout")}else e.advanceAfterAssetEnded(f,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const n=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!n||!i?!1:this.findItemIndex(n)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,n;if(this.mediaSelection===null)return;const i=this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&!i.event.appendInPlace)return;let s=this.media;!s&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(s=this.primaryMedia);const r=(n=s)==null?void 0:n.currentTime;if(!(r===void 0||!ee(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,n){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,n)}transferMediaFromPlayer(e,n){const i=e.interstitial.appendInPlace,s=e.media;if(i&&s===this.primaryMedia){if(this.bufferingAsset=null,(!n||this.isInterstitial(n)&&!n.event.appendInPlace)&&n&&s){this.detachedData={media:s};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ge(r)}`),this.detachedData=r}else n&&s&&(this.shouldPlay||(this.shouldPlay=!s.paused))}transferMediaTo(e,n){var i,s;if(e.media===n)return;let r=null;const a=this.hls,l=e!==a,o=l&&e.interstitial.appendInPlace,u=(i=this.detachedData)==null?void 0:i.mediaSource;let c;if(a.media)o&&(r=a.transferMedia(),this.detachedData=r),c="Primary";else if(u){const m=this.getBufferingPlayer();m?(r=m.transferMedia(),c=`${m}`):c="detached MediaSource"}else c="detached media";if(!r){if(u)r=this.detachedData,this.log(`using detachedData: MediaSource ${Ge(r)}`);else if(!this.detachedData||a.media===n){const m=this.playerQueue;m.length>1&&m.forEach(y=>{if(l&&y.interstitial.appendInPlace!==o){const x=y.interstitial;this.clearInterstitial(y.interstitial,null),x.appendInPlace=!1,x.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${x}`)}}),this.hls.detachMedia(),this.detachedData={media:n}}}const d=r&&"mediaSource"in r&&((s=r.mediaSource)==null?void 0:s.readyState)!=="closed",f=d&&r?r:n;this.log(`${d?"transfering MediaSource":"attaching media"} to ${l?e:"Primary"} from ${c} (media.currentTime: ${n.currentTime})`);const h=this.schedule;if(f===r&&h){const m=l&&e.assetId===h.assetIdAtEnd;f.overrides={duration:h.duration,endOfStream:!l||m,cueRemoval:!l}}e.attachMedia(f)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,n=e==null?void 0:e.events;if(!n||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,s=this.effectivePlayingItem;if(i===-1){const r=this.hls.startPosition;if(this.log(po("checkStart",r)),this.timelinePos=r,n.length&&n[0].cue.pre){const a=e.findEventIndex(n[0].identifier);this.setSchedulePosition(a)}else if(r>=0||!this.primaryLive){const a=this.timelinePos=r>0?r:0,l=e.findItemIndexAtTime(a);this.setSchedulePosition(l)}}else if(s&&!this.playingItem){const r=e.findItemIndex(s);this.setSchedulePosition(r)}}advanceAssetBuffering(e,n){const i=e.event,s=i.findAssetIndex(n),r=_d(i,s);if(!i.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var a;const l=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];l&&this.bufferedToItem(l)}}advanceAfterAssetEnded(e,n,i){const s=_d(e,i);if(e.isAssetPastPlayoutLimit(s)){if(this.schedule){const r=this.schedule.items;if(r){const a=n+1,l=r.length;if(a>=l){this.setSchedulePosition(-1);return}const o=e.resumeTime;this.timelinePos<o&&(this.log(po("advanceAfterAssetEnded",o)),this.timelinePos=o,e.appendInPlace&&this.advanceInPlace(o),this.checkBuffer(this.bufferedPos<o)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const r=e.assetList[s];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(n,s)}}setScheduleToAssetAtTime(e,n){const i=this.schedule;if(!i)return;const s=n.parentIdentifier,r=i.getEvent(s);if(r){const a=i.findEventIndex(s),l=i.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,a,l-1)}}setSchedulePosition(e,n){var i;const s=(i=this.schedule)==null?void 0:i.items;if(!s||this.playbackDisabled)return;const r=e>=0?s[e]:null;this.log(`setSchedulePosition ${e}, ${n} (${r&&Hn(r)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,l=this.playingLastItem;if(this.isInterstitial(a)){const c=a.event,d=this.playingAsset,f=d==null?void 0:d.identifier,h=f?this.getAssetPlayer(f):null;if(h&&f&&(!this.eventItemsMatch(a,r)||n!==void 0&&f!==c.assetList[n].identifier)){var o;const m=c.findAssetIndex(d);if(this.log(`INTERSTITIAL_ASSET_ENDED ${m+1}/${c.assetList.length} ${pr(d)}`),this.endedAsset=d,this.playingAsset=null,this.hls.trigger(S.INTERSTITIAL_ASSET_ENDED,{asset:d,assetListIndex:m,event:c,schedule:s.slice(0),scheduleIndex:e,player:h}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),m);return}this.retreiveMediaSource(f,r),h.media&&!((o=this.detachedData)!=null&&o.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${Hn(a)}`),c.hasPlayed=!0,this.hls.trigger(S.INTERSTITIAL_ENDED,{event:c,schedule:s.slice(0),scheduleIndex:e}),c.cue.once)){var u;this.updateSchedule();const m=(u=this.schedule)==null?void 0:u.items;if(r&&m){const y=this.findItemIndex(r);this.advanceSchedule(y,m,n,a,l)}return}}this.advanceSchedule(e,s,n,a,l)}advanceSchedule(e,n,i,s,r){const a=this.schedule;if(!a)return;const l=n[e]||null,o=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(c=>{const d=c.interstitial,f=a.findEventIndex(d.identifier);(f<e||f>e+1)&&this.clearInterstitial(d,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const c=l.event;if(i===void 0){i=a.findAssetIndex(c,this.timelinePos);const m=_d(c,i-1);if(c.isAssetPastPlayoutLimit(m)||c.appendInPlace&&this.timelinePos===l.end){this.advanceAfterAssetEnded(c,e,i);return}i=m}const d=this.waitingItem;this.assetsBuffered(l,o)||this.setBufferingItem(l);let f=this.preloadAssets(c,i);if(this.eventItemsMatch(l,d||s)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${Hn(l)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(S.INTERSTITIAL_STARTED,{event:c,schedule:n.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!o){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const h=c.assetList[i];if(!h){this.advanceAfterAssetEnded(c,e,i||0);return}if(f||(f=this.getAssetPlayer(h.identifier)),f===null||f.destroyed){const m=c.assetList.length;this.warn(`asset ${i+1}/${m} player destroyed ${c}`),f=this.createAssetPlayer(c,h,i),f.loadSource()}if(!this.eventItemsMatch(l,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(f,i,n,e,o),this.shouldPlay&&gy(f.media)}else l?(this.resumePrimary(l,e,s),this.shouldPlay&&gy(this.hls.media)):r&&this.isInterstitial(s)&&(this.endedItem=null,this.playingItem=s,s.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,n,i){var s,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Hn(e)}`),!((s=this.detachedData)!=null&&s.mediaSource)){let l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,n),this.log(po("resumePrimary",l)),this.timelinePos=l),this.attachPrimary(l,e)}if(!i)return;const a=(r=this.schedule)==null?void 0:r.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Hn(e)}`),this.hls.trigger(S.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:n}),this.checkBuffer())}getPrimaryResumption(e,n){const i=e.start;if(this.primaryLive){const s=this.primaryDetails;if(n===0)return this.hls.startPosition;if(s&&(i<s.fragmentStart||i>s.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const n=this.getAssetPlayer(e.identifier);return n!=null&&n.hls?n.hls.bufferedToEnd:he.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,n,i){n?this.setBufferingItem(n):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const s=this.primaryMedia;if(!s)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,s),i&&this.startLoadingPrimaryAt(e,i)),i||(this.log(po("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,n){var i;const s=this.hls;!s.loadingEnabled||!s.media||Math.abs((((i=s.mainForwardBufferInfo)==null?void 0:i.start)||s.media.currentTime)-e)>.5?s.startLoad(e,n):s.bufferingEnabled||s.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(S.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(S.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,n){if(n.level===-1||!this.schedule)return;const i=this.hls.levels[n.level];if(!i.details)return;const s=Me(Me({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=s,this.schedule.parseInterstitialDateRanges(s,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,n){const i=this.hls.audioTracks[n.id],s=this.mediaSelection;if(!s){this.altSelection=Me(Me({},this.altSelection),{},{audio:i});return}const r=Me(Me({},s),{},{audio:i});this.mediaSelection=r}onSubtitleTrackUpdated(e,n){const i=this.hls.subtitleTracks[n.id],s=this.mediaSelection;if(!s){this.altSelection=Me(Me({},this.altSelection),{},{subtitles:i});return}const r=Me(Me({},s),{},{subtitles:i});this.mediaSelection=r}onAudioTrackSwitching(e,n){const i=Ap(n);this.playerQueue.forEach(({hls:s})=>s&&(s.setAudioOption(n)||s.setAudioOption(i)))}onSubtitleTrackSwitch(e,n){const i=Ap(n);this.playerQueue.forEach(({hls:s})=>s&&(s.setSubtitleOption(n)||n.id!==-1&&s.setSubtitleOption(i)))}onBufferCodecs(e,n){const i=n.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,n){this.checkBuffer()}onBufferFlushed(e,n){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const s=this.timelinePos;this.bufferedPos=s,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const n=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&n){for(let s=0;s<n.length;s++){const r=n[s];if(r.cue.post){var i;const a=this.schedule.findEventIndex(r.identifier),l=(i=this.schedule.items)==null?void 0:i[a];this.isInterstitial(l)&&this.eventItemsMatch(l,this.bufferingItem)&&this.bufferedToItem(l,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const n=this.playingItem;if(!this.playingLastItem&&n){const i=this.findItemIndex(n);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,n){var i;const s=(i=this.schedule)==null?void 0:i.items;if(e&&s){const r=this.findItemIndex(e,n);return s[r]||null}return null}trimInPlace(e,n){if(this.isInterstitial(e)&&e.event.appendInPlace&&n.end-e.end>.25){e.event.assetList.forEach((r,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(r.identifier,null)});const i=e.end+.25,s=he.bufferInfo(this.primaryMedia,i,0);(s.end>i||(s.nextStart||0)>i)&&(this.log(`trim buffered interstitial ${Hn(e)} (was ${Hn(n)})`),this.attachPrimary(i,null,!0),this.flushFrontBuffer(i))}}itemsMatch(e,n){return!!n&&(e===n||e.event&&n.event&&this.eventItemsMatch(e,n)||!e.event&&!n.event&&this.findItemIndex(e)===this.findItemIndex(n))}eventItemsMatch(e,n){var i;return!!n&&(e===n||e.event.identifier===((i=n.event)==null?void 0:i.identifier))}findItemIndex(e,n){return e&&this.schedule?this.schedule.findItemIndex(e,n):-1}updateSchedule(e=!1){var n;const i=this.mediaSelection;i&&((n=this.schedule)==null||n.updateSchedule(i,[],e))}checkBuffer(e){var n;const i=(n=this.schedule)==null?void 0:n.items;if(!i)return;const s=he.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=s.len<1),this.updateBufferedPos(s.end,i,e)}updateBufferedPos(e,n,i){const s=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!s)return;if(n.length===1&&this.itemsMatch(n[0],r)){this.bufferedPos=e;return}const a=this.playingItem,l=this.findItemIndex(a);let o=s.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const c=this.findItemIndex(r),d=Math.min(c+1,n.length-1),f=n[d];if((o===-1&&r&&e>=r.end||(u=f.event)!=null&&u.appendInPlace&&e+.01>=f.start)&&(o=d),this.isInterstitial(r)){const h=r.event;if(d-l>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,o>c&&o>l)this.bufferedToItem(f);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&f.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(f)&&this.preloadAssets(f.event,0)}}else i&&a&&!this.itemsMatch(a,r)&&(o===l?this.bufferedToItem(a):o===l+1&&this.bufferedToItem(n[o]))}assetsBuffered(e,n){return e.event.assetList.length===0?!1:!e.event.assetList.some(s=>{const r=this.getAssetPlayer(s.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(n))})}setBufferingItem(e){const n=this.bufferingItem,i=this.schedule;if(!this.itemsMatch(e,n)&&i){const{items:s,events:r}=i;if(!s||!r)return n;const a=this.isInterstitial(e),l=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=l?l.remaining:n?n.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Hn(e)}`+(n?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const u=i.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((c,d)=>{const f=this.getAssetPlayer(c.identifier);f&&(d===u&&f.loadSource(),f.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(S.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:s.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return n}bufferedToItem(e,n=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,n);else if(i!==null){this.bufferingAsset=null;const s=this.detachedData;s?s.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const n=this.findItemIndex(e),i=this.getPrimaryResumption(e,n);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,n){const i=e.event,s=i.assetList.length===0&&!i.assetListLoader,r=i.cue.once;if(s||!r){const a=this.preloadAssets(i,n);if(a!=null&&a.interstitial.appendInPlace){const l=this.primaryMedia;l&&this.bufferAssetPlayer(a,l)}}}preloadAssets(e,n){const i=e.assetUrl,s=e.assetList.length,r=s===0&&!e.assetListLoader,a=e.cue.once;if(r){const o=e.timelineStart;if(e.appendInPlace){var l;const f=this.playingItem;!this.isInterstitial(f)&&(f==null||(l=f.nextEvent)==null?void 0:l.identifier)===e.identifier&&this.flushFrontBuffer(o+.25)}let u,c=0;if(!this.playingItem&&this.primaryLive&&(c=this.hls.startPosition,c===-1&&(c=this.hls.liveSyncPosition||0)),c&&!(e.cue.pre||e.cue.post)){const f=c-o;f>0&&(u=Math.round(f*1e3)/1e3)}if(this.log(`Load interstitial asset ${n+1}/${i?1:s} ${e}${u?` live-start: ${c} start-offset: ${u}`:""}`),i)return this.createAsset(e,0,0,o,e.duration,i);const d=this.assetListLoader.loadAssetList(e,u);d&&(e.assetListLoader=d)}else if(!a&&s){for(let u=n;u<s;u++){const c=e.assetList[u],d=this.getAssetPlayerQueueIndex(c.identifier);(d===-1||this.playerQueue[d].destroyed)&&!c.error&&this.createAssetPlayer(e,c,u)}const o=e.assetList[n];if(o){const u=this.getAssetPlayer(o.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const n=this.requiredTracks;if(!n)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(n).forEach(s=>{this.hls.trigger(S.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:s})})}getAssetPlayerQueueIndex(e){const n=this.playerQueue;for(let i=0;i<n.length;i++)if(e===n[i].assetId)return i;return-1}getAssetPlayer(e){const n=this.getAssetPlayerQueueIndex(e);return this.playerQueue[n]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:n}=this;if(n){for(let i=0;i<e.length;i++)if(e[i].media===n)return e[i]}return null}createAsset(e,n,i,s,r,a){const l={parentIdentifier:e.identifier,identifier:F2(e,a,n),duration:r,startOffset:i,timelineStart:s,uri:a};return this.createAssetPlayer(e,l,n)}createAssetPlayer(e,n,i){const s=this.hls,r=s.userConfig;let a=r.videoPreference;const l=s.loadLevelObj||s.levels[s.currentLevel];(a||l)&&(a=$e({},a),l.videoCodec&&(a.videoCodec=l.videoCodec),l.videoRange&&(a.allowedVideoRanges=[l.videoRange]));const o=s.audioTracks[s.audioTrack],u=s.subtitleTracks[s.subtitleTrack];let c=0;if(this.primaryLive||e.appendInPlace){const E=this.timelinePos-n.timelineStart;if(E>1){const k=n.duration;k&&E<k&&(c=E)}}const d=n.identifier,f=Me(Me({},r),{},{maxMaxBufferLength:Math.min(180,s.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:s.sessionId,assetPlayerId:d,abrEwmaDefaultEstimate:s.bandwidthEstimate,interstitialsController:void 0,startPosition:c,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:o||r.audioPreference,subtitlePreference:u||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,n.timelineStart&&(f.timelineOffset=n.timelineStart));const h=f.cmcd;h!=null&&h.sessionId&&h.contentId&&(f.cmcd=$e({},h,{contentId:Wa(n.uri)})),this.getAssetPlayer(d)&&this.warn(`Duplicate date range identifier ${e} and asset ${d}`);const m=new j2(this.HlsPlayerClass,f,e,n);this.playerQueue.push(m),e.assetList[i]=n;let y=!0;const x=E=>{if(E.live){var k;const C=new Error(`Interstitials MUST be VOD assets ${e}`),w={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:C},A=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(w,e,A,i,C.message);return}const _=E.edge-E.fragmentStart,L=n.duration;(y||L===null||_>L)&&(y=!1,this.log(`Interstitial asset "${d}" duration change ${L} > ${_}`),n.duration=_,this.updateSchedule())};m.on(S.LEVEL_UPDATED,(E,{details:k})=>x(k)),m.on(S.LEVEL_PTS_UPDATED,(E,{details:k})=>x(k)),m.on(S.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const p=(E,k)=>{const _=this.getAssetPlayer(d);if(_&&k.tracks){_.off(S.BUFFER_CODECS,p),_.tracks=k.tracks;const L=this.primaryMedia;this.bufferingAsset===_.assetItem&&L&&!_.media&&this.bufferAssetPlayer(_,L)}};m.on(S.BUFFER_CODECS,p);const v=()=>{var E;const k=this.getAssetPlayer(d);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const _=this.schedule.findEventIndex(e.identifier),L=(E=this.schedule.items)==null?void 0:E[_];this.isInterstitial(L)&&this.advanceAssetBuffering(L,n)};m.on(S.BUFFERED_TO_END,v);const b=E=>()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;this.shouldPlay=!0;const _=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,_,E)};return m.once(S.MEDIA_ENDED,b(i)),m.once(S.PLAYOUT_LIMIT_REACHED,b(1/0)),m.on(S.ERROR,(E,k)=>{if(!this.schedule)return;const _=this.getAssetPlayer(d);if(k.details===O.BUFFER_STALLED_ERROR){if(_!=null&&_.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${k.error} ${e}`)}),m.on(S.DESTROYING,()=>{if(!this.getAssetPlayer(d)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${d}`),_={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(_,e,this.schedule.findEventIndex(e.identifier),i,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${pr(n)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:n,assetListIndex:i,event:e,player:m}),m}clearInterstitial(e,n){this.clearAssetPlayers(e,n),e.reset()}clearAssetPlayers(e,n){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,n)})}resetAssetPlayer(e){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){this.log(`reset asset player "${e}" after error`);const i=this.playerQueue[n];this.transferMediaFromPlayer(i,null),i.resetDetails()}}clearAssetPlayer(e,n){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){const s=this.playerQueue[i];this.log(`clear ${s} toSegment: ${n&&Hn(n)}`),this.transferMediaFromPlayer(s,n),this.playerQueue.splice(i,1),s.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,n,i,s,r){const{interstitial:a,assetItem:l,assetId:o}=e,u=a.assetList.length,c=this.playingAsset;this.endedAsset=null,this.playingAsset=l,(!c||c.identifier!==o)&&(c&&(this.clearAssetPlayer(c.identifier,i[s]),delete c.error),this.log(`INTERSTITIAL_ASSET_STARTED ${n+1}/${u} ${pr(l)}`),this.hls.trigger(S.INTERSTITIAL_ASSET_STARTED,{asset:l,assetListIndex:n,event:a,schedule:i.slice(0),scheduleIndex:s,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,n){var i,s;if(!this.schedule)return;const{interstitial:r,assetItem:a}=e,l=this.schedule.findEventIndex(r.identifier),o=(i=this.schedule.items)==null?void 0:i[l];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=a;const u=this.getBufferingPlayer();if(u===e)return;const c=r.appendInPlace;if(c&&(u==null?void 0:u.interstitial.appendInPlace)===!1)return;const d=(u==null?void 0:u.tracks)||((s=this.detachedData)==null?void 0:s.tracks)||this.requiredTracks;if(c&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(d&&!G1(d,e.tracks)){const f=new Error(`Asset ${pr(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(d)}')`),h={fatal:!0,type:re.OTHER_ERROR,details:O.INTERSTITIAL_ASSET_ITEM_ERROR,error:f},m=r.findAssetIndex(a);this.handleAssetItemError(h,r,l,m,f.message);return}}this.transferMediaTo(e,n)}handleInPlaceStall(e){const n=this.schedule,i=this.primaryMedia;if(!n||!i)return;const s=i.currentTime,r=n.findAssetIndex(e,s),a=e.assetList[r];if(a){const l=this.getAssetPlayer(a.identifier);if(l){const o=l.currentTime||s-a.timelineStart,u=l.duration-o;if(this.warn(`Stalled at ${o} of ${o+u} in ${l} ${e} (media.currentTime: ${s})`),o&&(u/i.playbackRate<.5||l.bufferedInPlaceToEnd(i))&&l.hls){const c=n.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,c,r)}}}}advanceInPlace(e){const n=this.primaryMedia;n&&n.currentTime<e&&(n.currentTime=e)}handleAssetItemError(e,n,i,s,r){if(e.details===O.BUFFER_STALLED_ERROR)return;const a=n.assetList[s]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&pr(a)} ${e.error}`),!this.schedule)return;const l=(a==null?void 0:a.identifier)||"",o=this.getAssetPlayerQueueIndex(l),u=this.playerQueue[o]||null,c=this.schedule.items,d=$e({},e,{fatal:!1,errorAction:Br(!0),asset:a,assetListIndex:s,event:n,schedule:c,scheduleIndex:i,player:u});if(this.hls.trigger(S.INTERSTITIAL_ASSET_ERROR,d),!e.fatal)return;const f=this.playingAsset,h=this.bufferingAsset,m=new Error(r);if(a&&(this.clearAssetPlayer(l,null),a.error=m),!n.assetList.some(y=>!y.error))n.error=m;else for(let y=s;y<n.assetList.length;y++)this.resetAssetPlayer(n.assetList[y].identifier);this.updateSchedule(!0),n.error?this.primaryFallback(n):f&&f.identifier===l?this.advanceAfterAssetEnded(n,i,s):h&&h.identifier===l&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const n=e.timelineStart,i=this.effectivePlayingItem;let s=this.timelinePos;if(i){this.log(`Fallback to primary from event "${e.identifier}" start: ${n} pos: ${s} playing: ${Hn(i)} error: ${e.error}`),s===-1&&(s=this.hls.startPosition);const a=this.updateItem(i,s);this.itemsMatch(i,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(n,null),this.flushFrontBuffer(n))}else if(s===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(s);this.setSchedulePosition(r)}onAssetListLoaded(e,n){var i,s;const r=n.event,a=r.identifier,l=n.assetListResponse.ASSETS;if(!((i=this.schedule)!=null&&i.hasEvent(a)))return;const o=r.timelineStart,u=r.duration;let c=0;l.forEach((y,x)=>{const p=parseFloat(y.DURATION);this.createAsset(r,x,c,o+c,p,y.URI),c+=p}),r.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${u}) ${r}`);const d=this.waitingItem,f=(d==null?void 0:d.event.identifier)===a;this.updateSchedule();const h=(s=this.bufferingItem)==null?void 0:s.event;if(f){var m;const y=this.schedule.findEventIndex(a),x=(m=this.schedule.items)==null?void 0:m[y];if(x){if(!this.playingItem&&this.timelinePos>x.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){r.error=new Error(`Interstitial ${l.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(x)}this.setSchedulePosition(y)}else if((h==null?void 0:h.identifier)===a){const y=r.assetList[0];if(y){const x=this.getAssetPlayer(y.identifier);if(h.appendInPlace){const p=this.primaryMedia;x&&p&&this.bufferAssetPlayer(x,p)}else x&&x.loadSource()}}}onError(e,n){if(this.schedule)switch(n.details){case O.ASSET_LIST_PARSING_ERROR:case O.ASSET_LIST_LOAD_ERROR:case O.ASSET_LIST_LOAD_TIMEOUT:{const i=n.interstitial;i&&(this.updateSchedule(!0),this.primaryFallback(i));break}case O.BUFFER_STALLED_ERROR:{const i=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(i)&&i.event.appendInPlace){this.handleInPlaceStall(i.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const py=500;class H2 extends Km{constructor(e,n,i){super(e,n,i,"subtitle-stream-controller",ne.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(S.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(S.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,n){this.stopLoad(),this.state=H.IDLE,this.setInterval(py),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,n){this.tracksBuffered=[],super.onMediaDetaching(e,n)}onLevelLoaded(e,n){this.mainDetails=n.details}onSubtitleFragProcessed(e,n){const{frag:i,success:s}=n;if(this.fragContextChanged(i)||(ut(i)&&(this.fragPrevious=i),this.state=H.IDLE),!s)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let a;const l=i.start;for(let u=0;u<r.length;u++)if(l>=r[u].start&&l<=r[u].end){a=r[u];break}const o=i.start+i.duration;a?a.end=o:(a={start:l,end:o},r.push(a)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,n){const{startOffset:i,endOffset:s}=n;if(i===0&&s!==Number.POSITIVE_INFINITY){const r=s-1;if(r<=0)return;n.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(a=>{for(let l=0;l<a.length;){if(a[l].end<=r){a.shift();continue}else if(a[l].start<r)a[l].start=r;else break;l++}}),this.fragmentTracker.removeFragmentsInRange(i,r,ne.SUBTITLE)}}onError(e,n){const i=n.frag;(i==null?void 0:i.type)===ne.SUBTITLE&&(n.details===O.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==H.STOPPED&&(this.state=H.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:n}){if(this.levels&&KS(this.levels,n)){this.levels=n.map(i=>new bl(i));return}this.tracksBuffered=[],this.levels=n.map(i=>{const s=new bl(i);return this.tracksBuffered[s.id]=[],s}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ne.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,n){var i;if(this.currentTrackId=n.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const s=this.levels[this.currentTrackId];s!=null&&s.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,s&&this.state!==H.STOPPED&&this.setInterval(py)}onSubtitleTrackLoaded(e,n){var i;const{currentTrackId:s,levels:r}=this,{details:a,id:l}=n;if(!r){this.warn(`Subtitle tracks were reset while loading level ${l}`);return}const o=r[l];if(l>=r.length||!o)return;this.log(`Subtitle track ${l} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(a.live||(i=o.details)!=null&&i.live){if(a.deltaUpdateFailed)return;const d=this.mainDetails;if(!d){this.startFragRequested=!1;return}const f=d.fragments[0];if(!o.details)a.hasProgramDateTime&&d.hasProgramDateTime?(ju(a,d),u=a.fragmentStart):f&&(u=f.start,lh(a,u));else{var c;u=this.alignPlaylists(a,o.details,(c=this.levelLastLoaded)==null?void 0:c.details),u===0&&f&&(u=f.start,lh(a,u))}d&&!this.startFragRequested&&this.setStartPosition(d,u)}o.details=a,this.levelLastLoaded=o,l===s&&(this.hls.trigger(S.SUBTITLE_TRACK_UPDATED,{details:a,id:l,groupId:n.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===H.IDLE&&(Xs(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:n,payload:i}=e,s=n.decryptdata,r=this.hls;if(!this.fragContextChanged(n)&&i&&i.byteLength>0&&s!=null&&s.key&&s.iv&&Ur(s.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer,Hm(s.method)).catch(l=>{throw r.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.FRAG_DECRYPT_ERROR,fatal:!1,error:l,reason:l.message,frag:n}),l}).then(l=>{const o=performance.now();r.trigger(S.FRAG_DECRYPTED,{frag:n,payload:l,stats:{tstart:a,tdecrypt:o}})}).catch(l=>{this.warn(`${l.name}: ${l.message}`),this.state=H.IDLE})}}doTick(){if(!this.media){this.state=H.IDLE;return}if(this.state===H.IDLE){const{currentTrackId:e,levels:n}=this,i=n==null?void 0:n[e];if(!i||!n.length||!i.details||this.waitForLive(i))return;const{config:s}=this,r=this.getLoadPosition(),a=he.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,s.maxBufferHole),{end:l,len:o}=a,u=i.details,c=this.hls.maxBufferLength+u.levelTargetDuration;if(o>c)return;const d=u.fragments,f=d.length,h=u.edge;let m=null;const y=this.fragPrevious;if(l<h){const v=s.maxFragLookUpTolerance,b=l>h-v?0:v;m=Xs(y,d,Math.max(d[0].start,l),b),!m&&y&&y.start<d[0].start&&(m=d[0])}else m=d[f-1];if(m=this.filterReplacedPrimary(m,i.details),!m)return;const x=m.sn-u.startSN,p=d[x-1];if(p&&p.cc===m.cc&&this.fragmentTracker.getState(p)===bt.NOT_LOADED&&(m=p),this.fragmentTracker.getState(m)===bt.NOT_LOADED){const v=this.mapToInitFragWhenRequired(m);v&&this.loadFragment(v,i,l)}}}loadFragment(e,n,i){ut(e)?super.loadFragment(e,n,i):this._loadInitSegment(e,n)}get mediaBufferTimeRanges(){return new V2(this.tracksBuffered[this.currentTrackId]||[])}}class V2{constructor(e){this.buffered=void 0;const n=(i,s,r)=>{if(s=s>>>0,s>r-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${s}) is greater than the maximum bound (${r})`);return e[s][i]};this.buffered={get length(){return e.length},end(i){return n("end",i,e.length)},start(i){return n("start",i,e.length)}}}}const K2={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},oE=t=>String.fromCharCode(K2[t]||t),Vn=15,vi=100,Y2={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},q2={17:2,18:4,21:6,22:8,23:10,19:13,20:15},X2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Q2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},W2=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class Z2{constructor(){this.time=null,this.verboseLevel=0}log(e,n){if(this.verboseLevel>=e){const i=typeof n=="function"?n():n;Pe.log(`${this.time} [${e}] ${i}`)}}}const Ls=function(e){const n=[];for(let i=0;i<e.length;i++)n.push(e[i].toString(16));return n};class uE{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const n=["foreground","underline","italics","background","flash"];for(let i=0;i<n.length;i++){const s=n[i];e.hasOwnProperty(s)&&(this[s]=e[s])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class J2{constructor(){this.uchar=" ",this.penState=new uE}reset(){this.uchar=" ",this.penState.reset()}setChar(e,n){this.uchar=e,this.penState.copy(n)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class eN{constructor(e){this.chars=[],this.pos=0,this.currPenState=new uE,this.cueStartTime=null,this.logger=void 0;for(let n=0;n<vi;n++)this.chars.push(new J2);this.logger=e}equals(e){for(let n=0;n<vi;n++)if(!this.chars[n].equals(e.chars[n]))return!1;return!0}copy(e){for(let n=0;n<vi;n++)this.chars[n].copy(e.chars[n])}isEmpty(){let e=!0;for(let n=0;n<vi;n++)if(!this.chars[n].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>vi&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=vi)}moveCursor(e){const n=this.pos+e;if(e>1)for(let i=this.pos+1;i<n+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(n)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const n=oE(e);if(this.pos>=vi){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+n+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(n,this.currPenState),this.moveCursor(1)}clearFromPos(e){let n;for(n=e;n<vi;n++)this.chars[n].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let n=!0;for(let i=0;i<vi;i++){const s=this.chars[i].uchar;s!==" "&&(n=!1),e.push(s)}return n?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ld{constructor(e){this.rows=[],this.currRow=Vn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let n=0;n<Vn;n++)this.rows.push(new eN(e));this.logger=e}reset(){for(let e=0;e<Vn;e++)this.rows[e].clear();this.currRow=Vn-1}equals(e){let n=!0;for(let i=0;i<Vn;i++)if(!this.rows[i].equals(e.rows[i])){n=!1;break}return n}copy(e){for(let n=0;n<Vn;n++)this.rows[n].copy(e.rows[n])}isEmpty(){let e=!0;for(let n=0;n<Vn;n++)if(!this.rows[n].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ge(e));let n=e.row-1;if(this.nrRollUpRows&&n<this.nrRollUpRows-1&&(n=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==n){for(let l=0;l<Vn;l++)this.rows[l].clear();const r=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const l=a.rows[r].cueStartTime,o=this.logger.time;if(l!==null&&o!==null&&l<o)for(let u=0;u<this.nrRollUpRows;u++)this.rows[n-this.nrRollUpRows+u+1].copy(a.rows[r+u])}}this.currRow=n;const i=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,a=Math.max(r-1,0);i.setCursor(e.indent),e.color=i.chars[a].penState.foreground}const s={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(s)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ge(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,n=this.rows.splice(e,1)[0];n.clear(),this.rows.splice(this.currRow,0,n),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const n=[];let i="",s=-1;for(let r=0;r<Vn;r++){const a=this.rows[r].getTextString();a&&(s=r+1,e?n.push("Row "+s+": '"+a+"'"):n.push(a.trim()))}return n.length>0&&(e?i="["+n.join(" | ")+"]":i=n.join(`
`)),i}getTextAndFormat(){return this.rows}}class yy{constructor(e,n,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=n,this.mode=null,this.verbose=0,this.displayedMemory=new Ld(i),this.nonDisplayedMemory=new Ld(i),this.lastOutputScreen=new Ld(i),this.currRollUpRow=this.displayedMemory.rows[Vn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Vn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>n+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const n={flash:!1};if(n.underline=e%2===1,n.italics=e>=46,n.italics)n.foreground="white";else{const i=Math.floor(e/2)-16,s=["white","green","blue","cyan","red","yellow","magenta"];n.foreground=s[i]}this.logger.log(2,"MIDROW: "+Ge(n)),this.writeScreen.setPen(n)}outputDataUpdate(e=!1){const n=this.logger.time;n!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=n:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,n,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:n),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class xy{constructor(e,n,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=nN(),this.logger=void 0;const s=this.logger=new Z2;this.channels=[null,new yy(e,n,s),new yy(e+1,i,s)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,n){this.channels[e].setHandler(n)}addData(e,n){this.logger.time=e;for(let i=0;i<n.length;i+=2){const s=n[i]&127,r=n[i+1]&127;let a=!1,l=null;if(s===0&&r===0)continue;this.logger.log(3,()=>"["+Ls([n[i],n[i+1]])+"] -> ("+Ls([s,r])+")");const o=this.cmdHistory;if(s>=16&&s<=31){if(tN(s,r,o)){yo(null,null,o),this.logger.log(3,()=>"Repeated command ("+Ls([s,r])+") is dropped");continue}yo(s,r,this.cmdHistory),a=this.parseCmd(s,r),a||(a=this.parseMidrow(s,r)),a||(a=this.parsePAC(s,r)),a||(a=this.parseBackgroundAttributes(s,r))}else yo(null,null,o);if(!a&&(l=this.parseChars(s,r),l)){const c=this.currentChannel;c&&c>0?this.channels[c].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!l&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ls([s,r])+" orig: "+Ls([n[i],n[i+1]]))}}parseCmd(e,n){const i=(e===20||e===28||e===21||e===29)&&n>=32&&n<=47,s=(e===23||e===31)&&n>=33&&n<=35;if(!(i||s))return!1;const r=e===20||e===21||e===23?1:2,a=this.channels[r];return e===20||e===21||e===28||e===29?n===32?a.ccRCL():n===33?a.ccBS():n===34?a.ccAOF():n===35?a.ccAON():n===36?a.ccDER():n===37?a.ccRU(2):n===38?a.ccRU(3):n===39?a.ccRU(4):n===40?a.ccFON():n===41?a.ccRDC():n===42?a.ccTR():n===43?a.ccRTD():n===44?a.ccEDM():n===45?a.ccCR():n===46?a.ccENM():n===47&&a.ccEOC():a.ccTO(n-32),this.currentChannel=r,!0}parseMidrow(e,n){let i=0;if((e===17||e===25)&&n>=32&&n<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const s=this.channels[i];return s?(s.ccMIDROW(n),this.logger.log(3,()=>"MIDROW ("+Ls([e,n])+")"),!0):!1}return!1}parsePAC(e,n){let i;const s=(e>=17&&e<=23||e>=25&&e<=31)&&n>=64&&n<=127,r=(e===16||e===24)&&n>=64&&n<=95;if(!(s||r))return!1;const a=e<=23?1:2;n>=64&&n<=95?i=a===1?Y2[e]:X2[e]:i=a===1?q2[e]:Q2[e];const l=this.channels[a];return l?(l.setPAC(this.interpretPAC(i,n)),this.currentChannel=a,!0):!1}interpretPAC(e,n){let i;const s={color:null,italics:!1,indent:null,underline:!1,row:e};return n>95?i=n-96:i=n-64,s.underline=(i&1)===1,i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=Math.floor((i-16)/2)*4,s}parseChars(e,n){let i,s=null,r=null;if(e>=25?(i=2,r=e-8):(i=1,r=e),r>=17&&r<=19){let a;r===17?a=n+80:r===18?a=n+112:a=n+144,this.logger.log(2,()=>"Special char '"+oE(a)+"' in channel "+i),s=[a]}else e>=32&&e<=127&&(s=n===0?[e]:[e,n]);return s&&this.logger.log(3,()=>"Char codes =  "+Ls(s).join(",")),s}parseBackgroundAttributes(e,n){const i=(e===16||e===24)&&n>=32&&n<=47,s=(e===23||e===31)&&n>=45&&n<=47;if(!(i||s))return!1;let r;const a={};e===16||e===24?(r=Math.floor((n-32)/2),a.background=W2[r],n%2===1&&(a.background=a.background+"_semi")):n===45?a.background="transparent":(a.foreground="black",n===47&&(a.underline=!0));const l=e<=23?1:2;return this.channels[l].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const n=this.channels[e];n&&n.reset()}yo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let n=0;n<this.channels.length;n++){const i=this.channels[n];i&&i.cueSplitAtTime(e)}}}function yo(t,e,n){n.a=t,n.b=e}function tN(t,e,n){return n.a===t&&n.b===e}function nN(){return{a:null,b:null}}var s0=function(){if(Uu!=null&&Uu.VTTCue)return self.VTTCue;const t=["","lr","rl"],e=["start","middle","end","left","right"];function n(l,o){if(typeof o!="string"||!Array.isArray(l))return!1;const u=o.toLowerCase();return~l.indexOf(u)?u:!1}function i(l){return n(t,l)}function s(l){return n(e,l)}function r(l,...o){let u=1;for(;u<arguments.length;u++){const c=arguments[u];for(const d in c)l[d]=c[d]}return l}function a(l,o,u){const c=this,d={enumerable:!0};c.hasBeenReset=!1;let f="",h=!1,m=l,y=o,x=u,p=null,v="",b=!0,E="auto",k="start",_=50,L="middle",C=50,w="middle";Object.defineProperty(c,"id",r({},d,{get:function(){return f},set:function(A){f=""+A}})),Object.defineProperty(c,"pauseOnExit",r({},d,{get:function(){return h},set:function(A){h=!!A}})),Object.defineProperty(c,"startTime",r({},d,{get:function(){return m},set:function(A){if(typeof A!="number")throw new TypeError("Start time must be set to a number.");m=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"endTime",r({},d,{get:function(){return y},set:function(A){if(typeof A!="number")throw new TypeError("End time must be set to a number.");y=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"text",r({},d,{get:function(){return x},set:function(A){x=""+A,this.hasBeenReset=!0}})),Object.defineProperty(c,"region",r({},d,{get:function(){return p},set:function(A){p=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"vertical",r({},d,{get:function(){return v},set:function(A){const I=i(A);if(I===!1)throw new SyntaxError("An invalid or illegal string was specified.");v=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"snapToLines",r({},d,{get:function(){return b},set:function(A){b=!!A,this.hasBeenReset=!0}})),Object.defineProperty(c,"line",r({},d,{get:function(){return E},set:function(A){if(typeof A!="number"&&A!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"lineAlign",r({},d,{get:function(){return k},set:function(A){const I=s(A);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");k=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"position",r({},d,{get:function(){return _},set:function(A){if(A<0||A>100)throw new Error("Position must be between 0 and 100.");_=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"positionAlign",r({},d,{get:function(){return L},set:function(A){const I=s(A);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");L=I,this.hasBeenReset=!0}})),Object.defineProperty(c,"size",r({},d,{get:function(){return C},set:function(A){if(A<0||A>100)throw new Error("Size must be between 0 and 100.");C=A,this.hasBeenReset=!0}})),Object.defineProperty(c,"align",r({},d,{get:function(){return w},set:function(A){const I=s(A);if(!I)throw new SyntaxError("An invalid or illegal string was specified.");w=I,this.hasBeenReset=!0}})),c.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class iN{decode(e,n){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function cE(t){function e(i,s,r,a){return(i|0)*3600+(s|0)*60+(r|0)+parseFloat(a||0)}const n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}class sN{constructor(){this.values=Object.create(null)}set(e,n){!this.get(e)&&n!==""&&(this.values[e]=n)}get(e,n,i){return i?this.has(e)?this.values[e]:n[i]:this.has(e)?this.values[e]:n}has(e){return e in this.values}alt(e,n,i){for(let s=0;s<i.length;++s)if(n===i[s]){this.set(e,n);break}}integer(e,n){/^-?\d+$/.test(n)&&this.set(e,parseInt(n,10))}percent(e,n){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(n)){const i=parseFloat(n);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function dE(t,e,n,i){const s=i?t.split(i):[t];for(const r in s){if(typeof s[r]!="string")continue;const a=s[r].split(n);if(a.length!==2)continue;const l=a[0],o=a[1];e(l,o)}}const gh=new s0(0,0,""),xo=gh.align==="middle"?"middle":"center";function rN(t,e,n){const i=t;function s(){const l=cE(t);if(l===null)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),l}function r(l,o){const u=new sN;dE(l,function(f,h){let m;switch(f){case"region":for(let y=n.length-1;y>=0;y--)if(n[y].id===h){u.set(f,n[y].region);break}break;case"vertical":u.alt(f,h,["rl","lr"]);break;case"line":m=h.split(","),u.integer(f,m[0]),u.percent(f,m[0])&&u.set("snapToLines",!1),u.alt(f,m[0],["auto"]),m.length===2&&u.alt("lineAlign",m[1],["start",xo,"end"]);break;case"position":m=h.split(","),u.percent(f,m[0]),m.length===2&&u.alt("positionAlign",m[1],["start",xo,"end","line-left","line-right","auto"]);break;case"size":u.percent(f,h);break;case"align":u.alt(f,h,["start",xo,"end","left","right"]);break}},/:/,/\s/),o.region=u.get("region",null),o.vertical=u.get("vertical","");let c=u.get("line","auto");c==="auto"&&gh.line===-1&&(c=-1),o.line=c,o.lineAlign=u.get("lineAlign","start"),o.snapToLines=u.get("snapToLines",!0),o.size=u.get("size",100),o.align=u.get("align",xo);let d=u.get("position","auto");d==="auto"&&gh.position===50&&(d=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=d}function a(){t=t.replace(/^\s+/,"")}if(a(),e.startTime=s(),a(),t.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);t=t.slice(3),a(),e.endTime=s(),a(),r(t,e)}function fE(t){return t.replace(/<br(?: \/)?>/gi,`
`)}class aN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new iN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const n=this;e&&(n.buffer+=n.decoder.decode(e,{stream:!0}));function i(){let r=n.buffer,a=0;for(r=fE(r);a<r.length&&r[a]!=="\r"&&r[a]!==`
`;)++a;const l=r.slice(0,a);return r[a]==="\r"&&++a,r[a]===`
`&&++a,n.buffer=r.slice(a),l}function s(r){dE(r,function(a,l){},/:/)}try{let r="";if(n.state==="INITIAL"){if(!/\r\n|\n/.test(n.buffer))return this;r=i();const l=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(l!=null&&l[0]))throw new Error("Malformed WebVTT signature.");n.state="HEADER"}let a=!1;for(;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(a?a=!1:r=i(),n.state){case"HEADER":/:/.test(r)?s(r):r||(n.state="ID");continue;case"NOTE":r||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){n.state="NOTE";break}if(!r)continue;if(n.cue=new s0(0,0,""),n.state="CUE",r.indexOf("-->")===-1){n.cue.id=r;continue}case"CUE":if(!n.cue){n.state="BADCUE";continue}try{rN(r,n.cue,n.regionList)}catch{n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":{const l=r.indexOf("-->")!==-1;if(!r||l&&(a=!0)){n.oncue&&n.cue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}if(n.cue===null)continue;n.cue.text&&(n.cue.text+=`
`),n.cue.text+=r}continue;case"BADCUE":r||(n.state="ID")}}}catch{n.state==="CUETEXT"&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state=n.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(n){e.onparsingerror&&e.onparsingerror(n)}return e.onflush&&e.onflush(),this}}const lN=/\r\n|\n\r|\n|\r/g,Rd=function(e,n,i=0){return e.slice(i,i+n.length)===n},oN=function(e){let n=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),s=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ee(n)||!ee(i)||!ee(s)||!ee(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return n+=1e3*i,n+=60*1e3*s,n+=60*60*1e3*r,n};function r0(t,e,n){return Wa(t.toString())+Wa(e.toString())+Wa(n)}const uN=function(e,n,i){let s=e[n],r=e[s.prevCC];if(!r||!r.new&&s.new){e.ccOffset=e.presentationOffset=s.start,s.new=!1;return}for(;(a=r)!=null&&a.new;){var a;e.ccOffset+=s.start-r.start,s.new=!1,s=r,r=e[s.prevCC]}e.presentationOffset=i};function cN(t,e,n,i,s,r,a){const l=new aN,o=En(new Uint8Array(t)).trim().replace(lN,`
`).split(`
`),u=[],c=e?pD(e.baseTime,e.timescale):0;let d="00:00.000",f=0,h=0,m,y=!0;l.oncue=function(x){const p=n[i];let v=n.ccOffset;const b=(f-c)/9e4;if(p!=null&&p.new&&(h!==void 0?v=n.ccOffset=p.start:uN(n,i,b)),b){if(!e){m=new Error("Missing initPTS for VTT MPEGTS");return}v=b-n.presentationOffset}const E=x.endTime-x.startTime,k=dn((x.startTime+v-h)*9e4,s*9e4)/9e4;x.startTime=Math.max(k,0),x.endTime=Math.max(k+E,0);const _=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(_)),x.id||(x.id=r0(x.startTime,x.endTime,_)),x.endTime>0&&u.push(x)},l.onparsingerror=function(x){m=x},l.onflush=function(){if(m){a(m);return}r(u)},o.forEach(x=>{if(y)if(Rd(x,"X-TIMESTAMP-MAP=")){y=!1,x.slice(16).split(",").forEach(p=>{Rd(p,"LOCAL:")?d=p.slice(6):Rd(p,"MPEGTS:")&&(f=parseInt(p.slice(7)))});try{h=oN(d)/1e3}catch(p){m=p}return}else x===""&&(y=!1);l.parse(x+`
`)}),l.flush()}const wd="stpp.ttml.im1t",hE=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mE=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,dN={left:"start",center:"center",right:"end",start:"start",end:"end"};function vy(t,e,n,i){const s=ve(new Uint8Array(t),["mdat"]);if(s.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const r=s.map(l=>En(l)),a=gD(e.baseTime,1,e.timescale);try{r.forEach(l=>n(fN(l,a)))}catch(l){i(l)}}function fN(t,e){const s=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(r).reduce((d,f)=>(d[f]=s.getAttribute(`ttp:${f}`)||r[f],d),{}),l=s.getAttribute("xml:space")!=="preserve",o=by(Cd(s,"styling","style")),u=by(Cd(s,"layout","region")),c=Cd(s,"body","[begin]");return[].map.call(c,d=>{const f=gE(d,l);if(!f||!d.hasAttribute("begin"))return null;const h=Dd(d.getAttribute("begin"),a),m=Dd(d.getAttribute("dur"),a);let y=Dd(d.getAttribute("end"),a);if(h===null)throw Sy(d);if(y===null){if(m===null)throw Sy(d);y=h+m}const x=new s0(h-e,y-e,f);x.id=r0(x.startTime,x.endTime,x.text);const p=u[d.getAttribute("region")],v=o[d.getAttribute("style")],b=hN(p,v,o),{textAlign:E}=b;if(E){const k=dN[E];k&&(x.lineAlign=k),x.align=E}return $e(x,b),x}).filter(d=>d!==null)}function Cd(t,e,n){const i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(n)):[]}function by(t){return t.reduce((e,n)=>{const i=n.getAttribute("xml:id");return i&&(e[i]=n),e},{})}function gE(t,e){return[].slice.call(t.childNodes).reduce((n,i,s)=>{var r;return i.nodeName==="br"&&s?n+`
`:(r=i.childNodes)!=null&&r.length?gE(i,e):e?n+i.textContent.trim().replace(/\s+/g," "):n+i.textContent},"")}function hN(t,e,n){const i="http://www.w3.org/ns/ttml#styling";let s=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=t!=null&&t.hasAttribute("style")?t.getAttribute("style"):null;return a&&n.hasOwnProperty(a)&&(s=n[a]),r.reduce((l,o)=>{const u=Id(e,i,o)||Id(t,i,o)||Id(s,i,o);return u&&(l[o]=u),l},{})}function Id(t,e,n){return t&&t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function Sy(t){return new Error(`Could not parse ttml timestamp ${t}`)}function Dd(t,e){if(!t)return null;let n=cE(t);return n===null&&(hE.test(t)?n=mN(t,e):mE.test(t)&&(n=gN(t,e))),n}function mN(t,e){const n=hE.exec(t),i=(n[4]|0)+(n[5]|0)/e.subFrameRate;return(n[1]|0)*3600+(n[2]|0)*60+(n[3]|0)+i/e.frameRate}function gN(t,e){const n=mE.exec(t),i=Number(n[1]);switch(n[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class vo{constructor(e,n){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=n}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,n,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=n,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class pN{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ty(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(S.FRAG_LOADING,this.onFragLoading,this),e.on(S.FRAG_LOADED,this.onFragLoaded,this),e.on(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(S.FRAG_LOADING,this.onFragLoading,this),e.off(S.FRAG_LOADED,this.onFragLoaded,this),e.off(S.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(S.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(S.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(S.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new vo(this,"textTrack1"),n=new vo(this,"textTrack2"),i=new vo(this,"textTrack3"),s=new vo(this,"textTrack4");this.cea608Parser1=new xy(1,e,n),this.cea608Parser2=new xy(3,i,s)}addCues(e,n,i,s,r){let a=!1;for(let l=r.length;l--;){const o=r[l],u=yN(o[0],o[1],n,i);if(u>=0&&(o[0]=Math.min(o[0],n),o[1]=Math.max(o[1],i),a=!0,u/(i-n)>.5))return}if(a||r.push([n,i]),this.config.renderTextTracksNatively){const l=this.captionsTracks[e];this.Cues.newCue(l,n,i,s)}else{const l=this.Cues.newCue(null,n,i,s);this.hls.trigger(S.CUES_PARSED,{type:"captions",cues:l,track:e})}}onInitPtsFound(e,{frag:n,id:i,initPTS:s,timescale:r,trackId:a}){const{unparsedVttFrags:l}=this;i===ne.MAIN&&(this.initPTS[n.cc]={baseTime:s,timescale:r,trackId:a}),l.length&&(this.unparsedVttFrags=[],l.forEach(o=>{this.initPTS[o.frag.cc]?this.onFragLoaded(S.FRAG_LOADED,o):this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,n){const{media:i}=this;if(i)for(let s=0;s<i.textTracks.length;s++){const r=i.textTracks[s];if(Ey(r,{name:e,lang:n,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:n,captionsTracks:i,media:s}=this,{label:r,languageCode:a}=n[e],l=this.getExistingTrack(r,a);if(l)i[e]=l,Cr(i[e]),rE(i[e],s);else{const o=this.createTextTrack("captions",r,a);o&&(o[e]=!0,i[e]=o)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const n=this.captionsProperties[e];if(!n)return;const i=n.label,s={_id:e,label:i,kind:"captions",default:n.media?!!n.media.default:!1,closedCaptions:n.media};this.nonNativeCaptionsTracks[e]=s,this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[s]})}createTextTrack(e,n,i){const s=this.media;if(s)return s.addTextTrack(e,n,i)}onMediaAttaching(e,n){this.media=n.media,n.mediaSource||this._cleanTracks()}onMediaDetaching(e,n){const i=!!n.transferMedia;if(this.media=null,i)return;const{captionsTracks:s}=this;Object.keys(s).forEach(r=>{Cr(s[r]),delete s[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Ty(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const n=e.textTracks;if(n)for(let i=0;i<n.length;i++)Cr(n[i])}onSubtitleTracksUpdated(e,n){const i=n.subtitleTracks||[],s=i.some(r=>r.textCodec===wd);if(this.config.enableWebVTT||s&&this.config.enableIMSC1){if(KS(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const a=this.media,l=a?Qo(a.textTracks):null;if(this.tracks.forEach((o,u)=>{let c;if(l){let d=null;for(let f=0;f<l.length;f++)if(l[f]&&Ey(l[f],o)){d=l[f],l[f]=null;break}d&&(c=d)}if(c)Cr(c);else{const d=pE(o);c=this.createTextTrack(d,o.name,o.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),l!=null&&l.length){const o=l.filter(u=>u!==null).map(u=>u.label);o.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${o.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(S.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,n){this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(i=>{const s=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!s)return;const r=`textTrack${s[1]}`,a=this.captionsProperties[r];a&&(a.label=i.name,i.lang&&(a.languageCode=i.lang),a.media=i)})}closedCaptionsForLevel(e){const n=this.hls.levels[e.level];return n==null?void 0:n.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,n){if(this.enabled&&n.frag.type===ne.MAIN){var i,s;const{cea608Parser1:r,cea608Parser2:a,lastSn:l}=this,{cc:o,sn:u}=n.frag,c=(i=(s=n.part)==null?void 0:s.index)!=null?i:-1;r&&a&&(u!==l+1||u===l&&c!==this.lastPartIndex+1||o!==this.lastCc)&&(r.reset(),a.reset()),this.lastCc=o,this.lastSn=u,this.lastPartIndex=c}}onFragLoaded(e,n){const{frag:i,payload:s}=n;if(i.type===ne.SUBTITLE)if(s.byteLength){const r=i.decryptdata,a="stats"in n;if(r==null||!r.encrypted||a){const l=this.tracks[i.level],o=this.vttCCs;o[i.cc]||(o[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),l&&l.textCodec===wd?this._parseIMSC1(i,s):this._parseVTTs(n)}}else this.hls.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,n){const i=this.hls;vy(n,this.initPTS[e.cc],s=>{this._appendCues(s,e.level),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},s=>{i.logger.log(`Failed to parse IMSC1: ${s}`),i.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:s})})}_parseVTTs(e){var n;const{frag:i,payload:s}=e,{initPTS:r,unparsedVttFrags:a}=this,l=r.length-1;if(!r[i.cc]&&l===-1){a.push(e);return}const o=this.hls,u=(n=i.initSegment)!=null&&n.data?Bn(i.initSegment.data,new Uint8Array(s)).buffer:s;cN(u,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,c=>{this._appendCues(c,i.level),o.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},c=>{const d=c.message==="Missing initPTS for VTT MPEGTS";d?a.push(e):this._fallbackToIMSC1(i,s),o.logger.log(`Failed to parse VTT cue: ${c}`),!(d&&l>i.cc)&&o.trigger(S.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:c})})}_fallbackToIMSC1(e,n){const i=this.tracks[e.level];i.textCodec||vy(n,this.initPTS[e.cc],()=>{i.textCodec=wd,this._parseIMSC1(e,n)},()=>{i.textCodec="wvtt"})}_appendCues(e,n){const i=this.hls;if(this.config.renderTextTracksNatively){const s=this.textTracks[n];if(!s||s.mode==="disabled")return;e.forEach(r=>aE(s,r))}else{const s=this.tracks[n];if(!s)return;const r=s.default?"default":"subtitles"+n;i.trigger(S.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,n){const{frag:i}=n;i.type===ne.SUBTITLE&&this.onFragLoaded(S.FRAG_LOADED,n)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,n){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:s}=n;if(!(i.type===ne.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let r=0;r<s.length;r++){const a=s[r].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const l=this.extractCea608Data(a);this.cea608Parser1.addData(s[r].pts,l[0]),this.cea608Parser2.addData(s[r].pts,l[1])}}}onBufferFlushing(e,{startOffset:n,endOffset:i,endOffsetSubtitles:s,type:r}){const{media:a}=this;if(!(!a||a.currentTime<i)){if(!r||r==="video"){const{captionsTracks:l}=this;Object.keys(l).forEach(o=>mh(l[o],n,i))}if(this.config.renderTextTracksNatively&&n===0&&s!==void 0){const{textTracks:l}=this;Object.keys(l).forEach(o=>mh(l[o],n,s))}}}extractCea608Data(e){const n=[[],[]],i=e[0]&31;let s=2;for(let r=0;r<i;r++){const a=e[s++],l=127&e[s++],o=127&e[s++];if(l===0&&o===0)continue;if((4&a)!==0){const c=3&a;(c===0||c===1)&&(n[c].push(l),n[c].push(o))}}return n}}function pE(t){return t.characteristics&&/transcribes-spoken-dialog/gi.test(t.characteristics)&&/describes-music-and-sound/gi.test(t.characteristics)?"captions":"subtitles"}function Ey(t,e){return!!t&&t.kind===pE(e)&&ch(e,t)}function yN(t,e,n,i){return Math.min(e,i)-Math.max(t,n)}function Ty(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const xN=/\s/,vN={newCue(t,e,n,i){const s=[];let r,a,l,o,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<i.rows.length;f++)if(r=i.rows[f],l=!0,o=0,u="",!r.isEmpty()){var d;for(let y=0;y<r.chars.length;y++)xN.test(r.chars[y].uchar)&&l?o++:(u+=r.chars[y].uchar,l=!1);r.cueStartTime=e,e===n&&(n+=1e-4),o>=16?o--:o++;const h=fE(u.trim()),m=r0(e,n,h);t!=null&&(d=t.cues)!=null&&d.getCueById(m)||(a=new c(e,n,h),a.id=m,a.line=f+1,a.align="left",a.position=10+Math.min(80,Math.floor(o*8/32)*10),s.push(a))}return t&&s.length&&(s.sort((f,h)=>f.line==="auto"||h.line==="auto"?0:f.line>8&&h.line>8?h.line-f.line:f.line-h.line),s.forEach(f=>aE(t,f))),s}};function bN(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const SN=/(\d+)-(\d+)\/(\d+)/;class Ay{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||kN,this.controller=new self.AbortController,this.stats=new Fm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,n,i){const s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();const r=EN(e,this.controller.signal),a=e.responseType==="arraybuffer",l=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:u}=n.loadPolicy;this.context=e,this.config=n,this.callbacks=i,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),n.timeout=o&&ee(o)?o:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},n.timeout),(Tl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(d=>{var f;this.response=this.loader=d;const h=Math.max(self.performance.now(),s.loading.start);if(self.clearTimeout(this.requestTimeout),n.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(s,e,this.response))},u-(h-s.loading.start)),!d.ok){const{status:y,statusText:x}=d;throw new _N(x||"fetch, bad network response",y,d)}s.loading.first=h,s.total=AN(d.headers)||s.total;const m=(f=this.callbacks)==null?void 0:f.onProgress;return m&&ee(n.highWaterMark)?this.loadProgressively(d,s,e,n.highWaterMark,m):a?d.arrayBuffer():e.responseType==="json"?d.json():d.text()}).then(d=>{var f,h;const m=this.response;if(!m)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);const y=d[l];y&&(s.loaded=s.total=y);const x={url:m.url,data:d,code:m.status},p=(f=this.callbacks)==null?void 0:f.onProgress;p&&!ee(n.highWaterMark)&&p(s,e,d,m),(h=this.callbacks)==null||h.onSuccess(x,s,e,m)}).catch(d=>{var f;if(self.clearTimeout(this.requestTimeout),s.aborted)return;const h=d&&d.code||0,m=d?d.message:null;(f=this.callbacks)==null||f.onError({code:h,text:m},e,d?d.details:null,s)})}getCacheAge(){let e=null;if(this.response){const n=this.response.headers.get("age");e=n?parseFloat(n):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,n,i,s=0,r){const a=new _S,l=e.body.getReader(),o=()=>l.read().then(u=>{if(u.done)return a.dataLength&&r(n,i,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const c=u.value,d=c.length;return n.loaded+=d,d<s||a.dataLength?(a.push(c),a.dataLength>=s&&r(n,i,a.flush().buffer,e)):r(n,i,c.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function EN(t,e){const n={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers($e({},t.headers))};return t.rangeEnd&&n.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),n}function TN(t){const e=SN.exec(t);if(e)return parseInt(e[2])-parseInt(e[1])+1}function AN(t){const e=t.get("Content-Range");if(e){const i=TN(e);if(ee(i))return i}const n=t.get("Content-Length");if(n)return parseInt(n)}function kN(t,e){return new self.Request(t.url,e)}class _N extends Error{constructor(e,n,i){super(e),this.code=void 0,this.details=void 0,this.code=n,this.details=i}}const LN=/^age:\s*[\d.]+\s*$/im;class yE{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Fm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,n,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=n,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:n}=this;if(!e||!n)return;const i=this.loader=new self.XMLHttpRequest,s=this.stats;s.loading.first=0,s.loaded=0,s.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return r(i,n.url)}).catch(a=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",n.url,!0),r(i,n.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,n,e)}).catch(a=>{var l;(l=this.callbacks)==null||l.onError({code:i.status,text:a.message},n,i,s)}):this.openAndSendXhr(i,n,e)}openAndSendXhr(e,n,i){e.readyState||e.open("GET",n.url,!0);const s=n.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:a}=i.loadPolicy;if(s)for(const l in s)e.setRequestHeader(l,s[l]);n.rangeEnd&&e.setRequestHeader("Range","bytes="+n.rangeStart+"-"+(n.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=n.responseType,self.clearTimeout(this.requestTimeout),i.timeout=r&&ee(r)?r:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:n,stats:i}=this;if(!e||!n)return;const s=n.readyState,r=this.config;if(!i.aborted&&s>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),s===4)){self.clearTimeout(this.requestTimeout),n.onreadystatechange=null,n.onprogress=null;const u=n.status,c=n.responseType==="text"?n.responseText:null;if(u>=200&&u<300){const m=c??n.response;if(m!=null){var a,l;i.loading.end=Math.max(self.performance.now(),i.loading.first);const y=n.responseType==="arraybuffer"?m.byteLength:m.length;i.loaded=i.total=y,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const x=(a=this.callbacks)==null?void 0:a.onProgress;x&&x(i,e,m,n);const p={url:n.responseURL,data:m,code:u};(l=this.callbacks)==null||l.onSuccess(p,i,e,n);return}}const d=r.loadPolicy.errorRetry,f=i.retry,h={url:e.url,data:void 0,code:u};if(Fu(d,f,!1,h))this.retry(d);else{var o;Pe.error(`${u} while loading ${e.url}`),(o=this.callbacks)==null||o.onError({code:u,text:n.statusText},e,n,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,n=this.stats.retry;if(Fu(e,n,!0))this.retry(e);else{var i;Pe.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:n,stats:i}=this;this.retryDelay=$m(e,i.retry),i.retry++,Pe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${n==null?void 0:n.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total)}getCacheAge(){let e=null;if(this.loader&&LN.test(this.loader.getAllResponseHeaders())){const n=this.loader.getResponseHeader("age");e=n?parseFloat(n):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const RN={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},wN=Me(Me({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:yE,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:$C,bufferController:ID,capLevelController:t0,errorController:KC,fpsController:D2,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:gS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:RN},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},CN()),{},{subtitleStreamController:H2,subtitleTrackController:O2,timelineController:pN,audioStreamController:LD,audioTrackController:RD,emeController:jr,cmcdController:R2,contentSteeringController:C2,interstitialsController:G2});function CN(){return{cueHandler:vN,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function IN(t,e,n){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=ph(t),s=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return s.forEach(a=>{const l=`${a==="level"?"playlist":a}LoadPolicy`,o=e[l]===void 0,u=[];r.forEach(c=>{const d=`${a}Loading${c}`,f=e[d];if(f!==void 0&&o){u.push(d);const h=i[l].default;switch(e[l]={default:h},c){case"TimeOut":h.maxLoadTimeMs=f,h.maxTimeToFirstByteMs=f;break;case"MaxRetry":h.errorRetry.maxNumRetry=f,h.timeoutRetry.maxNumRetry=f;break;case"RetryDelay":h.errorRetry.retryDelayMs=f,h.timeoutRetry.retryDelayMs=f;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=f,h.timeoutRetry.maxRetryDelayMs=f;break}}}),u.length&&n.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${l}": ${Ge(e[l])}`)}),Me(Me({},i),e)}function ph(t){return t&&typeof t=="object"?Array.isArray(t)?t.map(ph):Object.keys(t).reduce((e,n)=>(e[n]=ph(t[n]),e),{}):t}function DN(t,e){const n=t.loader;n!==Ay&&n!==yE?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):bN()&&(t.loader=Ay,t.progressive=!0,t.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Wo=2,NN=.1,MN=.05,ON=100;class PN extends cS{constructor(e,n){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=n,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,n){this.setInterval(ON),this.mediaSource=n.mediaSource;const i=this.media=n.media;zt(i,"playing",this.onMediaPlaying),zt(i,"waiting",this.onMediaWaiting),zt(i,"ended",this.onMediaEnded)}onMediaDetaching(e,n){this.clearInterval();const{media:i}=this;i&&(Wt(i,"playing",this.onMediaPlaying),Wt(i,"waiting",this.onMediaWaiting),Wt(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,n){this.buffered=n.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const n=this.media.currentTime;this.poll(n,this.lastCurrentTime),this.lastCurrentTime=n}poll(e,n){var i,s;const r=(i=this.hls)==null?void 0:i.config;if(!r)return;const a=this.media;if(!a)return;const{seeking:l}=a,o=this.seeking&&!l,u=!this.seeking&&l,c=a.paused&&!l||a.ended||a.playbackRate===0;if(this.seeking=l,e!==n){n&&(this.ended=0),this.moved=!0,l||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!c&&e>n&&this.nudgeOnVideoHole(e,n)),this.waiting===0&&this.stallResolved(e);return}if(u||o){o&&this.stallResolved(e);return}if(c){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!1}));return}if(!he.getBuffered(a).length){this.nudgeRetry=0;return}const d=he.bufferInfo(a,e,0),f=d.nextStart||0,h=this.fragmentTracker;if(l&&h&&this.hls){const _=ky(this.hls.inFlightFragments,e),L=d.len>Wo,C=!f||_||f-e>Wo&&!h.getPartialFragment(e);if(L||C)return;this.moved=!1}const m=(s=this.hls)==null?void 0:s.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(d.len>0)&&!f)return;const L=Math.max(f,d.start||0)-e,w=!!(m!=null&&m.live)?m.targetduration*2:Wo,A=bo(e,h);if(L>0&&(L<=w||A)){a.paused||this._trySkipBufferHole(A);return}}const y=r.detectStallWithCurrentTimeMs,x=self.performance.now(),p=this.waiting;let v=this.stalled;if(v===null)if(p>0&&x-p<y)v=this.stalled=p;else{this.stalled=x;return}const b=x-v;if(!l&&(b>=y||p)&&this.hls){var E;if(((E=this.mediaSource)==null?void 0:E.readyState)==="ended"&&!(m!=null&&m.live)&&Math.abs(e-((m==null?void 0:m.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(S.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(d),!this.media||!this.hls)return}const k=he.bufferInfo(a,e,r.maxBufferHole);this._tryFixBufferStall(k,b,e)}stallResolved(e){const n=this.stalled;if(n&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-n;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(S.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,n){var i;const s=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&s&&s.length>1&&e>s.end(0)){const r=he.bufferedInfo(he.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&n>=r.start){const a=he.timeRangesToArray(s),l=he.bufferedInfo(a,n,0).bufferedIndex;if(l>-1&&l<a.length-1){const o=he.bufferedInfo(a,e,0).bufferedIndex,u=a[l].end,c=a[l+1].start;if((o===-1||o>l)&&c-u<1&&e-u<2){const d=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${c} buffered index: ${o}`);this.warn(d.message),this.media.currentTime+=1e-6;let f=bo(e,this.fragmentTracker);f&&"fragment"in f?f=f.fragment:f||(f=void 0);const h=he.bufferInfo(this.media,e,0);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:d,reason:d.message,frag:f,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,n,i){var s,r;const{fragmentTracker:a,media:l}=this,o=(s=this.hls)==null?void 0:s.config;if(!l||!a||!o)return;const u=(r=this.hls)==null?void 0:r.latestLevelDetails,c=bo(i,a);if((c||u!=null&&u.live&&i<u.fragmentStart)&&(this._trySkipBufferHole(c)||!this.media))return;const d=e.buffered,f=this.adjacentTraversal(e,i);(d&&d.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-i<o.maxBufferHole||f))&&(n>o.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,n){const i=this.fragmentTracker,s=e.nextStart;if(i&&s){const r=i.getFragAtPos(n,ne.MAIN),a=i.getFragAtPos(s,ne.MAIN);if(r&&a)return a.sn-r.sn<2}return!1}_reportStall(e){const{hls:n,media:i,stallReported:s,stalled:r}=this;if(!s&&r!==null&&i&&n){this.stallReported=!0;const a=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${Ge(e)})`);this.warn(a.message),n.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var n;const{fragmentTracker:i,media:s}=this,r=(n=this.hls)==null?void 0:n.config;if(!s||!i||!r)return 0;const a=s.currentTime,l=he.bufferInfo(s,a,0),o=a<l.start?l.start:l.nextStart;if(o&&this.hls){const c=l.len<=r.maxBufferHole,d=l.len>0&&l.len<1&&s.readyState<3,f=o-a;if(f>0&&(c||d)){if(f>r.maxBufferHole){let m=!1;if(a===0){const y=i.getAppendedFrag(0,ne.MAIN);y&&o<y.end&&(m=!0)}if(!m&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||ky(this.hls.inFlightFragments,o))return 0;let x=!1,p=e.end;for(;p<o;){const v=bo(p,i);if(v)p+=v.duration;else{x=!0;break}}if(x)return 0}}const h=Math.max(o+MN,a+NN);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${h}`),this.moved=!0,s.currentTime=h,!(e!=null&&e.gap)){const m=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${h}`),y={type:re.MEDIA_ERROR,details:O.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,buffer:l.len,bufferInfo:l};e&&("fragment"in e?y.part=e:y.frag=e),this.hls.trigger(S.ERROR,y)}return h}}return 0}_tryNudgeBuffer(e){const{hls:n,media:i,nudgeRetry:s}=this,r=n==null?void 0:n.config;if(!i||!r)return 0;const a=i.currentTime;if(this.nudgeRetry++,s<r.nudgeMaxRetry){const l=a+(s+1)*r.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${a} to ${l}`);this.warn(o.message),i.currentTime=l,n.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const l=new Error(`Playhead still not moving while enough data buffered @${a} after ${r.nudgeMaxRetry} nudges`);this.error(l.message),n.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.BUFFER_STALLED_ERROR,error:l,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ky(t,e){const n=_y(t.main);if(n&&n.start<=e)return n;const i=_y(t.audio);return i&&i.start<=e?i:null}function _y(t){if(!t)return null;switch(t.state){case H.IDLE:case H.STOPPED:case H.ENDED:case H.ERROR:return null}return t.frag}function bo(t,e){return e.getAppendedFrag(t,ne.MAIN)||e.getPartialFragment(t)}const FN=.25;function yh(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Nd(t,e,n,i,s){let r=new t(e,n,"");try{r.value=i,s&&(r.type=s)}catch{r=new t(e,n,Ge(s?Me({type:s},i):i))}return r}const So=(()=>{const t=yh();try{t&&new t(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class BN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(S.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(S.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,n){var i;this.media=n.media,((i=n.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const n=(e=this.hls)==null?void 0:e.latestLevelDetails;n&&this.updateDateRangeCues(n)}onMediaDetaching(e,n){this.media=null,!n.transferMedia&&(this.id3Track&&(this.removeCues&&Cr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const n=this.getID3Track(e.textTracks);return n.mode="hidden",n}getID3Track(e){if(this.media){for(let n=0;n<e.length;n++){const i=e[n];if(i.kind==="metadata"&&i.label==="id3")return rE(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,n){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:i,enableID3MetadataCues:s}=this.hls.config;if(!i&&!s)return;const{samples:r}=n;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=yh();if(a)for(let l=0;l<r.length;l++){const o=r[l].type;if(o===mn.emsg&&!i||!s)continue;const u=NS(r[l].data),c=r[l].pts;let d=c+r[l].duration;d>So&&(d=So),d-c<=0&&(d=c+FN);for(let h=0;h<u.length;h++){const m=u[h];if(!MS(m)){this.updateId3CueEnds(c,o);const y=Nd(a,c,d,m,o);y&&this.id3Track.addCue(y)}}}}updateId3CueEnds(e,n){var i;const s=(i=this.id3Track)==null?void 0:i.cues;if(s)for(let r=s.length;r--;){const a=s[r];a.type===n&&a.startTime<e&&a.endTime===So&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:n,endOffset:i,type:s}){const{id3Track:r,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:l,enableID3MetadataCues:o}}=a;if(r&&(l||o)){let u;s==="audio"?u=c=>c.type===mn.audioId3&&o:s==="video"?u=c=>c.type===mn.emsg&&l:u=c=>c.type===mn.audioId3&&o||c.type===mn.emsg&&l,mh(r,n,i,u)}}onLevelUpdated(e,{details:n}){this.updateDateRangeCues(n,!0)}onLevelPtsUpdated(e,n){Math.abs(n.drift)>.01&&this.updateDateRangeCues(n.details)}updateDateRangeCues(e,n){if(!this.hls||!this.media)return;const{assetPlayerId:i,timelineOffset:s,enableDateRangeMetadataCues:r,interstitialsController:a}=this.hls.config;if(!r)return;const l=yh();if(i&&s&&!a){const{fragmentStart:y,fragmentEnd:x}=e;let p=this.assetCue;p?(p.startTime=y,p.endTime=x):l&&(p=this.assetCue=Nd(l,y,x,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),p&&(p.id=i,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(p),p.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:u}=e,c=Object.keys(u);let d=this.dateRangeCuesAppended;if(o&&n){var f;if((f=o.cues)!=null&&f.length){const y=Object.keys(d).filter(x=>!c.includes(x));for(let x=y.length;x--;){var h;const p=y[x],v=(h=d[p])==null?void 0:h.cues;delete d[p],v&&Object.keys(v).forEach(b=>{const E=v[b];if(E){E.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(E)}catch{}}})}}else d=this.dateRangeCuesAppended={}}const m=e.fragments[e.fragments.length-1];if(!(c.length===0||!ee(m==null?void 0:m.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let y=0;y<c.length;y++){const x=c[y],p=u[x],v=p.startTime,b=d[x],E=(b==null?void 0:b.cues)||{};let k=(b==null?void 0:b.durationKnown)||!1,_=So;const{duration:L,endDate:C}=p;if(C&&L!==null)_=v+L,k=!0;else if(p.endOnNext&&!k){const A=c.reduce((I,N)=>{if(N!==p.id){const V=u[N];if(V.class===p.class&&V.startDate>p.startDate&&(!I||p.startDate<I.startDate))return V}return I},null);A&&(_=A.startTime,k=!0)}const w=Object.keys(p.attr);for(let A=0;A<w.length;A++){const I=w[A];if(!rI(I))continue;const N=E[I];if(N)k&&!(b!=null&&b.durationKnown)?N.endTime=_:Math.abs(N.startTime-v)>.01&&(N.startTime=v,N.endTime=_);else if(l){let V=p.attr[I];aI(I)&&(V=H1(V));const $=Nd(l,v,_,{key:I,data:V},mn.dateRange);$&&($.id=x,this.id3Track.addCue($),E[I]=$,a&&(I==="X-ASSET-LIST"||I==="X-ASSET-URL")&&$.addEventListener("enter",this.onEventCueEnter))}}d[x]={cues:E,dateRange:p,durationKnown:k}}}}}class UN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:n}=this,i=this.levelDetails;if(!n||!i)return;this.currentTime=n.currentTime;const s=this.computeLatency();if(s===null)return;this._latency=s;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:a}=this.config;if(!r||a===1||!i.live)return;const l=this.targetLatency;if(l===null)return;const o=s-l,u=Math.min(this.maxLatency,l+i.targetduration);if(o<u&&o>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,a)),f=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20,h=Math.min(d,Math.max(1,f));this.changeMediaPlaybackRate(n,h)}else n.playbackRate!==1&&n.playbackRate!==0&&this.changeMediaPlaybackRate(n,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const n=this.levelDetails;return n?e.liveMaxLatencyDurationCount*n.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:n,partHoldBack:i,targetduration:s}=e,{liveSyncDuration:r,liveSyncDurationCount:a,lowLatencyMode:l}=this.config,o=this.hls.userConfig;let u=l&&i||n;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||u===0)&&(u=r!==void 0?r:a*s);const c=s;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,c)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),n=this.targetLatency;if(e===null||n===null)return null;const i=this.levelDetails;if(i===null)return null;const s=i.edge,r=e-n-this.edgeStalled,a=s-i.totalduration,l=s-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,r),l)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const n=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-n,0)}get forwardBufferLength(){const{media:e}=this,n=this.levelDetails;if(!e||!n)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):n.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(S.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(S.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(S.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(S.ERROR,this.onError,this))}onMediaAttached(e,n){this.media=n.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:n}){n.advanced&&this.onTimeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,n){var i;n.details===O.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,n){var i,s;e.playbackRate!==n&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(s=this.targetLatency)==null?void 0:s.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${n}`),e.playbackRate=n)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class jN extends e0{constructor(e,n){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=n,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this),e.on(S.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this),e.off(S.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(n=>{n.loadError=0,n.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,n){this.resetLevels()}onManifestLoaded(e,n){const i=this.hls.config.preferManagedMediaSource,s=[],r={},a={};let l=!1,o=!1,u=!1;n.levels.forEach(c=>{const d=c.attrs;let{audioCodec:f,videoCodec:h}=c;f&&(c.audioCodec=f=Nu(f,i)||void 0),h&&(h=c.videoCodec=EC(h));const{width:m,height:y,unknownCodecs:x}=c,p=(x==null?void 0:x.length)||0;if(l||(l=!!(m&&y)),o||(o=!!h),u||(u=!!f),p||f&&!this.isAudioSupported(f)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${d.CODECS}"`);return}const{CODECS:v,"FRAME-RATE":b,"HDCP-LEVEL":E,"PATHWAY-ID":k,RESOLUTION:_,"VIDEO-RANGE":L}=d,w=`${`${k||"."}-`}${c.bitrate}-${_}-${b}-${v}-${L}-${E}`;if(r[w])if(r[w].uri!==c.url&&!c.attrs["PATHWAY-ID"]){const A=a[w]+=1;c.attrs["PATHWAY-ID"]=new Array(A+1).join(".");const I=this.createLevel(c);r[w]=I,s.push(I)}else r[w].addGroupId("audio",d.AUDIO),r[w].addGroupId("text",d.SUBTITLES);else{const A=this.createLevel(c);r[w]=A,a[w]=1,s.push(A)}}),this.filterAndSortMediaOptions(s,n,l,o,u)}createLevel(e){const n=new bl(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const s=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(s.message),n.supportedResult=nS(s,[])}return n}isAudioSupported(e){return xl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return xl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,n,i,s,r){var a;let l=[],o=[],u=e;const c=((a=n.stats)==null?void 0:a.parsing)||{};if((i||s)&&r&&(u=u.filter(({videoCodec:v,videoRange:b,width:E,height:k})=>(!!v||!!(E&&k))&&DC(b))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let v="no level with compatible codecs found in manifest",b=v;n.levels.length&&(b=`one or more CODECS in variant not supported: ${Ge(n.levels.map(k=>k.attrs.CODECS).filter((k,_,L)=>L.indexOf(k)===_))}`,this.warn(b),v+=` (${b})`);const E=new Error(v);this.hls.trigger(S.ERROR,{type:re.MEDIA_ERROR,details:O.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:n.url,error:E,reason:b})}}),c.end=performance.now();return}n.audioTracks&&(l=n.audioTracks.filter(v=>!v.audioCodec||this.isAudioSupported(v.audioCodec)),Ly(l)),n.subtitles&&(o=n.subtitles,Ly(o));const d=u.slice(0);u.sort((v,b)=>{if(v.attrs["HDCP-LEVEL"]!==b.attrs["HDCP-LEVEL"])return(v.attrs["HDCP-LEVEL"]||"")>(b.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&v.height!==b.height)return v.height-b.height;if(v.frameRate!==b.frameRate)return v.frameRate-b.frameRate;if(v.videoRange!==b.videoRange)return Mu.indexOf(v.videoRange)-Mu.indexOf(b.videoRange);if(v.videoCodec!==b.videoCodec){const E=xp(v.videoCodec),k=xp(b.videoCodec);if(E!==k)return k-E}if(v.uri===b.uri&&v.codecSet!==b.codecSet){const E=Du(v.codecSet),k=Du(b.codecSet);if(E!==k)return k-E}return v.averageBitrate!==b.averageBitrate?v.averageBitrate-b.averageBitrate:0});let f=d[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==d.length)){for(let v=0;v<d.length;v++)if(d[v].pathwayId===u[0].pathwayId){f=d[v];break}}this._levels=u;for(let v=0;v<u.length;v++)if(u[v]===f){var h;this._firstLevel=v;const b=f.bitrate,E=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${b}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const k=Math.min(b,this.hls.config.abrEwmaDefaultEstimateMax);k>E&&E===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const m=r&&!s,y=this.hls.config,x=!!(y.audioStreamController&&y.audioTrackController),p={levels:u,audioTracks:l,subtitleTracks:o,sessionData:n.sessionData,sessionKeys:n.sessionKeys,firstLevel:this._firstLevel,stats:n.stats,audio:r,video:s,altAudio:x&&!m&&l.some(v=>!!v.url)};c.end=performance.now(),this.hls.trigger(S.MANIFEST_PARSED,p)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const n=this._levels;if(n.length===0)return;if(e<0||e>=n.length){const c=new Error("invalid level idx"),d=e<0;if(this.hls.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.LEVEL_SWITCH_ERROR,level:e,fatal:d,error:c,reason:c.message}),d)return;e=Math.min(e,n.length-1)}const i=this.currentLevelIndex,s=this.currentLevel,r=s?s.attrs["PATHWAY-ID"]:void 0,a=n[e],l=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,i===e&&s&&r===l)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${l?" with Pathway "+l:""} from level ${i}${r?" with Pathway "+r:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(S.LEVEL_SWITCHING,o);const u=a.details;if(!u||u.live){const c=this.switchParams(a.uri,s==null?void 0:s.details,u);this.loadPlaylist(c)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const n=this.steering.pathways(),i=e.filter(s=>n.indexOf(s)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${n}`);return}this.steering.pathwayPriority=i}}onError(e,n){n.fatal||!n.context||n.context.type===Ee.LEVEL&&n.context.level===this.level&&this.checkRetry(n)}onFragBuffered(e,{frag:n}){if(n!==void 0&&n.type===ne.MAIN){const i=n.elementaryStreams;if(!Object.keys(i).some(r=>!!i[r]))return;const s=this._levels[n.level];s!=null&&s.loadError&&(this.log(`Resetting level error count of ${s.loadError} on frag buffered`),s.loadError=0)}}onLevelLoaded(e,n){var i;const{level:s,details:r}=n,a=n.levelInfo;if(!a){var l;this.warn(`Invalid level index ${s}`),(l=n.deliveryDirectives)!=null&&l.skip&&(r.deltaUpdateFailed=!0);return}if(a===this.currentLevel||n.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let o=a.details;o===n.details&&o.advanced&&(o=void 0),this.playlistLoaded(s,n,o)}else(i=n.deliveryDirectives)!=null&&i.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,n){super.loadingPlaylist(e,n);const i=this.getUrlWithDirectives(e.uri,n),s=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],a=e.details,l=a==null?void 0:a.age;this.log(`Loading level index ${s}${(n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:""}${r?" Pathway "+r:""}${l&&a.live?" age "+l.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(S.LEVEL_LOADING,{url:i,level:s,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:n||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var n;if(this._levels.length===1)return;const i=this._levels.filter((r,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(l=>l.level=-1)),!1));TS(i),this._levels=i,this.currentLevelIndex>-1&&(n=this.currentLevel)!=null&&n.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const s=i.length-1;this._firstLevel=Math.min(this._firstLevel,s),this._startLevel&&(this._startLevel=Math.min(this._startLevel,s)),this.hls.trigger(S.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:n}){this._levels=n}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:n,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==n&&(this._maxAutoLevel=n,this.hls.trigger(S.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:n,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function Ly(t){const e={};t.forEach(n=>{const i=n.groupId||"";n.id=e[i]=e[i]||0,e[i]++})}function xE(){return self.SourceBuffer||self.WebKitSourceBuffer}function vE(){if(!xs())return!1;const e=xE();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function $N(){if(!vE())return!1;const t=xs();return typeof(t==null?void 0:t.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>t.isTypeSupported(vl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>t.isTypeSupported(vl(e,"audio"))))}function zN(){var t;const e=xE();return typeof(e==null||(t=e.prototype)==null?void 0:t.changeType)=="function"}const GN=100;class HN extends Km{constructor(e,n,i){super(e,n,i,"stream-controller",ne.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const s=this.media,r=s?s.currentTime:null;if(r===null||!ee(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const a=this.getFwdBufferInfoAtPos(s,r,ne.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(S.MANIFEST_PARSED,this.onManifestParsed,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.LEVEL_LOADED,this.onLevelLoaded,this),e.on(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(S.BUFFER_CREATED,this.onBufferCreated,this),e.on(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(S.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(S.MANIFEST_PARSED,this.onManifestParsed,this),e.off(S.LEVEL_LOADED,this.onLevelLoaded,this),e.off(S.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(S.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(S.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(S.BUFFER_CREATED,this.onBufferCreated,this),e.off(S.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(S.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,n){if(this.levels){const{lastCurrentTime:i,hls:s}=this;if(this.stopLoad(),this.setInterval(GN),this.level=-1,!this.startFragRequested){let r=s.startLevel;r===-1&&(s.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=s.firstAutoLevel),s.nextLoadLevel=r,this.level=s.loadLevel,this._hasEnoughToStart=!!n}i>0&&e===-1&&!n&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=H.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=n?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=H.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case H.WAITING_LEVEL:{const{levels:e,level:n}=this,i=e==null?void 0:e[n],s=i==null?void 0:i.details;if(s&&(!s.live||this.levelLastLoaded===i&&!this.waitForLive(i))){if(this.waitForCdnTuneIn(s))break;this.state=H.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=H.IDLE;break}break}case H.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===H.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:n,levels:i,media:s}=this;if(n===null||!s&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[r]))return;const a=i[r],l=this.getMainFwdBufferInfo();if(l===null)return;const o=this.getLevelDetails();if(o&&this._streamEnded(l,o)){const y={};this.altAudio===2&&(y.type="video"),this.hls.trigger(S.BUFFER_EOS,y),this.state=H.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const u=a.details;if(!u||this.state===H.WAITING_LEVEL||this.waitForLive(a)){this.level=r,this.state=H.WAITING_LEVEL,this.startFragRequested=!1;return}const c=l.len,d=this.getMaxBufferLength(a.maxBitrate);if(c>=d)return;this.backtrackFragment&&this.backtrackFragment.start>l.end&&(this.backtrackFragment=null);const f=this.backtrackFragment?this.backtrackFragment.start:l.end;let h=this.getNextFragment(f,u);if(this.couldBacktrack&&!this.fragPrevious&&h&&ut(h)&&this.fragmentTracker.getState(h)!==bt.OK){var m;const x=((m=this.backtrackFragment)!=null?m:h).sn-u.startSN,p=u.fragments[x-1];p&&h.cc===p.cc&&(h=p,this.fragmentTracker.removeFragment(p))}else this.backtrackFragment&&l.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,f)){if(!h.gap){const x=this.audioOnly&&!this.altAudio?ze.AUDIO:ze.VIDEO,p=(x===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;p&&this.afterBufferFlushed(p,x,ne.MAIN)}h=this.getNextFragmentLoopLoading(h,u,l,ne.MAIN,d)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,f))}loadFragment(e,n,i){const s=this.fragmentTracker.getState(e);s===bt.NOT_LOADED||s===bt.PARTIAL?ut(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,n)):super.loadFragment(e,n,i):this._loadInitSegment(e,n):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ne.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:n}=this;if(n!=null&&n.readyState){let i;const s=this.getAppendedFrag(n.currentTime);s&&s.start>1&&this.flushMainBuffer(0,s.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const l=this.getMainFwdBufferInfo();if(!l||l.len<r.targetduration*2)return}if(!n.paused&&e){const l=this.hls.nextLoadLevel,o=e[l],u=this.fragLastKbps;u&&this.fragCurrent?i=this.fragCurrent.duration*o.maxBitrate/(1e3*u)+1:i=0}else i=0;const a=this.getBufferedFrag(n.currentTime+i);if(a){const l=this.followingBufferedFrag(a);if(l){this.abortCurrentFrag();const o=l.maxStartPTS?l.maxStartPTS:l.start,u=l.duration,c=Math.max(a.end,o+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case H.KEY_LOADING:case H.FRAG_LOADING:case H.FRAG_LOADING_WAITING_RETRY:case H.PARSING:case H.PARSED:this.state=H.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,n){super.flushMainBuffer(e,n,this.altAudio===2?"video":null)}onMediaAttached(e,n){super.onMediaAttached(e,n);const i=n.media;zt(i,"playing",this.onMediaPlaying),zt(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,n){const{media:i}=this;i&&(Wt(i,"playing",this.onMediaPlaying),Wt(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,n),!n.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(S.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,n){let i=!1,s=!1;for(let r=0;r<n.levels.length;r++){const a=n.levels[r].audioCodec;a&&(i=i||a.indexOf("mp4a.40.2")!==-1,s=s||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=i&&s&&!zN(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1}onLevelLoading(e,n){const{levels:i}=this;if(!i||this.state!==H.IDLE)return;const s=n.levelInfo;(!s.details||s.details.live&&(this.levelLastLoaded!==s||s.details.expired)||this.waitForCdnTuneIn(s.details))&&(this.state=H.WAITING_LEVEL)}onLevelLoaded(e,n){var i;const{levels:s,startFragRequested:r}=this,a=n.level,l=n.details,o=l.totalduration;if(!s){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${o}`);const u=n.levelInfo,c=this.fragCurrent;c&&(this.state===H.FRAG_LOADING||this.state===H.FRAG_LOADING_WAITING_RETRY)&&c.level!==n.level&&c.loader&&this.abortCurrentFrag();let d=0;if(l.live||(i=u.details)!=null&&i.live){var f;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;d=this.alignPlaylists(l,u.details,(f=this.levelLastLoaded)==null?void 0:f.details)}if(u.details=l,this.levelLastLoaded=u,r||this.setStartPosition(l,d),this.hls.trigger(S.LEVEL_UPDATED,{details:l,level:a}),this.state===H.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=H.IDLE}r&&l.live&&this.synchronizeToLiveEdge(l),this.tick()}synchronizeToLiveEdge(e){const{config:n,media:i}=this;if(!i)return;const s=this.hls.liveSyncPosition,r=this.getLoadPosition(),a=e.fragmentStart,l=e.edge,o=r>=a-n.maxFragLookUpTolerance&&r<=l;if(s!==null&&i.duration>s&&(r<s||!o)){const c=n.liveMaxLatencyDuration!==void 0?n.liveMaxLatencyDuration:n.liveMaxLatencyDurationCount*e.targetduration;if((!o&&i.readyState<4||r<l-c)&&(this._hasEnoughToStart||(this.nextLoadPosition=s),i.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${l}, reset currentTime to : ${s.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const d=he.bufferInfo(i,s,0);if(!((u=d.buffered)!=null&&u.length)){i.currentTime=s;return}if(d.start<=r){i.currentTime=s;return}const{nextStart:h}=he.bufferedInfo(d.buffered,r,0);h&&(i.currentTime=h)}else i.currentTime=s}}_handleFragmentLoadProgress(e){var n;const i=e.frag,{part:s,payload:r}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const l=a[i.level];if(!l){this.warn(`Level ${i.level} not found on progress`);return}const o=l.details;if(!o){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const u=l.videoCodec,c=o.PTSKnown||!o.live,d=(n=i.initSegment)==null?void 0:n.data,f=this._getAudioCodec(l),h=this.transmuxer=this.transmuxer||new VS(this.hls,ne.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=s?s.index:-1,y=m!==-1,x=new Gm(i.level,i.sn,i.stats.chunkCount,r.byteLength,m,y),p=this.initPTS[i.cc];h.push(r,d,f,u,i,s,o.totalduration,c,x,p)}onAudioTrackSwitching(e,n){const i=this.hls,s=this.altAudio!==0;if(Ou(n.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(s){this.altAudio=0,this.fragmentTracker.removeAllFragments(),i.once(S.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(S.AUDIO_TRACK_SWITCHED,n)}),i.trigger(S.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(S.AUDIO_TRACK_SWITCHED,n)}}onAudioTrackSwitched(e,n){const i=Ou(n.url,this.hls);if(i){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,n){const i=n.tracks;let s,r,a=!1;for(const l in i){const o=i[l];if(o.id==="main"){if(r=l,s=o,l==="video"){const u=i[l];u&&(this.videoBuffer=u.buffer)}}else a=!0}a&&s?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=s.buffer):this.mediaBuffer=this.media}onFragBuffered(e,n){const{frag:i,part:s}=n,r=i.type===ne.MAIN;if(r){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${s?" p: "+s.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===H.PARSED&&(this.state=H.IDLE);return}const l=s?s.stats:i.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),ut(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,s)}const a=this.media;a&&(!this._hasEnoughToStart&&he.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,n){var i;if(n.fatal){this.state=H.ERROR;return}switch(n.details){case O.FRAG_GAP:case O.FRAG_PARSING_ERROR:case O.FRAG_DECRYPT_ERROR:case O.FRAG_LOAD_ERROR:case O.FRAG_LOAD_TIMEOUT:case O.KEY_LOAD_ERROR:case O.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ne.MAIN,n);break;case O.LEVEL_LOAD_ERROR:case O.LEVEL_LOAD_TIMEOUT:case O.LEVEL_PARSING_ERROR:!n.levelRetry&&this.state===H.WAITING_LEVEL&&((i=n.context)==null?void 0:i.type)===Ee.LEVEL&&(this.state=H.IDLE);break;case O.BUFFER_ADD_CODEC_ERROR:case O.BUFFER_APPEND_ERROR:if(n.parent!=="main")return;this.reduceLengthAndFlushBuffer(n)&&this.resetLoadingState();break;case O.BUFFER_FULL_ERROR:if(n.parent!=="main")return;this.reduceLengthAndFlushBuffer(n)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case O.INTERNAL_EXCEPTION:this.recoverWorkerError(n);break}}onFragLoadEmergencyAborted(){this.state=H.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:n}){if(n!==ze.AUDIO||!this.altAudio){const i=(n===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,n,ne.MAIN),this.tick())}}onLevelsUpdated(e,n){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=n.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const n=e.currentTime;let i=this.startPosition;if(i>=0&&n<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${n}`);return}const s=this.timelineOffset;s&&i&&(i+=s);const r=this.getLevelDetails(),a=he.getBuffered(e),l=a.length?a.start(0):0,o=l-i,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<u||this.loadingParts&&o<2*((r==null?void 0:r.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),i+=o,this.startPosition=i),n<i&&(this.log(`seek to target start position ${i} from current time ${n} buffer start ${l}`),e.currentTime=i)}}_getAudioCodec(e){let n=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n.indexOf("mp4a.40.5")!==-1?n="mp4a.40.2":n="mp4a.40.5"),n}_loadBitrateTestFrag(e,n){e.bitrateTest=!0,this._doFragLoad(e,n).then(i=>{const{hls:s}=this,r=i==null?void 0:i.frag;if(!r||this.fragContextChanged(r))return;n.fragmentError=0,this.state=H.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=r.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),s.trigger(S.FRAG_LOADED,i),r.bitrateTest=!1}).catch(i=>{this.state===H.STOPPED||this.state===H.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const n=this.playlistType,{hls:i}=this,{remuxResult:s,chunkMeta:r}=e,a=this.getCurrentContext(r);if(!a){this.resetWhenMissingContext(r);return}const{frag:l,part:o,level:u}=a,{video:c,text:d,id3:f,initSegment:h}=s,{details:m}=u,y=this.altAudio?void 0:s.audio;if(this.fragContextChanged(l)){this.fragmentTracker.removeFragment(l);return}if(this.state=H.PARSING,h){const x=h.tracks;if(x){const E=l.initSegment||l;if(this.unhandledEncryptionError(h,l))return;this._bufferInitSegment(u,x,E,r),i.trigger(S.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:n,tracks:x})}const p=h.initPTS,v=h.timescale,b=this.initPTS[l.cc];if(ee(p)&&(!b||b.baseTime!==p||b.timescale!==v)){const E=h.trackId;this.initPTS[l.cc]={baseTime:p,timescale:v,trackId:E},i.trigger(S.INIT_PTS_FOUND,{frag:l,id:n,initPTS:p,timescale:v,trackId:E})}}if(c&&m){y&&c.type==="audiovideo"&&this.logMuxedErr(l);const x=m.fragments[l.sn-1-m.startSN],p=l.sn===m.startSN,v=!x||l.cc>x.cc;if(s.independent!==!1){const{startPTS:b,endPTS:E,startDTS:k,endDTS:_}=c;if(o)o.elementaryStreams[c.type]={startPTS:b,endPTS:E,startDTS:k,endDTS:_};else if(c.firstKeyFrame&&c.independent&&r.id===1&&!v&&(this.couldBacktrack=!0),c.dropped&&c.independent){const L=this.getMainFwdBufferInfo(),C=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,w=c.firstKeyFramePTS?c.firstKeyFramePTS:b;if(!p&&C<w-this.config.maxBufferHole&&!v){this.backtrack(l);return}else v&&(l.gap=!0);l.setElementaryStreamInfo(c.type,l.start,E,l.start,_,!0)}else p&&b-(m.appliedTimelineOffset||0)>Wo&&(l.gap=!0);l.setElementaryStreamInfo(c.type,b,E,k,_),this.backtrackFragment&&(this.backtrackFragment=l),this.bufferFragmentData(c,l,o,r,p||v)}else if(p||v)l.gap=!0;else{this.backtrack(l);return}}if(y){const{startPTS:x,endPTS:p,startDTS:v,endDTS:b}=y;o&&(o.elementaryStreams[ze.AUDIO]={startPTS:x,endPTS:p,startDTS:v,endDTS:b}),l.setElementaryStreamInfo(ze.AUDIO,x,p,v,b),this.bufferFragmentData(y,l,o,r)}if(m&&f!=null&&f.samples.length){const x={id:n,frag:l,details:m,samples:f.samples};i.trigger(S.FRAG_PARSING_METADATA,x)}if(m&&d){const x={id:n,frag:l,details:m,samples:d.samples};i.trigger(S.FRAG_PARSING_USERDATA,x)}}logMuxedErr(e){this.warn(`${ut(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,n,i,s){if(this.state!==H.PARSING)return;this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&(delete n.audio,n.audiovideo&&this.logMuxedErr(i));const{audio:r,video:a,audiovideo:l}=n;if(r){const u=e.audioCodec;let c=Ho(r.codec,u);c==="mp4a"&&(c="mp4a.40.5");const d=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){c&&(c.indexOf("mp4a.40.5")!==-1?c="mp4a.40.2":c="mp4a.40.5");const f=r.metadata;f&&"channelCount"in f&&(f.channelCount||1)!==1&&d.indexOf("firefox")===-1&&(c="mp4a.40.5")}c&&c.indexOf("mp4a.40.5")!==-1&&d.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(c="mp4a.40.2",this.log(`Android: force audio codec to ${c}`)),u&&u!==c&&this.log(`Swapping manifest audio codec "${u}" for "${c}"`),r.levelCodec=c,r.id=ne.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${c||""}/${u||""}/${r.codec}]`),delete n.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=ne.MAIN;const u=a.codec;if((u==null?void 0:u.length)===4)switch(u){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${a.codec!==u?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete n.audiovideo}l&&(this.log(`Init audiovideo buffer, container:${l.container}, codecs[level/parsed]=[${e.codecs}/${l.codec}]`),delete n.video,delete n.audio);const o=Object.keys(n);if(o.length){if(this.hls.trigger(S.BUFFER_CODECS,n),!this.hls)return;o.forEach(u=>{const d=n[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(S.BUFFER_APPENDING,{type:u,data:d,frag:i,part:null,chunkMeta:s,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ne.MAIN)}get maxBufferLength(){const{levels:e,level:n}=this,i=e==null?void 0:e[n];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=H.IDLE}checkFragmentChanged(){const e=this.media;let n=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(he.isBuffered(e,i)?n=this.getAppendedFrag(i):he.isBuffered(e,i+.1)&&(n=this.getAppendedFrag(i+.1)),n){this.backtrackFragment=null;const s=this.fragPlaying,r=n.level;(!s||n.sn!==s.sn||s.level!==r)&&(this.fragPlaying=n,this.hls.trigger(S.FRAG_CHANGED,{frag:n}),(!s||s.level!==r)&&this.hls.trigger(S.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const n=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ee(n)?this.getAppendedFrag(n):null}get currentProgramDateTime(){var e;const n=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ee(n)){const i=this.getLevelDetails(),s=this.currentFrag||(i?Xs(null,i.fragments,n):null);if(s){const r=s.programDateTime;if(r!==null){const a=r+(n-s.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class VN extends Un{constructor(e,n){super("key-loader",n),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyIdToKeyInfo){const s=this.keyIdToKeyInfo[i].loader;if(s){var n;if(e&&e!==((n=s.context)==null?void 0:n.frag.type))return;s.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[e];(n.mediaKeySessionContext||n.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[e].loader;n&&n.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,n=O.KEY_LOAD_ERROR,i,s,r){return new Si({type:re.NETWORK_ERROR,details:n,fatal:!1,frag:e,response:r,error:i,networkDetails:s})}loadClear(e,n,i){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(n.length)for(let s=0,r=n.length;s<r;s++){const a=n[s];if(e.cc<=a.cc&&(!ut(e)||!ut(a)||e.sn<a.sn)||!i&&s==r-1)return this.emeController.selectKeySystemFormat(a).then(l=>{if(!this.emeController)return;a.setKeyFormat(l);const o=Ko(l);if(o)return this.emeController.getKeySystemAccess([o])})}if(this.config.requireKeySystemAccessOnStart){const s=Ma(this.config);if(s.length)return this.emeController.getKeySystemAccess(s)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(n=>this.loadInternal(e,n)):this.loadInternal(e)}loadInternal(e,n){var i,s;n&&e.setKeyFormat(n);const r=e.decryptdata;if(!r){const u=new Error(n?`Expected frag.decryptdata to be defined after setting format ${n}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,u))}const a=r.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const l=Md(r);let o=this.keyIdToKeyInfo[l];if((i=o)!=null&&i.decryptdata.key)return r.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&(s=o)!=null&&s.keyLoadPromise)switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(c=>{const{keyInfo:d}=c;return r.key=d.decryptdata.key,{frag:e,keyInfo:d}})}switch(this.log(`${this.keyIdToKeyInfo[l]?"Rel":"L"}oading${r.keyId?" keyId: "+wt(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),o=this.keyIdToKeyInfo[l]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,O.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,n){const i={frag:n,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var s;if(!e.decryptdata.keyId&&(s=n.initSegment)!=null&&s.data){const a=cC(n.initSegment.data);if(a.length){let l=a[0];l.some(o=>o!==0)?(this.log(`Using keyId found in init segment ${wt(l)}`),fs.setKeyIdForUri(e.decryptdata.uri,l)):(l=fs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${wt(l)}`)),e.decryptdata.keyId=l}}if(!e.decryptdata.keyId&&!ut(n))return Promise.resolve(i);const r=this.emeController.loadKey(i);return(e.keyLoadPromise=r.then(a=>(e.mediaKeySessionContext=a,i))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=n),a})}return Promise.resolve(i)}loadKeyHTTP(e,n){const i=this.config,s=i.loader,r=new s(i);return n.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((a,l)=>{const o={keyInfo:e,frag:n,responseType:"arraybuffer",url:e.decryptdata.uri},u=i.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},d={onSuccess:(f,h,m,y)=>{const{frag:x,keyInfo:p}=m,v=Md(p.decryptdata);if(!x.decryptdata||p!==this.keyIdToKeyInfo[v])return l(this.createKeyLoadError(x,O.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));p.decryptdata.key=x.decryptdata.key=new Uint8Array(f.data),x.keyLoader=null,p.loader=null,a({frag:x,keyInfo:p})},onError:(f,h,m,y)=>{this.resetLoader(h),l(this.createKeyLoadError(n,O.KEY_LOAD_ERROR,new Error(`HTTP Error ${f.code} loading key ${f.text}`),m,Me({url:o.url,data:void 0},f)))},onTimeout:(f,h,m)=>{this.resetLoader(h),l(this.createKeyLoadError(n,O.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(f,h,m)=>{this.resetLoader(h),l(this.createKeyLoadError(n,O.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};r.load(o,c,d)})}resetLoader(e){const{frag:n,keyInfo:i,url:s}=e,r=i.loader;n.keyLoader===r&&(n.keyLoader=null,i.loader=null);const a=Md(i.decryptdata)||s;delete this.keyIdToKeyInfo[a],r&&r.destroy()}}function Md(t){if(t.keyFormat!==Ct.FAIRPLAY){const e=t.keyId;if(e)return wt(e)}return t.uri}function Ry(t){const{type:e}=t;switch(e){case Ee.AUDIO_TRACK:return ne.AUDIO;case Ee.SUBTITLE_TRACK:return ne.SUBTITLE;default:return ne.MAIN}}function Od(t,e){let n=t.url;return(n===void 0||n.indexOf("data:")===0)&&(n=e.url),n}class KN{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(S.MANIFEST_LOADING,this.onManifestLoading,this),e.on(S.LEVEL_LOADING,this.onLevelLoading,this),e.on(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(S.MANIFEST_LOADING,this.onManifestLoading,this),e.off(S.LEVEL_LOADING,this.onLevelLoading,this),e.off(S.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(S.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(S.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const n=this.hls.config,i=n.pLoader,s=n.loader,r=i||s,a=new r(n);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const n=this.loaders[e];n&&n.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,n){const{url:i}=n;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ee.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,n){const{id:i,level:s,pathwayId:r,url:a,deliveryDirectives:l,levelInfo:o}=n;this.load({id:i,level:s,pathwayId:r,responseType:"text",type:Ee.LEVEL,url:a,deliveryDirectives:l,levelOrTrack:o})}onAudioTrackLoading(e,n){const{id:i,groupId:s,url:r,deliveryDirectives:a,track:l}=n;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ee.AUDIO_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onSubtitleTrackLoading(e,n){const{id:i,groupId:s,url:r,deliveryDirectives:a,track:l}=n;this.load({id:i,groupId:s,level:null,responseType:"text",type:Ee.SUBTITLE_TRACK,url:r,deliveryDirectives:a,levelOrTrack:l})}onLevelsUpdated(e,n){const i=this.loaders[Ee.LEVEL];if(i){const s=i.context;s&&!n.levels.some(r=>r===s.levelOrTrack)&&(i.abort(),delete this.loaders[Ee.LEVEL])}}load(e){var n;const i=this.hls.config;let s=this.getInternalLoader(e);if(s){const u=this.hls.logger,c=s.context;if(c&&c.levelOrTrack===e.levelOrTrack&&(c.url===e.url||c.deliveryDirectives&&!e.deliveryDirectives)){c.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${c.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),s.abort()}let r;if(e.type===Ee.MANIFEST?r=i.manifestLoadPolicy.default:r=$e({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),ee((n=e.deliveryDirectives)==null?void 0:n.part)){let u;if(e.type===Ee.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===Ee.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===Ee.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const c=u.partTarget,d=u.targetduration;if(c&&d){const f=Math.max(c*3,d*.8)*1e3;r=$e({},r,{maxTimeToFirstByteMs:Math.min(f,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(f,r.maxTimeToFirstByteMs)})}}}const a=r.errorRetry||r.timeoutRetry||{},l={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(u,c,d,f)=>{const h=this.getInternalLoader(d);this.resetInternalLoader(d.type);const m=u.data;c.parsing.start=performance.now(),li.isMediaPlaylist(m)||d.type!==Ee.MANIFEST?this.handleTrackOrLevelPlaylist(u,c,d,f||null,h):this.handleMasterPlaylist(u,c,d,f)},onError:(u,c,d,f)=>{this.handleNetworkError(c,d,!1,u,f)},onTimeout:(u,c,d)=>{this.handleNetworkError(c,d,!0,void 0,u)}};s.load(e,l,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:n},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${n}`),this.hls.startLoad(n))}handleMasterPlaylist(e,n,i,s){const r=this.hls,a=e.data,l=Od(e,i),o=li.parseMasterPlaylist(a,l);if(o.playlistParsingError){n.parsing.end=performance.now(),this.handleManifestParsingError(e,i,o.playlistParsingError,s,n);return}const{contentSteering:u,levels:c,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m}=o;this.variableList=m,c.forEach(v=>{const{unknownCodecs:b}=v;if(b){const{preferManagedMediaSource:E}=this.hls.config;let{audioCodec:k,videoCodec:_}=v;for(let L=b.length;L--;){const C=b[L];xl(C,"audio",E)?(v.audioCodec=k=k?`${k},${C}`:C,ea.audio[k.substring(0,4)]=2,b.splice(L,1)):xl(C,"video",E)&&(v.videoCodec=_=_?`${_},${C}`:C,ea.video[_.substring(0,4)]=2,b.splice(L,1))}}});const{AUDIO:y=[],SUBTITLES:x,"CLOSED-CAPTIONS":p}=li.parseMasterPlaylistMedia(a,l,o);y.length&&!y.some(b=>!b.url)&&c[0].audioCodec&&!c[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new tt({}),bitrate:0,url:""})),r.trigger(S.MANIFEST_LOADED,{levels:c,audioTracks:y,subtitles:x,captions:p,contentSteering:u,url:l,stats:n,networkDetails:s,sessionData:d,sessionKeys:f,startTimeOffset:h,variableList:m})}handleTrackOrLevelPlaylist(e,n,i,s,r){const a=this.hls,{id:l,level:o,type:u}=i,c=Od(e,i),d=ee(o)?o:ee(l)?l:0,f=Ry(i),h=li.parseLevelPlaylist(e.data,c,d,f,0,this.variableList);if(u===Ee.MANIFEST){const m={attrs:new tt({}),bitrate:0,details:h,name:"",url:c};h.requestScheduled=n.loading.start+bS(h,0),a.trigger(S.MANIFEST_LOADED,{levels:[m],audioTracks:[],url:c,stats:n,networkDetails:s,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}n.parsing.end=performance.now(),i.levelDetails=h,this.handlePlaylistLoaded(h,e,n,i,s,r)}handleManifestParsingError(e,n,i,s,r){this.hls.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.MANIFEST_PARSING_ERROR,fatal:n.type===Ee.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:n,networkDetails:s,stats:r})}handleNetworkError(e,n,i=!1,s,r){let a=`A network ${i?"timeout":"error"+(s?" (status "+s.code+")":"")} occurred while loading ${e.type}`;e.type===Ee.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Ee.AUDIO_TRACK||e.type===Ee.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const l=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let o=O.UNKNOWN,u=!1;const c=this.getInternalLoader(e);switch(e.type){case Ee.MANIFEST:o=i?O.MANIFEST_LOAD_TIMEOUT:O.MANIFEST_LOAD_ERROR,u=!0;break;case Ee.LEVEL:o=i?O.LEVEL_LOAD_TIMEOUT:O.LEVEL_LOAD_ERROR,u=!1;break;case Ee.AUDIO_TRACK:o=i?O.AUDIO_TRACK_LOAD_TIMEOUT:O.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case Ee.SUBTITLE_TRACK:o=i?O.SUBTITLE_TRACK_LOAD_TIMEOUT:O.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);const d={type:re.NETWORK_ERROR,details:o,fatal:u,url:e.url,loader:c,context:e,error:l,networkDetails:n,stats:r};if(s){const f=(n==null?void 0:n.url)||e.url;d.response=Me({url:f,data:void 0},s)}this.hls.trigger(S.ERROR,d)}handlePlaylistLoaded(e,n,i,s,r,a){const l=this.hls,{type:o,level:u,levelOrTrack:c,id:d,groupId:f,deliveryDirectives:h}=s,m=Od(n,s),y=Ry(s);let x=typeof s.level=="number"&&y===ne.MAIN?u:void 0;const p=e.playlistParsingError;if(p){if(this.hls.logger.warn(`${p} ${e.url}`),!l.config.ignorePlaylistParsingErrors){l.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_PARSING_ERROR,fatal:!1,url:m,error:p,reason:p.message,response:n,context:s,level:x,parent:y,networkDetails:r,stats:i});return}e.playlistParsingError=null}if(!e.fragments.length){const v=e.playlistParsingError=new Error("No Segments found in Playlist");l.trigger(S.ERROR,{type:re.NETWORK_ERROR,details:O.LEVEL_EMPTY_ERROR,fatal:!1,url:m,error:v,reason:v.message,response:n,context:s,level:x,parent:y,networkDetails:r,stats:i});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),o){case Ee.MANIFEST:case Ee.LEVEL:if(x){if(!c)x=0;else if(c!==l.levels[x]){const v=l.levels.indexOf(c);v>-1&&(x=v)}}l.trigger(S.LEVEL_LOADED,{details:e,levelInfo:c||l.levels[0],level:x||0,id:d||0,stats:i,networkDetails:r,deliveryDirectives:h,withoutMultiVariant:o===Ee.MANIFEST});break;case Ee.AUDIO_TRACK:l.trigger(S.AUDIO_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:i,networkDetails:r,deliveryDirectives:h});break;case Ee.SUBTITLE_TRACK:l.trigger(S.SUBTITLE_TRACK_LOADED,{details:e,track:c,id:d||0,groupId:f||"",stats:i,networkDetails:r,deliveryDirectives:h});break}}}class pn{static get version(){return Sl}static isMSESupported(){return vE()}static isSupported(){return $N()}static getMediaSource(){return xs()}static get Events(){return S}static get MetadataSchema(){return mn}static get ErrorTypes(){return re}static get ErrorDetails(){return O}static get DefaultConfig(){return pn.defaultConfig?pn.defaultConfig:wN}static set DefaultConfig(e){pn.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ym,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const n=this.logger=Zw(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=IN(pn.DefaultConfig,e,n);this.userConfig=e,i.progressive&&DN(i,n);const{abrController:s,bufferController:r,capLevelController:a,errorController:l,fpsController:o}=i,u=new l(this),c=this.abrController=new s(this),d=new YC(this),f=i.interstitialsController,h=f?this.interstitialsController=new f(this,pn):null,m=this.bufferController=new r(this,d),y=this.capLevelController=new a(this),x=new o(this),p=new KN(this),v=i.contentSteeringController,b=v?new v(this):null,E=this.levelController=new jN(this,b),k=new BN(this),_=new VN(this.config,this.logger),L=this.streamController=new HN(this,d,_),C=this.gapController=new PN(this,d);y.setStreamController(L),x.setStreamController(L);const w=[p,E,L];h&&w.splice(1,0,h),b&&w.splice(1,0,b),this.networkControllers=w;const A=[c,m,C,y,x,k,d];this.audioTrackController=this.createController(i.audioTrackController,w);const I=i.audioStreamController;I&&w.push(this.audioStreamController=new I(this,d,_)),this.subtitleTrackController=this.createController(i.subtitleTrackController,w);const N=i.subtitleStreamController;N&&w.push(this.subtititleStreamController=new N(this,d,_)),this.createController(i.timelineController,A),_.emeController=this.emeController=this.createController(i.emeController,A),this.cmcdController=this.createController(i.cmcdController,A),this.latencyController=this.createController(UN,A),this.coreComponents=A,w.push(u);const V=u.onErrorOut;typeof V=="function"&&this.on(S.ERROR,V,u),this.on(S.MANIFEST_LOADED,p.onManifestLoaded,p)}createController(e,n){if(e){const i=new e(this);return n&&n.push(i),i}return null}on(e,n,i=this){this._emitter.on(e,n,i)}once(e,n,i=this){this._emitter.once(e,n,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,n,i=this,s){this._emitter.off(e,n,i,s)}listeners(e){return this._emitter.listeners(e)}emit(e,n,i){return this._emitter.emit(e,n,i)}trigger(e,n){if(this.config.debug)return this.emit(e,e,n);try{return this.emit(e,e,n)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const s=e===S.ERROR;this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.INTERNAL_EXCEPTION,fatal:s,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(S.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(n=>n.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(n=>n.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(S.ERROR,{type:re.OTHER_ERROR,details:O.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const n="media"in e,i=n?e.media:e,s=n?e:{media:i};this._media=i,this.trigger(S.MEDIA_ATTACHING,s)}detachMedia(){this.logger.log("detachMedia"),this.trigger(S.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(S.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const n=this.media,i=this._url,s=this._url=Pm.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${s}`),n&&i&&(i!==s||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(n)),this.trigger(S.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,n){this.logger.log(`startLoad(${e+(n?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,n),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ne.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ne.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ne.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,n=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),n&&this.startLoad(n))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=P2()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const n=!!e;n!==this.config.capLevelToPlayerSize&&(n?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=n)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){IC(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:n}}=this;if(!e)return 0;const i=e.length;for(let s=0;s<i;s++)if(e[s].maxBitrate>=n)return s;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:n,maxHdcpLevel:i}=this;let s;if(n===-1&&e!=null&&e.length?s=e.length-1:s=n,i)for(let r=s;r--;){const a=e[r].attrs["HDCP-LEVEL"];if(a&&a<=i)return r}return s}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var n;return((n=this.audioTrackController)==null?void 0:n.setAudioOption(e))||null}setSubtitleOption(e){var n;return((n=this.subtitleTrackController)==null?void 0:n.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const n=this.audioTrackController;n&&(n.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const n=this.subtitleTrackController;n&&(n.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const n=this.subtitleTrackController;n&&(n.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,n=this.allAudioTracks){const i=rS(n);return iS(e,i,navigator.mediaCapabilities)}}pn.defaultConfig=void 0;function YN(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const qN=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,XN=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,QN={};function wy(t,e){return(QN.jsx?XN:qN).test(t)}const WN=/[ \t\n\f\r]/g;function ZN(t){return typeof t=="object"?t.type==="text"?Cy(t.value):!1:Cy(t)}function Cy(t){return t.replace(WN,"")===""}class jl{constructor(e,n,i){this.normal=n,this.property=e,i&&(this.space=i)}}jl.prototype.normal={};jl.prototype.property={};jl.prototype.space=void 0;function bE(t,e){const n={},i={};for(const s of t)Object.assign(n,s.property),Object.assign(i,s.normal);return new jl(n,i,e)}function xh(t){return t.toLowerCase()}class tn{constructor(e,n){this.attribute=n,this.property=e}}tn.prototype.attribute="";tn.prototype.booleanish=!1;tn.prototype.boolean=!1;tn.prototype.commaOrSpaceSeparated=!1;tn.prototype.commaSeparated=!1;tn.prototype.defined=!1;tn.prototype.mustUseProperty=!1;tn.prototype.number=!1;tn.prototype.overloadedBoolean=!1;tn.prototype.property="";tn.prototype.spaceSeparated=!1;tn.prototype.space=void 0;let JN=0;const ye=ir(),mt=ir(),vh=ir(),W=ir(),Ke=ir(),zr=ir(),un=ir();function ir(){return 2**++JN}const bh=Object.freeze(Object.defineProperty({__proto__:null,boolean:ye,booleanish:mt,commaOrSpaceSeparated:un,commaSeparated:zr,number:W,overloadedBoolean:vh,spaceSeparated:Ke},Symbol.toStringTag,{value:"Module"})),Pd=Object.keys(bh);class a0 extends tn{constructor(e,n,i,s){let r=-1;if(super(e,n),Iy(this,"space",s),typeof i=="number")for(;++r<Pd.length;){const a=Pd[r];Iy(this,Pd[r],(i&bh[a])===bh[a])}}}a0.prototype.defined=!0;function Iy(t,e,n){n&&(t[e]=n)}function da(t){const e={},n={};for(const[i,s]of Object.entries(t.properties)){const r=new a0(i,t.transform(t.attributes||{},i),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(r.mustUseProperty=!0),e[i]=r,n[xh(i)]=i,n[xh(r.attribute)]=i}return new jl(e,n,t.space)}const SE=da({properties:{ariaActiveDescendant:null,ariaAtomic:mt,ariaAutoComplete:null,ariaBusy:mt,ariaChecked:mt,ariaColCount:W,ariaColIndex:W,ariaColSpan:W,ariaControls:Ke,ariaCurrent:null,ariaDescribedBy:Ke,ariaDetails:null,ariaDisabled:mt,ariaDropEffect:Ke,ariaErrorMessage:null,ariaExpanded:mt,ariaFlowTo:Ke,ariaGrabbed:mt,ariaHasPopup:null,ariaHidden:mt,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Ke,ariaLevel:W,ariaLive:null,ariaModal:mt,ariaMultiLine:mt,ariaMultiSelectable:mt,ariaOrientation:null,ariaOwns:Ke,ariaPlaceholder:null,ariaPosInSet:W,ariaPressed:mt,ariaReadOnly:mt,ariaRelevant:null,ariaRequired:mt,ariaRoleDescription:Ke,ariaRowCount:W,ariaRowIndex:W,ariaRowSpan:W,ariaSelected:mt,ariaSetSize:W,ariaSort:null,ariaValueMax:W,ariaValueMin:W,ariaValueNow:W,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function EE(t,e){return e in t?t[e]:e}function TE(t,e){return EE(t,e.toLowerCase())}const eM=da({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:zr,acceptCharset:Ke,accessKey:Ke,action:null,allow:null,allowFullScreen:ye,allowPaymentRequest:ye,allowUserMedia:ye,alt:null,as:null,async:ye,autoCapitalize:null,autoComplete:Ke,autoFocus:ye,autoPlay:ye,blocking:Ke,capture:null,charSet:null,checked:ye,cite:null,className:Ke,cols:W,colSpan:null,content:null,contentEditable:mt,controls:ye,controlsList:Ke,coords:W|zr,crossOrigin:null,data:null,dateTime:null,decoding:null,default:ye,defer:ye,dir:null,dirName:null,disabled:ye,download:vh,draggable:mt,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:ye,formTarget:null,headers:Ke,height:W,hidden:vh,high:W,href:null,hrefLang:null,htmlFor:Ke,httpEquiv:Ke,id:null,imageSizes:null,imageSrcSet:null,inert:ye,inputMode:null,integrity:null,is:null,isMap:ye,itemId:null,itemProp:Ke,itemRef:Ke,itemScope:ye,itemType:Ke,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:ye,low:W,manifest:null,max:null,maxLength:W,media:null,method:null,min:null,minLength:W,multiple:ye,muted:ye,name:null,nonce:null,noModule:ye,noValidate:ye,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:ye,optimum:W,pattern:null,ping:Ke,placeholder:null,playsInline:ye,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:ye,referrerPolicy:null,rel:Ke,required:ye,reversed:ye,rows:W,rowSpan:W,sandbox:Ke,scope:null,scoped:ye,seamless:ye,selected:ye,shadowRootClonable:ye,shadowRootDelegatesFocus:ye,shadowRootMode:null,shape:null,size:W,sizes:null,slot:null,span:W,spellCheck:mt,src:null,srcDoc:null,srcLang:null,srcSet:null,start:W,step:null,style:null,tabIndex:W,target:null,title:null,translate:null,type:null,typeMustMatch:ye,useMap:null,value:mt,width:W,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Ke,axis:null,background:null,bgColor:null,border:W,borderColor:null,bottomMargin:W,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:ye,declare:ye,event:null,face:null,frame:null,frameBorder:null,hSpace:W,leftMargin:W,link:null,longDesc:null,lowSrc:null,marginHeight:W,marginWidth:W,noResize:ye,noHref:ye,noShade:ye,noWrap:ye,object:null,profile:null,prompt:null,rev:null,rightMargin:W,rules:null,scheme:null,scrolling:mt,standby:null,summary:null,text:null,topMargin:W,valueType:null,version:null,vAlign:null,vLink:null,vSpace:W,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:ye,disableRemotePlayback:ye,prefix:null,property:null,results:W,security:null,unselectable:null},space:"html",transform:TE}),tM=da({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:un,accentHeight:W,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:W,amplitude:W,arabicForm:null,ascent:W,attributeName:null,attributeType:null,azimuth:W,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:W,by:null,calcMode:null,capHeight:W,className:Ke,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:W,diffuseConstant:W,direction:null,display:null,dur:null,divisor:W,dominantBaseline:null,download:ye,dx:null,dy:null,edgeMode:null,editable:null,elevation:W,enableBackground:null,end:null,event:null,exponent:W,externalResourcesRequired:null,fill:null,fillOpacity:W,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:zr,g2:zr,glyphName:zr,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:W,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:W,horizOriginX:W,horizOriginY:W,id:null,ideographic:W,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:W,k:W,k1:W,k2:W,k3:W,k4:W,kernelMatrix:un,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:W,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:W,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:W,overlineThickness:W,paintOrder:null,panose1:null,path:null,pathLength:W,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Ke,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:W,pointsAtY:W,pointsAtZ:W,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:un,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:un,rev:un,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:un,requiredFeatures:un,requiredFonts:un,requiredFormats:un,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:W,specularExponent:W,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:W,strikethroughThickness:W,string:null,stroke:null,strokeDashArray:un,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:W,strokeOpacity:W,strokeWidth:null,style:null,surfaceScale:W,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:un,tabIndex:W,tableValues:null,target:null,targetX:W,targetY:W,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:un,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:W,underlineThickness:W,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:W,values:null,vAlphabetic:W,vMathematical:W,vectorEffect:null,vHanging:W,vIdeographic:W,version:null,vertAdvY:W,vertOriginX:W,vertOriginY:W,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:W,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:EE}),AE=da({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),kE=da({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:TE}),_E=da({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),nM={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},iM=/[A-Z]/g,Dy=/-[a-z]/g,sM=/^data[-\w.:]+$/i;function rM(t,e){const n=xh(e);let i=e,s=tn;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&sM.test(e)){if(e.charAt(4)==="-"){const r=e.slice(5).replace(Dy,lM);i="data"+r.charAt(0).toUpperCase()+r.slice(1)}else{const r=e.slice(4);if(!Dy.test(r)){let a=r.replace(iM,aM);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}s=a0}return new s(i,e)}function aM(t){return"-"+t.toLowerCase()}function lM(t){return t.charAt(1).toUpperCase()}const oM=bE([SE,eM,AE,kE,_E],"html"),l0=bE([SE,tM,AE,kE,_E],"svg");function uM(t){return t.join(" ").trim()}var o0={},Ny=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,cM=/\n/g,dM=/^\s*/,fM=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,hM=/^:\s*/,mM=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,gM=/^[;\s]*/,pM=/^\s+|\s+$/g,yM=`
`,My="/",Oy="*",Ms="",xM="comment",vM="declaration";function bM(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,i=1;function s(m){var y=m.match(cM);y&&(n+=y.length);var x=m.lastIndexOf(yM);i=~x?m.length-x:i+m.length}function r(){var m={line:n,column:i};return function(y){return y.position=new a(m),u(),y}}function a(m){this.start=m,this.end={line:n,column:i},this.source=e.source}a.prototype.content=t;function l(m){var y=new Error(e.source+":"+n+":"+i+": "+m);if(y.reason=m,y.filename=e.source,y.line=n,y.column=i,y.source=t,!e.silent)throw y}function o(m){var y=m.exec(t);if(y){var x=y[0];return s(x),t=t.slice(x.length),y}}function u(){o(dM)}function c(m){var y;for(m=m||[];y=d();)y!==!1&&m.push(y);return m}function d(){var m=r();if(!(My!=t.charAt(0)||Oy!=t.charAt(1))){for(var y=2;Ms!=t.charAt(y)&&(Oy!=t.charAt(y)||My!=t.charAt(y+1));)++y;if(y+=2,Ms===t.charAt(y-1))return l("End of comment missing");var x=t.slice(2,y-2);return i+=2,s(x),t=t.slice(y),i+=2,m({type:xM,comment:x})}}function f(){var m=r(),y=o(fM);if(y){if(d(),!o(hM))return l("property missing ':'");var x=o(mM),p=m({type:vM,property:Py(y[0].replace(Ny,Ms)),value:x?Py(x[0].replace(Ny,Ms)):Ms});return o(gM),p}}function h(){var m=[];c(m);for(var y;y=f();)y!==!1&&(m.push(y),c(m));return m}return u(),h()}function Py(t){return t?t.replace(pM,Ms):Ms}var SM=bM,EM=eu&&eu.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o0,"__esModule",{value:!0});o0.default=AM;const TM=EM(SM);function AM(t,e){let n=null;if(!t||typeof t!="string")return n;const i=(0,TM.default)(t),s=typeof e=="function";return i.forEach(r=>{if(r.type!=="declaration")return;const{property:a,value:l}=r;s?e(a,l,r):l&&(n=n||{},n[a]=l)}),n}var yc={};Object.defineProperty(yc,"__esModule",{value:!0});yc.camelCase=void 0;var kM=/^--[a-zA-Z0-9_-]+$/,_M=/-([a-z])/g,LM=/^[^-]+$/,RM=/^-(webkit|moz|ms|o|khtml)-/,wM=/^-(ms)-/,CM=function(t){return!t||LM.test(t)||kM.test(t)},IM=function(t,e){return e.toUpperCase()},Fy=function(t,e){return"".concat(e,"-")},DM=function(t,e){return e===void 0&&(e={}),CM(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(wM,Fy):t=t.replace(RM,Fy),t.replace(_M,IM))};yc.camelCase=DM;var NM=eu&&eu.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},MM=NM(o0),OM=yc;function Sh(t,e){var n={};return!t||typeof t!="string"||(0,MM.default)(t,function(i,s){i&&s&&(n[(0,OM.camelCase)(i,e)]=s)}),n}Sh.default=Sh;var PM=Sh;const FM=Yu(PM),LE=RE("end"),u0=RE("start");function RE(t){return e;function e(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function BM(t){const e=u0(t),n=LE(t);if(e&&n)return{start:e,end:n}}function Za(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?By(t.position):"start"in t||"end"in t?By(t):"line"in t||"column"in t?Eh(t):""}function Eh(t){return Uy(t&&t.line)+":"+Uy(t&&t.column)}function By(t){return Eh(t&&t.start)+"-"+Eh(t&&t.end)}function Uy(t){return t&&typeof t=="number"?t:1}class Bt extends Error{constructor(e,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let s="",r={},a=!1;if(n&&("line"in n&&"column"in n?r={place:n}:"start"in n&&"end"in n?r={place:n}:"type"in n?r={ancestors:[n],place:n.position}:r={...n}),typeof e=="string"?s=e:!r.cause&&e&&(a=!0,s=e.message,r.cause=e),!r.ruleId&&!r.source&&typeof i=="string"){const o=i.indexOf(":");o===-1?r.ruleId=i:(r.source=i.slice(0,o),r.ruleId=i.slice(o+1))}if(!r.place&&r.ancestors&&r.ancestors){const o=r.ancestors[r.ancestors.length-1];o&&(r.place=o.position)}const l=r.place&&"start"in r.place?r.place.start:r.place;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=l?l.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=l?l.line:void 0,this.name=Za(r.place)||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=a&&r.cause&&typeof r.cause.stack=="string"?r.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Bt.prototype.file="";Bt.prototype.name="";Bt.prototype.reason="";Bt.prototype.message="";Bt.prototype.stack="";Bt.prototype.column=void 0;Bt.prototype.line=void 0;Bt.prototype.ancestors=void 0;Bt.prototype.cause=void 0;Bt.prototype.fatal=void 0;Bt.prototype.place=void 0;Bt.prototype.ruleId=void 0;Bt.prototype.source=void 0;const c0={}.hasOwnProperty,UM=new Map,jM=/[A-Z]/g,$M=new Set(["table","tbody","thead","tfoot","tr"]),zM=new Set(["td","th"]),wE="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function GM(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let i;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=WM(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=QM(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:i,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?l0:oM,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},r=CE(s,t,void 0);return r&&typeof r!="string"?r:s.create(t,s.Fragment,{children:r||void 0},void 0)}function CE(t,e,n){if(e.type==="element")return HM(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return VM(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return YM(t,e,n);if(e.type==="mdxjsEsm")return KM(t,e);if(e.type==="root")return qM(t,e,n);if(e.type==="text")return XM(t,e)}function HM(t,e,n){const i=t.schema;let s=i;e.tagName.toLowerCase()==="svg"&&i.space==="html"&&(s=l0,t.schema=s),t.ancestors.push(e);const r=DE(t,e.tagName,!1),a=ZM(t,e);let l=f0(t,e);return $M.has(e.tagName)&&(l=l.filter(function(o){return typeof o=="string"?!ZN(o):!0})),IE(t,a,r,e),d0(a,l),t.ancestors.pop(),t.schema=i,t.create(e,r,a,n)}function VM(t,e){if(e.data&&e.data.estree&&t.evaluater){const i=e.data.estree.body[0];return i.type,t.evaluater.evaluateExpression(i.expression)}kl(t,e.position)}function KM(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);kl(t,e.position)}function YM(t,e,n){const i=t.schema;let s=i;e.name==="svg"&&i.space==="html"&&(s=l0,t.schema=s),t.ancestors.push(e);const r=e.name===null?t.Fragment:DE(t,e.name,!0),a=JM(t,e),l=f0(t,e);return IE(t,a,r,e),d0(a,l),t.ancestors.pop(),t.schema=i,t.create(e,r,a,n)}function qM(t,e,n){const i={};return d0(i,f0(t,e)),t.create(e,t.Fragment,i,n)}function XM(t,e){return e.value}function IE(t,e,n,i){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=i)}function d0(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function QM(t,e,n){return i;function i(s,r,a,l){const u=Array.isArray(a.children)?n:e;return l?u(r,a,l):u(r,a)}}function WM(t,e){return n;function n(i,s,r,a){const l=Array.isArray(r.children),o=u0(i);return e(s,r,a,l,{columnNumber:o?o.column-1:void 0,fileName:t,lineNumber:o?o.line:void 0},void 0)}}function ZM(t,e){const n={};let i,s;for(s in e.properties)if(s!=="children"&&c0.call(e.properties,s)){const r=eO(t,s,e.properties[s]);if(r){const[a,l]=r;t.tableCellAlignToStyle&&a==="align"&&typeof l=="string"&&zM.has(e.tagName)?i=l:n[a]=l}}if(i){const r=n.style||(n.style={});r[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function JM(t,e){const n={};for(const i of e.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&t.evaluater){const r=i.data.estree.body[0];r.type;const a=r.expression;a.type;const l=a.properties[0];l.type,Object.assign(n,t.evaluater.evaluateExpression(l.argument))}else kl(t,e.position);else{const s=i.name;let r;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&t.evaluater){const l=i.value.data.estree.body[0];l.type,r=t.evaluater.evaluateExpression(l.expression)}else kl(t,e.position);else r=i.value===null?!0:i.value;n[s]=r}return n}function f0(t,e){const n=[];let i=-1;const s=t.passKeys?new Map:UM;for(;++i<e.children.length;){const r=e.children[i];let a;if(t.passKeys){const o=r.type==="element"?r.tagName:r.type==="mdxJsxFlowElement"||r.type==="mdxJsxTextElement"?r.name:void 0;if(o){const u=s.get(o)||0;a=o+"-"+u,s.set(o,u+1)}}const l=CE(t,r,a);l!==void 0&&n.push(l)}return n}function eO(t,e,n){const i=rM(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?YN(n):uM(n)),i.property==="style"){let s=typeof n=="object"?n:tO(t,String(n));return t.stylePropertyNameCase==="css"&&(s=nO(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&i.space?nM[i.property]||i.property:i.attribute,n]}}function tO(t,e){try{return FM(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const i=n,s=new Bt("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=wE+"#cannot-parse-style-attribute",s}}function DE(t,e,n){let i;if(!n)i={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let r=-1,a;for(;++r<s.length;){const l=wy(s[r])?{type:"Identifier",name:s[r]}:{type:"Literal",value:s[r]};a=a?{type:"MemberExpression",object:a,property:l,computed:!!(r&&l.type==="Literal"),optional:!1}:l}i=a}else i=wy(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(i.type==="Literal"){const s=i.value;return c0.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(i);kl(t)}function kl(t,e){const n=new Bt("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=wE+"#cannot-handle-mdx-estrees-without-createevaluater",n}function nO(t){const e={};let n;for(n in t)c0.call(t,n)&&(e[iO(n)]=t[n]);return e}function iO(t){let e=t.replace(jM,sO);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function sO(t){return"-"+t.toLowerCase()}const Fd={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},rO={};function h0(t,e){const n=rO,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return NE(t,i,s)}function NE(t,e,n){if(aO(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return jy(t.children,e,n)}return Array.isArray(t)?jy(t,e,n):""}function jy(t,e,n){const i=[];let s=-1;for(;++s<t.length;)i[s]=NE(t[s],e,n);return i.join("")}function aO(t){return!!(t&&typeof t=="object")}const $y=document.createElement("i");function m0(t){const e="&"+t+";";$y.innerHTML=e;const n=$y.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Tn(t,e,n,i){const s=t.length;let r=0,a;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,i.length<1e4)a=Array.from(i),a.unshift(e,n),t.splice(...a);else for(n&&t.splice(e,n);r<i.length;)a=i.slice(r,r+1e4),a.unshift(e,0),t.splice(...a),r+=1e4,e+=1e4}function In(t,e){return t.length>0?(Tn(t,t.length,0,e),t):e}const zy={}.hasOwnProperty;function ME(t){const e={};let n=-1;for(;++n<t.length;)lO(e,t[n]);return e}function lO(t,e){let n;for(n in e){const s=(zy.call(t,n)?t[n]:void 0)||(t[n]={}),r=e[n];let a;if(r)for(a in r){zy.call(s,a)||(s[a]=[]);const l=r[a];oO(s[a],Array.isArray(l)?l:l?[l]:[])}}}function oO(t,e){let n=-1;const i=[];for(;++n<e.length;)(e[n].add==="after"?t:i).push(e[n]);Tn(t,0,0,i)}function OE(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Yn(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const jt=Es(/[A-Za-z]/),Ft=Es(/[\dA-Za-z]/),uO=Es(/[#-'*+\--9=?A-Z^-~]/);function Gu(t){return t!==null&&(t<32||t===127)}const Th=Es(/\d/),cO=Es(/[\dA-Fa-f]/),dO=Es(/[!-/:-@[-`{-~]/);function oe(t){return t!==null&&t<-2}function Ve(t){return t!==null&&(t<0||t===32)}function ke(t){return t===-2||t===-1||t===32}const xc=Es(new RegExp("\\p{P}|\\p{S}","u")),Qs=Es(/\s/);function Es(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function fa(t){const e=[];let n=-1,i=0,s=0;for(;++n<t.length;){const r=t.charCodeAt(n);let a="";if(r===37&&Ft(t.charCodeAt(n+1))&&Ft(t.charCodeAt(n+2)))s=2;else if(r<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(r))||(a=String.fromCharCode(r));else if(r>55295&&r<57344){const l=t.charCodeAt(n+1);r<56320&&l>56319&&l<57344?(a=String.fromCharCode(r,l),s=1):a=""}else a=String.fromCharCode(r);a&&(e.push(t.slice(i,n),encodeURIComponent(a)),i=n+s+1,a=""),s&&(n+=s,s=0)}return e.join("")+t.slice(i)}function Re(t,e,n,i){const s=i?i-1:Number.POSITIVE_INFINITY;let r=0;return a;function a(o){return ke(o)?(t.enter(n),l(o)):e(o)}function l(o){return ke(o)&&r++<s?(t.consume(o),l):(t.exit(n),e(o))}}const fO={tokenize:hO};function hO(t){const e=t.attempt(this.parser.constructs.contentInitial,i,s);let n;return e;function i(l){if(l===null){t.consume(l);return}return t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),Re(t,e,"linePrefix")}function s(l){return t.enter("paragraph"),r(l)}function r(l){const o=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=o),n=o,a(l)}function a(l){if(l===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(l);return}return oe(l)?(t.consume(l),t.exit("chunkText"),r):(t.consume(l),a)}}const mO={tokenize:gO},Gy={tokenize:pO};function gO(t){const e=this,n=[];let i=0,s,r,a;return l;function l(b){if(i<n.length){const E=n[i];return e.containerState=E[1],t.attempt(E[0].continuation,o,u)(b)}return u(b)}function o(b){if(i++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&v();const E=e.events.length;let k=E,_;for(;k--;)if(e.events[k][0]==="exit"&&e.events[k][1].type==="chunkFlow"){_=e.events[k][1].end;break}p(i);let L=E;for(;L<e.events.length;)e.events[L][1].end={..._},L++;return Tn(e.events,k+1,0,e.events.slice(E)),e.events.length=L,u(b)}return l(b)}function u(b){if(i===n.length){if(!s)return f(b);if(s.currentConstruct&&s.currentConstruct.concrete)return m(b);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(Gy,c,d)(b)}function c(b){return s&&v(),p(i),f(b)}function d(b){return e.parser.lazy[e.now().line]=i!==n.length,a=e.now().offset,m(b)}function f(b){return e.containerState={},t.attempt(Gy,h,m)(b)}function h(b){return i++,n.push([e.currentConstruct,e.containerState]),f(b)}function m(b){if(b===null){s&&v(),p(0),t.consume(b);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:r}),y(b)}function y(b){if(b===null){x(t.exit("chunkFlow"),!0),p(0),t.consume(b);return}return oe(b)?(t.consume(b),x(t.exit("chunkFlow")),i=0,e.interrupt=void 0,l):(t.consume(b),y)}function x(b,E){const k=e.sliceStream(b);if(E&&k.push(null),b.previous=r,r&&(r.next=b),r=b,s.defineSkip(b.start),s.write(k),e.parser.lazy[b.start.line]){let _=s.events.length;for(;_--;)if(s.events[_][1].start.offset<a&&(!s.events[_][1].end||s.events[_][1].end.offset>a))return;const L=e.events.length;let C=L,w,A;for(;C--;)if(e.events[C][0]==="exit"&&e.events[C][1].type==="chunkFlow"){if(w){A=e.events[C][1].end;break}w=!0}for(p(i),_=L;_<e.events.length;)e.events[_][1].end={...A},_++;Tn(e.events,C+1,0,e.events.slice(L)),e.events.length=_}}function p(b){let E=n.length;for(;E-- >b;){const k=n[E];e.containerState=k[1],k[0].exit.call(e,t)}n.length=b}function v(){s.write([null]),r=void 0,s=void 0,e.containerState._closeFlow=void 0}}function pO(t,e,n){return Re(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function na(t){if(t===null||Ve(t)||Qs(t))return 1;if(xc(t))return 2}function vc(t,e,n){const i=[];let s=-1;for(;++s<t.length;){const r=t[s].resolveAll;r&&!i.includes(r)&&(e=r(e,n),i.push(r))}return e}const Ah={name:"attention",resolveAll:yO,tokenize:xO};function yO(t,e){let n=-1,i,s,r,a,l,o,u,c;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&e.sliceSerialize(t[i][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;o=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[i][1].end},f={...t[n][1].start};Hy(d,-o),Hy(f,o),a={type:o>1?"strongSequence":"emphasisSequence",start:d,end:{...t[i][1].end}},l={type:o>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:f},r={type:o>1?"strongText":"emphasisText",start:{...t[i][1].end},end:{...t[n][1].start}},s={type:o>1?"strong":"emphasis",start:{...a.start},end:{...l.end}},t[i][1].end={...a.start},t[n][1].start={...l.end},u=[],t[i][1].end.offset-t[i][1].start.offset&&(u=In(u,[["enter",t[i][1],e],["exit",t[i][1],e]])),u=In(u,[["enter",s,e],["enter",a,e],["exit",a,e],["enter",r,e]]),u=In(u,vc(e.parser.constructs.insideSpan.null,t.slice(i+1,n),e)),u=In(u,[["exit",r,e],["enter",l,e],["exit",l,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(c=2,u=In(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):c=0,Tn(t,i-1,n-i+3,u),n=i+u.length-c-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function xO(t,e){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,s=na(i);let r;return a;function a(o){return r=o,t.enter("attentionSequence"),l(o)}function l(o){if(o===r)return t.consume(o),l;const u=t.exit("attentionSequence"),c=na(o),d=!c||c===2&&s||n.includes(o),f=!s||s===2&&c||n.includes(i);return u._open=!!(r===42?d:d&&(s||!f)),u._close=!!(r===42?f:f&&(c||!d)),e(o)}}function Hy(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const vO={name:"autolink",tokenize:bO};function bO(t,e,n){let i=0;return s;function s(h){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),r}function r(h){return jt(h)?(t.consume(h),a):h===64?n(h):u(h)}function a(h){return h===43||h===45||h===46||Ft(h)?(i=1,l(h)):u(h)}function l(h){return h===58?(t.consume(h),i=0,o):(h===43||h===45||h===46||Ft(h))&&i++<32?(t.consume(h),l):(i=0,u(h))}function o(h){return h===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.exit("autolink"),e):h===null||h===32||h===60||Gu(h)?n(h):(t.consume(h),o)}function u(h){return h===64?(t.consume(h),c):uO(h)?(t.consume(h),u):n(h)}function c(h){return Ft(h)?d(h):n(h)}function d(h){return h===46?(t.consume(h),i=0,c):h===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(h),t.exit("autolinkMarker"),t.exit("autolink"),e):f(h)}function f(h){if((h===45||Ft(h))&&i++<63){const m=h===45?f:d;return t.consume(h),m}return n(h)}}const $l={partial:!0,tokenize:SO};function SO(t,e,n){return i;function i(r){return ke(r)?Re(t,s,"linePrefix")(r):s(r)}function s(r){return r===null||oe(r)?e(r):n(r)}}const PE={continuation:{tokenize:TO},exit:AO,name:"blockQuote",tokenize:EO};function EO(t,e,n){const i=this;return s;function s(a){if(a===62){const l=i.containerState;return l.open||(t.enter("blockQuote",{_container:!0}),l.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(a),t.exit("blockQuoteMarker"),r}return n(a)}function r(a){return ke(a)?(t.enter("blockQuotePrefixWhitespace"),t.consume(a),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(a))}}function TO(t,e,n){const i=this;return s;function s(a){return ke(a)?Re(t,r,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):r(a)}function r(a){return t.attempt(PE,e,n)(a)}}function AO(t){t.exit("blockQuote")}const FE={name:"characterEscape",tokenize:kO};function kO(t,e,n){return i;function i(r){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(r),t.exit("escapeMarker"),s}function s(r){return dO(r)?(t.enter("characterEscapeValue"),t.consume(r),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(r)}}const BE={name:"characterReference",tokenize:_O};function _O(t,e,n){const i=this;let s=0,r,a;return l;function l(d){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),o}function o(d){return d===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(d),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),r=31,a=Ft,c(d))}function u(d){return d===88||d===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(d),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),r=6,a=cO,c):(t.enter("characterReferenceValue"),r=7,a=Th,c(d))}function c(d){if(d===59&&s){const f=t.exit("characterReferenceValue");return a===Ft&&!m0(i.sliceSerialize(f))?n(d):(t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return a(d)&&s++<r?(t.consume(d),c):n(d)}}const Vy={partial:!0,tokenize:RO},Ky={concrete:!0,name:"codeFenced",tokenize:LO};function LO(t,e,n){const i=this,s={partial:!0,tokenize:k};let r=0,a=0,l;return o;function o(_){return u(_)}function u(_){const L=i.events[i.events.length-1];return r=L&&L[1].type==="linePrefix"?L[2].sliceSerialize(L[1],!0).length:0,l=_,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),c(_)}function c(_){return _===l?(a++,t.consume(_),c):a<3?n(_):(t.exit("codeFencedFenceSequence"),ke(_)?Re(t,d,"whitespace")(_):d(_))}function d(_){return _===null||oe(_)?(t.exit("codeFencedFence"),i.interrupt?e(_):t.check(Vy,y,E)(_)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),f(_))}function f(_){return _===null||oe(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),d(_)):ke(_)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Re(t,h,"whitespace")(_)):_===96&&_===l?n(_):(t.consume(_),f)}function h(_){return _===null||oe(_)?d(_):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(_))}function m(_){return _===null||oe(_)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),d(_)):_===96&&_===l?n(_):(t.consume(_),m)}function y(_){return t.attempt(s,E,x)(_)}function x(_){return t.enter("lineEnding"),t.consume(_),t.exit("lineEnding"),p}function p(_){return r>0&&ke(_)?Re(t,v,"linePrefix",r+1)(_):v(_)}function v(_){return _===null||oe(_)?t.check(Vy,y,E)(_):(t.enter("codeFlowValue"),b(_))}function b(_){return _===null||oe(_)?(t.exit("codeFlowValue"),v(_)):(t.consume(_),b)}function E(_){return t.exit("codeFenced"),e(_)}function k(_,L,C){let w=0;return A;function A($){return _.enter("lineEnding"),_.consume($),_.exit("lineEnding"),I}function I($){return _.enter("codeFencedFence"),ke($)?Re(_,N,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)($):N($)}function N($){return $===l?(_.enter("codeFencedFenceSequence"),V($)):C($)}function V($){return $===l?(w++,_.consume($),V):w>=a?(_.exit("codeFencedFenceSequence"),ke($)?Re(_,G,"whitespace")($):G($)):C($)}function G($){return $===null||oe($)?(_.exit("codeFencedFence"),L($)):C($)}}}function RO(t,e,n){const i=this;return s;function s(a){return a===null?n(a):(t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),r)}function r(a){return i.parser.lazy[i.now().line]?n(a):e(a)}}const Bd={name:"codeIndented",tokenize:CO},wO={partial:!0,tokenize:IO};function CO(t,e,n){const i=this;return s;function s(u){return t.enter("codeIndented"),Re(t,r,"linePrefix",5)(u)}function r(u){const c=i.events[i.events.length-1];return c&&c[1].type==="linePrefix"&&c[2].sliceSerialize(c[1],!0).length>=4?a(u):n(u)}function a(u){return u===null?o(u):oe(u)?t.attempt(wO,a,o)(u):(t.enter("codeFlowValue"),l(u))}function l(u){return u===null||oe(u)?(t.exit("codeFlowValue"),a(u)):(t.consume(u),l)}function o(u){return t.exit("codeIndented"),e(u)}}function IO(t,e,n){const i=this;return s;function s(a){return i.parser.lazy[i.now().line]?n(a):oe(a)?(t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),s):Re(t,r,"linePrefix",5)(a)}function r(a){const l=i.events[i.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?e(a):oe(a)?s(a):n(a)}}const DO={name:"codeText",previous:MO,resolve:NO,tokenize:OO};function NO(t){let e=t.length-4,n=3,i,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(i=n;++i<e;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(i=n-1,e++;++i<=e;)s===void 0?i!==e&&t[i][1].type!=="lineEnding"&&(s=i):(i===e||t[i][1].type==="lineEnding")&&(t[s][1].type="codeTextData",i!==s+2&&(t[s][1].end=t[i-1][1].end,t.splice(s+2,i-s-2),e-=i-s-2,i=s+2),s=void 0);return t}function MO(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function OO(t,e,n){let i=0,s,r;return a;function a(d){return t.enter("codeText"),t.enter("codeTextSequence"),l(d)}function l(d){return d===96?(t.consume(d),i++,l):(t.exit("codeTextSequence"),o(d))}function o(d){return d===null?n(d):d===32?(t.enter("space"),t.consume(d),t.exit("space"),o):d===96?(r=t.enter("codeTextSequence"),s=0,c(d)):oe(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),o):(t.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||oe(d)?(t.exit("codeTextData"),o(d)):(t.consume(d),u)}function c(d){return d===96?(t.consume(d),s++,c):s===i?(t.exit("codeTextSequence"),t.exit("codeText"),e(d)):(r.type="codeTextData",u(d))}}class PO{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(e,i):e>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(e,n,i){const s=n||0;this.setCursor(Math.trunc(e));const r=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return i&&La(this.left,i),r.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),La(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),La(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);La(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);La(this.left,n.reverse())}}}function La(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function UE(t){const e={};let n=-1,i,s,r,a,l,o,u;const c=new PO(t);for(;++n<c.length;){for(;n in e;)n=e[n];if(i=c.get(n),n&&i[1].type==="chunkFlow"&&c.get(n-1)[1].type==="listItemPrefix"&&(o=i[1]._tokenizer.events,r=0,r<o.length&&o[r][1].type==="lineEndingBlank"&&(r+=2),r<o.length&&o[r][1].type==="content"))for(;++r<o.length&&o[r][1].type!=="content";)o[r][1].type==="chunkText"&&(o[r][1]._isInFirstContentOfListItem=!0,r++);if(i[0]==="enter")i[1].contentType&&(Object.assign(e,FO(c,n)),n=e[n],u=!0);else if(i[1]._container){for(r=n,s=void 0;r--;)if(a=c.get(r),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(s&&(c.get(s)[1].type="lineEndingBlank"),a[1].type="lineEnding",s=r);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;s&&(i[1].end={...c.get(s)[1].start},l=c.slice(s,n),l.unshift(i),c.splice(s,n-s+1,l))}}return Tn(t,0,Number.POSITIVE_INFINITY,c.slice(0)),!u}function FO(t,e){const n=t.get(e)[1],i=t.get(e)[2];let s=e-1;const r=[];let a=n._tokenizer;a||(a=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const l=a.events,o=[],u={};let c,d,f=-1,h=n,m=0,y=0;const x=[y];for(;h;){for(;t.get(++s)[1]!==h;);r.push(s),h._tokenizer||(c=i.sliceStream(h),h.next||c.push(null),d&&a.defineSkip(h.start),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(c),h._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=h,h=h.next}for(h=n;++f<l.length;)l[f][0]==="exit"&&l[f-1][0]==="enter"&&l[f][1].type===l[f-1][1].type&&l[f][1].start.line!==l[f][1].end.line&&(y=f+1,x.push(y),h._tokenizer=void 0,h.previous=void 0,h=h.next);for(a.events=[],h?(h._tokenizer=void 0,h.previous=void 0):x.pop(),f=x.length;f--;){const p=l.slice(x[f],x[f+1]),v=r.pop();o.push([v,v+p.length-1]),t.splice(v,2,p)}for(o.reverse(),f=-1;++f<o.length;)u[m+o[f][0]]=m+o[f][1],m+=o[f][1]-o[f][0]-1;return u}const BO={resolve:jO,tokenize:$O},UO={partial:!0,tokenize:zO};function jO(t){return UE(t),t}function $O(t,e){let n;return i;function i(l){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(l)}function s(l){return l===null?r(l):oe(l)?t.check(UO,a,r)(l):(t.consume(l),s)}function r(l){return t.exit("chunkContent"),t.exit("content"),e(l)}function a(l){return t.consume(l),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function zO(t,e,n){const i=this;return s;function s(a){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Re(t,r,"linePrefix")}function r(a){if(a===null||oe(a))return n(a);const l=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?e(a):t.interrupt(i.parser.constructs.flow,n,e)(a)}}function jE(t,e,n,i,s,r,a,l,o){const u=o||Number.POSITIVE_INFINITY;let c=0;return d;function d(p){return p===60?(t.enter(i),t.enter(s),t.enter(r),t.consume(p),t.exit(r),f):p===null||p===32||p===41||Gu(p)?n(p):(t.enter(i),t.enter(a),t.enter(l),t.enter("chunkString",{contentType:"string"}),y(p))}function f(p){return p===62?(t.enter(r),t.consume(p),t.exit(r),t.exit(s),t.exit(i),e):(t.enter(l),t.enter("chunkString",{contentType:"string"}),h(p))}function h(p){return p===62?(t.exit("chunkString"),t.exit(l),f(p)):p===null||p===60||oe(p)?n(p):(t.consume(p),p===92?m:h)}function m(p){return p===60||p===62||p===92?(t.consume(p),h):h(p)}function y(p){return!c&&(p===null||p===41||Ve(p))?(t.exit("chunkString"),t.exit(l),t.exit(a),t.exit(i),e(p)):c<u&&p===40?(t.consume(p),c++,y):p===41?(t.consume(p),c--,y):p===null||p===32||p===40||Gu(p)?n(p):(t.consume(p),p===92?x:y)}function x(p){return p===40||p===41||p===92?(t.consume(p),y):y(p)}}function $E(t,e,n,i,s,r){const a=this;let l=0,o;return u;function u(h){return t.enter(i),t.enter(s),t.consume(h),t.exit(s),t.enter(r),c}function c(h){return l>999||h===null||h===91||h===93&&!o||h===94&&!l&&"_hiddenFootnoteSupport"in a.parser.constructs?n(h):h===93?(t.exit(r),t.enter(s),t.consume(h),t.exit(s),t.exit(i),e):oe(h)?(t.enter("lineEnding"),t.consume(h),t.exit("lineEnding"),c):(t.enter("chunkString",{contentType:"string"}),d(h))}function d(h){return h===null||h===91||h===93||oe(h)||l++>999?(t.exit("chunkString"),c(h)):(t.consume(h),o||(o=!ke(h)),h===92?f:d)}function f(h){return h===91||h===92||h===93?(t.consume(h),l++,d):d(h)}}function zE(t,e,n,i,s,r){let a;return l;function l(f){return f===34||f===39||f===40?(t.enter(i),t.enter(s),t.consume(f),t.exit(s),a=f===40?41:f,o):n(f)}function o(f){return f===a?(t.enter(s),t.consume(f),t.exit(s),t.exit(i),e):(t.enter(r),u(f))}function u(f){return f===a?(t.exit(r),o(a)):f===null?n(f):oe(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),Re(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===a||f===null||oe(f)?(t.exit("chunkString"),u(f)):(t.consume(f),f===92?d:c)}function d(f){return f===a||f===92?(t.consume(f),c):c(f)}}function Ja(t,e){let n;return i;function i(s){return oe(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,i):ke(s)?Re(t,i,n?"linePrefix":"lineSuffix")(s):e(s)}}const GO={name:"definition",tokenize:VO},HO={partial:!0,tokenize:KO};function VO(t,e,n){const i=this;let s;return r;function r(h){return t.enter("definition"),a(h)}function a(h){return $E.call(i,t,l,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(h)}function l(h){return s=Yn(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),h===58?(t.enter("definitionMarker"),t.consume(h),t.exit("definitionMarker"),o):n(h)}function o(h){return Ve(h)?Ja(t,u)(h):u(h)}function u(h){return jE(t,c,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(h)}function c(h){return t.attempt(HO,d,d)(h)}function d(h){return ke(h)?Re(t,f,"whitespace")(h):f(h)}function f(h){return h===null||oe(h)?(t.exit("definition"),i.parser.defined.push(s),e(h)):n(h)}}function KO(t,e,n){return i;function i(l){return Ve(l)?Ja(t,s)(l):n(l)}function s(l){return zE(t,r,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(l)}function r(l){return ke(l)?Re(t,a,"whitespace")(l):a(l)}function a(l){return l===null||oe(l)?e(l):n(l)}}const YO={name:"hardBreakEscape",tokenize:qO};function qO(t,e,n){return i;function i(r){return t.enter("hardBreakEscape"),t.consume(r),s}function s(r){return oe(r)?(t.exit("hardBreakEscape"),e(r)):n(r)}}const XO={name:"headingAtx",resolve:QO,tokenize:WO};function QO(t,e){let n=t.length-2,i=3,s,r;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(s={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},r={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Tn(t,i,n-i+1,[["enter",s,e],["enter",r,e],["exit",r,e],["exit",s,e]])),t}function WO(t,e,n){let i=0;return s;function s(c){return t.enter("atxHeading"),r(c)}function r(c){return t.enter("atxHeadingSequence"),a(c)}function a(c){return c===35&&i++<6?(t.consume(c),a):c===null||Ve(c)?(t.exit("atxHeadingSequence"),l(c)):n(c)}function l(c){return c===35?(t.enter("atxHeadingSequence"),o(c)):c===null||oe(c)?(t.exit("atxHeading"),e(c)):ke(c)?Re(t,l,"whitespace")(c):(t.enter("atxHeadingText"),u(c))}function o(c){return c===35?(t.consume(c),o):(t.exit("atxHeadingSequence"),l(c))}function u(c){return c===null||c===35||Ve(c)?(t.exit("atxHeadingText"),l(c)):(t.consume(c),u)}}const ZO=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Yy=["pre","script","style","textarea"],JO={concrete:!0,name:"htmlFlow",resolveTo:nP,tokenize:iP},eP={partial:!0,tokenize:rP},tP={partial:!0,tokenize:sP};function nP(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function iP(t,e,n){const i=this;let s,r,a,l,o;return u;function u(T){return c(T)}function c(T){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(T),d}function d(T){return T===33?(t.consume(T),f):T===47?(t.consume(T),r=!0,y):T===63?(t.consume(T),s=3,i.interrupt?e:R):jt(T)?(t.consume(T),a=String.fromCharCode(T),x):n(T)}function f(T){return T===45?(t.consume(T),s=2,h):T===91?(t.consume(T),s=5,l=0,m):jt(T)?(t.consume(T),s=4,i.interrupt?e:R):n(T)}function h(T){return T===45?(t.consume(T),i.interrupt?e:R):n(T)}function m(T){const Y="CDATA[";return T===Y.charCodeAt(l++)?(t.consume(T),l===Y.length?i.interrupt?e:N:m):n(T)}function y(T){return jt(T)?(t.consume(T),a=String.fromCharCode(T),x):n(T)}function x(T){if(T===null||T===47||T===62||Ve(T)){const Y=T===47,X=a.toLowerCase();return!Y&&!r&&Yy.includes(X)?(s=1,i.interrupt?e(T):N(T)):ZO.includes(a.toLowerCase())?(s=6,Y?(t.consume(T),p):i.interrupt?e(T):N(T)):(s=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(T):r?v(T):b(T))}return T===45||Ft(T)?(t.consume(T),a+=String.fromCharCode(T),x):n(T)}function p(T){return T===62?(t.consume(T),i.interrupt?e:N):n(T)}function v(T){return ke(T)?(t.consume(T),v):A(T)}function b(T){return T===47?(t.consume(T),A):T===58||T===95||jt(T)?(t.consume(T),E):ke(T)?(t.consume(T),b):A(T)}function E(T){return T===45||T===46||T===58||T===95||Ft(T)?(t.consume(T),E):k(T)}function k(T){return T===61?(t.consume(T),_):ke(T)?(t.consume(T),k):b(T)}function _(T){return T===null||T===60||T===61||T===62||T===96?n(T):T===34||T===39?(t.consume(T),o=T,L):ke(T)?(t.consume(T),_):C(T)}function L(T){return T===o?(t.consume(T),o=null,w):T===null||oe(T)?n(T):(t.consume(T),L)}function C(T){return T===null||T===34||T===39||T===47||T===60||T===61||T===62||T===96||Ve(T)?k(T):(t.consume(T),C)}function w(T){return T===47||T===62||ke(T)?b(T):n(T)}function A(T){return T===62?(t.consume(T),I):n(T)}function I(T){return T===null||oe(T)?N(T):ke(T)?(t.consume(T),I):n(T)}function N(T){return T===45&&s===2?(t.consume(T),D):T===60&&s===1?(t.consume(T),j):T===62&&s===4?(t.consume(T),F):T===63&&s===3?(t.consume(T),R):T===93&&s===5?(t.consume(T),q):oe(T)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(eP,B,V)(T)):T===null||oe(T)?(t.exit("htmlFlowData"),V(T)):(t.consume(T),N)}function V(T){return t.check(tP,G,B)(T)}function G(T){return t.enter("lineEnding"),t.consume(T),t.exit("lineEnding"),$}function $(T){return T===null||oe(T)?V(T):(t.enter("htmlFlowData"),N(T))}function D(T){return T===45?(t.consume(T),R):N(T)}function j(T){return T===47?(t.consume(T),a="",U):N(T)}function U(T){if(T===62){const Y=a.toLowerCase();return Yy.includes(Y)?(t.consume(T),F):N(T)}return jt(T)&&a.length<8?(t.consume(T),a+=String.fromCharCode(T),U):N(T)}function q(T){return T===93?(t.consume(T),R):N(T)}function R(T){return T===62?(t.consume(T),F):T===45&&s===2?(t.consume(T),R):N(T)}function F(T){return T===null||oe(T)?(t.exit("htmlFlowData"),B(T)):(t.consume(T),F)}function B(T){return t.exit("htmlFlow"),e(T)}}function sP(t,e,n){const i=this;return s;function s(a){return oe(a)?(t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),r):n(a)}function r(a){return i.parser.lazy[i.now().line]?n(a):e(a)}}function rP(t,e,n){return i;function i(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt($l,e,n)}}const aP={name:"htmlText",tokenize:lP};function lP(t,e,n){const i=this;let s,r,a;return l;function l(R){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(R),o}function o(R){return R===33?(t.consume(R),u):R===47?(t.consume(R),k):R===63?(t.consume(R),b):jt(R)?(t.consume(R),C):n(R)}function u(R){return R===45?(t.consume(R),c):R===91?(t.consume(R),r=0,m):jt(R)?(t.consume(R),v):n(R)}function c(R){return R===45?(t.consume(R),h):n(R)}function d(R){return R===null?n(R):R===45?(t.consume(R),f):oe(R)?(a=d,j(R)):(t.consume(R),d)}function f(R){return R===45?(t.consume(R),h):d(R)}function h(R){return R===62?D(R):R===45?f(R):d(R)}function m(R){const F="CDATA[";return R===F.charCodeAt(r++)?(t.consume(R),r===F.length?y:m):n(R)}function y(R){return R===null?n(R):R===93?(t.consume(R),x):oe(R)?(a=y,j(R)):(t.consume(R),y)}function x(R){return R===93?(t.consume(R),p):y(R)}function p(R){return R===62?D(R):R===93?(t.consume(R),p):y(R)}function v(R){return R===null||R===62?D(R):oe(R)?(a=v,j(R)):(t.consume(R),v)}function b(R){return R===null?n(R):R===63?(t.consume(R),E):oe(R)?(a=b,j(R)):(t.consume(R),b)}function E(R){return R===62?D(R):b(R)}function k(R){return jt(R)?(t.consume(R),_):n(R)}function _(R){return R===45||Ft(R)?(t.consume(R),_):L(R)}function L(R){return oe(R)?(a=L,j(R)):ke(R)?(t.consume(R),L):D(R)}function C(R){return R===45||Ft(R)?(t.consume(R),C):R===47||R===62||Ve(R)?w(R):n(R)}function w(R){return R===47?(t.consume(R),D):R===58||R===95||jt(R)?(t.consume(R),A):oe(R)?(a=w,j(R)):ke(R)?(t.consume(R),w):D(R)}function A(R){return R===45||R===46||R===58||R===95||Ft(R)?(t.consume(R),A):I(R)}function I(R){return R===61?(t.consume(R),N):oe(R)?(a=I,j(R)):ke(R)?(t.consume(R),I):w(R)}function N(R){return R===null||R===60||R===61||R===62||R===96?n(R):R===34||R===39?(t.consume(R),s=R,V):oe(R)?(a=N,j(R)):ke(R)?(t.consume(R),N):(t.consume(R),G)}function V(R){return R===s?(t.consume(R),s=void 0,$):R===null?n(R):oe(R)?(a=V,j(R)):(t.consume(R),V)}function G(R){return R===null||R===34||R===39||R===60||R===61||R===96?n(R):R===47||R===62||Ve(R)?w(R):(t.consume(R),G)}function $(R){return R===47||R===62||Ve(R)?w(R):n(R)}function D(R){return R===62?(t.consume(R),t.exit("htmlTextData"),t.exit("htmlText"),e):n(R)}function j(R){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(R),t.exit("lineEnding"),U}function U(R){return ke(R)?Re(t,q,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(R):q(R)}function q(R){return t.enter("htmlTextData"),a(R)}}const g0={name:"labelEnd",resolveAll:dP,resolveTo:fP,tokenize:hP},oP={tokenize:mP},uP={tokenize:gP},cP={tokenize:pP};function dP(t){let e=-1;const n=[];for(;++e<t.length;){const i=t[e][1];if(n.push(t[e]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const s=i.type==="labelImage"?4:2;i.type="data",e+=s}}return t.length!==n.length&&Tn(t,0,t.length,n),t}function fP(t,e){let n=t.length,i=0,s,r,a,l;for(;n--;)if(s=t[n][1],r){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(a){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(r=n,s.type!=="labelLink")){i=2;break}}else s.type==="labelEnd"&&(a=n);const o={type:t[r][1].type==="labelLink"?"link":"image",start:{...t[r][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[r][1].start},end:{...t[a][1].end}},c={type:"labelText",start:{...t[r+i+2][1].end},end:{...t[a-2][1].start}};return l=[["enter",o,e],["enter",u,e]],l=In(l,t.slice(r+1,r+i+3)),l=In(l,[["enter",c,e]]),l=In(l,vc(e.parser.constructs.insideSpan.null,t.slice(r+i+4,a-3),e)),l=In(l,[["exit",c,e],t[a-2],t[a-1],["exit",u,e]]),l=In(l,t.slice(a+1)),l=In(l,[["exit",o,e]]),Tn(t,r,t.length,l),t}function hP(t,e,n){const i=this;let s=i.events.length,r,a;for(;s--;)if((i.events[s][1].type==="labelImage"||i.events[s][1].type==="labelLink")&&!i.events[s][1]._balanced){r=i.events[s][1];break}return l;function l(f){return r?r._inactive?d(f):(a=i.parser.defined.includes(Yn(i.sliceSerialize({start:r.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(f),t.exit("labelMarker"),t.exit("labelEnd"),o):n(f)}function o(f){return f===40?t.attempt(oP,c,a?c:d)(f):f===91?t.attempt(uP,c,a?u:d)(f):a?c(f):d(f)}function u(f){return t.attempt(cP,c,d)(f)}function c(f){return e(f)}function d(f){return r._balanced=!0,n(f)}}function mP(t,e,n){return i;function i(d){return t.enter("resource"),t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),s}function s(d){return Ve(d)?Ja(t,r)(d):r(d)}function r(d){return d===41?c(d):jE(t,a,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function a(d){return Ve(d)?Ja(t,o)(d):c(d)}function l(d){return n(d)}function o(d){return d===34||d===39||d===40?zE(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):c(d)}function u(d){return Ve(d)?Ja(t,c)(d):c(d)}function c(d){return d===41?(t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),t.exit("resource"),e):n(d)}}function gP(t,e,n){const i=this;return s;function s(l){return $E.call(i,t,r,a,"reference","referenceMarker","referenceString")(l)}function r(l){return i.parser.defined.includes(Yn(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?e(l):n(l)}function a(l){return n(l)}}function pP(t,e,n){return i;function i(r){return t.enter("reference"),t.enter("referenceMarker"),t.consume(r),t.exit("referenceMarker"),s}function s(r){return r===93?(t.enter("referenceMarker"),t.consume(r),t.exit("referenceMarker"),t.exit("reference"),e):n(r)}}const yP={name:"labelStartImage",resolveAll:g0.resolveAll,tokenize:xP};function xP(t,e,n){const i=this;return s;function s(l){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(l),t.exit("labelImageMarker"),r}function r(l){return l===91?(t.enter("labelMarker"),t.consume(l),t.exit("labelMarker"),t.exit("labelImage"),a):n(l)}function a(l){return l===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(l):e(l)}}const vP={name:"labelStartLink",resolveAll:g0.resolveAll,tokenize:bP};function bP(t,e,n){const i=this;return s;function s(a){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelLink"),r}function r(a){return a===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(a):e(a)}}const Ud={name:"lineEnding",tokenize:SP};function SP(t,e){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),Re(t,e,"linePrefix")}}const Zo={name:"thematicBreak",tokenize:EP};function EP(t,e,n){let i=0,s;return r;function r(u){return t.enter("thematicBreak"),a(u)}function a(u){return s=u,l(u)}function l(u){return u===s?(t.enter("thematicBreakSequence"),o(u)):i>=3&&(u===null||oe(u))?(t.exit("thematicBreak"),e(u)):n(u)}function o(u){return u===s?(t.consume(u),i++,o):(t.exit("thematicBreakSequence"),ke(u)?Re(t,l,"whitespace")(u):l(u))}}const qt={continuation:{tokenize:_P},exit:RP,name:"list",tokenize:kP},TP={partial:!0,tokenize:wP},AP={partial:!0,tokenize:LP};function kP(t,e,n){const i=this,s=i.events[i.events.length-1];let r=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,a=0;return l;function l(h){const m=i.containerState.type||(h===42||h===43||h===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!i.containerState.marker||h===i.containerState.marker:Th(h)){if(i.containerState.type||(i.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),h===42||h===45?t.check(Zo,n,u)(h):u(h);if(!i.interrupt||h===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),o(h)}return n(h)}function o(h){return Th(h)&&++a<10?(t.consume(h),o):(!i.interrupt||a<2)&&(i.containerState.marker?h===i.containerState.marker:h===41||h===46)?(t.exit("listItemValue"),u(h)):n(h)}function u(h){return t.enter("listItemMarker"),t.consume(h),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||h,t.check($l,i.interrupt?n:c,t.attempt(TP,f,d))}function c(h){return i.containerState.initialBlankLine=!0,r++,f(h)}function d(h){return ke(h)?(t.enter("listItemPrefixWhitespace"),t.consume(h),t.exit("listItemPrefixWhitespace"),f):n(h)}function f(h){return i.containerState.size=r+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(h)}}function _P(t,e,n){const i=this;return i.containerState._closeFlow=void 0,t.check($l,s,r);function s(l){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Re(t,e,"listItemIndent",i.containerState.size+1)(l)}function r(l){return i.containerState.furtherBlankLines||!ke(l)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,a(l)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(AP,e,a)(l))}function a(l){return i.containerState._closeFlow=!0,i.interrupt=void 0,Re(t,t.attempt(qt,e,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l)}}function LP(t,e,n){const i=this;return Re(t,s,"listItemIndent",i.containerState.size+1);function s(r){const a=i.events[i.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===i.containerState.size?e(r):n(r)}}function RP(t){t.exit(this.containerState.type)}function wP(t,e,n){const i=this;return Re(t,s,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(r){const a=i.events[i.events.length-1];return!ke(r)&&a&&a[1].type==="listItemPrefixWhitespace"?e(r):n(r)}}const qy={name:"setextUnderline",resolveTo:CP,tokenize:IP};function CP(t,e){let n=t.length,i,s,r;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!r&&t[n][1].type==="definition"&&(r=n);const a={type:"setextHeading",start:{...t[i][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",r?(t.splice(s,0,["enter",a,e]),t.splice(r+1,0,["exit",t[i][1],e]),t[i][1].end={...t[r][1].end}):t[i][1]=a,t.push(["exit",a,e]),t}function IP(t,e,n){const i=this;let s;return r;function r(u){let c=i.events.length,d;for(;c--;)if(i.events[c][1].type!=="lineEnding"&&i.events[c][1].type!=="linePrefix"&&i.events[c][1].type!=="content"){d=i.events[c][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||d)?(t.enter("setextHeadingLine"),s=u,a(u)):n(u)}function a(u){return t.enter("setextHeadingLineSequence"),l(u)}function l(u){return u===s?(t.consume(u),l):(t.exit("setextHeadingLineSequence"),ke(u)?Re(t,o,"lineSuffix")(u):o(u))}function o(u){return u===null||oe(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const DP={tokenize:NP};function NP(t){const e=this,n=t.attempt($l,i,t.attempt(this.parser.constructs.flowInitial,s,Re(t,t.attempt(this.parser.constructs.flow,s,t.attempt(BO,s)),"linePrefix")));return n;function i(r){if(r===null){t.consume(r);return}return t.enter("lineEndingBlank"),t.consume(r),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(r){if(r===null){t.consume(r);return}return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const MP={resolveAll:HE()},OP=GE("string"),PP=GE("text");function GE(t){return{resolveAll:HE(t==="text"?FP:void 0),tokenize:e};function e(n){const i=this,s=this.parser.constructs[t],r=n.attempt(s,a,l);return a;function a(c){return u(c)?r(c):l(c)}function l(c){if(c===null){n.consume(c);return}return n.enter("data"),n.consume(c),o}function o(c){return u(c)?(n.exit("data"),r(c)):(n.consume(c),o)}function u(c){if(c===null)return!0;const d=s[c];let f=-1;if(d)for(;++f<d.length;){const h=d[f];if(!h.previous||h.previous.call(i,i.previous))return!0}return!1}}}function HE(t){return e;function e(n,i){let s=-1,r;for(;++s<=n.length;)r===void 0?n[s]&&n[s][1].type==="data"&&(r=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==r+2&&(n[r][1].end=n[s-1][1].end,n.splice(r+2,s-r-2),s=r+2),r=void 0);return t?t(n,i):n}}function FP(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],s=e.sliceStream(i);let r=s.length,a=-1,l=0,o;for(;r--;){const u=s[r];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)l++,a--;if(a)break;a=-1}else if(u===-2)o=!0,l++;else if(u!==-1){r++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(l=0),l){const u={type:n===t.length||o||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:r?a:i.start._bufferIndex+a,_index:i.start._index+r,line:i.end.line,column:i.end.column-l,offset:i.end.offset-l},end:{...i.end}};i.end={...u.start},i.start.offset===i.end.offset?Object.assign(i,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const BP={42:qt,43:qt,45:qt,48:qt,49:qt,50:qt,51:qt,52:qt,53:qt,54:qt,55:qt,56:qt,57:qt,62:PE},UP={91:GO},jP={[-2]:Bd,[-1]:Bd,32:Bd},$P={35:XO,42:Zo,45:[qy,Zo],60:JO,61:qy,95:Zo,96:Ky,126:Ky},zP={38:BE,92:FE},GP={[-5]:Ud,[-4]:Ud,[-3]:Ud,33:yP,38:BE,42:Ah,60:[vO,aP],91:vP,92:[YO,FE],93:g0,95:Ah,96:DO},HP={null:[Ah,MP]},VP={null:[42,95]},KP={null:[]},YP=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:VP,contentInitial:UP,disable:KP,document:BP,flow:$P,flowInitial:jP,insideSpan:HP,string:zP,text:GP},Symbol.toStringTag,{value:"Module"}));function qP(t,e,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},r=[];let a=[],l=[];const o={attempt:L(k),check:L(_),consume:v,enter:b,exit:E,interrupt:L(_,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:m,parser:t,previous:null,sliceSerialize:f,sliceStream:h,write:d};let c=e.tokenize.call(u,o);return e.resolveAll&&r.push(e),u;function d(I){return a=In(a,I),x(),a[a.length-1]!==null?[]:(C(e,0),u.events=vc(r,u.events,u),u.events)}function f(I,N){return QP(h(I),N)}function h(I){return XP(a,I)}function m(){const{_bufferIndex:I,_index:N,line:V,column:G,offset:$}=i;return{_bufferIndex:I,_index:N,line:V,column:G,offset:$}}function y(I){s[I.line]=I.column,A()}function x(){let I;for(;i._index<a.length;){const N=a[i._index];if(typeof N=="string")for(I=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===I&&i._bufferIndex<N.length;)p(N.charCodeAt(i._bufferIndex));else p(N)}}function p(I){c=c(I)}function v(I){oe(I)?(i.line++,i.column=1,i.offset+=I===-3?2:1,A()):I!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===a[i._index].length&&(i._bufferIndex=-1,i._index++)),u.previous=I}function b(I,N){const V=N||{};return V.type=I,V.start=m(),u.events.push(["enter",V,u]),l.push(V),V}function E(I){const N=l.pop();return N.end=m(),u.events.push(["exit",N,u]),N}function k(I,N){C(I,N.from)}function _(I,N){N.restore()}function L(I,N){return V;function V(G,$,D){let j,U,q,R;return Array.isArray(G)?B(G):"tokenize"in G?B([G]):F(G);function F(Z){return le;function le(se){const fe=se!==null&&Z[se],te=se!==null&&Z.null,ge=[...Array.isArray(fe)?fe:fe?[fe]:[],...Array.isArray(te)?te:te?[te]:[]];return B(ge)(se)}}function B(Z){return j=Z,U=0,Z.length===0?D:T(Z[U])}function T(Z){return le;function le(se){return R=w(),q=Z,Z.partial||(u.currentConstruct=Z),Z.name&&u.parser.constructs.disable.null.includes(Z.name)?X():Z.tokenize.call(N?Object.assign(Object.create(u),N):u,o,Y,X)(se)}}function Y(Z){return I(q,R),$}function X(Z){return R.restore(),++U<j.length?T(j[U]):D}}}function C(I,N){I.resolveAll&&!r.includes(I)&&r.push(I),I.resolve&&Tn(u.events,N,u.events.length-N,I.resolve(u.events.slice(N),u)),I.resolveTo&&(u.events=I.resolveTo(u.events,u))}function w(){const I=m(),N=u.previous,V=u.currentConstruct,G=u.events.length,$=Array.from(l);return{from:G,restore:D};function D(){i=I,u.previous=N,u.currentConstruct=V,u.events.length=G,l=$,A()}}function A(){i.line in s&&i.column<2&&(i.column=s[i.line],i.offset+=s[i.line]-1)}}function XP(t,e){const n=e.start._index,i=e.start._bufferIndex,s=e.end._index,r=e.end._bufferIndex;let a;if(n===s)a=[t[n].slice(i,r)];else{if(a=t.slice(n,s),i>-1){const l=a[0];typeof l=="string"?a[0]=l.slice(i):a.shift()}r>0&&a.push(t[s].slice(0,r))}return a}function QP(t,e){let n=-1;const i=[];let s;for(;++n<t.length;){const r=t[n];let a;if(typeof r=="string")a=r;else switch(r){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=e?" ":"	";break}case-1:{if(!e&&s)continue;a=" ";break}default:a=String.fromCharCode(r)}s=r===-2,i.push(a)}return i.join("")}function WP(t){const i={constructs:ME([YP,...(t||{}).extensions||[]]),content:s(fO),defined:[],document:s(mO),flow:s(DP),lazy:{},string:s(OP),text:s(PP)};return i;function s(r){return a;function a(l){return qP(i,r,l)}}}function ZP(t){for(;!UE(t););return t}const Xy=/[\0\t\n\r]/g;function JP(){let t=1,e="",n=!0,i;return s;function s(r,a,l){const o=[];let u,c,d,f,h;for(r=e+(typeof r=="string"?r.toString():new TextDecoder(a||void 0).decode(r)),d=0,e="",n&&(r.charCodeAt(0)===65279&&d++,n=void 0);d<r.length;){if(Xy.lastIndex=d,u=Xy.exec(r),f=u&&u.index!==void 0?u.index:r.length,h=r.charCodeAt(f),!u){e=r.slice(d);break}if(h===10&&d===f&&i)o.push(-3),i=void 0;else switch(i&&(o.push(-5),i=void 0),d<f&&(o.push(r.slice(d,f)),t+=f-d),h){case 0:{o.push(65533),t++;break}case 9:{for(c=Math.ceil(t/4)*4,o.push(-2);t++<c;)o.push(-1);break}case 10:{o.push(-4),t=1;break}default:i=!0,t=1}d=f+1}return l&&(i&&o.push(-5),e&&o.push(e),o.push(null)),o}}const e3=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function t3(t){return t.replace(e3,n3)}function n3(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),r=s===120||s===88;return OE(n.slice(r?2:1),r?16:10)}return m0(n)||t}const VE={}.hasOwnProperty;function i3(t,e,n){return typeof e!="string"&&(n=e,e=void 0),s3(n)(ZP(WP(n).document().write(JP()(t,e,!0))))}function s3(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:r(Ot),autolinkProtocol:w,autolinkEmail:w,atxHeading:r(et),blockQuote:r(te),characterEscape:w,characterReference:w,codeFenced:r(ge),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:r(ge,a),codeText:r(Ce,a),codeTextData:w,data:w,codeFlowValue:w,definition:r(Fe),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:r(ft),hardBreakEscape:r(ae),hardBreakTrailing:r(ae),htmlFlow:r(be,a),htmlFlowData:w,htmlText:r(be,a),htmlTextData:w,image:r(lt),label:a,link:r(Ot),listItem:r(nn),listItemValue:f,listOrdered:r(ht,d),listUnordered:r(ht),paragraph:r(sn),reference:T,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:r(et),strong:r(Ht),thematicBreak:r(Xn)},exit:{atxHeading:o(),atxHeadingSequence:k,autolink:o(),autolinkEmail:fe,autolinkProtocol:se,blockQuote:o(),characterEscapeValue:A,characterReferenceMarkerHexadecimal:X,characterReferenceMarkerNumeric:X,characterReferenceValue:Z,characterReference:le,codeFenced:o(x),codeFencedFence:y,codeFencedFenceInfo:h,codeFencedFenceMeta:m,codeFlowValue:A,codeIndented:o(p),codeText:o($),codeTextData:A,data:A,definition:o(),definitionDestinationString:E,definitionLabelString:v,definitionTitleString:b,emphasis:o(),hardBreakEscape:o(N),hardBreakTrailing:o(N),htmlFlow:o(V),htmlFlowData:A,htmlText:o(G),htmlTextData:A,image:o(j),label:q,labelText:U,lineEnding:I,link:o(D),listItem:o(),listOrdered:o(),listUnordered:o(),paragraph:o(),referenceString:Y,resourceDestinationString:R,resourceTitleString:F,resource:B,setextHeading:o(C),setextHeadingLineSequence:L,setextHeadingText:_,strong:o(),thematicBreak:o()}};KE(e,(t||{}).mdastExtensions||[]);const n={};return i;function i(z){let Q={type:"root",children:[]};const ue={stack:[Q],tokenStack:[],config:e,enter:l,exit:u,buffer:a,resume:c,data:n},xe=[];let we=-1;for(;++we<z.length;)if(z[we][1].type==="listOrdered"||z[we][1].type==="listUnordered")if(z[we][0]==="enter")xe.push(we);else{const ot=xe.pop();we=s(z,ot,we)}for(we=-1;++we<z.length;){const ot=e[z[we][0]];VE.call(ot,z[we][1].type)&&ot[z[we][1].type].call(Object.assign({sliceSerialize:z[we][2].sliceSerialize},ue),z[we][1])}if(ue.tokenStack.length>0){const ot=ue.tokenStack[ue.tokenStack.length-1];(ot[1]||Qy).call(ue,void 0,ot[0])}for(Q.position={start:Gi(z.length>0?z[0][1].start:{line:1,column:1,offset:0}),end:Gi(z.length>0?z[z.length-2][1].end:{line:1,column:1,offset:0})},we=-1;++we<e.transforms.length;)Q=e.transforms[we](Q)||Q;return Q}function s(z,Q,ue){let xe=Q-1,we=-1,ot=!1,Qn,$n,Ts,_n;for(;++xe<=ue;){const Pt=z[xe];switch(Pt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Pt[0]==="enter"?we++:we--,_n=void 0;break}case"lineEndingBlank":{Pt[0]==="enter"&&(Qn&&!_n&&!we&&!Ts&&(Ts=xe),_n=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:_n=void 0}if(!we&&Pt[0]==="enter"&&Pt[1].type==="listItemPrefix"||we===-1&&Pt[0]==="exit"&&(Pt[1].type==="listUnordered"||Pt[1].type==="listOrdered")){if(Qn){let Bi=xe;for($n=void 0;Bi--;){const zn=z[Bi];if(zn[1].type==="lineEnding"||zn[1].type==="lineEndingBlank"){if(zn[0]==="exit")continue;$n&&(z[$n][1].type="lineEndingBlank",ot=!0),zn[1].type="lineEnding",$n=Bi}else if(!(zn[1].type==="linePrefix"||zn[1].type==="blockQuotePrefix"||zn[1].type==="blockQuotePrefixWhitespace"||zn[1].type==="blockQuoteMarker"||zn[1].type==="listItemIndent"))break}Ts&&(!$n||Ts<$n)&&(Qn._spread=!0),Qn.end=Object.assign({},$n?z[$n][1].start:Pt[1].end),z.splice($n||xe,0,["exit",Qn,Pt[2]]),xe++,ue++}if(Pt[1].type==="listItemPrefix"){const Bi={type:"listItem",_spread:!1,start:Object.assign({},Pt[1].start),end:void 0};Qn=Bi,z.splice(xe,0,["enter",Bi,Pt[2]]),xe++,ue++,Ts=void 0,_n=!0}}}return z[Q][1]._spread=ot,ue}function r(z,Q){return ue;function ue(xe){l.call(this,z(xe),xe),Q&&Q.call(this,xe)}}function a(){this.stack.push({type:"fragment",children:[]})}function l(z,Q,ue){this.stack[this.stack.length-1].children.push(z),this.stack.push(z),this.tokenStack.push([Q,ue||void 0]),z.position={start:Gi(Q.start),end:void 0}}function o(z){return Q;function Q(ue){z&&z.call(this,ue),u.call(this,ue)}}function u(z,Q){const ue=this.stack.pop(),xe=this.tokenStack.pop();if(xe)xe[0].type!==z.type&&(Q?Q.call(this,z,xe[0]):(xe[1]||Qy).call(this,z,xe[0]));else throw new Error("Cannot close `"+z.type+"` ("+Za({start:z.start,end:z.end})+"): its not open");ue.position.end=Gi(z.end)}function c(){return h0(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f(z){if(this.data.expectingFirstListItemValue){const Q=this.stack[this.stack.length-2];Q.start=Number.parseInt(this.sliceSerialize(z),10),this.data.expectingFirstListItemValue=void 0}}function h(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.lang=z}function m(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.meta=z}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function x(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.value=z.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function p(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.value=z.replace(/(\r?\n|\r)$/g,"")}function v(z){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.label=Q,ue.identifier=Yn(this.sliceSerialize(z)).toLowerCase()}function b(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.title=z}function E(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.url=z}function k(z){const Q=this.stack[this.stack.length-1];if(!Q.depth){const ue=this.sliceSerialize(z).length;Q.depth=ue}}function _(){this.data.setextHeadingSlurpLineEnding=!0}function L(z){const Q=this.stack[this.stack.length-1];Q.depth=this.sliceSerialize(z).codePointAt(0)===61?1:2}function C(){this.data.setextHeadingSlurpLineEnding=void 0}function w(z){const ue=this.stack[this.stack.length-1].children;let xe=ue[ue.length-1];(!xe||xe.type!=="text")&&(xe=jn(),xe.position={start:Gi(z.start),end:void 0},ue.push(xe)),this.stack.push(xe)}function A(z){const Q=this.stack.pop();Q.value+=this.sliceSerialize(z),Q.position.end=Gi(z.end)}function I(z){const Q=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ue=Q.children[Q.children.length-1];ue.position.end=Gi(z.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Q.type)&&(w.call(this,z),A.call(this,z))}function N(){this.data.atHardBreak=!0}function V(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.value=z}function G(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.value=z}function $(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.value=z}function D(){const z=this.stack[this.stack.length-1];if(this.data.inReference){const Q=this.data.referenceType||"shortcut";z.type+="Reference",z.referenceType=Q,delete z.url,delete z.title}else delete z.identifier,delete z.label;this.data.referenceType=void 0}function j(){const z=this.stack[this.stack.length-1];if(this.data.inReference){const Q=this.data.referenceType||"shortcut";z.type+="Reference",z.referenceType=Q,delete z.url,delete z.title}else delete z.identifier,delete z.label;this.data.referenceType=void 0}function U(z){const Q=this.sliceSerialize(z),ue=this.stack[this.stack.length-2];ue.label=t3(Q),ue.identifier=Yn(Q).toLowerCase()}function q(){const z=this.stack[this.stack.length-1],Q=this.resume(),ue=this.stack[this.stack.length-1];if(this.data.inReference=!0,ue.type==="link"){const xe=z.children;ue.children=xe}else ue.alt=Q}function R(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.url=z}function F(){const z=this.resume(),Q=this.stack[this.stack.length-1];Q.title=z}function B(){this.data.inReference=void 0}function T(){this.data.referenceType="collapsed"}function Y(z){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.label=Q,ue.identifier=Yn(this.sliceSerialize(z)).toLowerCase(),this.data.referenceType="full"}function X(z){this.data.characterReferenceType=z.type}function Z(z){const Q=this.sliceSerialize(z),ue=this.data.characterReferenceType;let xe;ue?(xe=OE(Q,ue==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):xe=m0(Q);const we=this.stack[this.stack.length-1];we.value+=xe}function le(z){const Q=this.stack.pop();Q.position.end=Gi(z.end)}function se(z){A.call(this,z);const Q=this.stack[this.stack.length-1];Q.url=this.sliceSerialize(z)}function fe(z){A.call(this,z);const Q=this.stack[this.stack.length-1];Q.url="mailto:"+this.sliceSerialize(z)}function te(){return{type:"blockquote",children:[]}}function ge(){return{type:"code",lang:null,meta:null,value:""}}function Ce(){return{type:"inlineCode",value:""}}function Fe(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function ft(){return{type:"emphasis",children:[]}}function et(){return{type:"heading",depth:0,children:[]}}function ae(){return{type:"break"}}function be(){return{type:"html",value:""}}function lt(){return{type:"image",title:null,url:"",alt:null}}function Ot(){return{type:"link",title:null,url:"",children:[]}}function ht(z){return{type:"list",ordered:z.type==="listOrdered",start:null,spread:z._spread,children:[]}}function nn(z){return{type:"listItem",spread:z._spread,checked:null,children:[]}}function sn(){return{type:"paragraph",children:[]}}function Ht(){return{type:"strong",children:[]}}function jn(){return{type:"text",value:""}}function Xn(){return{type:"thematicBreak"}}}function Gi(t){return{line:t.line,column:t.column,offset:t.offset}}function KE(t,e){let n=-1;for(;++n<e.length;){const i=e[n];Array.isArray(i)?KE(t,i):r3(t,i)}}function r3(t,e){let n;for(n in e)if(VE.call(e,n))switch(n){case"canContainEols":{const i=e[n];i&&t[n].push(...i);break}case"transforms":{const i=e[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=e[n];i&&Object.assign(t[n],i);break}}}function Qy(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+Za({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+Za({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Za({start:e.start,end:e.end})+") is still open")}function a3(t){const e=this;e.parser=n;function n(i){return i3(i,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function l3(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function o3(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function u3(t,e){const n=e.value?e.value+`
`:"",i={},s=e.lang?e.lang.split(/\s+/):[];s.length>0&&(i.className=["language-"+s[0]]);let r={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return e.meta&&(r.data={meta:e.meta}),t.patch(e,r),r=t.applyData(e,r),r={type:"element",tagName:"pre",properties:{},children:[r]},t.patch(e,r),r}function c3(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function d3(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function f3(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(e.identifier).toUpperCase(),s=fa(i.toLowerCase()),r=t.footnoteOrder.indexOf(i);let a,l=t.footnoteCounts.get(i);l===void 0?(l=0,t.footnoteOrder.push(i),a=t.footnoteOrder.length):a=r+1,l+=1,t.footnoteCounts.set(i,l);const o={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(l>1?"-"+l:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};t.patch(e,o);const u={type:"element",tagName:"sup",properties:{},children:[o]};return t.patch(e,u),t.applyData(e,u)}function h3(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function m3(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function YE(t,e){const n=e.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+i}];const s=t.all(e),r=s[0];r&&r.type==="text"?r.value="["+r.value:s.unshift({type:"text",value:"["});const a=s[s.length-1];return a&&a.type==="text"?a.value+=i:s.push({type:"text",value:i}),s}function g3(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return YE(t,e);const s={src:fa(i.url||""),alt:e.alt};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,r),t.applyData(e,r)}function p3(t,e){const n={src:fa(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,i),t.applyData(e,i)}function y3(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,i),t.applyData(e,i)}function x3(t,e){const n=String(e.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return YE(t,e);const s={href:fa(i.url||"")};i.title!==null&&i.title!==void 0&&(s.title=i.title);const r={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function v3(t,e){const n={href:fa(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const i={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function b3(t,e,n){const i=t.all(e),s=n?S3(n):qE(e),r={},a=[];if(typeof e.checked=="boolean"){const c=i[0];let d;c&&c.type==="element"&&c.tagName==="p"?d=c:(d={type:"element",tagName:"p",properties:{},children:[]},i.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),r.className=["task-list-item"]}let l=-1;for(;++l<i.length;){const c=i[l];(s||l!==0||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`}),c.type==="element"&&c.tagName==="p"&&!s?a.push(...c.children):a.push(c)}const o=i[i.length-1];o&&(s||o.type!=="element"||o.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:r,children:a};return t.patch(e,u),t.applyData(e,u)}function S3(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let i=-1;for(;!e&&++i<n.length;)e=qE(n[i])}return e}function qE(t){const e=t.spread;return e??t.children.length>1}function E3(t,e){const n={},i=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<i.length;){const a=i[s];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const r={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(e,r),t.applyData(e,r)}function T3(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function A3(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function k3(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function _3(t,e){const n=t.all(e),i=n.shift(),s=[];if(i){const a={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(e.children[0],a),s.push(a)}if(n.length>0){const a={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},l=u0(e.children[1]),o=LE(e.children[e.children.length-1]);l&&o&&(a.position={start:l,end:o}),s.push(a)}const r={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,r),t.applyData(e,r)}function L3(t,e,n){const i=n?n.children:void 0,r=(i?i.indexOf(e):1)===0?"th":"td",a=n&&n.type==="table"?n.align:void 0,l=a?a.length:e.children.length;let o=-1;const u=[];for(;++o<l;){const d=e.children[o],f={},h=a?a[o]:void 0;h&&(f.align=h);let m={type:"element",tagName:r,properties:f,children:[]};d&&(m.children=t.all(d),t.patch(d,m),m=t.applyData(d,m)),u.push(m)}const c={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,c),t.applyData(e,c)}function R3(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const Wy=9,Zy=32;function w3(t){const e=String(t),n=/\r?\n|\r/g;let i=n.exec(e),s=0;const r=[];for(;i;)r.push(Jy(e.slice(s,i.index),s>0,!0),i[0]),s=i.index+i[0].length,i=n.exec(e);return r.push(Jy(e.slice(s),s>0,!1)),r.join("")}function Jy(t,e,n){let i=0,s=t.length;if(e){let r=t.codePointAt(i);for(;r===Wy||r===Zy;)i++,r=t.codePointAt(i)}if(n){let r=t.codePointAt(s-1);for(;r===Wy||r===Zy;)s--,r=t.codePointAt(s-1)}return s>i?t.slice(i,s):""}function C3(t,e){const n={type:"text",value:w3(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function I3(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const D3={blockquote:l3,break:o3,code:u3,delete:c3,emphasis:d3,footnoteReference:f3,heading:h3,html:m3,imageReference:g3,image:p3,inlineCode:y3,linkReference:x3,link:v3,listItem:b3,list:E3,paragraph:T3,root:A3,strong:k3,table:_3,tableCell:R3,tableRow:L3,text:C3,thematicBreak:I3,toml:Eo,yaml:Eo,definition:Eo,footnoteDefinition:Eo};function Eo(){}const XE=-1,bc=0,el=1,Hu=2,p0=3,y0=4,x0=5,v0=6,QE=7,WE=8,ex=typeof self=="object"?self:globalThis,N3=(t,e)=>{const n=(s,r)=>(t.set(r,s),s),i=s=>{if(t.has(s))return t.get(s);const[r,a]=e[s];switch(r){case bc:case XE:return n(a,s);case el:{const l=n([],s);for(const o of a)l.push(i(o));return l}case Hu:{const l=n({},s);for(const[o,u]of a)l[i(o)]=i(u);return l}case p0:return n(new Date(a),s);case y0:{const{source:l,flags:o}=a;return n(new RegExp(l,o),s)}case x0:{const l=n(new Map,s);for(const[o,u]of a)l.set(i(o),i(u));return l}case v0:{const l=n(new Set,s);for(const o of a)l.add(i(o));return l}case QE:{const{name:l,message:o}=a;return n(new ex[l](o),s)}case WE:return n(BigInt(a),s);case"BigInt":return n(Object(BigInt(a)),s);case"ArrayBuffer":return n(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:l}=new Uint8Array(a);return n(new DataView(l),a)}}return n(new ex[r](a),s)};return i},tx=t=>N3(new Map,t)(0),fr="",{toString:M3}={},{keys:O3}=Object,Ra=t=>{const e=typeof t;if(e!=="object"||!t)return[bc,e];const n=M3.call(t).slice(8,-1);switch(n){case"Array":return[el,fr];case"Object":return[Hu,fr];case"Date":return[p0,fr];case"RegExp":return[y0,fr];case"Map":return[x0,fr];case"Set":return[v0,fr];case"DataView":return[el,n]}return n.includes("Array")?[el,n]:n.includes("Error")?[QE,n]:[Hu,n]},To=([t,e])=>t===bc&&(e==="function"||e==="symbol"),P3=(t,e,n,i)=>{const s=(a,l)=>{const o=i.push(a)-1;return n.set(l,o),o},r=a=>{if(n.has(a))return n.get(a);let[l,o]=Ra(a);switch(l){case bc:{let c=a;switch(o){case"bigint":l=WE,c=a.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+o);c=null;break;case"undefined":return s([XE],a)}return s([l,c],a)}case el:{if(o){let f=a;return o==="DataView"?f=new Uint8Array(a.buffer):o==="ArrayBuffer"&&(f=new Uint8Array(a)),s([o,[...f]],a)}const c=[],d=s([l,c],a);for(const f of a)c.push(r(f));return d}case Hu:{if(o)switch(o){case"BigInt":return s([o,a.toString()],a);case"Boolean":case"Number":case"String":return s([o,a.valueOf()],a)}if(e&&"toJSON"in a)return r(a.toJSON());const c=[],d=s([l,c],a);for(const f of O3(a))(t||!To(Ra(a[f])))&&c.push([r(f),r(a[f])]);return d}case p0:return s([l,a.toISOString()],a);case y0:{const{source:c,flags:d}=a;return s([l,{source:c,flags:d}],a)}case x0:{const c=[],d=s([l,c],a);for(const[f,h]of a)(t||!(To(Ra(f))||To(Ra(h))))&&c.push([r(f),r(h)]);return d}case v0:{const c=[],d=s([l,c],a);for(const f of a)(t||!To(Ra(f)))&&c.push(r(f));return d}}const{message:u}=a;return s([l,{name:o,message:u}],a)};return r},nx=(t,{json:e,lossy:n}={})=>{const i=[];return P3(!(e||n),!!e,new Map,i)(t),i},Vu=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?tx(nx(t,e)):structuredClone(t):(t,e)=>tx(nx(t,e));function F3(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function B3(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function U3(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||F3,i=t.options.footnoteBackLabel||B3,s=t.options.footnoteLabel||"Footnotes",r=t.options.footnoteLabelTagName||"h2",a=t.options.footnoteLabelProperties||{className:["sr-only"]},l=[];let o=-1;for(;++o<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[o]);if(!u)continue;const c=t.all(u),d=String(u.identifier).toUpperCase(),f=fa(d.toLowerCase());let h=0;const m=[],y=t.footnoteCounts.get(d);for(;y!==void 0&&++h<=y;){m.length>0&&m.push({type:"text",value:" "});let v=typeof n=="string"?n:n(o,h);typeof v=="string"&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(h>1?"-"+h:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(o,h),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const x=c[c.length-1];if(x&&x.type==="element"&&x.tagName==="p"){const v=x.children[x.children.length-1];v&&v.type==="text"?v.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...m)}else c.push(...m);const p={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:t.wrap(c,!0)};t.patch(u,p),l.push(p)}if(l.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:r,properties:{...Vu(a),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(l,!0)},{type:"text",value:`
`}]}}const Sc=function(t){if(t==null)return G3;if(typeof t=="function")return Ec(t);if(typeof t=="object")return Array.isArray(t)?j3(t):$3(t);if(typeof t=="string")return z3(t);throw new Error("Expected function, string, or object as test")};function j3(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=Sc(t[n]);return Ec(i);function i(...s){let r=-1;for(;++r<e.length;)if(e[r].apply(this,s))return!0;return!1}}function $3(t){const e=t;return Ec(n);function n(i){const s=i;let r;for(r in t)if(s[r]!==e[r])return!1;return!0}}function z3(t){return Ec(e);function e(n){return n&&n.type===t}}function Ec(t){return e;function e(n,i,s){return!!(H3(n)&&t.call(this,n,typeof i=="number"?i:void 0,s||void 0))}}function G3(){return!0}function H3(t){return t!==null&&typeof t=="object"&&"type"in t}const ZE=[],V3=!0,kh=!1,K3="skip";function JE(t,e,n,i){let s;typeof e=="function"&&typeof n!="function"?(i=n,n=e):s=e;const r=Sc(s),a=i?-1:1;l(t,void 0,[])();function l(o,u,c){const d=o&&typeof o=="object"?o:{};if(typeof d.type=="string"){const h=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(o.type+(h?"<"+h+">":""))+")"})}return f;function f(){let h=ZE,m,y,x;if((!e||r(o,u,c[c.length-1]||void 0))&&(h=Y3(n(o,c)),h[0]===kh))return h;if("children"in o&&o.children){const p=o;if(p.children&&h[0]!==K3)for(y=(i?p.children.length:-1)+a,x=c.concat(p);y>-1&&y<p.children.length;){const v=p.children[y];if(m=l(v,y,x)(),m[0]===kh)return m;y=typeof m[1]=="number"?m[1]:y+a}}return h}}}function Y3(t){return Array.isArray(t)?t:typeof t=="number"?[V3,t]:t==null?ZE:[t]}function b0(t,e,n,i){let s,r,a;typeof e=="function"&&typeof n!="function"?(r=void 0,a=e,s=n):(r=e,a=n,s=i),JE(t,r,l,s);function l(o,u){const c=u[u.length-1],d=c?c.children.indexOf(o):void 0;return a(o,d,c)}}const _h={}.hasOwnProperty,q3={};function X3(t,e){const n=e||q3,i=new Map,s=new Map,r=new Map,a={...D3,...n.handlers},l={all:u,applyData:W3,definitionById:i,footnoteById:s,footnoteCounts:r,footnoteOrder:[],handlers:a,one:o,options:n,patch:Q3,wrap:J3};return b0(t,function(c){if(c.type==="definition"||c.type==="footnoteDefinition"){const d=c.type==="definition"?i:s,f=String(c.identifier).toUpperCase();d.has(f)||d.set(f,c)}}),l;function o(c,d){const f=c.type,h=l.handlers[f];if(_h.call(l.handlers,f)&&h)return h(l,c,d);if(l.options.passThrough&&l.options.passThrough.includes(f)){if("children"in c){const{children:y,...x}=c,p=Vu(x);return p.children=l.all(c),p}return Vu(c)}return(l.options.unknownHandler||Z3)(l,c,d)}function u(c){const d=[];if("children"in c){const f=c.children;let h=-1;for(;++h<f.length;){const m=l.one(f[h],c);if(m){if(h&&f[h-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=ix(m.value)),!Array.isArray(m)&&m.type==="element")){const y=m.children[0];y&&y.type==="text"&&(y.value=ix(y.value))}Array.isArray(m)?d.push(...m):d.push(m)}}}return d}}function Q3(t,e){t.position&&(e.position=BM(t))}function W3(t,e){let n=e;if(t&&t.data){const i=t.data.hName,s=t.data.hChildren,r=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const a="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:a}}n.type==="element"&&r&&Object.assign(n.properties,Vu(r)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function Z3(t,e){const n=e.data||{},i="value"in e&&!(_h.call(n,"hProperties")||_h.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function J3(t,e){const n=[];let i=-1;for(e&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function ix(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function sx(t,e){const n=X3(t,e),i=n.one(t,void 0),s=U3(n),r=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return s&&r.children.push({type:"text",value:`
`},s),r}function eF(t,e){return t&&"run"in t?async function(n,i){const s=sx(n,{file:i,...e});await t.run(s,i)}:function(n,i){return sx(n,{file:i,...t||e})}}function rx(t){if(t)throw t}var Jo=Object.prototype.hasOwnProperty,eT=Object.prototype.toString,ax=Object.defineProperty,lx=Object.getOwnPropertyDescriptor,ox=function(e){return typeof Array.isArray=="function"?Array.isArray(e):eT.call(e)==="[object Array]"},ux=function(e){if(!e||eT.call(e)!=="[object Object]")return!1;var n=Jo.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&Jo.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!i)return!1;var s;for(s in e);return typeof s>"u"||Jo.call(e,s)},cx=function(e,n){ax&&n.name==="__proto__"?ax(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},dx=function(e,n){if(n==="__proto__")if(Jo.call(e,n)){if(lx)return lx(e,n).value}else return;return e[n]},tF=function t(){var e,n,i,s,r,a,l=arguments[0],o=1,u=arguments.length,c=!1;for(typeof l=="boolean"&&(c=l,l=arguments[1]||{},o=2),(l==null||typeof l!="object"&&typeof l!="function")&&(l={});o<u;++o)if(e=arguments[o],e!=null)for(n in e)i=dx(l,n),s=dx(e,n),l!==s&&(c&&s&&(ux(s)||(r=ox(s)))?(r?(r=!1,a=i&&ox(i)?i:[]):a=i&&ux(i)?i:{},cx(l,{name:n,newValue:t(c,a,s)})):typeof s<"u"&&cx(l,{name:n,newValue:s}));return l};const jd=Yu(tF);function Lh(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function nF(){const t=[],e={run:n,use:i};return e;function n(...s){let r=-1;const a=s.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);l(null,...s);function l(o,...u){const c=t[++r];let d=-1;if(o){a(o);return}for(;++d<s.length;)(u[d]===null||u[d]===void 0)&&(u[d]=s[d]);s=u,c?iF(c,l)(...u):a(null,...u)}}function i(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function iF(t,e){let n;return i;function i(...a){const l=t.length>a.length;let o;l&&a.push(s);try{o=t.apply(this,a)}catch(u){const c=u;if(l&&n)throw c;return s(c)}l||(o&&o.then&&typeof o.then=="function"?o.then(r,s):o instanceof Error?s(o):r(o))}function s(a,...l){n||(n=!0,e(a,...l))}function r(a){s(null,a)}}const ei={basename:sF,dirname:rF,extname:aF,join:lF,sep:"/"};function sF(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');zl(t);let n=0,i=-1,s=t.length,r;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(r){n=s+1;break}}else i<0&&(r=!0,i=s+1);return i<0?"":t.slice(n,i)}if(e===t)return"";let a=-1,l=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(r){n=s+1;break}}else a<0&&(r=!0,a=s+1),l>-1&&(t.codePointAt(s)===e.codePointAt(l--)?l<0&&(i=s):(l=-1,i=a));return n===i?i=a:i<0&&(i=t.length),t.slice(n,i)}function rF(t){if(zl(t),t.length===0)return".";let e=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){e=n;break}}else i||(i=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function aF(t){zl(t);let e=t.length,n=-1,i=0,s=-1,r=0,a;for(;e--;){const l=t.codePointAt(e);if(l===47){if(a){i=e+1;break}continue}n<0&&(a=!0,n=e+1),l===46?s<0?s=e:r!==1&&(r=1):s>-1&&(r=-1)}return s<0||n<0||r===0||r===1&&s===n-1&&s===i+1?"":t.slice(s,n)}function lF(...t){let e=-1,n;for(;++e<t.length;)zl(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":oF(n)}function oF(t){zl(t);const e=t.codePointAt(0)===47;let n=uF(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function uF(t,e){let n="",i=0,s=-1,r=0,a=-1,l,o;for(;++a<=t.length;){if(a<t.length)l=t.codePointAt(a);else{if(l===47)break;l=47}if(l===47){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(o=n.lastIndexOf("/"),o!==n.length-1){o<0?(n="",i=0):(n=n.slice(0,o),i=n.length-1-n.lastIndexOf("/")),s=a,r=0;continue}}else if(n.length>0){n="",i=0,s=a,r=0;continue}}e&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(s+1,a):n=t.slice(s+1,a),i=a-s-1;s=a,r=0}else l===46&&r>-1?r++:r=-1}return n}function zl(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const cF={cwd:dF};function dF(){return"/"}function Rh(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function fF(t){if(typeof t=="string")t=new URL(t);else if(!Rh(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return hF(t)}function hF(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const i=e.codePointAt(n+2);if(i===70||i===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const $d=["history","path","basename","stem","extname","dirname"];class tT{constructor(e){let n;e?Rh(e)?n={path:e}:typeof e=="string"||mF(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":cF.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<$d.length;){const r=$d[i];r in n&&n[r]!==void 0&&n[r]!==null&&(this[r]=r==="history"?[...n[r]]:n[r])}let s;for(s in n)$d.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?ei.basename(this.path):void 0}set basename(e){Gd(e,"basename"),zd(e,"basename"),this.path=ei.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?ei.dirname(this.path):void 0}set dirname(e){fx(this.basename,"dirname"),this.path=ei.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?ei.extname(this.path):void 0}set extname(e){if(zd(e,"extname"),fx(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=ei.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Rh(e)&&(e=fF(e)),Gd(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?ei.basename(this.path,this.extname):void 0}set stem(e){Gd(e,"stem"),zd(e,"stem"),this.path=ei.join(this.dirname||"",e+(this.extname||""))}fail(e,n,i){const s=this.message(e,n,i);throw s.fatal=!0,s}info(e,n,i){const s=this.message(e,n,i);return s.fatal=void 0,s}message(e,n,i){const s=new Bt(e,n,i);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function zd(t,e){if(t&&t.includes(ei.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+ei.sep+"`")}function Gd(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function fx(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function mF(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const gF=function(t){const i=this.constructor.prototype,s=i[t],r=function(){return s.apply(r,arguments)};return Object.setPrototypeOf(r,i),r},pF={}.hasOwnProperty;class S0 extends gF{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=nF()}copy(){const e=new S0;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];e.use(...i)}return e.data(jd(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Kd("data",this.frozen),this.namespace[e]=n,this):pF.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Kd("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const s=n.call(e,...i);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Ao(e),i=this.parser||this.Parser;return Hd("parse",i),i(String(n),n)}process(e,n){const i=this;return this.freeze(),Hd("process",this.parser||this.Parser),Vd("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(r,a){const l=Ao(e),o=i.parse(l);i.run(o,l,function(c,d,f){if(c||!d||!f)return u(c);const h=d,m=i.stringify(h,f);vF(m)?f.value=m:f.result=m,u(c,f)});function u(c,d){c||!d?a(c):r?r(d):n(void 0,d)}}}processSync(e){let n=!1,i;return this.freeze(),Hd("processSync",this.parser||this.Parser),Vd("processSync",this.compiler||this.Compiler),this.process(e,s),mx("processSync","process",n),i;function s(r,a){n=!0,rx(r),i=a}}run(e,n,i){hx(e),this.freeze();const s=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?r(void 0,i):new Promise(r);function r(a,l){const o=Ao(n);s.run(e,o,u);function u(c,d,f){const h=d||e;c?l(c):a?a(h):i(void 0,h,f)}}}runSync(e,n){let i=!1,s;return this.run(e,n,r),mx("runSync","run",i),s;function r(a,l){rx(a),s=l,i=!0}}stringify(e,n){this.freeze();const i=Ao(n),s=this.compiler||this.Compiler;return Vd("stringify",s),hx(e),s(e,i)}use(e,...n){const i=this.attachers,s=this.namespace;if(Kd("use",this.frozen),e!=null)if(typeof e=="function")o(e,n);else if(typeof e=="object")Array.isArray(e)?l(e):a(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function r(u){if(typeof u=="function")o(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[c,...d]=u;o(c,d)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");l(u.plugins),u.settings&&(s.settings=jd(!0,s.settings,u.settings))}function l(u){let c=-1;if(u!=null)if(Array.isArray(u))for(;++c<u.length;){const d=u[c];r(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function o(u,c){let d=-1,f=-1;for(;++d<i.length;)if(i[d][0]===u){f=d;break}if(f===-1)i.push([u,...c]);else if(c.length>0){let[h,...m]=c;const y=i[f][1];Lh(y)&&Lh(h)&&(h=jd(!0,y,h)),i[f]=[u,h,...m]}}}}const yF=new S0().freeze();function Hd(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Vd(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Kd(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function hx(t){if(!Lh(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function mx(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Ao(t){return xF(t)?t:new tT(t)}function xF(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function vF(t){return typeof t=="string"||bF(t)}function bF(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const SF="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",gx=[],px={allowDangerousHtml:!0},EF=/^(https?|ircs?|mailto|xmpp)$/i,TF=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function AF(t){const e=kF(t),n=_F(t);return LF(e.runSync(e.parse(n),n),t)}function kF(t){const e=t.rehypePlugins||gx,n=t.remarkPlugins||gx,i=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...px}:px;return yF().use(a3).use(n).use(eF,i).use(e)}function _F(t){const e=t.children||"",n=new tT;return typeof e=="string"&&(n.value=e),n}function LF(t,e){const n=e.allowedElements,i=e.allowElement,s=e.components,r=e.disallowedElements,a=e.skipHtml,l=e.unwrapDisallowed,o=e.urlTransform||RF;for(const c of TF)Object.hasOwn(e,c.from)&&(""+c.from+(c.to?"use `"+c.to+"` instead":"remove it")+SF+c.id,void 0);return e.className&&(t={type:"element",tagName:"div",properties:{className:e.className},children:t.type==="root"?t.children:[t]}),b0(t,u),GM(t,{Fragment:g.Fragment,components:s,ignoreInvalidStyle:!0,jsx:g.jsx,jsxs:g.jsxs,passKeys:!0,passNode:!0});function u(c,d,f){if(c.type==="raw"&&f&&typeof d=="number")return a?f.children.splice(d,1):f.children[d]={type:"text",value:c.value},d;if(c.type==="element"){let h;for(h in Fd)if(Object.hasOwn(Fd,h)&&Object.hasOwn(c.properties,h)){const m=c.properties[h],y=Fd[h];(y===null||y.includes(c.tagName))&&(c.properties[h]=o(String(m||""),h,c))}}if(c.type==="element"){let h=n?!n.includes(c.tagName):r?r.includes(c.tagName):!1;if(!h&&i&&typeof d=="number"&&(h=!i(c,d,f)),h&&f&&typeof d=="number")return l&&c.children?f.children.splice(d,1,...c.children):f.children.splice(d,1),d}}}function RF(t){const e=t.indexOf(":"),n=t.indexOf("?"),i=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||i!==-1&&e>i||EF.test(t.slice(0,e))?t:""}function yx(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let i=0,s=n.indexOf(e);for(;s!==-1;)i++,s=n.indexOf(e,s+e.length);return i}function wF(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function CF(t,e,n){const s=Sc((n||{}).ignore||[]),r=IF(e);let a=-1;for(;++a<r.length;)JE(t,"text",l);function l(u,c){let d=-1,f;for(;++d<c.length;){const h=c[d],m=f?f.children:void 0;if(s(h,m?m.indexOf(h):void 0,f))return;f=h}if(f)return o(u,c)}function o(u,c){const d=c[c.length-1],f=r[a][0],h=r[a][1];let m=0;const x=d.children.indexOf(u);let p=!1,v=[];f.lastIndex=0;let b=f.exec(u.value);for(;b;){const E=b.index,k={index:b.index,input:b.input,stack:[...c,u]};let _=h(...b,k);if(typeof _=="string"&&(_=_.length>0?{type:"text",value:_}:void 0),_===!1?f.lastIndex=E+1:(m!==E&&v.push({type:"text",value:u.value.slice(m,E)}),Array.isArray(_)?v.push(..._):_&&v.push(_),m=E+b[0].length,p=!0),!f.global)break;b=f.exec(u.value)}return p?(m<u.value.length&&v.push({type:"text",value:u.value.slice(m)}),d.children.splice(x,1,...v)):v=[u],x+v.length}}function IF(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const s=n[i];e.push([DF(s[0]),NF(s[1])])}return e}function DF(t){return typeof t=="string"?new RegExp(wF(t),"g"):t}function NF(t){return typeof t=="function"?t:function(){return t}}const Yd="phrasing",qd=["autolink","link","image","label"];function MF(){return{transforms:[$F],enter:{literalAutolink:PF,literalAutolinkEmail:Xd,literalAutolinkHttp:Xd,literalAutolinkWww:Xd},exit:{literalAutolink:jF,literalAutolinkEmail:UF,literalAutolinkHttp:FF,literalAutolinkWww:BF}}}function OF(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Yd,notInConstruct:qd},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Yd,notInConstruct:qd},{character:":",before:"[ps]",after:"\\/",inConstruct:Yd,notInConstruct:qd}]}}function PF(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Xd(t){this.config.enter.autolinkProtocol.call(this,t)}function FF(t){this.config.exit.autolinkProtocol.call(this,t)}function BF(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function UF(t){this.config.exit.autolinkEmail.call(this,t)}function jF(t){this.exit(t)}function $F(t){CF(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,zF],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),GF]],{ignore:["link","linkReference"]})}function zF(t,e,n,i,s){let r="";if(!nT(s)||(/^w/i.test(e)&&(n=e+n,e="",r="http://"),!HF(n)))return!1;const a=VF(n+i);if(!a[0])return!1;const l={type:"link",title:null,url:r+e+a[0],children:[{type:"text",value:e+a[0]}]};return a[1]?[l,{type:"text",value:a[1]}]:l}function GF(t,e,n,i){return!nT(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function HF(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function VF(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],i=n.indexOf(")");const s=yx(t,"(");let r=yx(t,")");for(;i!==-1&&s>r;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),r++;return[t,n]}function nT(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||Qs(n)||xc(n))&&(!e||n!==47)}iT.peek=e4;function KF(){this.buffer()}function YF(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function qF(){this.buffer()}function XF(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function QF(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Yn(this.sliceSerialize(t)).toLowerCase(),n.label=e}function WF(t){this.exit(t)}function ZF(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Yn(this.sliceSerialize(t)).toLowerCase(),n.label=e}function JF(t){this.exit(t)}function e4(){return"["}function iT(t,e,n,i){const s=n.createTracker(i);let r=s.move("[^");const a=n.enter("footnoteReference"),l=n.enter("reference");return r+=s.move(n.safe(n.associationId(t),{after:"]",before:r})),l(),a(),r+=s.move("]"),r}function t4(){return{enter:{gfmFootnoteCallString:KF,gfmFootnoteCall:YF,gfmFootnoteDefinitionLabelString:qF,gfmFootnoteDefinition:XF},exit:{gfmFootnoteCallString:QF,gfmFootnoteCall:WF,gfmFootnoteDefinitionLabelString:ZF,gfmFootnoteDefinition:JF}}}function n4(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:n,footnoteReference:iT},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,s,r,a){const l=r.createTracker(a);let o=l.move("[^");const u=r.enter("footnoteDefinition"),c=r.enter("label");return o+=l.move(r.safe(r.associationId(i),{before:o,after:"]"})),c(),o+=l.move("]:"),i.children&&i.children.length>0&&(l.shift(4),o+=l.move((e?`
`:" ")+r.indentLines(r.containerFlow(i,l.current()),e?sT:i4))),u(),o}}function i4(t,e,n){return e===0?t:sT(t,e,n)}function sT(t,e,n){return(n?"":"    ")+t}const s4=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];rT.peek=u4;function r4(){return{canContainEols:["delete"],enter:{strikethrough:l4},exit:{strikethrough:o4}}}function a4(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:s4}],handlers:{delete:rT}}}function l4(t){this.enter({type:"delete",children:[]},t)}function o4(t){this.exit(t)}function rT(t,e,n,i){const s=n.createTracker(i),r=n.enter("strikethrough");let a=s.move("~~");return a+=n.containerPhrasing(t,{...s.current(),before:a,after:"~"}),a+=s.move("~~"),r(),a}function u4(){return"~"}function c4(t){return t.length}function d4(t,e){const n=e||{},i=(n.align||[]).concat(),s=n.stringLength||c4,r=[],a=[],l=[],o=[];let u=0,c=-1;for(;++c<t.length;){const y=[],x=[];let p=-1;for(t[c].length>u&&(u=t[c].length);++p<t[c].length;){const v=f4(t[c][p]);if(n.alignDelimiters!==!1){const b=s(v);x[p]=b,(o[p]===void 0||b>o[p])&&(o[p]=b)}y.push(v)}a[c]=y,l[c]=x}let d=-1;if(typeof i=="object"&&"length"in i)for(;++d<u;)r[d]=xx(i[d]);else{const y=xx(i);for(;++d<u;)r[d]=y}d=-1;const f=[],h=[];for(;++d<u;){const y=r[d];let x="",p="";y===99?(x=":",p=":"):y===108?x=":":y===114&&(p=":");let v=n.alignDelimiters===!1?1:Math.max(1,o[d]-x.length-p.length);const b=x+"-".repeat(v)+p;n.alignDelimiters!==!1&&(v=x.length+v+p.length,v>o[d]&&(o[d]=v),h[d]=v),f[d]=b}a.splice(1,0,f),l.splice(1,0,h),c=-1;const m=[];for(;++c<a.length;){const y=a[c],x=l[c];d=-1;const p=[];for(;++d<u;){const v=y[d]||"";let b="",E="";if(n.alignDelimiters!==!1){const k=o[d]-(x[d]||0),_=r[d];_===114?b=" ".repeat(k):_===99?k%2?(b=" ".repeat(k/2+.5),E=" ".repeat(k/2-.5)):(b=" ".repeat(k/2),E=b):E=" ".repeat(k)}n.delimiterStart!==!1&&!d&&p.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&v==="")&&(n.delimiterStart!==!1||d)&&p.push(" "),n.alignDelimiters!==!1&&p.push(b),p.push(v),n.alignDelimiters!==!1&&p.push(E),n.padding!==!1&&p.push(" "),(n.delimiterEnd!==!1||d!==u-1)&&p.push("|")}m.push(n.delimiterEnd===!1?p.join("").replace(/ +$/,""):p.join(""))}return m.join(`
`)}function f4(t){return t==null?"":String(t)}function xx(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function h4(t,e,n,i){const s=n.enter("blockquote"),r=n.createTracker(i);r.move("> "),r.shift(2);const a=n.indentLines(n.containerFlow(t,r.current()),m4);return s(),a}function m4(t,e,n){return">"+(n?"":" ")+t}function g4(t,e){return vx(t,e.inConstruct,!0)&&!vx(t,e.notInConstruct,!1)}function vx(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let i=-1;for(;++i<e.length;)if(t.includes(e[i]))return!0;return!1}function bx(t,e,n,i){let s=-1;for(;++s<n.unsafe.length;)if(n.unsafe[s].character===`
`&&g4(n.stack,n.unsafe[s]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function p4(t,e){const n=String(t);let i=n.indexOf(e),s=i,r=0,a=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===s?++r>a&&(a=r):r=1,s=i+e.length,i=n.indexOf(e,s);return a}function y4(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function x4(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function v4(t,e,n,i){const s=x4(n),r=t.value||"",a=s==="`"?"GraveAccent":"Tilde";if(y4(t,n)){const d=n.enter("codeIndented"),f=n.indentLines(r,b4);return d(),f}const l=n.createTracker(i),o=s.repeat(Math.max(p4(r,s)+1,3)),u=n.enter("codeFenced");let c=l.move(o);if(t.lang){const d=n.enter(`codeFencedLang${a}`);c+=l.move(n.safe(t.lang,{before:c,after:" ",encode:["`"],...l.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${a}`);c+=l.move(" "),c+=l.move(n.safe(t.meta,{before:c,after:`
`,encode:["`"],...l.current()})),d()}return c+=l.move(`
`),r&&(c+=l.move(r+`
`)),c+=l.move(o),u(),c}function b4(t,e,n){return(n?"":"    ")+t}function E0(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function S4(t,e,n,i){const s=E0(n),r=s==='"'?"Quote":"Apostrophe",a=n.enter("definition");let l=n.enter("label");const o=n.createTracker(i);let u=o.move("[");return u+=o.move(n.safe(n.associationId(t),{before:u,after:"]",...o.current()})),u+=o.move("]: "),l(),!t.url||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(n.safe(t.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(l=n.enter("destinationRaw"),u+=o.move(n.safe(t.url,{before:u,after:t.title?" ":`
`,...o.current()}))),l(),t.title&&(l=n.enter(`title${r}`),u+=o.move(" "+s),u+=o.move(n.safe(t.title,{before:u,after:s,...o.current()})),u+=o.move(s),l()),a(),u}function E4(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function _l(t){return"&#x"+t.toString(16).toUpperCase()+";"}function Ku(t,e,n){const i=na(t),s=na(e);return i===void 0?s===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}aT.peek=T4;function aT(t,e,n,i){const s=E4(n),r=n.enter("emphasis"),a=n.createTracker(i),l=a.move(s);let o=a.move(n.containerPhrasing(t,{after:s,before:l,...a.current()}));const u=o.charCodeAt(0),c=Ku(i.before.charCodeAt(i.before.length-1),u,s);c.inside&&(o=_l(u)+o.slice(1));const d=o.charCodeAt(o.length-1),f=Ku(i.after.charCodeAt(0),d,s);f.inside&&(o=o.slice(0,-1)+_l(d));const h=a.move(s);return r(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},l+o+h}function T4(t,e,n){return n.options.emphasis||"*"}function A4(t,e){let n=!1;return b0(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,kh}),!!((!t.depth||t.depth<3)&&h0(t)&&(e.options.setext||n))}function k4(t,e,n,i){const s=Math.max(Math.min(6,t.depth||1),1),r=n.createTracker(i);if(A4(t,n)){const c=n.enter("headingSetext"),d=n.enter("phrasing"),f=n.containerPhrasing(t,{...r.current(),before:`
`,after:`
`});return d(),c(),f+`
`+(s===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const a="#".repeat(s),l=n.enter("headingAtx"),o=n.enter("phrasing");r.move(a+" ");let u=n.containerPhrasing(t,{before:"# ",after:`
`,...r.current()});return/^[\t ]/.test(u)&&(u=_l(u.charCodeAt(0))+u.slice(1)),u=u?a+" "+u:a,n.options.closeAtx&&(u+=" "+a),o(),l(),u}lT.peek=_4;function lT(t){return t.value||""}function _4(){return"<"}oT.peek=L4;function oT(t,e,n,i){const s=E0(n),r=s==='"'?"Quote":"Apostrophe",a=n.enter("image");let l=n.enter("label");const o=n.createTracker(i);let u=o.move("![");return u+=o.move(n.safe(t.alt,{before:u,after:"]",...o.current()})),u+=o.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),u+=o.move("<"),u+=o.move(n.safe(t.url,{before:u,after:">",...o.current()})),u+=o.move(">")):(l=n.enter("destinationRaw"),u+=o.move(n.safe(t.url,{before:u,after:t.title?" ":")",...o.current()}))),l(),t.title&&(l=n.enter(`title${r}`),u+=o.move(" "+s),u+=o.move(n.safe(t.title,{before:u,after:s,...o.current()})),u+=o.move(s),l()),u+=o.move(")"),a(),u}function L4(){return"!"}uT.peek=R4;function uT(t,e,n,i){const s=t.referenceType,r=n.enter("imageReference");let a=n.enter("label");const l=n.createTracker(i);let o=l.move("![");const u=n.safe(t.alt,{before:o,after:"]",...l.current()});o+=l.move(u+"]["),a();const c=n.stack;n.stack=[],a=n.enter("reference");const d=n.safe(n.associationId(t),{before:o,after:"]",...l.current()});return a(),n.stack=c,r(),s==="full"||!u||u!==d?o+=l.move(d+"]"):s==="shortcut"?o=o.slice(0,-1):o+=l.move("]"),o}function R4(){return"!"}cT.peek=w4;function cT(t,e,n){let i=t.value||"",s="`",r=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(i);)s+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++r<n.unsafe.length;){const a=n.unsafe[r],l=n.compilePattern(a);let o;if(a.atBreak)for(;o=l.exec(i);){let u=o.index;i.charCodeAt(u)===10&&i.charCodeAt(u-1)===13&&u--,i=i.slice(0,u)+" "+i.slice(o.index+1)}}return s+i+s}function w4(){return"`"}function dT(t,e){const n=h0(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}fT.peek=C4;function fT(t,e,n,i){const s=E0(n),r=s==='"'?"Quote":"Apostrophe",a=n.createTracker(i);let l,o;if(dT(t,n)){const c=n.stack;n.stack=[],l=n.enter("autolink");let d=a.move("<");return d+=a.move(n.containerPhrasing(t,{before:d,after:">",...a.current()})),d+=a.move(">"),l(),n.stack=c,d}l=n.enter("link"),o=n.enter("label");let u=a.move("[");return u+=a.move(n.containerPhrasing(t,{before:u,after:"](",...a.current()})),u+=a.move("]("),o(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(o=n.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(n.safe(t.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(o=n.enter("destinationRaw"),u+=a.move(n.safe(t.url,{before:u,after:t.title?" ":")",...a.current()}))),o(),t.title&&(o=n.enter(`title${r}`),u+=a.move(" "+s),u+=a.move(n.safe(t.title,{before:u,after:s,...a.current()})),u+=a.move(s),o()),u+=a.move(")"),l(),u}function C4(t,e,n){return dT(t,n)?"<":"["}hT.peek=I4;function hT(t,e,n,i){const s=t.referenceType,r=n.enter("linkReference");let a=n.enter("label");const l=n.createTracker(i);let o=l.move("[");const u=n.containerPhrasing(t,{before:o,after:"]",...l.current()});o+=l.move(u+"]["),a();const c=n.stack;n.stack=[],a=n.enter("reference");const d=n.safe(n.associationId(t),{before:o,after:"]",...l.current()});return a(),n.stack=c,r(),s==="full"||!u||u!==d?o+=l.move(d+"]"):s==="shortcut"?o=o.slice(0,-1):o+=l.move("]"),o}function I4(){return"["}function T0(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function D4(t){const e=T0(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function N4(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function mT(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function M4(t,e,n,i){const s=n.enter("list"),r=n.bulletCurrent;let a=t.ordered?N4(n):T0(n);const l=t.ordered?a==="."?")":".":D4(n);let o=e&&n.bulletLastUsed?a===n.bulletLastUsed:!1;if(!t.ordered){const c=t.children?t.children[0]:void 0;if((a==="*"||a==="-")&&c&&(!c.children||!c.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(o=!0),mT(n)===a&&c){let d=-1;for(;++d<t.children.length;){const f=t.children[d];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){o=!0;break}}}}o&&(a=l),n.bulletCurrent=a;const u=n.containerFlow(t,i);return n.bulletLastUsed=a,n.bulletCurrent=r,s(),u}function O4(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function P4(t,e,n,i){const s=O4(n);let r=n.bulletCurrent||T0(n);e&&e.type==="list"&&e.ordered&&(r=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+r);let a=r.length+1;(s==="tab"||s==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(a=Math.ceil(a/4)*4);const l=n.createTracker(i);l.move(r+" ".repeat(a-r.length)),l.shift(a);const o=n.enter("listItem"),u=n.indentLines(n.containerFlow(t,l.current()),c);return o(),u;function c(d,f,h){return f?(h?"":" ".repeat(a))+d:(h?r:r+" ".repeat(a-r.length))+d}}function F4(t,e,n,i){const s=n.enter("paragraph"),r=n.enter("phrasing"),a=n.containerPhrasing(t,i);return r(),s(),a}const B4=Sc(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function U4(t,e,n,i){return(t.children.some(function(a){return B4(a)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function j4(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}gT.peek=$4;function gT(t,e,n,i){const s=j4(n),r=n.enter("strong"),a=n.createTracker(i),l=a.move(s+s);let o=a.move(n.containerPhrasing(t,{after:s,before:l,...a.current()}));const u=o.charCodeAt(0),c=Ku(i.before.charCodeAt(i.before.length-1),u,s);c.inside&&(o=_l(u)+o.slice(1));const d=o.charCodeAt(o.length-1),f=Ku(i.after.charCodeAt(0),d,s);f.inside&&(o=o.slice(0,-1)+_l(d));const h=a.move(s+s);return r(),n.attentionEncodeSurroundingInfo={after:f.outside,before:c.outside},l+o+h}function $4(t,e,n){return n.options.strong||"*"}function z4(t,e,n,i){return n.safe(t.value,i)}function G4(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function H4(t,e,n){const i=(mT(n)+(n.options.ruleSpaces?" ":"")).repeat(G4(n));return n.options.ruleSpaces?i.slice(0,-1):i}const pT={blockquote:h4,break:bx,code:v4,definition:S4,emphasis:aT,hardBreak:bx,heading:k4,html:lT,image:oT,imageReference:uT,inlineCode:cT,link:fT,linkReference:hT,list:M4,listItem:P4,paragraph:F4,root:U4,strong:gT,text:z4,thematicBreak:H4};function V4(){return{enter:{table:K4,tableData:Sx,tableHeader:Sx,tableRow:q4},exit:{codeText:X4,table:Y4,tableData:Qd,tableHeader:Qd,tableRow:Qd}}}function K4(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function Y4(t){this.exit(t),this.data.inTable=void 0}function q4(t){this.enter({type:"tableRow",children:[]},t)}function Qd(t){this.exit(t)}function Sx(t){this.enter({type:"tableCell",children:[]},t)}function X4(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,Q4));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function Q4(t,e){return e==="|"?e:t}function W4(t){const e=t||{},n=e.tableCellPadding,i=e.tablePipeAlign,s=e.stringLength,r=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:a,tableCell:o,tableRow:l}};function a(h,m,y,x){return u(c(h,y,x),h.align)}function l(h,m,y,x){const p=d(h,y,x),v=u([p]);return v.slice(0,v.indexOf(`
`))}function o(h,m,y,x){const p=y.enter("tableCell"),v=y.enter("phrasing"),b=y.containerPhrasing(h,{...x,before:r,after:r});return v(),p(),b}function u(h,m){return d4(h,{align:m,alignDelimiters:i,padding:n,stringLength:s})}function c(h,m,y){const x=h.children;let p=-1;const v=[],b=m.enter("table");for(;++p<x.length;)v[p]=d(x[p],m,y);return b(),v}function d(h,m,y){const x=h.children;let p=-1;const v=[],b=m.enter("tableRow");for(;++p<x.length;)v[p]=o(x[p],h,m,y);return b(),v}function f(h,m,y){let x=pT.inlineCode(h,m,y);return y.stack.includes("tableCell")&&(x=x.replace(/\|/g,"\\$&")),x}}function Z4(){return{exit:{taskListCheckValueChecked:Ex,taskListCheckValueUnchecked:Ex,paragraph:eB}}}function J4(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:tB}}}function Ex(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function eB(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const s=e.children;let r=-1,a;for(;++r<s.length;){const l=s[r];if(l.type==="paragraph"){a=l;break}}a===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function tB(t,e,n,i){const s=t.children[0],r=typeof t.checked=="boolean"&&s&&s.type==="paragraph",a="["+(t.checked?"x":" ")+"] ",l=n.createTracker(i);r&&l.move(a);let o=pT.listItem(t,e,n,{...i,...l.current()});return r&&(o=o.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),o;function u(c){return c+a}}function nB(){return[MF(),t4(),r4(),V4(),Z4()]}function iB(t){return{extensions:[OF(),n4(t),a4(),W4(t),J4()]}}const sB={tokenize:cB,partial:!0},yT={tokenize:dB,partial:!0},xT={tokenize:fB,partial:!0},vT={tokenize:hB,partial:!0},rB={tokenize:mB,partial:!0},bT={name:"wwwAutolink",tokenize:oB,previous:ET},ST={name:"protocolAutolink",tokenize:uB,previous:TT},Fi={name:"emailAutolink",tokenize:lB,previous:AT},hi={};function aB(){return{text:hi}}let Rs=48;for(;Rs<123;)hi[Rs]=Fi,Rs++,Rs===58?Rs=65:Rs===91&&(Rs=97);hi[43]=Fi;hi[45]=Fi;hi[46]=Fi;hi[95]=Fi;hi[72]=[Fi,ST];hi[104]=[Fi,ST];hi[87]=[Fi,bT];hi[119]=[Fi,bT];function lB(t,e,n){const i=this;let s,r;return a;function a(d){return!wh(d)||!AT.call(i,i.previous)||A0(i.events)?n(d):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),l(d))}function l(d){return wh(d)?(t.consume(d),l):d===64?(t.consume(d),o):n(d)}function o(d){return d===46?t.check(rB,c,u)(d):d===45||d===95||Ft(d)?(r=!0,t.consume(d),o):c(d)}function u(d){return t.consume(d),s=!0,o}function c(d){return r&&s&&jt(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(d)):n(d)}}function oB(t,e,n){const i=this;return s;function s(a){return a!==87&&a!==119||!ET.call(i,i.previous)||A0(i.events)?n(a):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(sB,t.attempt(yT,t.attempt(xT,r),n),n)(a))}function r(a){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(a)}}function uB(t,e,n){const i=this;let s="",r=!1;return a;function a(d){return(d===72||d===104)&&TT.call(i,i.previous)&&!A0(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),s+=String.fromCodePoint(d),t.consume(d),l):n(d)}function l(d){if(jt(d)&&s.length<5)return s+=String.fromCodePoint(d),t.consume(d),l;if(d===58){const f=s.toLowerCase();if(f==="http"||f==="https")return t.consume(d),o}return n(d)}function o(d){return d===47?(t.consume(d),r?u:(r=!0,o)):n(d)}function u(d){return d===null||Gu(d)||Ve(d)||Qs(d)||xc(d)?n(d):t.attempt(yT,t.attempt(xT,c),n)(d)}function c(d){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(d)}}function cB(t,e,n){let i=0;return s;function s(a){return(a===87||a===119)&&i<3?(i++,t.consume(a),s):a===46&&i===3?(t.consume(a),r):n(a)}function r(a){return a===null?n(a):e(a)}}function dB(t,e,n){let i,s,r;return a;function a(u){return u===46||u===95?t.check(vT,o,l)(u):u===null||Ve(u)||Qs(u)||u!==45&&xc(u)?o(u):(r=!0,t.consume(u),a)}function l(u){return u===95?i=!0:(s=i,i=void 0),t.consume(u),a}function o(u){return s||i||!r?n(u):e(u)}}function fB(t,e){let n=0,i=0;return s;function s(a){return a===40?(n++,t.consume(a),s):a===41&&i<n?r(a):a===33||a===34||a===38||a===39||a===41||a===42||a===44||a===46||a===58||a===59||a===60||a===63||a===93||a===95||a===126?t.check(vT,e,r)(a):a===null||Ve(a)||Qs(a)?e(a):(t.consume(a),s)}function r(a){return a===41&&i++,t.consume(a),s}}function hB(t,e,n){return i;function i(l){return l===33||l===34||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===63||l===95||l===126?(t.consume(l),i):l===38?(t.consume(l),r):l===93?(t.consume(l),s):l===60||l===null||Ve(l)||Qs(l)?e(l):n(l)}function s(l){return l===null||l===40||l===91||Ve(l)||Qs(l)?e(l):i(l)}function r(l){return jt(l)?a(l):n(l)}function a(l){return l===59?(t.consume(l),i):jt(l)?(t.consume(l),a):n(l)}}function mB(t,e,n){return i;function i(r){return t.consume(r),s}function s(r){return Ft(r)?n(r):e(r)}}function ET(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Ve(t)}function TT(t){return!jt(t)}function AT(t){return!(t===47||wh(t))}function wh(t){return t===43||t===45||t===46||t===95||Ft(t)}function A0(t){let e=t.length,n=!1;for(;e--;){const i=t[e][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const gB={tokenize:TB,partial:!0};function pB(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:bB,continuation:{tokenize:SB},exit:EB}},text:{91:{name:"gfmFootnoteCall",tokenize:vB},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:yB,resolveTo:xB}}}}function yB(t,e,n){const i=this;let s=i.events.length;const r=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let a;for(;s--;){const o=i.events[s][1];if(o.type==="labelImage"){a=o;break}if(o.type==="gfmFootnoteCall"||o.type==="labelLink"||o.type==="label"||o.type==="image"||o.type==="link")break}return l;function l(o){if(!a||!a._balanced)return n(o);const u=Yn(i.sliceSerialize({start:a.end,end:i.now()}));return u.codePointAt(0)!==94||!r.includes(u.slice(1))?n(o):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(o),t.exit("gfmFootnoteCallLabelMarker"),e(o))}}function xB(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},s={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};s.end.column++,s.end.offset++,s.end._bufferIndex++;const r={type:"gfmFootnoteCallString",start:Object.assign({},s.end),end:Object.assign({},t[t.length-1][1].start)},a={type:"chunkString",contentType:"string",start:Object.assign({},r.start),end:Object.assign({},r.end)},l=[t[n+1],t[n+2],["enter",i,e],t[n+3],t[n+4],["enter",s,e],["exit",s,e],["enter",r,e],["enter",a,e],["exit",a,e],["exit",r,e],t[t.length-2],t[t.length-1],["exit",i,e]];return t.splice(n,t.length-n+1,...l),t}function vB(t,e,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r=0,a;return l;function l(d){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),o}function o(d){return d!==94?n(d):(t.enter("gfmFootnoteCallMarker"),t.consume(d),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",u)}function u(d){if(r>999||d===93&&!a||d===null||d===91||Ve(d))return n(d);if(d===93){t.exit("chunkString");const f=t.exit("gfmFootnoteCallString");return s.includes(Yn(i.sliceSerialize(f)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(d)}return Ve(d)||(a=!0),r++,t.consume(d),d===92?c:u}function c(d){return d===91||d===92||d===93?(t.consume(d),r++,u):u(d)}}function bB(t,e,n){const i=this,s=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let r,a=0,l;return o;function o(m){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(m){return m===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",c):n(m)}function c(m){if(a>999||m===93&&!l||m===null||m===91||Ve(m))return n(m);if(m===93){t.exit("chunkString");const y=t.exit("gfmFootnoteDefinitionLabelString");return r=Yn(i.sliceSerialize(y)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),f}return Ve(m)||(l=!0),a++,t.consume(m),m===92?d:c}function d(m){return m===91||m===92||m===93?(t.consume(m),a++,c):c(m)}function f(m){return m===58?(t.enter("definitionMarker"),t.consume(m),t.exit("definitionMarker"),s.includes(r)||s.push(r),Re(t,h,"gfmFootnoteDefinitionWhitespace")):n(m)}function h(m){return e(m)}}function SB(t,e,n){return t.check($l,e,t.attempt(gB,e,n))}function EB(t){t.exit("gfmFootnoteDefinition")}function TB(t,e,n){const i=this;return Re(t,s,"gfmFootnoteDefinitionIndent",5);function s(r){const a=i.events[i.events.length-1];return a&&a[1].type==="gfmFootnoteDefinitionIndent"&&a[2].sliceSerialize(a[1],!0).length===4?e(r):n(r)}}function AB(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:r,resolveAll:s};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function s(a,l){let o=-1;for(;++o<a.length;)if(a[o][0]==="enter"&&a[o][1].type==="strikethroughSequenceTemporary"&&a[o][1]._close){let u=o;for(;u--;)if(a[u][0]==="exit"&&a[u][1].type==="strikethroughSequenceTemporary"&&a[u][1]._open&&a[o][1].end.offset-a[o][1].start.offset===a[u][1].end.offset-a[u][1].start.offset){a[o][1].type="strikethroughSequence",a[u][1].type="strikethroughSequence";const c={type:"strikethrough",start:Object.assign({},a[u][1].start),end:Object.assign({},a[o][1].end)},d={type:"strikethroughText",start:Object.assign({},a[u][1].end),end:Object.assign({},a[o][1].start)},f=[["enter",c,l],["enter",a[u][1],l],["exit",a[u][1],l],["enter",d,l]],h=l.parser.constructs.insideSpan.null;h&&Tn(f,f.length,0,vc(h,a.slice(u+1,o),l)),Tn(f,f.length,0,[["exit",d,l],["enter",a[o][1],l],["exit",a[o][1],l],["exit",c,l]]),Tn(a,u-1,o-u+3,f),o=u+f.length-2;break}}for(o=-1;++o<a.length;)a[o][1].type==="strikethroughSequenceTemporary"&&(a[o][1].type="data");return a}function r(a,l,o){const u=this.previous,c=this.events;let d=0;return f;function f(m){return u===126&&c[c.length-1][1].type!=="characterEscape"?o(m):(a.enter("strikethroughSequenceTemporary"),h(m))}function h(m){const y=na(u);if(m===126)return d>1?o(m):(a.consume(m),d++,h);if(d<2&&!n)return o(m);const x=a.exit("strikethroughSequenceTemporary"),p=na(m);return x._open=!p||p===2&&!!y,x._close=!y||y===2&&!!p,l(m)}}}class kB{constructor(){this.map=[]}add(e,n,i){_B(this,e,n,i)}consume(e){if(this.map.sort(function(r,a){return r[0]-a[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];i.push(e.slice()),e.length=0;let s=i.pop();for(;s;){for(const r of s)e.push(r);s=i.pop()}this.map.length=0}}function _B(t,e,n,i){let s=0;if(!(n===0&&i.length===0)){for(;s<t.map.length;){if(t.map[s][0]===e){t.map[s][1]+=n,t.map[s][2].push(...i);return}s+=1}t.map.push([e,n,i])}}function LB(t,e){let n=!1;const i=[];for(;e<t.length;){const s=t[e];if(n){if(s[0]==="enter")s[1].type==="tableContent"&&i.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(s[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const r=i.length-1;i[r]=i[r]==="left"?"center":"right"}}else if(s[1].type==="tableDelimiterRow")break}else s[0]==="enter"&&s[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return i}function RB(){return{flow:{null:{name:"table",tokenize:wB,resolveAll:CB}}}}function wB(t,e,n){const i=this;let s=0,r=0,a;return l;function l(A){let I=i.events.length-1;for(;I>-1;){const G=i.events[I][1].type;if(G==="lineEnding"||G==="linePrefix")I--;else break}const N=I>-1?i.events[I][1].type:null,V=N==="tableHead"||N==="tableRow"?_:o;return V===_&&i.parser.lazy[i.now().line]?n(A):V(A)}function o(A){return t.enter("tableHead"),t.enter("tableRow"),u(A)}function u(A){return A===124||(a=!0,r+=1),c(A)}function c(A){return A===null?n(A):oe(A)?r>1?(r=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(A),t.exit("lineEnding"),h):n(A):ke(A)?Re(t,c,"whitespace")(A):(r+=1,a&&(a=!1,s+=1),A===124?(t.enter("tableCellDivider"),t.consume(A),t.exit("tableCellDivider"),a=!0,c):(t.enter("data"),d(A)))}function d(A){return A===null||A===124||Ve(A)?(t.exit("data"),c(A)):(t.consume(A),A===92?f:d)}function f(A){return A===92||A===124?(t.consume(A),d):d(A)}function h(A){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(A):(t.enter("tableDelimiterRow"),a=!1,ke(A)?Re(t,m,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):m(A))}function m(A){return A===45||A===58?x(A):A===124?(a=!0,t.enter("tableCellDivider"),t.consume(A),t.exit("tableCellDivider"),y):k(A)}function y(A){return ke(A)?Re(t,x,"whitespace")(A):x(A)}function x(A){return A===58?(r+=1,a=!0,t.enter("tableDelimiterMarker"),t.consume(A),t.exit("tableDelimiterMarker"),p):A===45?(r+=1,p(A)):A===null||oe(A)?E(A):k(A)}function p(A){return A===45?(t.enter("tableDelimiterFiller"),v(A)):k(A)}function v(A){return A===45?(t.consume(A),v):A===58?(a=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(A),t.exit("tableDelimiterMarker"),b):(t.exit("tableDelimiterFiller"),b(A))}function b(A){return ke(A)?Re(t,E,"whitespace")(A):E(A)}function E(A){return A===124?m(A):A===null||oe(A)?!a||s!==r?k(A):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(A)):k(A)}function k(A){return n(A)}function _(A){return t.enter("tableRow"),L(A)}function L(A){return A===124?(t.enter("tableCellDivider"),t.consume(A),t.exit("tableCellDivider"),L):A===null||oe(A)?(t.exit("tableRow"),e(A)):ke(A)?Re(t,L,"whitespace")(A):(t.enter("data"),C(A))}function C(A){return A===null||A===124||Ve(A)?(t.exit("data"),L(A)):(t.consume(A),A===92?w:C)}function w(A){return A===92||A===124?(t.consume(A),C):C(A)}}function CB(t,e){let n=-1,i=!0,s=0,r=[0,0,0,0],a=[0,0,0,0],l=!1,o=0,u,c,d;const f=new kB;for(;++n<t.length;){const h=t[n],m=h[1];h[0]==="enter"?m.type==="tableHead"?(l=!1,o!==0&&(Tx(f,e,o,u,c),c=void 0,o=0),u={type:"table",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[["enter",u,e]])):m.type==="tableRow"||m.type==="tableDelimiterRow"?(i=!0,d=void 0,r=[0,0,0,0],a=[0,n+1,0,0],l&&(l=!1,c={type:"tableBody",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[["enter",c,e]])),s=m.type==="tableDelimiterRow"?2:c?3:1):s&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")?(i=!1,a[2]===0&&(r[1]!==0&&(a[0]=a[1],d=ko(f,e,r,s,void 0,d),r=[0,0,0,0]),a[2]=n)):m.type==="tableCellDivider"&&(i?i=!1:(r[1]!==0&&(a[0]=a[1],d=ko(f,e,r,s,void 0,d)),r=a,a=[r[1],n,0,0])):m.type==="tableHead"?(l=!0,o=n):m.type==="tableRow"||m.type==="tableDelimiterRow"?(o=n,r[1]!==0?(a[0]=a[1],d=ko(f,e,r,s,n,d)):a[1]!==0&&(d=ko(f,e,a,s,n,d)),s=0):s&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")&&(a[3]=n)}for(o!==0&&Tx(f,e,o,u,c),f.consume(e.events),n=-1;++n<e.events.length;){const h=e.events[n];h[0]==="enter"&&h[1].type==="table"&&(h[1]._align=LB(e.events,n))}return t}function ko(t,e,n,i,s,r){const a=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",l="tableContent";n[0]!==0&&(r.end=Object.assign({},yr(e.events,n[0])),t.add(n[0],0,[["exit",r,e]]));const o=yr(e.events,n[1]);if(r={type:a,start:Object.assign({},o),end:Object.assign({},o)},t.add(n[1],0,[["enter",r,e]]),n[2]!==0){const u=yr(e.events,n[2]),c=yr(e.events,n[3]),d={type:l,start:Object.assign({},u),end:Object.assign({},c)};if(t.add(n[2],0,[["enter",d,e]]),i!==2){const f=e.events[n[2]],h=e.events[n[3]];if(f[1].end=Object.assign({},h[1].end),f[1].type="chunkText",f[1].contentType="text",n[3]>n[2]+1){const m=n[2]+1,y=n[3]-n[2]-1;t.add(m,y,[])}}t.add(n[3]+1,0,[["exit",d,e]])}return s!==void 0&&(r.end=Object.assign({},yr(e.events,s)),t.add(s,0,[["exit",r,e]]),r=void 0),r}function Tx(t,e,n,i,s){const r=[],a=yr(e.events,n);s&&(s.end=Object.assign({},a),r.push(["exit",s,e])),i.end=Object.assign({},a),r.push(["exit",i,e]),t.add(n+1,0,r)}function yr(t,e){const n=t[e],i=n[0]==="enter"?"start":"end";return n[1][i]}const IB={name:"tasklistCheck",tokenize:NB};function DB(){return{text:{91:IB}}}function NB(t,e,n){const i=this;return s;function s(o){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(o):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(o),t.exit("taskListCheckMarker"),r)}function r(o){return Ve(o)?(t.enter("taskListCheckValueUnchecked"),t.consume(o),t.exit("taskListCheckValueUnchecked"),a):o===88||o===120?(t.enter("taskListCheckValueChecked"),t.consume(o),t.exit("taskListCheckValueChecked"),a):n(o)}function a(o){return o===93?(t.enter("taskListCheckMarker"),t.consume(o),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),l):n(o)}function l(o){return oe(o)?e(o):ke(o)?t.check({tokenize:MB},e,n)(o):n(o)}}function MB(t,e,n){return Re(t,i,"whitespace");function i(s){return s===null?n(s):e(s)}}function OB(t){return ME([aB(),pB(),AB(t),RB(),DB()])}const PB={};function FB(t){const e=this,n=t||PB,i=e.data(),s=i.micromarkExtensions||(i.micromarkExtensions=[]),r=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),a=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);s.push(OB(n)),r.push(nB()),a.push(iB(n))}const kT=({mode:t="full",phase:e="fetching"})=>{const n={idle:{text:"Ready",progress:0,icon:ud,step:0},fetching:{text:"Retrieving posts from the hive mind...",progress:30,icon:ap,step:1},analyzing:{text:"AI is detecting rage-bait & toxicity...",progress:66,icon:ud,step:2},filtering:{text:"Curating your zen space...",progress:100,icon:sp,step:3}},i=n[e]||n.fetching,s=i.icon;return t==="compact"?g.jsxs("div",{className:"w-full max-w-sm mx-auto flex flex-col items-center animate-fade-in",children:[g.jsxs("div",{className:"flex items-center gap-2 text-stone-500 dark:text-stone-400 mb-2 text-xs font-medium uppercase tracking-wide",children:[g.jsx(s,{size:14,className:"text-emerald-500 animate-pulse"}),g.jsx("span",{className:"animate-pulse transition-all duration-300",children:i.text})]}),g.jsx("div",{className:"w-full h-1 bg-stone-200 dark:bg-stone-800 rounded-full overflow-hidden relative",children:g.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-400 via-teal-400 to-emerald-600 rounded-full transition-all duration-500 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]",style:{width:`${i.progress}%`}})})]}):g.jsxs("div",{className:"flex flex-col items-center justify-center py-20 space-y-8 animate-in fade-in duration-700 w-full relative",children:[g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"absolute inset-0 bg-emerald-500/10 rounded-full animate-ping duration-[3000ms]"}),g.jsx("div",{className:"absolute inset-0 bg-emerald-500/20 rounded-full animate-ping delay-100 duration-[2000ms]"}),g.jsxs("div",{className:"relative bg-white/80 dark:bg-stone-800/80 p-8 rounded-full shadow-2xl border border-white/50 dark:border-stone-700 backdrop-blur-xl z-10 group animate-float transition-all duration-500",children:[g.jsx(s,{className:"text-emerald-500 transition-all duration-500 drop-shadow-lg",size:48,strokeWidth:1.5}),g.jsx("div",{className:"absolute -top-2 -right-2 bg-white dark:bg-stone-800 rounded-full p-2.5 shadow-lg border border-stone-100 dark:border-stone-700 animate-bounce delay-75",children:g.jsx(Dm,{size:18,className:"text-amber-400"})}),e==="analyzing"&&g.jsx("div",{className:"absolute inset-0 overflow-hidden rounded-full opacity-40 pointer-events-none",children:g.jsx("div",{className:"w-full h-1/2 bg-gradient-to-b from-transparent to-emerald-400/30 absolute top-0 animate-[scan_2.5s_linear_infinite]"})})]})]}),g.jsxs("div",{className:"flex flex-col items-center space-y-6 max-w-sm w-full",children:[g.jsx("div",{className:"flex items-center gap-2 w-full justify-center",children:[1,2,3].map(r=>g.jsxs("div",{className:"flex items-center",children:[g.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${i.step>=r?"w-8 bg-emerald-500":"w-2 bg-stone-200 dark:bg-stone-800"}`}),r<3&&g.jsx("div",{className:"w-1"})]},r))}),g.jsx("div",{className:"h-12 flex items-center justify-center text-center",children:g.jsx("p",{className:"text-sm font-medium text-stone-600 dark:text-stone-300 transition-all duration-300 animate-in slide-in-from-bottom-2 fade-in",children:i.text})}),g.jsx("div",{className:"w-full h-1 bg-stone-200 dark:bg-stone-800 rounded-full overflow-hidden relative shadow-inner",children:g.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-400 via-teal-300 to-emerald-500 rounded-full transition-all duration-700 ease-out",style:{width:`${i.progress}%`}})})]}),g.jsxs("div",{className:"grid grid-cols-3 gap-12 text-stone-400 dark:text-stone-600 pt-4",children:[g.jsxs("div",{className:`flex flex-col items-center gap-2 transition-all duration-500 ${e==="fetching"?"text-emerald-500 scale-110":""}`,children:[g.jsx(ap,{size:16}),g.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold",children:"Fetch"})]}),g.jsxs("div",{className:`flex flex-col items-center gap-2 transition-all duration-500 ${e==="analyzing"?"text-emerald-500 scale-110":""}`,children:[g.jsx(ud,{size:16}),g.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold",children:"Scan"})]}),g.jsxs("div",{className:`flex flex-col items-center gap-2 transition-all duration-500 ${e==="filtering"?"text-emerald-500 scale-110":""}`,children:[g.jsx(sp,{size:16}),g.jsx("span",{className:"text-[10px] uppercase tracking-wider font-semibold",children:"Filter"})]})]}),g.jsx("style",{children:`
            @keyframes scan {
                0% { transform: translateY(-100%); }
                100% { transform: translateY(200%); }
            }
        `})]})},BB=({isOpen:t,onClose:e,result:n,isLoading:i,originalText:s})=>{if(!t)return null;const r=o=>{switch(o){case"True":return{color:"text-emerald-600",bg:"bg-emerald-50 dark:bg-emerald-900/30",border:"border-emerald-200 dark:border-emerald-800",icon:uL};case"False":return{color:"text-red-600",bg:"bg-red-50 dark:bg-red-900/30",border:"border-red-200 dark:border-red-800",icon:mL};case"Misleading":return{color:"text-orange-600",bg:"bg-orange-50 dark:bg-orange-900/30",border:"border-orange-200 dark:border-orange-800",icon:op};case"Opinion":return{color:"text-blue-600",bg:"bg-blue-50 dark:bg-blue-900/30",border:"border-blue-200 dark:border-blue-800",icon:$o};default:return{color:"text-stone-600",bg:"bg-stone-50 dark:bg-stone-800",border:"border-stone-200 dark:border-stone-700",icon:fL}}},a=r(n?n.verdict:"Unverified"),l=a.icon;return g.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in",onClick:e}),g.jsxs("div",{className:"bg-white dark:bg-stone-900 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-stone-200 dark:border-stone-700 animate-scale-in relative z-10 flex flex-col max-h-[85vh]",children:[g.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-stone-100 dark:border-stone-800 bg-stone-50 dark:bg-stone-900/50",children:[g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx($o,{size:20,className:"text-emerald-600 dark:text-emerald-400"}),g.jsx("h2",{className:"font-bold text-stone-800 dark:text-stone-100",children:"Zen Fact Check"})]}),g.jsx("button",{onClick:e,className:"p-1.5 rounded-full hover:bg-stone-200 dark:hover:bg-stone-800 transition-colors",children:g.jsx(qs,{size:20,className:"text-stone-500"})})]}),g.jsxs("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:[g.jsxs("div",{className:"mb-6 relative",children:[g.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-stone-300 dark:bg-stone-700 rounded-full"}),g.jsxs("p",{className:"pl-4 text-sm text-stone-600 dark:text-stone-300 italic line-clamp-4",children:['"',s,'"']})]}),i?g.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[g.jsxs("div",{className:"relative",children:[g.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-emerald-100 dark:border-emerald-900 border-t-emerald-500 animate-spin"}),g.jsx($o,{size:20,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-emerald-500"})]}),g.jsx("p",{className:"text-sm font-medium text-stone-500 animate-pulse",children:"Researching claims..."})]}):n?g.jsxs("div",{className:"space-y-6",children:[g.jsxs("div",{className:`flex items-center gap-3 p-4 rounded-xl border ${a.bg} ${a.border}`,children:[g.jsx(l,{size:32,className:a.color}),g.jsxs("div",{children:[g.jsx("h3",{className:`font-bold text-lg ${a.color}`,children:n.verdict}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400 font-medium opacity-80",children:"AI Assessment"})]})]}),g.jsxs("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:[g.jsx("h4",{className:"text-xs font-bold uppercase text-stone-400 tracking-wider mb-2",children:"Analysis"}),g.jsx("div",{className:"text-stone-800 dark:text-stone-200 leading-relaxed whitespace-pre-wrap",children:n.explanation})]}),n.sources.length>0&&g.jsxs("div",{children:[g.jsx("h4",{className:"text-xs font-bold uppercase text-stone-400 tracking-wider mb-3",children:"References"}),g.jsx("ul",{className:"space-y-2",children:n.sources.map((o,u)=>g.jsx("li",{children:g.jsxs("a",{href:o.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-start gap-2 p-3 rounded-lg bg-stone-50 dark:bg-stone-800 hover:bg-stone-100 dark:hover:bg-stone-700 border border-stone-100 dark:border-stone-700 transition-colors group",children:[g.jsx(js,{size:14,className:"mt-0.5 text-stone-400 group-hover:text-emerald-500 shrink-0"}),g.jsxs("div",{className:"flex flex-col",children:[g.jsx("span",{className:"text-sm font-medium text-stone-700 dark:text-stone-300 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 leading-snug",children:o.title}),g.jsx("span",{className:"text-xs text-stone-400 truncate max-w-[250px] mt-0.5",children:new URL(o.uri).hostname})]})]})},u))})]}),g.jsx("div",{className:"text-[10px] text-stone-400 text-center pt-2",children:"Automated fact-checking via OpenRouter AI. Results may vary."})]}):g.jsxs("div",{className:"text-center py-8 text-stone-500",children:[g.jsx(op,{className:"mx-auto mb-2 text-stone-400",size:24}),g.jsx("p",{children:"Unable to verify this comment."})]})]})]})]})},_T=Ll.createContext({isCollapsed:()=>!1,setCollapsed:()=>{},onFactCheck:()=>{}}),UB=t=>{const e=["bg-red-500","bg-orange-500","bg-amber-500","bg-green-500","bg-emerald-500","bg-teal-500","bg-cyan-500","bg-sky-500","bg-blue-500","bg-indigo-500","bg-violet-500","bg-purple-500","bg-fuchsia-500","bg-pink-500","bg-rose-500"];let n=0;for(let i=0;i<t.length;i++)n=t.charCodeAt(i)+((n<<5)-n);return e[Math.abs(n)%e.length]},LT=t=>t?t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&nbsp;/g," "):"",jB=()=>{navigator.vibrate&&navigator.vibrate(5)},$B=t=>{if(t.length<50)return!1;const e=/https?:\/\//.test(t),n=/\d/.test(t),i=/["][^"]+["]/.test(t);return e||n||i||/\b(source|evidence|study|report|data|stats|statistic|research|proven|official|according|history|science|law|legal|policy|released|announced|percent|%|dollar|cost|price|rate|increase|decrease|truth|false|fake|real|actually|fact)\b/i.test(t)},RT=({text:t,bgColor:e,textColor:n,className:i=""})=>{if(!t)return null;const s=e&&e!=="transparent"&&e!=="",r=n==="light",a={backgroundColor:s?e:void 0};return g.jsx("span",{style:a,className:`
        inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-bold uppercase tracking-tight 
        ${s?"":"bg-stone-200 dark:bg-stone-800 text-stone-600 dark:text-stone-400"} 
        ${s&&r?"text-white shadow-[inset_0_0_0_1px_rgba(255,255,255,0.2),0_1px_2px_rgba(0,0,0,0.1)]":""} 
        ${s&&!r?"text-stone-900 shadow-[inset_0_0_0_1px_rgba(0,0,0,0.1)]":""} 
        ${i} whitespace-nowrap leading-none border border-black/5 dark:border-white/5
      `,children:LT(t)})},zB=t=>{const e=/(https?:\/\/[^\s]+)/g;return(t.match(e)||[]).map(i=>i.replace(/[)\]]+$/,"")).map(i=>i.match(/\.gifv$/i)?i.replace(/\.gifv$/i,".mp4"):i).filter(i=>{const s=i.toLowerCase(),a=s.split("?")[0].match(/\.(jpeg|jpg|png|gif|webp|bmp|mp4|webm|mov)$/),l=s.includes("preview.redd.it")||s.includes("i.redd.it")||s.includes("external-preview.redd.it"),o=s.includes("giphy.com/media")||s.includes("media.giphy.com"),u=s.includes("i.imgur.com");return a||l||o||u})},wT=P.memo(({content:t,onNavigateSub:e,onInternalLinkClick:n,textSize:i})=>{const s={small:"prose-sm",medium:"prose-base",large:"prose-lg"}[i],r=P.useMemo(()=>t?t.replace(/(^|[\s])(\/?r\/[A-Za-z0-9_]+)\b/g,(a,l,o)=>{const u=o.startsWith("/")?o:`/${o}`;return`${l}[${o}](${u})`}):"",[t]);return g.jsx("div",{className:`prose prose-stone dark:prose-invert ${s} max-w-none break-words leading-relaxed opacity-90`,children:g.jsx(AF,{remarkPlugins:[FB],components:{a:({node:a,href:l,...o})=>{const u=l==null?void 0:l.match(/^(?:https?:\/\/(?:www\.|old\.|new\.)?reddit\.com)?(\/r\/[A-Za-z0-9_]+(?:\/comments\/[A-Za-z0-9]+)?\/?)?/);return l!=null&&l.match(/^(\/)?r\/([^/]+)/)||(l==null||l.match(/^https?:\/\/(www\.)?reddit\.com\/r\/([^/]+)/)),n&&u&&(u[1]||l!=null&&l.startsWith("/r/"))?g.jsx("a",{...o,href:l,onClick:c=>{c.preventDefault(),l&&n(l)},className:"text-emerald-600 dark:text-emerald-400 hover:underline font-medium cursor-pointer"}):g.jsx("a",{...o,href:l,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline"})},p:({node:a,...l})=>g.jsx("p",{...l,className:"mb-2 last:mb-0"}),img:({node:a,...l})=>g.jsx("span",{className:"hidden",children:"Image hidden in markdown (shown in media grid)"}),table:({node:a,...l})=>g.jsx("div",{className:"overflow-x-auto my-2 rounded-lg border border-stone-200 dark:border-stone-700",children:g.jsx("table",{...l,className:"table-auto w-full text-sm"})}),th:({node:a,...l})=>g.jsx("th",{...l,className:"px-3 py-2 bg-stone-100 dark:bg-stone-800 font-semibold text-left"}),td:({node:a,...l})=>g.jsx("td",{...l,className:"px-3 py-2 border-t border-stone-100 dark:border-stone-800"}),blockquote:({node:a,...l})=>g.jsx("blockquote",{...l,className:"border-l-4 border-emerald-500/30 pl-3 py-1 my-2 text-stone-500 dark:text-stone-400 italic bg-stone-50 dark:bg-stone-800/20 rounded-r"}),pre:({node:a,...l})=>g.jsx("div",{className:"overflow-x-auto my-2 bg-stone-100 dark:bg-stone-800 rounded-lg border border-stone-200 dark:border-stone-700",children:g.jsx("pre",{...l,className:"p-3 text-xs"})})},children:r})})}),GB=({items:t,onImageClick:e})=>{const[n,i]=P.useState(0),[s,r]=P.useState(0),[a,l]=P.useState(!1),o=P.useRef(null),u=y=>{l(!1),o.current=y.targetTouches[0].clientX},c=y=>{if(o.current===null)return;const p=y.targetTouches[0].clientX-o.current;n===0&&p>0||n===t.length-1&&p<0?r(p*.3):r(p)},d=()=>{o.current!==null&&(l(!0),Math.abs(s)>80&&(s>0&&n>0?i(y=>y-1):s<0&&n<t.length-1&&i(y=>y+1)),r(0),o.current=null)},f=y=>{y.stopPropagation(),l(!0),n>0&&i(x=>x-1)},h=y=>{y.stopPropagation(),l(!0),n<t.length-1&&i(x=>x+1)},m=t[n];return m?g.jsxs("div",{className:"relative w-full bg-stone-100 dark:bg-stone-900 rounded-xl overflow-hidden mb-6 group select-none shadow-sm border border-stone-200 dark:border-stone-800",onTouchStart:u,onTouchMove:c,onTouchEnd:d,children:[g.jsxs("div",{className:"relative overflow-hidden min-h-[300px] md:min-h-[400px] bg-stone-100 dark:bg-stone-950",children:[g.jsx("div",{className:"flex h-full w-full",style:{transform:`translateX(calc(-${n*100}% + ${s}px))`,transition:a?"transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)":"none"},children:t.map((y,x)=>g.jsx("div",{className:"w-full h-full flex-shrink-0 flex items-center justify-center p-0.5",children:g.jsx("img",{src:y.src,alt:y.caption||`Image ${x+1}`,className:"max-h-[70vh] w-full object-contain cursor-zoom-in",loading:Math.abs(x-n)<=1?"eager":"lazy",draggable:!1,onClick:()=>e&&e(x)})},y.id||x))}),n>0&&g.jsx("button",{onClick:f,className:"absolute left-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 hover:bg-black/60 text-white rounded-full backdrop-blur-md transition-all opacity-0 group-hover:opacity-100 hidden md:flex items-center justify-center transform hover:scale-110 active:scale-95",title:"Previous Image",children:g.jsx(Im,{size:28})}),n<t.length-1&&g.jsx("button",{onClick:h,className:"absolute right-4 top-1/2 -translate-y-1/2 p-2 bg-black/40 hover:bg-black/60 text-white rounded-full backdrop-blur-md transition-all opacity-0 group-hover:opacity-100 hidden md:flex items-center justify-center transform hover:scale-110 active:scale-95",title:"Next Image",children:g.jsx(C1,{size:28})})]}),g.jsx("div",{className:"bg-white dark:bg-stone-900 p-3 text-sm text-stone-600 dark:text-stone-300 border-t border-stone-100 dark:border-stone-800 transition-opacity duration-300",children:m.caption||g.jsx("span",{children:""})}),g.jsxs("div",{className:"absolute top-3 right-3 bg-black/60 text-white px-2.5 py-1 rounded-full text-xs font-semibold backdrop-blur-sm flex items-center gap-1.5 shadow-sm pointer-events-none",children:[g.jsx(O1,{size:12}),n+1," / ",t.length]}),t.length>1&&t.length<=15&&g.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1.5 pointer-events-none z-10",children:t.map((y,x)=>g.jsx("div",{className:`w-1.5 h-1.5 rounded-full transition-all shadow-sm ${x===n?"bg-white scale-125 w-3":"bg-white/40"}`},x))})]}):null},CT=P.memo(({comment:t,depth:e=0,onNavigateSub:n,textSize:i,opAuthor:s,toxicityAnalysis:r,linkId:a,subreddit:l,onInternalLinkClick:o})=>{const{isCollapsed:u,setCollapsed:c,onFactCheck:d,onNavigateUser:f}=P.useContext(_T),[h,m]=P.useState(()=>u(t.data.id)),[y,x]=P.useState(5),[p,v]=P.useState(!1),[b,E]=P.useState([]),[k,_]=P.useState(!1),[L,C]=P.useState(!1),[w,A]=P.useState(null),I=t.data,N=I.author===s,V=r==null?void 0:r.isToxic,G=P.useMemo(()=>r?!!r.isFactCheckable:$B(I.body),[r,I.body]);P.useEffect(()=>{I.replies&&typeof I.replies!="string"&&I.replies.data?E(I.replies.data.children):E([]),_(!0)},[I.replies]);const $=async F=>{C(!0),A(null);try{if(F.data.count===0||F.data.children&&F.data.children.length===1){const B=F.data.children[0],Y=`/comments/${a.startsWith("t3_")?a.substring(3):a}/_/${B}`,X=await $1(Y);E(Z=>{const le=Z.findIndex(fe=>fe.data.id===F.data.id);if(le===-1)return Z;const se=[...Z];return X.length>0&&se.splice(le,1,...X),se})}else{const B=await HR(a,F.data.children);E(T=>{const Y=T.findIndex(Z=>Z.data.id===F.data.id);if(Y===-1)return T;const X=[...T];return X.splice(Y,1,...B),X})}}catch(B){console.error("Failed to load more comments",B),A("Failed to load. Click to open in Reddit.")}finally{C(!1)}};if(I.author==="[deleted]")return null;const D=P.useMemo(()=>{const F=zB(I.body);return I.media_metadata&&Object.values(I.media_metadata).forEach(B=>{if(B.status==="valid"&&B.s){let T=B.s.gif||B.s.mp4||B.s.u;T&&(T=T.replace(/&amp;/g,"&"),F.push(T))}}),Array.from(new Set(F))},[I.body,I.media_metadata]),j=F=>{F.stopPropagation(),jB();const B=!h;m(B),c(I.id,B)},U=F=>{F.stopPropagation(),x(B=>B+5)},q=F=>{F.stopPropagation(),x(b.length)};if(V&&!p)return g.jsx("div",{className:"mt-4 border border-stone-200 dark:border-stone-800 rounded-lg p-3 bg-stone-50 dark:bg-stone-900/30 animate-list-enter",children:g.jsxs("div",{className:"flex items-center justify-between",children:[g.jsxs("div",{className:"flex items-center gap-2 text-stone-500 dark:text-stone-400",children:[g.jsx(Qf,{size:16,className:"text-orange-500"}),g.jsxs("span",{className:"text-xs font-medium",children:["Comment hidden by Zen Shield ",r!=null&&r.reason?`(${r.reason})`:""]})]}),g.jsxs("button",{onClick:()=>v(!0),className:"flex items-center gap-1.5 text-[10px] font-bold uppercase tracking-wider text-stone-400 hover:text-stone-600 dark:hover:text-stone-300 transition-colors btn-press",children:[g.jsx(AL,{size:12}),"View"]})]})});const R=b.length>0;return g.jsxs("div",{className:`flex flex-col ${e===0?"mt-4 border-b border-stone-100 dark:border-stone-800 pb-4":"mt-4"}`,children:[g.jsxs("div",{onClick:j,className:"flex items-center gap-2 cursor-pointer group select-none py-1",children:[g.jsx("div",{className:`w-6 h-6 rounded-full shrink-0 flex items-center justify-center text-[10px] text-white font-bold shadow-sm ${UB(I.author)} ${h?"opacity-50":""}`,children:h?g.jsx(gl,{size:14,className:"text-white"}):I.author.substring(0,1).toUpperCase()}),g.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-stone-500 dark:text-stone-400 overflow-hidden flex-wrap",children:[g.jsx("span",{className:`font-bold truncate ${N?"text-blue-600 dark:text-blue-400":"text-stone-700 dark:text-stone-300"} ${h?"text-stone-500":""} hover:underline cursor-pointer`,onClick:F=>{f&&!h&&(F.stopPropagation(),f(I.author))},children:I.author}),N&&g.jsx("span",{className:"text-[9px] font-bold text-blue-600 bg-blue-50 dark:bg-blue-900/30 px-1 rounded border border-blue-100 dark:border-blue-900/50",children:"OP"}),I.author_flair_text&&!h&&g.jsx(RT,{text:I.author_flair_text,bgColor:I.author_flair_background_color,textColor:I.author_flair_text_color,className:"opacity-70 scale-90 origin-left"}),!h&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"text-stone-300 dark:text-stone-600",children:""}),g.jsx("span",{children:yl(new Date(I.created_utc*1e3),{addSuffix:!1}).replace("about ","").replace(" hours","h")})]}),h&&g.jsx("span",{className:"ml-1 text-[10px] bg-stone-100 dark:bg-stone-800 px-2 py-0.5 rounded-full text-stone-500 font-medium",children:R?`${b.length} replies`:"collapsed"}),V&&p&&g.jsx("span",{className:"ml-1 text-[10px] bg-orange-100 text-orange-600 px-1.5 py-0.5 rounded border border-orange-200",children:"Toxic Content"})]})]}),g.jsxs("div",{className:`flex transition-all duration-300 ${h?"hidden":"block"}`,children:[g.jsx("div",{className:"w-6 flex justify-center shrink-0 cursor-pointer group/line",onClick:j,children:g.jsx("div",{className:"w-full h-full bg-transparent border-l-2 border-stone-100 dark:border-stone-800 group-hover/line:border-emerald-400 dark:group-hover/line:border-emerald-600/50 transition-colors my-1 ml-[50%]"})}),g.jsxs("div",{className:"flex-1 min-w-0 pb-1 pr-1 pl-1",children:[g.jsx("div",{className:"pt-0.5 pb-2 text-stone-800 dark:text-stone-200",children:g.jsx(wT,{content:I.body,onNavigateSub:n,onInternalLinkClick:o,textSize:i})}),D.length>0&&g.jsx("div",{className:"mt-2 mb-3 flex flex-wrap gap-2",children:D.map((F,B)=>{const T=F.match(/\.(mp4|webm|mov)(\?|$)/i);return g.jsx("div",{className:"relative rounded-lg overflow-hidden bg-stone-100 dark:bg-stone-900 border border-stone-200 dark:border-stone-700 max-w-full md:max-w-md shadow-sm",children:T?g.jsx("video",{src:F,controls:!0,loop:!0,muted:!0,playsInline:!0,className:"max-h-60 w-auto bg-black"}):g.jsx("img",{src:F.replace(/&amp;/g,"&"),alt:"media",className:"max-h-60 object-contain w-auto",loading:"lazy"})},B)})}),g.jsxs("div",{className:"flex items-center gap-4 mb-2 select-none",children:[g.jsxs("div",{className:"flex items-center gap-1 text-stone-500 dark:text-stone-400 text-xs font-bold",children:[g.jsx(Cu,{size:18,className:`${I.score>0?"text-orange-500":""}`,strokeWidth:2}),g.jsx("span",{children:I.score})]}),g.jsxs("button",{className:"flex items-center gap-1.5 text-stone-400 hover:text-stone-600 dark:hover:text-stone-300 text-xs font-medium transition-colors btn-press",children:[g.jsx(Ys,{size:14}),g.jsx("span",{children:"Reply"})]}),G&&g.jsxs("button",{onClick:F=>{F.stopPropagation(),d(I.body,l)},className:"flex items-center gap-1.5 text-stone-400 hover:text-emerald-600 dark:hover:text-emerald-400 text-xs font-medium transition-colors btn-press",title:"Fact Check with AI",children:[g.jsx($o,{size:14}),g.jsx("span",{children:"Fact Check"})]}),g.jsx("button",{className:"p-1 text-stone-300 hover:text-stone-500 dark:text-stone-600 dark:hover:text-stone-400 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 transition-colors btn-press",children:g.jsx(SL,{size:14})})]}),R&&g.jsxs("div",{className:"mt-1",children:[b.slice(0,y).map(F=>F.kind==="t1"?g.jsx(CT,{comment:F,depth:e+1,onNavigateSub:n,textSize:i,opAuthor:s,toxicityAnalysis:r,linkId:a,subreddit:l,onInternalLinkClick:o},F.data.id):F.kind==="more"?g.jsx("div",{className:"mt-3 ml-1 text-xs",children:L?g.jsxs("div",{className:"flex items-center gap-2 text-stone-400",children:[g.jsx(hc,{size:12,className:"animate-spin"}),g.jsx("span",{children:"Loading more comments..."})]}):w?g.jsxs("a",{href:`https://reddit.com${t.data.permalink||""}`,target:"_blank",rel:"noreferrer",className:"text-red-500 hover:underline flex items-center gap-1",children:[g.jsx(js,{size:12}),w]}):g.jsxs("button",{onClick:()=>$(F),className:"text-emerald-600 dark:text-emerald-500 font-medium hover:underline flex items-center gap-1.5 py-1",children:[g.jsx(xL,{size:14}),F.data.count===0?"Continue this thread...":`Load ${F.data.count} more replies...`]})},F.data.id):null),b.length>y&&g.jsxs("div",{className:"mt-3 ml-1 flex items-center gap-3",children:[g.jsxs("button",{onClick:U,className:"text-xs font-bold text-stone-500 hover:text-emerald-600 dark:text-stone-400 dark:hover:text-emerald-400 flex items-center gap-1.5 py-1 px-3 bg-stone-100 dark:bg-stone-800 rounded-full transition-colors btn-press",children:[g.jsx(gl,{size:12}),"Show ",Math.min(5,b.length-y)," more"]}),b.length-y>5&&g.jsxs("button",{onClick:q,className:"text-xs text-stone-400 hover:text-stone-600 dark:hover:text-stone-300 underline",children:["Show all (",b.length-y,")"]})]})]})]})]})]})}),HB=({post:t,onClose:e,onNavigateSub:n,onNavigateUser:i,textSize:s,aiConfig:r,onCommentsBlocked:a,onImageClick:l,onInternalLinkClick:o})=>{const[u,c]=P.useState([]),[d,f]=P.useState(!0),[h,m]=P.useState(!1),[y,x]=P.useState({}),[p,v]=P.useState("confidence"),[b,E]=P.useState(!1),[k,_]=P.useState(null),[L,C]=P.useState(""),[w,A]=P.useState(!1),I=P.useRef(null),N=P.useRef(null),V=P.useRef(null),G=P.useRef(new Set),$=P.useMemo(()=>Object.values(y).filter(te=>te.isToxic).length,[y]),D=P.useCallback(te=>G.current.has(te),[]),j=P.useCallback((te,ge)=>{ge?G.current.add(te):G.current.delete(te)},[]),U=P.useCallback(async(te,ge)=>{C(te),A(!0),E(!0),_(null);try{const Ce=r.openRouterKey||void 0,Fe=await Gw(te,ge,Ce,r.openRouterModel);_(Fe)}catch(Ce){console.error("Fact check UI failed",Ce)}finally{E(!1)}},[r]),q=P.useMemo(()=>({isCollapsed:D,setCollapsed:j,onFactCheck:U,onNavigateUser:i}),[D,j,U,i]),[R,F]=P.useState(!1),[B,T]=P.useState(!1);P.useEffect(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),P.useEffect(()=>{(async()=>{f(!0);const ge=await $1(t.permalink,p);c(ge),f(!1);const Ce=ge.filter(Fe=>Fe.kind==="t1");if(r.analyzeComments&&Ce.length>0&&(r.openRouterKey||void 0)){m(!0);try{const ft=await zw(Ce,r,{title:t.title,subreddit:t.subreddit,selftext:t.selftext}),et={};ft.forEach(be=>et[be.id]=be),x(et);const ae=ft.filter(be=>be.isToxic).length;ae>0&&a(ae)}catch(ft){console.warn("Comment analysis failed",ft)}finally{m(!1)}}})()},[t.permalink,r,p]),P.useEffect(()=>{var Ce;const te=(Ce=t.secure_media)==null?void 0:Ce.reddit_video;if(!te||!I.current)return;const ge=I.current;if(F(!1),T(!1),pn.isSupported()&&te.hls_url){N.current&&N.current.destroy();const Fe=new pn({enableWebVTT:!0,capLevelToPlayerSize:!0});N.current=Fe,Fe.on(pn.Events.SUBTITLE_TRACKS_UPDATED,()=>{F(Fe.subtitleTracks.length>0),T(Fe.subtitleTrack!==-1)}),Fe.loadSource(te.hls_url),Fe.attachMedia(ge)}else ge.canPlayType("application/vnd.apple.mpegurl")&&te.hls_url?ge.src=te.hls_url:ge.src=te.fallback_url;return()=>{N.current&&(N.current.destroy(),N.current=null)}},[t.secure_media]);const Y=()=>{N.current&&(B?(N.current.subtitleTrack=-1,T(!1)):(N.current.subtitleTrack=0,T(!0)))},X=te=>{if(!te)return"";const ge=document.createElement("textarea");return ge.innerHTML=te,ge.value},Z=()=>{if(!V.current)return;const te=V.current,ge=te.querySelectorAll('[data-parent-comment="true"]'),Ce=te.getBoundingClientRect();for(let Fe=0;Fe<ge.length;Fe++){const et=ge[Fe].getBoundingClientRect();if(et.top>Ce.top+60){const ae=et.top-Ce.top;te.scrollTo({top:te.scrollTop+ae-20,behavior:"smooth"});return}}},le=()=>{if(!V.current)return;const te=V.current,ge=Array.from(te.querySelectorAll('[data-parent-comment="true"]')),Ce=te.getBoundingClientRect(),Fe=5;for(let ft=ge.length-1;ft>=0;ft--){const ae=ge[ft].getBoundingClientRect();if(ae.top<Ce.top-Fe){const be=ae.top-Ce.top;te.scrollTo({top:te.scrollTop+be-20,behavior:"smooth"});return}}},se=()=>{var ge;const te=(ge=t.secure_media)==null?void 0:ge.reddit_video;return te?{src:t.thumbnail&&t.thumbnail.startsWith("http")?t.thumbnail:"",caption:t.title,id:t.id,type:"video",videoSources:{hls:te.hls_url,mp4:te.fallback_url}}:null},fe=()=>{var te,ge,Ce,Fe,ft;if((te=t.secure_media)!=null&&te.reddit_video)return g.jsxs("div",{className:"relative mb-6 mx-auto w-full bg-black md:rounded-xl shadow-lg max-h-[60vh] group",children:[g.jsx("video",{ref:I,controls:!0,className:"w-full h-full object-contain max-h-[60vh] md:rounded-xl",playsInline:!0,poster:t.thumbnail&&t.thumbnail.startsWith("http")?t.thumbnail:void 0}),g.jsx("button",{onClick:et=>{et.stopPropagation();const ae=se();ae&&l([ae],0)},className:"absolute top-4 left-4 z-10 p-2 rounded-full bg-black/50 text-white hover:bg-black/70 backdrop-blur-md transition-opacity opacity-0 group-hover:opacity-100",title:"Fullscreen",children:g.jsx(F1,{size:20})}),R&&g.jsx("button",{onClick:Y,className:`absolute top-4 right-4 z-10 p-2 rounded-full backdrop-blur-md transition-colors ${B?"bg-emerald-600 text-white":"bg-black/60 text-white hover:bg-black/80"}`,title:"Toggle Captions",children:g.jsx(w1,{size:20})})]});if(t.is_gallery&&t.gallery_data&&t.media_metadata){const et=t.gallery_data.items.map(ae=>{var Ot,ht;const be=t.media_metadata[ae.media_id];let lt=((Ot=be==null?void 0:be.s)==null?void 0:Ot.u)||((ht=be==null?void 0:be.s)==null?void 0:ht.gif);return lt?(lt=lt.replace(/&amp;/g,"&"),{id:ae.id,src:lt,caption:ae.caption}):null}).filter(ae=>ae!==null);if(et.length>0)return g.jsx(GB,{items:et,onImageClick:ae=>l(et.map(be=>({...be,type:"image"})),ae)})}if(t.url&&t.url.match(/\.(jpg|jpeg|png|gif|webp)$/i))return g.jsx("img",{src:t.url,alt:t.title,className:"w-full md:rounded-xl mb-6 object-contain max-h-[60vh] bg-stone-100 dark:bg-stone-900 shadow-sm cursor-zoom-in",onClick:()=>l([{src:t.url,caption:t.title,id:t.id,type:"image"}],0)});if((ft=(Fe=(Ce=(ge=t.preview)==null?void 0:ge.images)==null?void 0:Ce[0])==null?void 0:Fe.source)!=null&&ft.url){const et=t.preview.images[0].source.url.replace(/&amp;/g,"&"),ae=t.url.includes("imgur.com/a/")||t.url.includes("imgur.com/gallery/");return g.jsxs("div",{className:"relative mb-6 group inline-block w-full",children:[g.jsx("img",{src:et,alt:t.title,className:"w-full md:rounded-xl object-contain max-h-[60vh] bg-stone-100 dark:bg-stone-900 shadow-sm cursor-zoom-in",onClick:()=>l([{src:et,caption:t.title,id:t.id,type:"image"}],0)}),ae&&g.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"absolute bottom-4 right-4 bg-stone-900/80 text-white px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 hover:bg-black transition-colors backdrop-blur-sm shadow-lg",children:[g.jsx(js,{size:14}),"View Album"]})]})}return t.url&&!t.url.includes("reddit.com")?g.jsxs("a",{href:t.url,target:"_blank",rel:"noreferrer",className:"flex items-center p-4 bg-stone-50 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 md:rounded-xl mb-6 text-blue-600 dark:text-blue-400 hover:bg-stone-100 dark:hover:bg-stone-750 transition-colors group mx-4 md:mx-0",children:[g.jsx("div",{className:"bg-blue-100 dark:bg-blue-900/30 p-2 rounded-lg mr-3 group-hover:scale-110 transition-transform",children:g.jsx(js,{className:"shrink-0",size:20})}),g.jsxs("div",{className:"flex flex-col min-w-0",children:[g.jsx("span",{className:"font-semibold text-sm text-stone-900 dark:text-stone-100 truncate",children:t.domain}),g.jsx("span",{className:"truncate text-xs text-stone-500 dark:text-stone-400",children:t.url})]})]}):null};return g.jsx(_T.Provider,{value:q,children:g.jsxs("div",{className:"fixed inset-0 z-[60] flex items-end md:items-center justify-center animate-fade-smooth",onClick:e,children:[g.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-md animate-fade-in"}),g.jsxs("div",{className:"bg-white dark:bg-stone-950 w-full md:max-w-6xl lg:max-w-7xl h-[100dvh] md:h-[90vh] md:rounded-2xl shadow-2xl flex flex-col overflow-hidden md:border border-stone-200 dark:border-stone-800 animate-modal-spring relative z-10",onClick:te=>te.stopPropagation(),children:[g.jsx("div",{className:"sticky top-0 z-20 shrink-0 border-b border-stone-200 dark:border-stone-800 bg-white/90 dark:bg-stone-950/90 backdrop-blur-md pt-safe",children:g.jsxs("div",{className:"flex items-center justify-between px-3 md:px-4 py-3",children:[g.jsxs("div",{className:"flex items-center gap-3 overflow-hidden flex-1",children:[g.jsx("button",{onClick:e,className:"p-2 -ml-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors shrink-0 md:hidden btn-press",children:g.jsx(Im,{size:24,className:"text-stone-800 dark:text-stone-200"})}),g.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[g.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-full bg-emerald-100 dark:bg-emerald-900/30 flex items-center justify-center shrink-0 text-emerald-600 dark:text-emerald-400 font-bold text-sm md:text-base cursor-pointer",onClick:()=>n&&n(t.subreddit),children:"r/"}),g.jsxs("div",{className:"flex flex-col min-w-0 justify-center",children:[g.jsx("button",{onClick:()=>n&&n(t.subreddit),className:"font-bold text-stone-900 dark:text-stone-100 truncate text-sm md:text-base hover:text-emerald-600 dark:hover:text-emerald-400 text-left transition-colors leading-tight",children:t.subreddit}),g.jsxs("div",{className:"text-xs text-stone-500 dark:text-stone-400 truncate flex items-center gap-1.5 leading-tight opacity-80",children:[g.jsx("span",{className:"hidden sm:inline",children:"Posted by"}),g.jsxs("span",{className:"hover:underline cursor-pointer hover:text-stone-800 dark:hover:text-stone-200",onClick:te=>{i&&(te.stopPropagation(),i(t.author))},children:["u/",t.author]}),g.jsx("span",{className:"text-stone-300 dark:text-stone-700",children:""}),g.jsxs("span",{className:"shrink-0",children:[yl(new Date(t.created_utc*1e3)).replace("about ","").replace(" hours","h")," ago"]})]})]})]})]}),g.jsx("button",{onClick:e,className:"hidden md:block p-2 hover:bg-stone-100 dark:hover:bg-stone-800 rounded-full transition-colors shrink-0 btn-press ml-2",children:g.jsx(qs,{size:24,className:"text-stone-500 dark:text-stone-400"})})]})}),g.jsx("div",{ref:V,className:"flex-1 overflow-y-auto overflow-x-hidden bg-white dark:bg-stone-950 relative",children:g.jsxs("div",{className:"md:p-8 md:pb-20 max-w-5xl mx-auto pb-safe",children:[g.jsxs("div",{className:"mb-4 md:mb-6 px-4 md:px-0 pt-4 md:pt-0",children:[g.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[t.link_flair_text&&g.jsx(RT,{text:t.link_flair_text,bgColor:t.link_flair_background_color,textColor:t.link_flair_text_color}),t.isRageBait&&g.jsxs("span",{className:"text-[10px] font-bold uppercase tracking-wider text-red-500 bg-red-50 dark:bg-red-900/20 px-1.5 py-0.5 rounded border border-red-100 dark:border-red-900/30 flex items-center gap-1",children:[g.jsx(Qf,{size:10}),"Rage Bait"]}),t.zenScore!==void 0&&g.jsx(Wf,{score:t.zenScore,size:"md"})]}),g.jsx("h1",{className:"text-lg md:text-2xl font-bold text-stone-900 dark:text-stone-100 leading-snug mb-4",children:LT(t.title)}),fe(),t.selftext&&g.jsx("div",{className:"mb-6 p-4 md:p-5 bg-stone-50 dark:bg-stone-900/50 md:rounded-xl border-y md:border border-stone-100 dark:border-stone-800 -mx-4 md:mx-0",children:g.jsx(wT,{content:X(t.selftext),onNavigateSub:n,onInternalLinkClick:o,textSize:s})}),g.jsxs("div",{className:"flex items-center justify-between gap-3 text-stone-500 dark:text-stone-400 border-y border-stone-100 dark:border-stone-800/50 py-3 mb-6 bg-stone-50/50 dark:bg-stone-900/30 md:rounded-lg px-3 md:px-4 -mx-4 md:mx-0",children:[g.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[g.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",title:"Upvotes",children:[g.jsx(Cu,{size:22,className:`${t.score>0?"text-orange-600 dark:text-orange-500":""}`,strokeWidth:2.5}),g.jsx("span",{className:"font-bold text-stone-700 dark:text-stone-300 text-sm md:text-base",children:t.score>1e3?`${(t.score/1e3).toFixed(1)}k`:t.score})]}),g.jsx("div",{className:"w-px h-4 bg-stone-300 dark:bg-stone-700"}),g.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",title:"Comments",children:[g.jsx(Ys,{size:20,className:"text-stone-400 dark:text-stone-500"}),g.jsx("span",{className:"font-bold text-stone-700 dark:text-stone-300 text-sm md:text-base",children:t.num_comments>1e3?`${(t.num_comments/1e3).toFixed(1)}k`:t.num_comments}),g.jsx("span",{className:"hidden md:inline text-sm font-medium",children:"Comments"})]})]}),g.jsxs("a",{href:`https://reddit.com${t.permalink}`,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 bg-stone-200/50 dark:bg-stone-800 hover:bg-emerald-100 dark:hover:bg-emerald-900/30 text-stone-600 dark:text-stone-300 hover:text-emerald-700 dark:hover:text-emerald-400 px-3 py-1.5 rounded-full text-xs md:text-sm font-semibold transition-all",children:[g.jsx("span",{children:"Reddit"}),g.jsx(js,{size:14})]})]})]}),g.jsxs("div",{className:"min-h-[300px] px-4 md:px-0",children:[g.jsxs("div",{className:"flex items-center justify-between mb-4 sticky top-0 bg-white/95 dark:bg-stone-950/95 backdrop-blur-sm py-3 z-10 border-b border-stone-100 dark:border-stone-800/50",children:[g.jsx("h3",{className:"font-bold text-lg text-stone-800 dark:text-stone-200",children:"Discussion"}),g.jsx("div",{className:"relative group",children:g.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-stone-100 dark:bg-stone-800/80 border border-stone-200 dark:border-stone-700 text-xs font-medium text-stone-600 dark:text-stone-300 hover:bg-stone-200 dark:hover:bg-stone-700 transition-colors cursor-pointer",children:[g.jsx(UL,{size:14}),g.jsxs("select",{value:p,onChange:te=>v(te.target.value),className:"appearance-none bg-transparent border-none p-0 pr-4 focus:ring-0 cursor-pointer text-stone-700 dark:text-stone-200 font-semibold",children:[g.jsx("option",{value:"confidence",children:"Best"}),g.jsx("option",{value:"top",children:"Top"}),g.jsx("option",{value:"new",children:"New"}),g.jsx("option",{value:"controversial",children:"Controversial"}),g.jsx("option",{value:"old",children:"Old"}),g.jsx("option",{value:"qa",children:"Q&A"})]}),g.jsx(qf,{size:14,className:"absolute right-3 pointer-events-none text-stone-400"})]})})]}),h&&g.jsxs("div",{className:"mb-4 p-4 bg-emerald-50 dark:bg-emerald-900/10 border border-emerald-100 dark:border-emerald-800/30 rounded-xl flex items-center gap-3 animate-pulse",children:[g.jsx(kT,{mode:"compact"}),g.jsx("span",{className:"text-xs font-medium text-emerald-700 dark:text-emerald-400",children:"Analyzing conversation health..."})]}),$>0&&g.jsxs("div",{className:"mb-6 p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-100 dark:border-orange-800 rounded-lg flex items-center gap-2",children:[g.jsx(Qf,{size:16,className:"text-orange-500"}),g.jsxs("span",{className:"text-xs text-orange-700 dark:text-orange-400 font-medium",children:["Zen Shield active: ",$," toxic comment threads collapsed."]})]}),g.jsxs("div",{className:"space-y-1",children:[d?g.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-stone-400",children:[g.jsx(hc,{size:32,className:"animate-spin mb-3"}),g.jsx("span",{className:"text-sm font-medium",children:"Loading conversation..."})]}):u.map(te=>te.kind==="t1"?g.jsx("div",{"data-parent-comment":"true",children:g.jsx(CT,{comment:te,depth:0,onNavigateSub:n,textSize:s,opAuthor:t.author,toxicityAnalysis:y[te.data.id],linkId:t.name,subreddit:t.subreddit,onInternalLinkClick:o})},te.data.id):null),!d&&u.length===0&&g.jsx("div",{className:"text-center py-16 text-stone-500 dark:text-stone-400 italic bg-stone-50 dark:bg-stone-900/30 rounded-xl",children:"No comments yet. Be the first to start the conversation on Reddit!"})]})]})]})}),g.jsx("div",{className:"absolute bottom-6 right-4 md:right-8 z-30 flex flex-col gap-2 pointer-events-none mb-safe md:mb-0 transition-opacity duration-200 opacity-90 hover:opacity-100",children:g.jsxs("div",{className:"bg-white/80 dark:bg-stone-900/80 backdrop-blur-xl p-1.5 rounded-full shadow-lg border border-white/20 dark:border-white/10 ring-1 ring-black/5 dark:ring-white/5 flex flex-col gap-1 pointer-events-auto",children:[g.jsx("button",{onClick:le,className:"p-3 rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-stone-600 dark:text-stone-300 transition-all active:scale-90 flex items-center justify-center group",title:"Previous Thread",children:g.jsx(aL,{size:22,className:"group-hover:-translate-y-0.5 transition-transform duration-300",strokeWidth:2.5})}),g.jsx("div",{className:"h-px w-4 bg-stone-300/50 dark:bg-stone-700/50 mx-auto"}),g.jsx("button",{onClick:Z,className:"p-3 rounded-full hover:bg-black/5 dark:hover:bg-white/10 text-stone-600 dark:text-stone-300 transition-all active:scale-90 flex items-center justify-center group",title:"Next Thread",children:g.jsx(qf,{size:22,className:"group-hover:translate-y-0.5 transition-transform duration-300",strokeWidth:2.5})})]})}),g.jsx(BB,{isOpen:w,onClose:()=>A(!1),result:k,isLoading:b,originalText:L})]})]})})},VB=Ll.memo(HB),KB=({items:t,initialIndex:e=0,onClose:n})=>{const[i,s]=P.useState(e),[r,a]=P.useState(1),[l,o]=P.useState({x:0,y:0}),[u,c]=P.useState(0),[d,f]=P.useState(!1),[h,m]=P.useState(!1),[y,x]=P.useState(!1),[p,v]=P.useState(!1),b=P.useRef(null),E=P.useRef([]),k=P.useRef(new Map),_=P.useRef(null),L=P.useRef(null),C=P.useRef(1),w=P.useRef(null);P.useEffect(()=>{a(1),o({x:0,y:0}),f(!0)},[i]),P.useEffect(()=>()=>{k.current.forEach(T=>T.destroy()),k.current.clear()},[]),P.useEffect(()=>{E.current.forEach((T,Y)=>{var X,Z;if(T)if(Y!==i)T.pause();else{T.play().catch(()=>{});const le=t[Y];if(le.type==="video"&&((X=le.videoSources)!=null&&X.hls)&&pn.isSupported()&&!k.current.has(Y)){const se=new pn({enableWebVTT:!0,capLevelToPlayerSize:!0});se.on(pn.Events.SUBTITLE_TRACKS_UPDATED,()=>{Y===i&&(x(se.subtitleTracks.length>0),v(se.subtitleTrack!==-1))}),se.loadSource(le.videoSources.hls),se.attachMedia(T),k.current.set(Y,se)}else le.type==="video"&&((Z=le.videoSources)!=null&&Z.hls)&&T.canPlayType("application/vnd.apple.mpegurl")&&(T.src=le.videoSources.hls)}})},[i,t]),P.useEffect(()=>{const T=k.current.get(i);T&&T.subtitleTracks.length>0?(x(!0),v(T.subtitleTrack!==-1)):(x(!1),v(!1))},[i]);const A=()=>{const T=k.current.get(i);T&&(p?(T.subtitleTrack=-1,v(!1)):(T.subtitleTrack=0,v(!0)))},I=P.useCallback(()=>{i<t.length-1&&s(T=>T+1)},[i,t.length]),N=P.useCallback(()=>{i>0&&s(T=>T-1)},[i]),V=()=>a(T=>Math.min(T+.5,4)),G=()=>{a(T=>{const Y=T-.5;return Y<=1&&o({x:0,y:0}),Math.max(Y,1)})};P.useEffect(()=>{const T=Y=>{Y.key==="ArrowRight"&&I(),Y.key==="ArrowLeft"&&N(),Y.key==="Escape"&&n()};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[I,N,n]);const $=async()=>{var Y;const T=t[i];if(T.type==="video"&&((Y=T.videoSources)!=null&&Y.mp4)){window.open(T.videoSources.mp4,"_blank");return}try{const Z=await(await fetch(T.src)).blob(),le=window.URL.createObjectURL(Z),se=document.createElement("a");se.href=le,se.download=`zen-reddit-${Date.now()}.jpg`,document.body.appendChild(se),se.click(),document.body.removeChild(se),window.URL.revokeObjectURL(le)}catch{window.open(T.src,"_blank")}},D=T=>Math.hypot(T[0].clientX-T[1].clientX,T[0].clientY-T[1].clientY),j=T=>{T.touches.length===1?(_.current={x:T.touches[0].clientX,y:T.touches[0].clientY},w.current={x:T.touches[0].clientX,y:T.touches[0].clientY},r===1?(m(!0),f(!1)):m(!0)):T.touches.length===2&&(L.current=D(T.touches),C.current=r,m(!1))},U=T=>{if(T.preventDefault(),T.touches.length===1&&h){const Y=T.touches[0],X=_.current;if(!X||!w.current)return;const Z=Y.clientX-X.x,le=Y.clientY-X.y;if(r>1)o(se=>({x:se.x+Z,y:se.y+le}));else{const se=Y.clientX-w.current.x;i===0&&se>0||i===t.length-1&&se<0?c(se*.3):c(se)}_.current={x:Y.clientX,y:Y.clientY}}else if(T.touches.length===2&&L.current){const X=D(T.touches)/L.current;a(Math.max(1,Math.min(C.current*X,5)))}},q=T=>{if(m(!1),_.current=null,L.current=null,r===1){f(!0);const Y=window.innerWidth*.2;u<-Y&&i<t.length-1?s(X=>X+1):u>Y&&i>0&&s(X=>X-1),c(0)}else r<=1&&(a(1),o({x:0,y:0}));w.current=null},R=()=>{r>1?(a(1),o({x:0,y:0})):a(2.5)},F=t[i],B=F.type==="video";return g.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center animate-fade-in",children:[g.jsx("div",{className:"absolute inset-0 bg-black/95 backdrop-blur-sm transition-opacity",onClick:n}),g.jsxs("div",{ref:b,className:"relative w-full h-full md:w-[95vw] md:h-[90vh] md:max-w-7xl md:rounded-xl md:overflow-hidden md:bg-black md:shadow-2xl md:border md:border-stone-800 flex flex-col bg-black transition-all duration-300",onClick:T=>T.stopPropagation(),children:[g.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-start z-10 bg-gradient-to-b from-black/60 to-transparent pointer-events-none transition-opacity duration-300",children:[g.jsx("button",{onClick:n,className:"p-2 bg-black/40 text-white rounded-full backdrop-blur-md pointer-events-auto hover:bg-white/20 transition-colors",children:g.jsx(qs,{size:24})}),g.jsxs("div",{className:"flex items-center gap-3",children:[t.length>1&&g.jsxs("div",{className:"bg-black/40 text-white px-3 py-1.5 rounded-full backdrop-blur-md text-sm font-medium flex items-center gap-2",children:[g.jsx(O1,{size:14}),g.jsxs("span",{children:[i+1," / ",t.length]})]}),y&&g.jsx("button",{onClick:A,className:`p-2 rounded-full backdrop-blur-md transition-colors pointer-events-auto ${p?"bg-emerald-600 text-white":"bg-black/40 text-white hover:bg-white/20"}`,title:"Toggle Captions",children:g.jsx(w1,{size:24})}),g.jsx("button",{onClick:$,className:"p-2 bg-black/40 text-white rounded-full backdrop-blur-md hover:bg-white/20 transition-colors pointer-events-auto",title:B?"Open in New Tab":"Download",children:g.jsx(D1,{size:24})})]})]}),g.jsxs("div",{className:"w-full h-full touch-none relative flex-1",onTouchStart:j,onTouchMove:U,onTouchEnd:q,onDoubleClick:R,children:[g.jsx("div",{className:"flex h-full w-full",style:{transform:`translateX(calc(-${i*100}% + ${u}px))`,transition:d?"transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1)":"none"},children:t.map((T,Y)=>{var le;if(Math.abs(i-Y)>1)return g.jsx("div",{className:"w-full h-full flex-shrink-0"},T.id||Y);const X=Y===i,Z=T.type==="video";return g.jsx("div",{className:"w-full h-full flex-shrink-0 flex items-center justify-center overflow-hidden",children:Z?g.jsx("video",{ref:se=>{E.current[Y]=se},className:"max-w-full max-h-full",controls:X,playsInline:!0,poster:T.src,onClick:se=>se.stopPropagation(),style:{transform:X?`translate(${l.x}px, ${l.y}px) scale(${r})`:"none",transition:"transform 0.1s ease-out"},children:g.jsx("source",{src:(le=T.videoSources)==null?void 0:le.mp4,type:"video/mp4"})}):g.jsx("img",{src:T.src,alt:T.caption||"Full size",className:"max-w-full max-h-full object-contain select-none",style:{transform:X?`translate(${l.x}px, ${l.y}px) scale(${r})`:"none",transition:h&&r>1?"none":"transform 0.2s ease-out",cursor:r>1?"grab":"default"},draggable:!1})},T.id||Y)})}),F.caption&&r===1&&g.jsx("div",{className:"absolute bottom-20 left-4 right-4 text-center pointer-events-none transition-opacity duration-300",children:g.jsx("span",{className:"inline-block bg-black/60 backdrop-blur-md text-white px-4 py-2 rounded-lg text-sm",children:F.caption})})]}),i>0&&g.jsx("button",{onClick:N,className:"absolute left-4 top-1/2 -translate-y-1/2 p-3 bg-black/30 hover:bg-black/50 text-white rounded-full transition-all hidden md:block z-20 hover:scale-110 active:scale-95",children:g.jsx(Im,{size:32})}),i<t.length-1&&g.jsx("button",{onClick:I,className:"absolute right-4 top-1/2 -translate-y-1/2 p-3 bg-black/30 hover:bg-black/50 text-white rounded-full transition-all hidden md:block z-20 hover:scale-110 active:scale-95",children:g.jsx(C1,{size:32})}),!B&&g.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-4 pointer-events-auto z-10 opacity-0 md:opacity-100 transition-opacity",children:g.jsxs("div",{className:"flex bg-stone-900/80 backdrop-blur-md rounded-full px-2 py-1 border border-stone-800 shadow-lg",children:[g.jsx("button",{onClick:G,className:"p-3 text-stone-300 hover:text-white disabled:opacity-50",disabled:r<=1,children:g.jsx(CR,{size:20})}),g.jsx("div",{className:"w-px bg-stone-700 my-2"}),g.jsx("button",{onClick:V,className:"p-3 text-stone-300 hover:text-white disabled:opacity-50",disabled:r>=4,children:g.jsx(RR,{size:20})})]})})]})]})},YB=[{id:"google/gemini-2.0-flash-lite-preview-02-05:free",name:"Gemini 2.0 Flash Lite",isFree:!0},{id:"meta-llama/llama-3-8b-instruct:free",name:"Llama 3 8B",isFree:!0},{id:"deepseek/deepseek-r1:free",name:"DeepSeek R1",isFree:!0},{id:"liquid/lfm-40b:free",name:"Liquid LFM 40B",isFree:!0}],qB=({isOpen:t,onClose:e,config:n,onSave:i,pageSize:s,onPageSizeChange:r,textSize:a,onTextSizeChange:l,blockedCount:o,blockedCommentCount:u})=>{const[c]=P.useState("openrouter"),[d,f]=P.useState(""),[h,m]=P.useState("meta-llama/llama-3-8b-instruct:free"),[y,x]=P.useState(50),[p,v]=P.useState(""),[b,E]=P.useState(!1),[k,_]=P.useState(s),[L,C]=P.useState(a),[w,A]=P.useState([]),[I,N]=P.useState(!1),[V,G]=P.useState(!1),$=P.useRef(null),D=P.useRef(null);P.useEffect(()=>{t&&(f(n.openRouterKey||""),m(n.openRouterModel||"meta-llama/llama-3-8b-instruct:free"),x(n.minZenScore??50),v(n.customInstructions||""),E(n.analyzeComments||!1),_(s),C(a))},[t,n,s,a]),P.useEffect(()=>{const T=Y=>{$.current&&!$.current.contains(Y.target)&&G(!1)};return document.addEventListener("mousedown",T),()=>document.removeEventListener("mousedown",T)},[]),P.useEffect(()=>{const T=setTimeout(async()=>{if(d.trim().length>5&&w.length===0){N(!0);try{const Y=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${d}`}});if(Y.ok){const X=await Y.json();if(X&&Array.isArray(X.data)){const Z=X.data.map(le=>({id:le.id,name:le.name||le.id})).sort((le,se)=>le.name.localeCompare(se.name));A(Z)}}}catch(Y){console.error("Failed to fetch OpenRouter models",Y)}finally{N(!1)}}},800);return()=>clearTimeout(T)},[d,w.length]);const j=()=>{i({provider:c,openRouterKey:d,openRouterModel:h,minZenScore:y,customInstructions:p,analyzeComments:b}),r(k),l(L),e()},U=T=>T<30?{text:"Relaxed",color:"text-blue-500"}:T<70?{text:"Balanced",color:"text-emerald-500"}:{text:"Strict",color:"text-purple-500"},q=()=>{const T={timestamp:Date.now(),zen_followed_subs:localStorage.getItem("zen_followed_subs"),zen_ai_config:localStorage.getItem("zen_ai_config"),zen_blocked_count:localStorage.getItem("zen_blocked_count"),zen_blocked_comment_count:localStorage.getItem("zen_blocked_comment_count"),zen_theme:localStorage.getItem("zen_theme"),zen_sort:localStorage.getItem("zen_sort"),zen_page_size:localStorage.getItem("zen_page_size"),zen_text_size:localStorage.getItem("zen_text_size")},Y=new Blob([JSON.stringify(T,null,2)],{type:"application/json"}),X=URL.createObjectURL(Y),Z=document.createElement("a");Z.href=X,Z.download=`zen-reddit-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),URL.revokeObjectURL(X)},R=()=>{var T;(T=D.current)==null||T.click()},F=T=>{var Z;const Y=(Z=T.target.files)==null?void 0:Z[0];if(!Y)return;const X=new FileReader;X.onload=le=>{var se;try{const fe=JSON.parse((se=le.target)==null?void 0:se.result);if(!fe.zen_followed_subs&&!fe.zen_ai_config){alert("Invalid backup file.");return}confirm("This will overwrite your current settings and subscriptions. Continue?")&&(fe.zen_followed_subs&&localStorage.setItem("zen_followed_subs",fe.zen_followed_subs),fe.zen_ai_config&&localStorage.setItem("zen_ai_config",fe.zen_ai_config),fe.zen_blocked_count&&localStorage.setItem("zen_blocked_count",fe.zen_blocked_count),fe.zen_blocked_comment_count&&localStorage.setItem("zen_blocked_comment_count",fe.zen_blocked_comment_count),fe.zen_theme&&localStorage.setItem("zen_theme",fe.zen_theme),fe.zen_sort&&localStorage.setItem("zen_sort",fe.zen_sort),fe.zen_page_size&&localStorage.setItem("zen_page_size",fe.zen_page_size),fe.zen_text_size&&localStorage.setItem("zen_text_size",fe.zen_text_size),window.location.reload())}catch{alert("Failed to parse backup file.")}},X.readAsText(Y),T.target.value=""},B=w.filter(T=>T.name.toLowerCase().includes(h.toLowerCase())||T.id.toLowerCase().includes(h.toLowerCase())).slice(0,50);return t?g.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",children:g.jsxs("div",{className:"bg-white dark:bg-stone-900 w-full max-w-md rounded-2xl shadow-2xl overflow-hidden border border-stone-200 dark:border-stone-700 max-h-[90vh] flex flex-col animate-scale-in",children:[g.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-stone-100 dark:border-stone-800 bg-stone-50 dark:bg-stone-900/50 sticky top-0 z-10 shrink-0",children:[g.jsx("h2",{className:"text-lg font-semibold text-stone-800 dark:text-stone-100",children:"Settings"}),g.jsx("button",{onClick:e,className:"p-1.5 text-stone-500 hover:bg-stone-200 dark:hover:bg-stone-800 rounded-full transition-colors",children:g.jsx(qs,{size:20})})]}),g.jsxs("div",{className:"p-6 space-y-8 overflow-y-auto custom-scrollbar",children:[g.jsxs("div",{className:"bg-stone-50 dark:bg-stone-800/50 p-4 rounded-xl border border-stone-100 dark:border-stone-800 relative overflow-hidden",children:[g.jsx("div",{className:"absolute top-0 right-0 p-3 opacity-10",children:g.jsx(eL,{size:60})}),g.jsxs("h3",{className:"text-sm font-semibold text-stone-800 dark:text-stone-200 mb-4 flex items-center gap-2",children:[g.jsx(U1,{size:18,className:"text-emerald-500"}),"Zen Shield Status"]}),g.jsxs("div",{className:"space-y-3 relative z-10",children:[g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between text-xs text-stone-500 dark:text-stone-400 mb-1.5",children:[g.jsx("span",{children:"Blocked Posts"}),g.jsx("span",{className:"font-mono font-medium",children:o})]}),g.jsx("div",{className:"w-full h-1.5 bg-stone-200 dark:bg-stone-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-emerald-500 rounded-full",style:{width:`${Math.min(o,100)}%`}})})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex justify-between text-xs text-stone-500 dark:text-stone-400 mb-1.5",children:[g.jsx("span",{children:"Toxic Comments Hidden"}),g.jsx("span",{className:"font-mono font-medium",children:u})]}),g.jsx("div",{className:"w-full h-1.5 bg-stone-200 dark:bg-stone-700 rounded-full overflow-hidden",children:g.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(u,100)}%`}})})]})]})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center justify-between mb-4",children:[g.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-stone-700 dark:text-stone-300",children:[g.jsx(j1,{size:16}),"Filter Strictness"]}),g.jsxs("span",{className:`text-xs font-bold uppercase tracking-wide ${U(y).color}`,children:[U(y).text," (",y,")"]})]}),g.jsx("input",{type:"range",min:"10",max:"90",step:"5",value:y,onChange:T=>x(Number(T.target.value)),className:"w-full h-2 bg-stone-200 dark:bg-stone-700 rounded-lg appearance-none cursor-pointer accent-emerald-500"}),g.jsxs("div",{className:"flex justify-between mt-2 text-[10px] text-stone-400 uppercase font-medium",children:[g.jsx("span",{children:"Allow More"}),g.jsx("span",{children:"Zen Only"})]}),g.jsxs("p",{className:"text-xs text-stone-500 mt-3 bg-stone-50 dark:bg-stone-800/50 p-3 rounded-lg border border-stone-100 dark:border-stone-800",children:[y<40&&"Only extreme rage bait will be blocked. Mild annoyances will pass through.",y>=40&&y<=60&&"Standard filtering. Blocks obviously divisive content and anger-inducing posts.",y>60&&"High purity. Filters out anything even slightly controversial or non-constructive."]})]}),g.jsx("div",{className:"border-t border-stone-100 dark:border-stone-800"}),g.jsxs("div",{className:"flex items-start justify-between gap-4",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-stone-700 dark:text-stone-300 mb-1",children:[g.jsx(Ys,{size:16}),"Zen Comments"]}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400",children:"Analyze comments when you open a post and hide toxic or aggressive threads automatically."})]}),g.jsx("div",{className:`w-11 h-6 rounded-full p-0.5 cursor-pointer transition-colors ${b?"bg-emerald-500":"bg-stone-300 dark:bg-stone-700"}`,onClick:()=>E(!b),children:g.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-sm transition-transform ${b?"translate-x-5":"translate-x-0"}`})})]}),g.jsx("div",{className:"border-t border-stone-100 dark:border-stone-800"}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[g.jsx(P1,{size:16,className:"text-stone-400"}),g.jsx("h3",{className:"text-sm font-semibold text-stone-800 dark:text-stone-200",children:"Display Options"})]}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{children:[g.jsx("label",{className:"text-xs font-medium text-stone-500 dark:text-stone-400 mb-2 block",children:"Posts per Load"}),g.jsx("div",{className:"grid grid-cols-3 gap-3",children:[25,50,100].map(T=>g.jsx("button",{onClick:()=>_(T),className:`px-3 py-2 text-sm font-medium rounded-lg border transition-all ${k===T?"bg-stone-800 text-white dark:bg-stone-100 dark:text-stone-900 border-stone-800 dark:border-stone-100":"bg-white dark:bg-stone-950 text-stone-600 dark:text-stone-400 border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800"}`,children:T},T))})]}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[g.jsx(yR,{size:14,className:"text-stone-400"}),g.jsx("label",{className:"text-xs font-medium text-stone-500 dark:text-stone-400",children:"Content Text Size"})]}),g.jsx("div",{className:"grid grid-cols-3 gap-3",children:["small","medium","large"].map(T=>g.jsx("button",{onClick:()=>C(T),className:`px-3 py-2 text-sm font-medium rounded-lg border transition-all capitalize ${L===T?"bg-stone-800 text-white dark:bg-stone-100 dark:text-stone-900 border-stone-800 dark:border-stone-100":"bg-white dark:bg-stone-950 text-stone-600 dark:text-stone-400 border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800"}`,children:T},T))})]})]})]}),g.jsx("div",{className:"border-t border-stone-100 dark:border-stone-800"}),g.jsxs("div",{children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[g.jsx($_,{size:16,className:"text-stone-400"}),g.jsx("h3",{className:"text-sm font-semibold text-stone-800 dark:text-stone-200",children:"Data Management"})]}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400 mb-4",children:"Backup your settings and subscriptions to transfer between devices."}),g.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[g.jsxs("button",{onClick:q,className:"flex flex-col items-center justify-center p-3 rounded-xl border border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800 hover:border-emerald-500 dark:hover:border-emerald-500 transition-all group",children:[g.jsx(D1,{size:20,className:"text-stone-400 group-hover:text-emerald-500 mb-2 transition-colors"}),g.jsx("span",{className:"text-xs font-semibold text-stone-600 dark:text-stone-300",children:"Export Backup"})]}),g.jsxs("button",{onClick:R,className:"flex flex-col items-center justify-center p-3 rounded-xl border border-stone-200 dark:border-stone-700 hover:bg-stone-50 dark:hover:bg-stone-800 hover:border-blue-500 dark:hover:border-blue-500 transition-all group",children:[g.jsx(vR,{size:20,className:"text-stone-400 group-hover:text-blue-500 mb-2 transition-colors"}),g.jsx("span",{className:"text-xs font-semibold text-stone-600 dark:text-stone-300",children:"Import Data"})]}),g.jsx("input",{type:"file",ref:D,className:"hidden",accept:".json",onChange:F})]})]}),g.jsx("div",{className:"border-t border-stone-100 dark:border-stone-800"}),g.jsxs("div",{children:[g.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-stone-700 dark:text-stone-300 mb-2",children:[g.jsx(Dm,{size:16}),"Custom Instructions"]}),g.jsx("textarea",{value:p,onChange:T=>v(T.target.value),placeholder:"e.g. I dislike politics, I love cats, Filter out spoilers...",className:"w-full h-24 bg-white dark:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-lg px-3 py-2 text-sm text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 resize-none transition-shadow"}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400 mt-1",children:"These instructions will be passed to the AI to tailor your feed."})]}),g.jsx("div",{className:"border-t border-stone-100 dark:border-stone-800"}),g.jsxs("div",{className:"space-y-4",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[g.jsx(NL,{size:16,className:"text-stone-400"}),g.jsx("h3",{className:"text-sm font-semibold text-stone-800 dark:text-stone-200",children:"OpenRouter Configuration"})]}),g.jsxs("p",{className:"text-xs text-stone-500 dark:text-stone-400 mb-4",children:["This app uses OpenRouter to access AI models. You need an API key from ",g.jsx("a",{href:"https://openrouter.ai",target:"_blank",rel:"noopener noreferrer",className:"text-emerald-600 hover:underline",children:"openrouter.ai"}),"."]}),g.jsxs("div",{children:[g.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300 mb-1",children:"API Key"}),g.jsx("input",{type:"password",value:d,onChange:T=>f(T.target.value),placeholder:"sk-or-...",className:"w-full bg-white dark:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-lg px-3 py-2 text-sm text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 transition-shadow"}),g.jsx("p",{className:"text-xs text-stone-400 mt-1",children:"Stored locally in your browser."})]}),g.jsxs("div",{ref:$,className:"relative",children:[g.jsx("label",{className:"block text-sm font-medium text-stone-700 dark:text-stone-300 mb-2",children:"Model Selection"}),g.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:YB.map(T=>g.jsx("button",{onClick:()=>m(T.id),className:`text-xs px-2.5 py-1.5 rounded-full border transition-all ${h===T.id?"bg-emerald-100 border-emerald-200 text-emerald-700 dark:bg-emerald-900/30 dark:border-emerald-800 dark:text-emerald-400 font-medium shadow-sm":"bg-stone-50 border-stone-200 text-stone-600 dark:bg-stone-800 dark:border-stone-700 dark:text-stone-400 hover:bg-stone-100 dark:hover:bg-stone-700"}`,children:T.name},T.id))}),g.jsxs("div",{className:"relative group",children:[g.jsx("input",{type:"text",value:h,onChange:T=>{m(T.target.value),G(!0)},onFocus:()=>G(!0),placeholder:"Search model ID (e.g. anthropic/claude-3)...",className:"w-full bg-white dark:bg-stone-950 border border-stone-200 dark:border-stone-700 rounded-xl pl-10 pr-10 py-3 text-sm text-stone-900 dark:text-stone-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 transition-all shadow-sm"}),g.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400 pointer-events-none",children:g.jsx(pl,{size:16})}),g.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-2",children:[I&&g.jsx(hc,{className:"animate-spin text-stone-400",size:16}),!I&&h&&g.jsx("button",{onClick:()=>{m(""),G(!0)},className:"text-stone-400 hover:text-stone-600 dark:hover:text-stone-200 p-1 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800",children:g.jsx(qs,{size:14})})]})]}),V&&g.jsxs("div",{className:"mt-2 w-full bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-700 rounded-xl shadow-inner max-h-[300px] overflow-y-auto custom-scrollbar animate-fade-in",children:[w.length===0&&!I&&g.jsx("div",{className:"p-4 text-center text-sm text-stone-500",children:d.length<5?"Enter API Key to load models":"No models found."}),B.map(T=>g.jsxs("button",{onClick:()=>{m(T.id),G(!1)},className:"w-full text-left px-4 py-3 text-sm hover:bg-stone-50 dark:hover:bg-stone-800 border-b border-stone-100 dark:border-stone-800 last:border-0 flex items-center justify-between group transition-colors",children:[g.jsxs("div",{className:"min-w-0 pr-2",children:[g.jsx("div",{className:"font-medium text-stone-800 dark:text-stone-200 truncate",children:T.name}),g.jsx("div",{className:"text-xs text-stone-500 truncate",children:T.id})]}),h===T.id&&g.jsx(Iu,{size:16,className:"text-emerald-500 shrink-0"})]},T.id)),B.length===0&&h&&w.length>0&&g.jsxs("button",{onClick:()=>G(!1),className:"w-full text-left px-4 py-3 text-sm hover:bg-stone-50 dark:hover:bg-stone-800 text-stone-500 italic border-t border-stone-100 dark:border-stone-800",children:['Use custom ID: "',h,'"']})]}),g.jsxs("div",{className:"flex items-start gap-2 mt-3 p-2 bg-stone-50 dark:bg-stone-900/50 rounded-lg border border-stone-100 dark:border-stone-800",children:[g.jsx(I1,{size:14,className:"text-stone-400 shrink-0 mt-0.5"}),g.jsx("p",{className:"text-[10px] text-stone-500 dark:text-stone-400 leading-relaxed",children:'Models with "free", "flash", or "haiku" in the name are usually the fastest and cheapest options for filtering.'})]})]})]})]}),g.jsx("div",{className:"p-4 border-t border-stone-100 dark:border-stone-800 flex justify-end sticky bottom-0 bg-white dark:bg-stone-900 shrink-0",children:g.jsxs("button",{onClick:j,className:"flex items-center space-x-2 bg-stone-800 dark:bg-stone-100 text-stone-100 dark:text-stone-900 px-4 py-2 rounded-lg font-medium hover:opacity-90 transition-opacity active:scale-95",children:[g.jsx(eR,{size:16}),g.jsx("span",{children:"Save Settings"})]})})]})}):null},XB=({isOpen:t,onClose:e})=>t?g.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[g.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in"}),g.jsxs("div",{className:"relative bg-white dark:bg-stone-900 w-full max-w-lg rounded-2xl shadow-2xl p-6 md:p-8 animate-scale-in border border-stone-200 dark:border-stone-700 overflow-hidden max-h-[90vh] overflow-y-auto custom-scrollbar",children:[g.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"}),g.jsx("div",{className:"absolute bottom-0 left-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none"}),g.jsxs("div",{className:"relative z-10",children:[g.jsx("div",{className:"flex justify-center mb-6",children:g.jsx("div",{className:"w-16 h-16 bg-emerald-100 dark:bg-emerald-900/30 rounded-2xl flex items-center justify-center rotate-3 shadow-lg ring-1 ring-emerald-500/20",children:g.jsx(Dm,{className:"text-emerald-600 dark:text-emerald-400",size:32})})}),g.jsx("h2",{className:"text-2xl font-bold text-center text-stone-900 dark:text-stone-100 mb-2",children:"Welcome to ZenReddit"}),g.jsx("p",{className:"text-center text-stone-500 dark:text-stone-400 mb-8 max-w-sm mx-auto text-sm leading-relaxed",children:"Experience Reddit without the stress. We use advanced AI to curate your feed in real-time."}),g.jsxs("div",{className:"space-y-6 mb-8",children:[g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 dark:text-blue-400 border border-blue-100 dark:border-blue-900/30",children:g.jsx(j1,{size:20})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-semibold text-stone-800 dark:text-stone-200 text-sm",children:"Rage-Bait & Stress Shield"}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400 mt-1 leading-relaxed",children:"The AI reads titles and body text to detect hostility, divisive politics, and anxiety-inducing patterns. Content is graded 0-100 (Zen Score) and hidden if it fails your strictness settings."})]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-purple-50 dark:bg-purple-900/20 flex items-center justify-center text-purple-600 dark:text-purple-400 border border-purple-100 dark:border-purple-900/30",children:g.jsx(Ys,{size:20})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-semibold text-stone-800 dark:text-stone-200 text-sm",children:"Contextual Comment Analysis"}),g.jsx("p",{className:"text-xs text-stone-500 dark:text-stone-400 mt-1 leading-relaxed",children:"We don't just look at keywords. The AI analyzes thread context to distinguish between friendly banter and actual toxicity, collapsing harmful discussions automatically."})]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-emerald-50 dark:bg-emerald-900/20 flex items-center justify-center text-emerald-600 dark:text-emerald-400 border border-emerald-100 dark:border-emerald-900/30",children:g.jsx(uR,{size:20})}),g.jsxs("div",{children:[g.jsx("h3",{className:"font-semibold text-stone-800 dark:text-stone-200 text-sm",children:"Tailored to You"}),g.jsxs("p",{className:"text-xs text-stone-500 dark:text-stone-400 mt-1 leading-relaxed",children:["You control the AI. Go to ",g.jsx("strong",{children:"Settings"}),' to add custom prompts (e.g., "I hate spoilers," "No political news," or "I love cats") to shape exactly how the analysis works.']})]})]})]}),g.jsx("button",{onClick:e,className:"w-full py-3.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-semibold shadow-lg shadow-emerald-600/20 transition-all active:scale-[0.98] btn-press",children:"Start Browsing"})]})]})]}):null,QB=({followedSubs:t,onNavigate:e,onFollow:n,currentFeed:i,currentSub:s,forceOpen:r=!1,onClose:a})=>{const[l,o]=P.useState(r),[u,c]=P.useState(""),[d,f]=P.useState([]),[h,m]=P.useState(!1),y=P.useRef(null);P.useEffect(()=>{r&&o(!0)},[r]),P.useEffect(()=>(l?(document.body.style.overflow="hidden",setTimeout(()=>{var E;return(E=y.current)==null?void 0:E.focus()},50)):(document.body.style.overflow="",c(""),f([]),m(!1),a&&a()),()=>{document.body.style.overflow=""}),[l]);const x=()=>{o(!1)},p=(E,k)=>{e(E,k),x()},v=async E=>{if(E.preventDefault(),!!u.trim()){m(!0);try{const k=await z1(u);f(k)}catch(k){console.error("Search failed",k)}finally{m(!1)}}},b=t.filter(E=>E.toLowerCase().includes(u.toLowerCase()));return g.jsx(g.Fragment,{children:l&&g.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col justify-end md:justify-center md:items-center",children:[g.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm animate-fade-in",onClick:x}),g.jsxs("div",{className:"bg-white dark:bg-stone-900 w-full md:w-[600px] md:rounded-2xl rounded-t-2xl shadow-2xl max-h-[85vh] md:max-h-[80vh] flex flex-col animate-slide-up relative z-10 border-t border-stone-200 dark:border-stone-800 md:border-none pb-safe",children:[g.jsx("div",{className:"w-full flex justify-center pt-3 pb-1 md:hidden",onClick:x,children:g.jsx("div",{className:"w-12 h-1.5 bg-stone-300 dark:bg-stone-700 rounded-full opacity-50"})}),g.jsxs("div",{className:"px-4 pb-4 md:pt-4 flex items-center justify-between shrink-0",children:[g.jsx("h3",{className:"font-semibold text-lg text-stone-800 dark:text-stone-200",children:"Explore & Search"}),g.jsx("button",{onClick:x,className:"p-2 bg-stone-100 dark:bg-stone-800 rounded-full text-stone-500 hover:text-stone-800 dark:hover:text-stone-200 transition-colors",children:g.jsx(qs,{size:20})})]}),g.jsx("div",{className:"px-4 pb-2 shrink-0",children:g.jsxs("form",{onSubmit:v,className:"relative group",children:[g.jsx(pl,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-stone-400 group-focus-within:text-emerald-500 transition-colors",size:18}),g.jsx("input",{ref:y,type:"text",placeholder:"Find or search subreddits...",value:u,onChange:E=>c(E.target.value),className:"w-full bg-stone-100 dark:bg-stone-800 border-2 border-transparent focus:border-emerald-500/50 rounded-xl py-3 pl-10 pr-10 text-base text-stone-800 dark:text-stone-200 placeholder-stone-400 outline-none transition-all"}),h&&g.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:g.jsx(hc,{className:"animate-spin text-emerald-500",size:18})})]})}),g.jsxs("div",{className:"overflow-y-auto p-4 space-y-4 overscroll-contain pb-8 min-h-[40vh] custom-scrollbar",children:[d.length>0&&g.jsxs("div",{className:"space-y-2 mb-4",children:[g.jsxs("div",{className:"flex items-center justify-between px-2",children:[g.jsx("p",{className:"text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wider",children:"Search Results"}),g.jsx("button",{onClick:()=>f([]),className:"text-xs text-stone-400",children:"Clear"})]}),g.jsx("div",{className:"grid grid-cols-1 gap-2",children:d.map(E=>g.jsxs("button",{onClick:()=>{n(E),p("subreddit",E)},className:"w-full flex items-center justify-between gap-3 p-3 rounded-xl bg-white dark:bg-stone-900 border border-emerald-100 dark:border-emerald-900/30 text-stone-700 dark:text-stone-300 shadow-sm transition-all active:scale-[0.98]",children:[g.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[g.jsx("div",{className:"p-2 rounded-full shrink-0 bg-stone-100 dark:bg-stone-800 text-stone-500",children:g.jsx(Xf,{size:18})}),g.jsxs("span",{className:"font-medium truncate text-base",children:["r/",E]})]}),g.jsx(gl,{size:18,className:"text-emerald-500 shrink-0"})]},E))})]}),(!u||"popular".includes(u.toLowerCase())||"all".includes(u.toLowerCase()))&&d.length===0&&g.jsxs("div",{className:"space-y-2",children:[g.jsx("p",{className:"text-xs font-bold text-stone-400 uppercase tracking-wider px-2",children:"Feeds"}),(!u||"popular".includes(u.toLowerCase()))&&g.jsxs("button",{onClick:()=>p("popular"),className:`w-full flex items-center gap-4 p-3 rounded-xl transition-all active:scale-[0.98] ${i==="popular"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 ring-1 ring-emerald-200 dark:ring-emerald-800":"bg-stone-50 dark:bg-stone-800/50 text-stone-700 dark:text-stone-300"}`,children:[g.jsx("div",{className:`p-2.5 rounded-full ${i==="popular"?"bg-emerald-100 dark:bg-emerald-800 text-emerald-600 dark:text-emerald-300":"bg-white dark:bg-stone-700 text-stone-500 dark:text-stone-400"}`,children:g.jsx(N1,{size:20,fill:i==="popular"?"currentColor":"none"})}),g.jsx("span",{className:"font-semibold text-lg",children:"Popular"})]}),(!u||"all".includes(u.toLowerCase()))&&g.jsxs("button",{onClick:()=>p("all"),className:`w-full flex items-center gap-4 p-3 rounded-xl transition-all active:scale-[0.98] ${i==="all"?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 ring-1 ring-emerald-200 dark:ring-emerald-800":"bg-stone-50 dark:bg-stone-800/50 text-stone-700 dark:text-stone-300"}`,children:[g.jsx("div",{className:`p-2.5 rounded-full ${i==="all"?"bg-emerald-100 dark:bg-emerald-800 text-emerald-600 dark:text-emerald-300":"bg-white dark:bg-stone-700 text-stone-500 dark:text-stone-400"}`,children:g.jsx(M1,{size:20})}),g.jsx("span",{className:"font-semibold text-lg",children:"All"})]})]}),g.jsxs("div",{className:"space-y-2",children:[g.jsxs("div",{className:"flex items-center justify-between px-2",children:[g.jsx("p",{className:"text-xs font-bold text-stone-400 uppercase tracking-wider",children:"Following"}),g.jsx("span",{className:"text-xs text-stone-400 bg-stone-100 dark:bg-stone-800 px-2 py-0.5 rounded-full",children:b.length})]}),b.length===0?g.jsxs("div",{className:"text-center py-10 bg-stone-50 dark:bg-stone-800/30 rounded-xl border border-dashed border-stone-200 dark:border-stone-700",children:[g.jsx("p",{className:"text-stone-500 dark:text-stone-400 font-medium",children:u?"No followed subreddits match":"No followed subreddits"}),!u&&g.jsx("p",{className:"text-xs text-stone-400 mt-1",children:"Search via the top bar to add some!"}),u&&d.length===0&&!h&&g.jsxs("button",{onClick:v,className:"mt-3 text-emerald-600 dark:text-emerald-500 text-sm font-medium hover:underline",children:['Search Reddit for "',u,'"']})]}):g.jsx("div",{className:"grid grid-cols-1 gap-2",children:b.map(E=>g.jsxs("button",{onClick:()=>p("subreddit",E),className:`w-full flex items-center gap-3 p-3 rounded-xl transition-all active:scale-[0.98] ${i==="subreddit"&&s===E?"bg-emerald-50 dark:bg-emerald-900/20 text-emerald-700 dark:text-emerald-400 ring-1 ring-emerald-200 dark:ring-emerald-800":"bg-white dark:bg-stone-900 hover:bg-stone-50 dark:hover:bg-stone-800 border border-stone-100 dark:border-stone-800 text-stone-700 dark:text-stone-300"}`,children:[g.jsx("div",{className:`p-2 rounded-full shrink-0 ${i==="subreddit"&&s===E?"bg-emerald-100 dark:bg-emerald-800 text-emerald-600 dark:text-emerald-300":"bg-stone-100 dark:bg-stone-800 text-stone-500"}`,children:g.jsx(Xf,{size:18})}),g.jsxs("span",{className:"font-medium truncate text-base",children:["r/",E]})]},E))})]})]})]})]})})},WB=({children:t,rootMargin:e="800px",minHeight:n=100,className:i="",style:s={}})=>{const[r,a]=P.useState(!1),[l,o]=P.useState(void 0),u=P.useRef(null);return P.useEffect(()=>{const c=new IntersectionObserver(([d])=>{if(d.isIntersecting)a(!0);else{const f=d.boundingClientRect.height;f>0&&o(f),a(!1)}},{rootMargin:e,threshold:0});return u.current&&c.observe(u.current),()=>c.disconnect()},[e]),g.jsx("div",{ref:u,className:i,style:{...s,height:r?void 0:l||n,minHeight:r?void 0:l||n,display:"block",contain:r?"none":"strict"},children:r?t:null})},ZB=({subreddit:t,isFollowed:e,onToggleFollow:n})=>{var c,d,f,h,m;const[i,s]=P.useState(null),[r,a]=P.useState(!0);if(P.useEffect(()=>{let y=!0;return(async()=>{a(!0);const p=await VR(t);y&&p&&s(p),y&&a(!1)})(),()=>{y=!1}},[t]),r)return g.jsx("div",{className:"w-full h-32 md:h-48 bg-stone-200 dark:bg-stone-800 animate-pulse rounded-xl mb-6 relative overflow-hidden",children:g.jsxs("div",{className:"absolute bottom-4 left-4 flex items-end gap-3",children:[g.jsx("div",{className:"w-12 h-12 md:w-16 md:h-16 rounded-full bg-stone-300 dark:bg-stone-700 ring-4 ring-stone-100 dark:ring-stone-900"}),g.jsxs("div",{className:"mb-1 space-y-2",children:[g.jsx("div",{className:"h-5 w-32 bg-stone-300 dark:bg-stone-700 rounded"}),g.jsx("div",{className:"h-3 w-20 bg-stone-300 dark:bg-stone-700 rounded"})]})]})});if(!i)return null;const l=((c=i.banner_background_image)==null?void 0:c.split("?")[0])||((d=i.banner_img)==null?void 0:d.split("?")[0])||((f=i.mobile_banner_image)==null?void 0:f.split("?")[0]),o=((h=i.community_icon)==null?void 0:h.split("?")[0])||((m=i.icon_img)==null?void 0:m.split("?")[0]),u=i.subscribers>=1e6?`${(i.subscribers/1e6).toFixed(1)}M`:i.subscribers>=1e3?`${(i.subscribers/1e3).toFixed(1)}k`:i.subscribers;return g.jsxs("div",{className:"mb-6 rounded-xl overflow-hidden bg-white dark:bg-stone-900 shadow-sm border border-stone-200 dark:border-stone-800 animate-list-enter w-full max-w-4xl mx-auto",children:[g.jsx("div",{className:"h-24 md:h-40 w-full bg-stone-200 dark:bg-stone-800 bg-cover bg-center relative",style:{backgroundImage:l?`url(${l})`:void 0,backgroundColor:i.key_color||i.primary_color||"#10b981"},children:!l&&g.jsx("div",{className:"w-full h-full opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"})}),g.jsxs("div",{className:"px-4 pb-4 md:px-6 md:pb-6 relative",children:[g.jsxs("div",{className:"flex justify-between items-end -mt-8 md:-mt-10 mb-3",children:[g.jsxs("div",{className:"flex items-end gap-3 md:gap-4",children:[g.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 rounded-full bg-white dark:bg-stone-900 p-1 shadow-md ring-1 ring-black/5 dark:ring-white/10 shrink-0",children:o?g.jsx("img",{src:o,alt:t,className:"w-full h-full rounded-full object-cover bg-stone-100 dark:bg-stone-800"}):g.jsx("div",{className:"w-full h-full rounded-full bg-emerald-100 dark:bg-emerald-900/50 flex items-center justify-center text-emerald-600 dark:text-emerald-400 font-bold text-xl md:text-2xl",children:"r/"})}),g.jsxs("div",{className:"mb-1 md:mb-1.5 min-w-0",children:[g.jsx("h1",{className:"text-lg md:text-2xl font-bold text-stone-900 dark:text-stone-100 leading-none truncate drop-shadow-sm md:drop-shadow-none shadow-black",children:i.title||i.display_name_prefixed}),g.jsx("p",{className:"text-sm text-stone-500 dark:text-stone-400 font-medium",children:i.display_name_prefixed})]})]}),g.jsx("button",{onClick:n,className:`hidden md:flex items-center gap-2 px-5 py-2 rounded-full font-bold transition-all shadow-sm active:scale-95 ${e?"bg-white dark:bg-stone-800 border border-stone-300 dark:border-stone-600 text-stone-700 dark:text-stone-300 hover:border-red-500 hover:text-red-500":"bg-emerald-600 hover:bg-emerald-700 text-white border border-transparent"}`,children:e?g.jsxs(g.Fragment,{children:[g.jsx(Iu,{size:18}),g.jsx("span",{children:"Joined"})]}):g.jsxs(g.Fragment,{children:[g.jsx(gl,{size:18}),g.jsx("span",{children:"Join"})]})})]}),g.jsxs("div",{className:"md:ml-24",children:[g.jsx("p",{className:"text-sm md:text-base text-stone-700 dark:text-stone-300 mb-3 leading-relaxed line-clamp-3",children:i.public_description}),g.jsxs("div",{className:"flex items-center gap-4 text-xs md:text-sm font-medium text-stone-500 dark:text-stone-400",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(TR,{size:16}),g.jsxs("span",{children:[u," members"]})]}),i.active_user_count&&g.jsxs("div",{className:"flex items-center gap-1.5 text-emerald-600 dark:text-emerald-500",children:[g.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),g.jsxs("span",{children:[i.active_user_count>=1e3?`${(i.active_user_count/1e3).toFixed(1)}k`:i.active_user_count," online"]})]})]})]}),g.jsx("button",{onClick:n,className:`mt-4 w-full md:hidden flex justify-center items-center gap-2 px-4 py-2.5 rounded-full font-bold transition-all active:scale-95 ${e?"bg-stone-100 dark:bg-stone-800 border border-stone-200 dark:border-stone-700 text-stone-700 dark:text-stone-300":"bg-emerald-600 text-white shadow-md shadow-emerald-900/20"}`,children:e?"Joined":"Join Community"})]})]})},JB=({username:t})=>{var a;const[e,n]=P.useState(null),[i,s]=P.useState(!0);if(P.useEffect(()=>{let l=!0;return(async()=>{s(!0);const u=await zR(t);l&&u&&n(u),l&&s(!1)})(),()=>{l=!1}},[t]),i)return g.jsx("div",{className:"w-full max-w-4xl mx-auto mb-6 bg-white dark:bg-stone-900 rounded-xl p-6 shadow-sm border border-stone-200 dark:border-stone-800 animate-pulse",children:g.jsxs("div",{className:"flex items-center gap-4",children:[g.jsx("div",{className:"w-16 h-16 rounded-full bg-stone-200 dark:bg-stone-800"}),g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"w-40 h-6 bg-stone-200 dark:bg-stone-800 rounded"}),g.jsx("div",{className:"w-24 h-4 bg-stone-200 dark:bg-stone-800 rounded"})]})]})});if(!e)return null;const r=e.snoovatar_img||((a=e.icon_img)==null?void 0:a.split("?")[0]);return g.jsxs("div",{className:"w-full max-w-4xl mx-auto mb-6 bg-gradient-to-br from-white to-stone-50 dark:from-stone-900 dark:to-stone-950 rounded-xl overflow-hidden shadow-sm border border-stone-200 dark:border-stone-800 animate-list-enter",children:[g.jsx("div",{className:"h-24 bg-gradient-to-r from-emerald-500 to-teal-600 relative",children:g.jsx("div",{className:"absolute -bottom-8 left-6",children:g.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-white dark:border-stone-900 bg-white dark:bg-stone-800 overflow-hidden shadow-md",children:r?g.jsx("img",{src:r,alt:e.name,className:"w-full h-full object-cover"}):g.jsx("div",{className:"w-full h-full flex items-center justify-center bg-stone-200 dark:bg-stone-700 text-stone-400",children:g.jsx(SR,{size:40})})})})}),g.jsx("div",{className:"pt-10 px-6 pb-6",children:g.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[g.jsxs("div",{children:[g.jsxs("h1",{className:"text-2xl font-bold text-stone-900 dark:text-stone-100",children:["u/",e.name]}),g.jsxs("div",{className:"flex items-center gap-2 text-sm text-stone-500 dark:text-stone-400 mt-1",children:[g.jsx(W_,{size:14}),g.jsxs("span",{children:["Joined ",yl(new Date(e.created_utc*1e3))," ago"]})]})]}),g.jsxs("div",{className:"flex gap-4",children:[g.jsxs("div",{className:"flex flex-col items-center bg-stone-100 dark:bg-stone-800/50 p-3 rounded-lg min-w-[100px]",children:[g.jsx("span",{className:"text-xs font-semibold text-stone-500 dark:text-stone-400 uppercase tracking-wider",children:"Karma"}),g.jsx("span",{className:"text-lg font-bold text-emerald-600 dark:text-emerald-400",children:e.total_karma>1e3?`${(e.total_karma/1e3).toFixed(1)}k`:e.total_karma})]}),g.jsxs("div",{className:"flex flex-col gap-1 text-xs text-stone-500 dark:text-stone-400 justify-center",children:[g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(q_,{size:14,className:"text-orange-500"}),g.jsxs("span",{children:[e.link_karma.toLocaleString()," Post"]})]}),g.jsxs("div",{className:"flex items-center gap-1.5",children:[g.jsx(Ys,{size:14,className:"text-blue-500"}),g.jsxs("span",{children:[e.comment_karma.toLocaleString()," Comment"]})]})]})]})]})})]})},eU=({activeTab:t,onTabChange:e,onScrollTop:n,isScrolled:i})=>{const s=()=>{navigator.vibrate&&navigator.vibrate(10)},r=a=>{s(),t===a&&a==="home"?n():e(a)};return g.jsxs("div",{className:"md:hidden fixed bottom-0 left-0 right-0 z-50",children:[g.jsx("div",{className:"absolute bottom-full left-0 right-0 h-6 bg-gradient-to-t from-stone-100/80 dark:from-stone-950/80 to-transparent pointer-events-none"}),g.jsx("div",{className:"bg-white/90 dark:bg-stone-900/90 backdrop-blur-xl border-t border-stone-200 dark:border-stone-800 h-16",children:g.jsxs("div",{className:"flex items-center justify-around h-full",children:[g.jsxs("button",{onClick:()=>r("home"),className:`flex flex-col items-center justify-center w-full h-full space-y-1 active:scale-95 transition-transform ${t==="home"?"text-emerald-600 dark:text-emerald-400":"text-stone-400 dark:text-stone-500"}`,children:[t==="home"&&i?g.jsx(K_,{size:24,className:"animate-bounce"}):g.jsx(CL,{size:24,strokeWidth:t==="home"?2.5:2}),g.jsx("span",{className:"text-[10px] font-medium",children:"Home"})]}),g.jsxs("button",{onClick:()=>r("explore"),className:`flex flex-col items-center justify-center w-full h-full space-y-1 active:scale-95 transition-transform ${t==="explore"?"text-emerald-600 dark:text-emerald-400":"text-stone-400 dark:text-stone-500"}`,children:[g.jsx(pl,{size:24,strokeWidth:t==="explore"?2.5:2}),g.jsx("span",{className:"text-[10px] font-medium",children:"Explore"})]}),g.jsxs("button",{onClick:()=>r("settings"),className:`flex flex-col items-center justify-center w-full h-full space-y-1 active:scale-95 transition-transform ${t==="settings"?"text-emerald-600 dark:text-emerald-400":"text-stone-400 dark:text-stone-500"}`,children:[g.jsx(B1,{size:24,strokeWidth:t==="settings"?2.5:2}),g.jsx("span",{className:"text-[10px] font-medium",children:"Settings"})]})]})})]})},ln=(t,e)=>{try{const n=localStorage.getItem(t);if(!n)return e;try{return JSON.parse(n)}catch{return typeof e=="string"?n:e}}catch(n){return console.warn(`Failed to load ${t} from storage`,n),e}},Ax=72*60*60*1e3,kx=Ll.memo(({viewMode:t})=>t==="compact"?g.jsxs("div",{className:"bg-white dark:bg-stone-900 rounded-lg shadow-sm border border-stone-200 dark:border-stone-800 mb-2 animate-pulse flex overflow-hidden w-full h-[100px]",children:[g.jsx("div",{className:"w-[80px] sm:w-[110px] bg-stone-200 dark:bg-stone-800 shrink-0 h-full"}),g.jsx("div",{className:"flex-1 p-3 flex flex-col justify-between",children:g.jsxs("div",{className:"space-y-2",children:[g.jsx("div",{className:"h-4 bg-stone-200 dark:bg-stone-800 rounded w-full"}),g.jsx("div",{className:"h-3 bg-stone-200 dark:bg-stone-800 rounded w-2/3"})]})})]}):g.jsxs("div",{className:"bg-white dark:bg-stone-900 p-4 rounded-xl shadow-sm border border-stone-200 dark:border-stone-800 mb-6 animate-pulse break-inside-avoid w-full h-[400px]",children:[g.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[g.jsx("div",{className:"w-6 h-6 bg-stone-200 dark:bg-stone-800 rounded-full"}),g.jsx("div",{className:"h-3 bg-stone-200 dark:bg-stone-800 rounded w-24"})]}),g.jsx("div",{className:"space-y-2 mb-4",children:g.jsx("div",{className:"h-4 bg-stone-200 dark:bg-stone-800 rounded w-3/4"})}),g.jsx("div",{className:"h-48 bg-stone-200 dark:bg-stone-800 rounded-lg mb-3"})]})),tU=()=>{const[t,e]=P.useState(()=>ln("zen_last_feed","popular")),[n,i]=P.useState(()=>ln("zen_last_sub",void 0)),[s,r]=P.useState(()=>ln("zen_last_search","")),[a,l]=P.useState([]),[o,u]=P.useState(""),[c,d]=P.useState(!0),[f,h]=P.useState(()=>ln("zen_sort","hot")),[m,y]=P.useState(()=>ln("zen_top_time","day")),[x,p]=P.useState(()=>ln("zen_view_mode","card")),[v,b]=P.useState(()=>ln("zen_page_size",25)),[E,k]=P.useState(()=>ln("zen_text_size","medium")),[_,L]=P.useState([]),[C,w]=P.useState("idle"),[A,I]=P.useState(null),[N,V]=P.useState(!1),[G,$]=P.useState(null),[D,j]=P.useState(null),[U,q]=P.useState(null),[R,F]=P.useState(()=>ln("zen_analysis_cache",{})),[B,T]=P.useState(()=>ln("zen_followed_subs",[])),[Y,X]=P.useState(()=>ln("zen_blocked_count",0)),[Z,le]=P.useState(()=>ln("zen_blocked_comment_count",0)),[se,fe]=P.useState(()=>{try{const J=localStorage.getItem("zen_seen_posts");if(!J)return{};const Se=JSON.parse(J),Be=Date.now(),it={};return Object.entries(Se).forEach(([Ui,rn])=>{typeof rn=="number"&&Be-rn<Ax&&(it[Ui]=rn)}),it}catch{return{}}}),[te,ge]=P.useState(()=>{const J=localStorage.getItem("zen_theme");return J==="dark"||J==="light"?J:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}),[Ce,Fe]=P.useState(()=>({provider:"openrouter",minZenScore:50,analyzeComments:!1,...ln("zen_ai_config",{})})),[ft,et]=P.useState(!1),[ae,be]=P.useState(!1),[lt,Ot]=P.useState(!1),[ht,nn]=P.useState("home"),sn=P.useRef(null),Ht=P.useRef(null),jn=P.useRef(null),Xn=P.useRef(null);P.useEffect(()=>{localStorage.getItem("zen_has_visited")||(Ot(!0),localStorage.setItem("zen_has_visited","true"))},[]),P.useEffect(()=>{te==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("zen_theme",te)},[te]),P.useEffect(()=>{const J=Se=>{if(Se.state)if(Se.state.postId){if(!G||G.id!==Se.state.postId){const Be=_.find(it=>it.id===Se.state.postId);Be?$(Be):window.history.replaceState(null,"")}}else $(null);else $(null)};return window.addEventListener("popstate",J),()=>window.removeEventListener("popstate",J)},[_,G]),P.useEffect(()=>{localStorage.setItem("zen_last_feed",t)},[t]),P.useEffect(()=>{n&&localStorage.setItem("zen_last_sub",n)},[n]),P.useEffect(()=>{s&&localStorage.setItem("zen_last_search",s)},[s]),P.useEffect(()=>{localStorage.setItem("zen_sort",f)},[f]),P.useEffect(()=>{localStorage.setItem("zen_top_time",m)},[m]),P.useEffect(()=>{localStorage.setItem("zen_view_mode",x)},[x]),P.useEffect(()=>{localStorage.setItem("zen_page_size",v.toString())},[v]),P.useEffect(()=>{localStorage.setItem("zen_text_size",E)},[E]),P.useEffect(()=>{localStorage.setItem("zen_followed_subs",JSON.stringify(B))},[B]),P.useEffect(()=>{localStorage.setItem("zen_blocked_count",Y.toString())},[Y]),P.useEffect(()=>{localStorage.setItem("zen_blocked_comment_count",Z.toString())},[Z]),P.useEffect(()=>{localStorage.setItem("zen_ai_config",JSON.stringify(Ce))},[Ce]),P.useEffect(()=>{const J=setTimeout(()=>{try{const Se=Date.now(),Be={};let it=!1;Object.entries(se).forEach(([rn,ha])=>{Se-ha<Ax?Be[rn]=ha:it=!0}),localStorage.setItem("zen_seen_posts",JSON.stringify(Be)),it&&fe(Be);const Ui=Object.entries(R);if(Ui.length>500){const rn=Object.fromEntries(Ui.slice(Ui.length-500));localStorage.setItem("zen_analysis_cache",JSON.stringify(rn))}else localStorage.setItem("zen_analysis_cache",JSON.stringify(R))}catch(Se){console.warn("Storage save failed",Se)}},2e3);return()=>clearTimeout(J)},[se,R]);const z=P.useCallback(async(J=!1,Se=null)=>{if(C!=="idle"&&!J&&!Se)return;J&&jn.current&&jn.current.abort();const Be=new AbortController;jn.current=Be;try{J&&(w("fetching"),V(!0)),I(null);const{posts:it,after:Ui}=await $R(t,n,Se,B,s,f,m,v,J,Be.signal);if(!it||it.length===0){J&&L([]),q(null),w("idle"),V(!1);return}q(Ui);const rn=it.filter(Ze=>!R[Ze.data.id]),ha=it.filter(Ze=>R[Ze.data.id]).map(Ze=>({...Ze.data,...R[Ze.data.id],zenScore:R[Ze.data.id].zenScore}));let Tc=[];if(rn.length>0){w("analyzing");const Ze=rn.map(As=>As.data);Tc=await jw(Ze,Ce),F(As=>{const ma={...As};return Tc.forEach(an=>{ma[an.id]={id:an.id,isRageBait:an.isRageBait,zenScore:an.zenScore,reason:an.reason,timestamp:Date.now()}}),ma})}w("filtering");const k0=new Map;Tc.forEach(Ze=>k0.set(Ze.id,Ze));const _0=it.map(Ze=>{const As=R[Ze.data.id],an=k0.get(Ze.data.id)||As||{isRageBait:!1,zenScore:50,reason:"",id:Ze.data.id},NT=Ce.minZenScore??50,MT=an.zenScore<NT;return{...Ze.data,...an,isRageBait:MT,zenScore:an.zenScore}}),Ac=_0.filter(Ze=>!Ze.isRageBait),L0=_0.length-Ac.length;L0>0&&X(Ze=>Ze+L0),J?(L(Ac),Ht.current&&(Ht.current.scrollTop=0)):L(Ze=>{const As=new Set(Ze.map(an=>an.id)),ma=Ac.filter(an=>!As.has(an.id));return[...Ze,...ma]})}catch(it){it.name!=="AbortError"&&(console.error(it),I(it.message||"Failed to load feed"))}finally{w("idle"),V(!1),jn.current=null}},[t,n,s,f,m,v,B,Ce,R]);P.useEffect(()=>{z(!0)},[t,n,f,m,s,Ce.minZenScore]),P.useEffect(()=>{const J=new IntersectionObserver(Se=>{Se[0].isIntersecting&&U&&C==="idle"&&z(!1,U)},{threshold:.1,rootMargin:"400px"});return sn.current&&J.observe(sn.current),()=>J.disconnect()},[U,C,z]);const Q=(J,Se,Be)=>{l(it=>[...it,{feed:t,sub:n,query:s}]),e(J),i(Se||void 0),r(Be||""),(J==="popular"||J==="all")&&nn("home"),J==="subreddit"&&nn("home")},ue=()=>{Ht.current&&Ht.current.scrollTo({top:0,behavior:"smooth"})},xe=J=>{$(J),fe(Be=>({...Be,[J.id]:Date.now()}));const Se=`/r/${J.subreddit}/comments/${J.id}`;window.history.pushState({postId:J.id},"",Se)},we=()=>{$(null),window.history.state&&window.history.state.postId?window.history.back():window.history.replaceState(null,"","/")},ot=J=>{B.includes(J)||T(Se=>[...Se,J])},Qn=J=>{T(Se=>Se.filter(Be=>Be!==J))},$n=J=>{const Se=J.match(/\/r\/([^/]+)/),Be=Se?Se[1]:null,it=J.match(/\/comments\/([^/]+)/);(it?it[1]:null)&&Be?GR(J).then(rn=>{if(rn){const ha={...rn,isRageBait:!1,zenScore:50};$(ha)}}):Be&&(Q("subreddit",Be),$(null))},Ts=J=>{nn(J),J==="home"?t==="search"&&Q("popular"):J==="explore"?be(!0):J==="settings"&&et(!0)},[_n,Pt]=P.useState(0),Bi=J=>{Ht.current&&Ht.current.scrollTop===0?Xn.current={x:J.touches[0].clientX,y:J.touches[0].clientY}:Xn.current=null},zn=J=>{if(!Xn.current)return;const Be=J.touches[0].clientY-Xn.current.y;Be>0&&Be<200&&Pt(Be)},DT=()=>{_n>80&&z(!0),Pt(0),Xn.current=null};return g.jsxs("div",{className:`flex h-screen w-full bg-stone-100 dark:bg-black transition-colors duration-300 ${te}`,children:[g.jsx("div",{className:"hidden md:flex md:w-64 shrink-0 h-full z-20 relative shadow-xl",children:g.jsx(KR,{currentFeed:t,currentSub:n,onNavigate:Q,followedSubs:B,onFollow:ot,onUnfollow:Qn,theme:te,toggleTheme:()=>ge(J=>J==="light"?"dark":"light"),blockedCount:Y,blockedCommentCount:Z,onOpenSettings:()=>et(!0)})}),g.jsxs("div",{ref:Ht,className:"flex-1 h-full overflow-y-auto overflow-x-hidden relative w-full scroll-smooth no-scrollbar md:custom-scrollbar",id:"main-scroll-container",onTouchStart:Bi,onTouchMove:zn,onTouchEnd:DT,children:[g.jsx("div",{className:"absolute top-0 left-0 right-0 flex justify-center items-center pointer-events-none transition-transform duration-200",style:{transform:`translateY(${_n>0?_n/2:-50}px)`,opacity:_n>0?1:0},children:g.jsx("div",{className:"bg-white dark:bg-stone-800 p-2 rounded-full shadow-lg",children:g.jsx(ZL,{size:20,className:`text-emerald-500 ${_n>80?"animate-spin":""} transition-transform`,style:{transform:`rotate(${_n*2}deg)`}})})}),g.jsxs("div",{className:"max-w-4xl mx-auto pb-24 md:pb-10 pt-safe pl-safe pr-safe min-h-full",children:[g.jsxs("div",{className:"md:hidden sticky top-0 z-30 bg-white/80 dark:bg-stone-950/80 backdrop-blur-lg border-b border-stone-200 dark:border-stone-800 px-4 py-3 flex items-center justify-between mb-4 transition-all",children:[g.jsxs("div",{className:"flex items-center gap-2",onClick:()=>{ue(),t!=="popular"&&Q("popular")},children:[g.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-tr from-emerald-400 to-teal-500 shadow-lg shadow-emerald-500/30 flex items-center justify-center text-white font-bold text-lg",children:"Z"}),g.jsx("span",{className:"font-semibold text-stone-800 dark:text-stone-100 tracking-tight",children:"ZenReddit"})]}),g.jsx("div",{className:"flex items-center gap-2",children:g.jsx("button",{onClick:()=>ge(J=>J==="light"?"dark":"light"),className:"p-2 rounded-full hover:bg-stone-100 dark:hover:bg-stone-800 text-stone-600 dark:text-stone-400",children:te==="light"?g.jsx("div",{className:"w-5 h-5 bg-stone-800 rounded-full"}):g.jsx("div",{className:"w-5 h-5 bg-stone-200 rounded-full"})})})]}),t==="subreddit"&&n&&g.jsx(ZB,{subreddit:n,isFollowed:B.includes(n),onToggleFollow:()=>B.includes(n)?Qn(n):ot(n)}),t==="user"&&n&&g.jsx(JB,{username:n}),g.jsxs("div",{className:"flex items-center justify-between mb-6 px-4 md:px-0",children:[g.jsxs("div",{className:"flex flex-col",children:[g.jsx("h2",{className:"text-xl md:text-2xl font-bold text-stone-800 dark:text-stone-100 capitalize flex items-center gap-2",children:t==="search"?`Results: "${s}"`:t==="subreddit"?`r/${n}`:t==="user"?`u/${n}`:`${t} Posts`}),C!=="idle"&&C!=="fetching"&&g.jsx("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 animate-pulse font-medium",children:C==="analyzing"?"AI is scanning for toxicity...":"Filtering content..."})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-800 rounded-lg p-1 flex items-center gap-1",children:[g.jsx("button",{onClick:()=>p("card"),className:`p-1.5 rounded ${x==="card"?"bg-stone-100 dark:bg-stone-800 text-stone-900 dark:text-stone-100":"text-stone-400 hover:text-stone-600"}`,title:"Card View",children:g.jsx(PL,{size:16})}),g.jsx("button",{onClick:()=>p("compact"),className:`p-1.5 rounded ${x==="compact"?"bg-stone-100 dark:bg-stone-800 text-stone-900 dark:text-stone-100":"text-stone-400 hover:text-stone-600"}`,title:"Compact View",children:g.jsx($L,{size:16})})]}),g.jsxs("div",{className:"relative group z-10",children:[g.jsxs("button",{className:"flex items-center gap-1.5 px-3 py-2 bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-800 rounded-lg text-sm font-medium text-stone-700 dark:text-stone-300 hover:bg-stone-50 dark:hover:bg-stone-800 transition-colors",children:[g.jsx("span",{className:"capitalize",children:f}),g.jsx(qf,{size:14,className:"text-stone-400"})]}),g.jsx("div",{className:"absolute right-0 top-full mt-2 w-32 bg-white dark:bg-stone-900 rounded-xl shadow-lg border border-stone-100 dark:border-stone-800 overflow-hidden opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all transform origin-top-right",children:["hot","new","top","rising"].map(J=>g.jsx("button",{onClick:()=>h(J),className:`w-full text-left px-4 py-2 text-sm hover:bg-stone-50 dark:hover:bg-stone-800 capitalize ${f===J?"text-emerald-600 font-bold":"text-stone-600 dark:text-stone-300"}`,children:J},J))})]}),f==="top"&&g.jsxs("select",{value:m,onChange:J=>y(J.target.value),className:"px-3 py-2 bg-white dark:bg-stone-900 border border-stone-200 dark:border-stone-800 rounded-lg text-sm font-medium text-stone-700 dark:text-stone-300 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 cursor-pointer hover:bg-stone-50 dark:hover:bg-stone-800 transition-colors",children:[g.jsx("option",{value:"hour",children:"Hour"}),g.jsx("option",{value:"day",children:"Day"}),g.jsx("option",{value:"week",children:"Week"}),g.jsx("option",{value:"month",children:"Month"}),g.jsx("option",{value:"year",children:"Year"}),g.jsx("option",{value:"all",children:"All Time"})]})]})]}),A&&g.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center animate-fade-in",children:[g.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-full mb-4",children:g.jsx(pL,{className:"text-red-500",size:32})}),g.jsx("h3",{className:"text-lg font-bold text-stone-800 dark:text-stone-200 mb-2",children:"Something went wrong"}),g.jsx("p",{className:"text-stone-500 dark:text-stone-400 mb-6 max-w-xs",children:A}),g.jsx("button",{onClick:()=>z(!0),className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors shadow-lg shadow-emerald-600/20 active:scale-95",children:"Try Again"})]}),C!=="idle"&&_.length===0&&!A&&g.jsx(kT,{phase:C}),g.jsx("div",{className:"space-y-4 md:space-y-6 columns-1 md:columns-1 lg:columns-1 gap-6 max-w-3xl mx-auto",children:_.map(J=>g.jsx(WB,{minHeight:200,className:"break-inside-avoid",children:g.jsx(Uw,{post:J,isSeen:!!se[J.id],onClick:xe,onNavigateSub:Se=>Q("subreddit",Se),onNavigateUser:Se=>Q("user",Se),onImageClick:(Se,Be)=>j({items:Se,index:Be}),viewMode:x})},J.id))}),C!=="idle"&&_.length>0&&g.jsxs("div",{className:"mt-6 max-w-3xl mx-auto space-y-6",children:[g.jsx(kx,{viewMode:x}),g.jsx(kx,{viewMode:x})]}),!A&&g.jsx("div",{ref:sn,className:"h-20 w-full"}),C==="idle"&&_.length>0&&!U&&g.jsx("div",{className:"text-center py-12 text-stone-400 dark:text-stone-600",children:g.jsx("p",{children:"You've reached the end of zen."})})]})]}),G&&g.jsx(VB,{post:G,onClose:we,onNavigateSub:J=>{$(null),Q("subreddit",J)},onNavigateUser:J=>{$(null),Q("user",J)},textSize:E,aiConfig:Ce,onCommentsBlocked:J=>{le(Se=>Se+J)},onImageClick:(J,Se)=>{j({items:J,index:Se})},onInternalLinkClick:$n}),D&&g.jsx(KB,{items:D.items,initialIndex:D.index,onClose:()=>j(null)}),g.jsx(qB,{isOpen:ft,onClose:()=>et(!1),config:Ce,onSave:Fe,pageSize:v,onPageSizeChange:b,textSize:E,onTextSizeChange:k,blockedCount:Y,blockedCommentCount:Z}),g.jsx(QB,{forceOpen:ae,onClose:()=>{be(!1),ht==="explore"&&nn("home")},followedSubs:B,onNavigate:Q,onFollow:ot,currentFeed:t,currentSub:n}),g.jsx(XB,{isOpen:lt,onClose:()=>Ot(!1)}),g.jsx(eU,{activeTab:ht,onTabChange:Ts,onScrollTop:ue,isScrolled:Ht.current?Ht.current.scrollTop>200:!1})]})},IT=document.getElementById("root");if(!IT)throw new Error("Could not find root element to mount to");const nU=M_.createRoot(IT);nU.render(g.jsx(Ll.StrictMode,{children:g.jsx(tU,{})}));
